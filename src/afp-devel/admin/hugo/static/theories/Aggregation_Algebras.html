<div id="Semigroups_Big">
<div class="head">
<h1>Theory Semigroups_Big</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Big Sum over Finite Sets in Abelian Semigroups
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="comment1">(*  Title:      HOL/Groups_Big.thy
    Author:     Tobias Nipkow
    Author:     Lawrence C Paulson
    Author:     Markus Wenzel
    Author:     Jeremy Avigad
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Big Sum over Finite Sets in Abelian Semigroups›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Semigroups_Big
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory is based on Isabelle/HOL's <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Groups_Big.thy›</span></span></span></span> written by T. Nipkow, L. C. Paulson, M. Wenzel and J. Avigad.
We have generalised a selection of its results from Abelian monoids to Abelian semigroups with an element that is a unit on the image of the semigroup operation.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generic Abelian semigroup operation over a set›</span></span>

<span class="keyword1"><span class="command">locale</span></span> abel_semigroup_set <span class="main">=</span> abel_semigroup <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>1</b></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z_neutral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="free">y</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> comp_fun_commute <span class="quoted"><span class="free">f</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> comp<span class="main">?</span><span class="main">:</span> comp_fun_commute <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> comp_comp_fun_commute<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> eq_fold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Finite_Set.fold <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="Semigroups_Big-infinite"><span class="command">lemma</span></span> infinite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="free">A</span> <span class="main">⟹</span> F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fold<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-empty"><span class="command">lemma</span></span> empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">{}</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fold<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-insert"><span class="command">lemma</span></span> insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> F <span class="free">g</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fold<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-remove"><span class="command">lemma</span></span> remove<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> insert <span class="free">x</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mk_disjoint_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-insert_remove"><span class="command">lemma</span></span> insert_remove<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> F <span class="free">g</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove insert_absorb<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-insert_if"><span class="command">lemma</span></span> insert_if<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> F <span class="free">g</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> F <span class="free">g</span> <span class="free">A</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="free">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-neutral"><span class="command">lemma</span></span> neutral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">⟹</span> F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Semigroups_Big-neutral_const"><span class="command">lemma</span></span> neutral_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neutral<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-F_one"><span class="command">lemma</span></span> F_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">b</span> <span class="bound">B</span><span class="main">.</span> F <span class="bound">f</span> <span class="main">(</span>insert <span class="main">(</span><span class="bound">b</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="bound">B</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">=</span> F <span class="bound">f</span> <span class="main">(</span>insert <span class="bound">b</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∨</span> infinite <span class="bound">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert_remove <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> all_not_in_conv empty z_idem infinite insert_if<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-one_F"><span class="command">lemma</span></span> one_F <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> F_one commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Semigroups_Big-F_g_one"><span class="command">lemma</span></span> F_g_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_F assoc insert<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-union_inter"><span class="command">lemma</span></span> union_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">B</span>"</span></span>
  <span class="comment1">― ‹The reversed orientation looks more natural, but LOOPS as a simprule!›</span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_absorb Int_insert_left commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span> assoc left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> union_inter_neutral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_inter <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> neutral<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> union_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_inter_neutral<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-union_diff2"><span class="command">lemma</span></span> union_diff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">subst</span> union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-subset_diff"><span class="command">lemma</span></span> subset_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-setdiff_irrelevant"><span class="command">lemma</span></span> setdiff_irrelevant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_Diff_if<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-not_neutral_contains_not_neutral"><span class="command">lemma</span></span> not_neutral_contains_not_neutral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">≠</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">a</span> <span class="main">≠</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> infinite
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-reindex"><span class="command">lemma</span></span> reindex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">h</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fold fold_image comp_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_imageD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-cong"><span class="command">lemma</span></span> cong <span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> g_h <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Semigroups_Big-strong_cong"><span class="command">lemma</span></span> strong_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="keyword1">=simp=&gt;</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> simp_implies_def›</span><span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-reindex_cong"><span class="command">lemma</span></span> reindex_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">l</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">l</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">l</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reindex<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-UNION_disjoint"><span class="command">lemma</span></span> UNION_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> finite <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="improper">Fa</span><span class="main">.</span> <span class="improper">x</span> <span class="main">≠</span> <span class="bound">i</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="improper">x</span> <span class="main">∩</span> <span class="main">⋃</span><span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="improper">Fa</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Semigroups_Big-Union_disjoint"><span class="command">lemma</span></span> Union_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> finite <span class="bound">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="main">⋃</span><span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>F <span class="main">∘</span> F<span class="main">)</span> <span class="free">g</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> UNION_disjoint <span class="main">[</span><span class="operator">OF</span> this assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_UnionD <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> infinite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-distrib"><span class="command">lemma</span></span> distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">h</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assoc commute left_commute<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-Sigma"><span class="command">lemma</span></span> Sigma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> finite <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> F <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="main">(</span>case_prod <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Sigma_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> UNION_disjoint<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> UNION_disjoint<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Semigroups_Big-related"><span class="command">lemma</span></span> related<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Re<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Rop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">y1</span> <span class="bound">x2</span> <span class="bound">y2</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">y1</span> <span class="bound">y2</span> <span class="main">⟶</span> <span class="free">R</span> <span class="main">(</span><span class="bound">x1</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="bound">y1</span><span class="main">)</span> <span class="main">(</span><span class="bound">x2</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="bound">y2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> R_h_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>F <span class="free">h</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>F <span class="free">g</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset_induct<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-mono_neutral_cong_left"><span class="command">lemma</span></span> mono_neutral_cong_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">.</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> <span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">T</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_disjoint <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f d<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> eq <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">symmetric</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> neutral <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-mono_neutral_cong_right"><span class="command">lemma</span></span> mono_neutral_cong_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">T</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
    F <span class="free">g</span> <span class="free">T</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mono_neutral_cong_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-mono_neutral_left"><span class="command">lemma</span></span> mono_neutral_left<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">⟹</span> F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mono_neutral_cong_left<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-mono_neutral_right"><span class="command">lemma</span></span> mono_neutral_right<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="main">⟹</span> F <span class="free">g</span> <span class="free">T</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mono_neutral_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-mono_neutral_cong"><span class="command">lemma</span></span> mono_neutral_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∩</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mono_neutral_right<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> F <span class="free">h</span> <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> refl gh <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mono_neutral_left<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-reindex_bij_betw"><span class="command">lemma</span></span> reindex_bij_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">h</span> <span class="free">S</span> <span class="free">T</span> <span class="main">⟹</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def reindex<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-reindex_bij_witness"><span class="command">lemma</span></span> reindex_bij_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> witness<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">j</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">(</span><span class="free">i</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">i</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">(</span><span class="free">j</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">j</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_byWitness<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span><span class="main">]</span> witness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="free">j</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reindex_bij_betw<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-reindex_bij_betw_not_neutral"><span class="command">lemma</span></span> reindex_bij_betw_not_neutral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S'</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">h</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">S'</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="free">T'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nn<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S'</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">T'</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟷</span> finite <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_finite<span class="main">[</span><span class="operator">OF</span> bij<span class="main">]</span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> nn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_neutral_cong_right<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="free">T'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reindex_bij_betw<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nn <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_neutral_cong_left<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-reindex_nontrivial"><span class="command">lemma</span></span> reindex_nontrivial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> reindex_bij_betw_not_neutral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">h</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="free">A</span> <span class="main">-</span> <span class="free">h</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-reindex_bij_witness_not_neutral"><span class="command">lemma</span></span> reindex_bij_witness_not_neutral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S'</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> witness<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">S'</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">S'</span> <span class="main">⟹</span> <span class="free">j</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">T'</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">T'</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">(</span><span class="free">i</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">T'</span> <span class="main">⟹</span> <span class="free">i</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">S'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nn<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S'</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">T'</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">(</span><span class="free">j</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">j</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">(</span><span class="free">S'</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="main">(</span><span class="free">T'</span> <span class="main">∩</span> <span class="free">T</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> witness <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="free">j</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">using</span></span> fin nn eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> reindex_bij_betw_not_neutral<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ bij<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-delta_remove"><span class="command">lemma</span></span> delta_remove<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="free">c</span> <span class="bound">k</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="free">a</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">c</span> <span class="main">(</span><span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> F <span class="free">c</span> <span class="main">(</span><span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="free">c</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">c</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> dj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∩</span> <span class="var">?B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> fS <span class="keyword1"><span class="command">have</span></span> fAB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="var">?f</span> <span class="free">S</span> <span class="main">=</span> F <span class="var">?f</span> <span class="var">?A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="var">?f</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> union_disjoint <span class="main">[</span><span class="operator">OF</span> fAB dj<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> abel_semigroup_set.remove abel_semigroup_set_axioms fS <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-delta"><span class="command">lemma</span></span> delta <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="free">a</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delta_remove <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-delta'"><span class="command">lemma</span></span> delta' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="free">a</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> delta <span class="main">[</span><span class="operator">OF</span> fin<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cong<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-If_cases"><span class="command">lemma</span></span> If_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">h</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">h</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">h</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> union_disjoint <span class="main">[</span><span class="operator">OF</span> f a<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">]</span> a<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> cong<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-cartesian_product"><span class="command">lemma</span></span> cartesian_product<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> F <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">B</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="main">(</span>case_prod <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sigma<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> infinite <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_cartesian_productD2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> infinite <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_cartesian_productD1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Semigroups_Big-inter_restrict"><span class="command">lemma</span></span> inter_restrict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span> <span class="main">-</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="var">?g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="var">?g</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_neutral_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-inter_filter"><span class="command">lemma</span></span> inter_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> F <span class="free">g</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_restrict <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> mem_Collect_eq<span class="main"><span class="main">]</span></span> Int_def<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-Union_comp"><span class="command">lemma</span></span> Union_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> finite <span class="bound">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A1</span> <span class="bound">A2</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">A1</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">A2</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">A1</span> <span class="main">≠</span> <span class="bound">A2</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A2</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="main">⋃</span><span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>F <span class="main">∘</span> F<span class="main">)</span> <span class="free">g</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite <span class="main">(</span><span class="main">⋃</span><span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_UnionD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> infinite <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">∩</span> <span class="main">⋃</span><span class="skolem">B</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>F <span class="main">∘</span> F<span class="main">)</span> <span class="free">g</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">⋃</span><span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> F <span class="free">g</span> <span class="skolem">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_inter_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∉</span> <span class="skolem">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-swap"><span class="command">lemma</span></span> swap<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> F <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="free">B</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cartesian_product
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reindex_bij_witness <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Semigroups_Big-swap_restrict"><span class="command">lemma</span></span> swap_restrict<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="free">B</span> <span class="main">⟹</span>
    F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> F <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_filter<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> swap<span class="main">)</span>

<span class="keyword1" id="Semigroups_Big-Plus"><span class="command">lemma</span></span> Plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">&lt;+&gt;</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> Inl<span class="main">)</span> <span class="free">A</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> Inr<span class="main">)</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;+&gt;</span> <span class="free">B</span> <span class="main">=</span> Inl <span class="main">`</span> <span class="free">A</span> <span class="main">∪</span> Inr <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Inl <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Inr <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">`</span> <span class="free">A</span> <span class="main">∩</span> Inr <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on Inl <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on Inr <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_disjoint reindex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-same_carrier"><span class="command">lemma</span></span> same_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">b</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">B</span> <span class="main">⟷</span> F <span class="free">g</span> <span class="free">C</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">C</span>›</span></span> subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> subset <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subset <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">-</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">C</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> union_diff2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">C</span> <span class="main">=</span> F <span class="free">g</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">h</span> <span class="free">C</span> <span class="main">=</span> F <span class="free">h</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> F <span class="free">h</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">h</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>*</b></span></span> F <span class="free">h</span> <span class="main">(</span><span class="free">B</span> <span class="main">∩</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> union_diff2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">h</span> <span class="free">C</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-same_carrierI"><span class="command">lemma</span></span> same_carrierI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">b</span> <span class="main">=</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>1</b></span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">C</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">g</span> <span class="free">A</span> <span class="main">=</span> F <span class="free">h</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms same_carrier <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalized summation over a set›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> Sum <span class="main">(</span><span class="quoted">"<span class="keyword1">∑</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> ab_semigroup_add_0 <span class="main">=</span> zero <span class="main">+</span> ab_semigroup_add <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_neutral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sum_0<span class="main">:</span> abel_semigroup_set <span class="quoted">plus</span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> sum_0 <span class="main">=</span> <span class="quoted">sum_0.F</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Sum_0</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∑</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∑</span></span> <span class="main">≡</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_monoid_add
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> ab_semigroup_add_0
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now: lots of fancy syntax. First, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">e</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is written <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∑x∈A. e›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_sum"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>comm_monoid_add"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">SUM</span> <span class="keyword3">(</span>_<span class="keyword3">/</span><span class="keyword1">:</span>_<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 51<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_sum"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>comm_monoid_add"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span><span class="keyword1">∑</span><span class="keyword3">(</span>_<span class="keyword3">/</span><span class="keyword1">∈</span>_<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 51<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="comment1">― ‹Beware of argument permutation!›</span>
  <span class="quoted">"<span class="main">∑</span><span class="free">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">b</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="free">i</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="free">A</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Instead of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">∑</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">∈</span></span><span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">e</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> we introduce the shorter <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∑x|P. e›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_qsum"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> bool <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">SUM</span> _ <span class="keyword1">|</span><span class="keyword3">/ </span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_qsum"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> bool <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span><span class="keyword1">∑</span>_ <span class="keyword1">|</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">∑</span><span class="free">x</span><span class="main">|</span><span class="free">P</span><span class="main">.</span> <span class="free">t</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">t</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">}</span>"</span>

<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sum_tr'</span> <span class="main">[</span>Abs <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">Tx</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">,</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> Collect<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ Abs <span class="main">(</span><span class="entity">y</span><span class="main">,</span> <span class="entity">Ty</span><span class="main">,</span> <span class="entity">P</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">x</span> &lt;&gt; <span class="entity">y</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Match
        <span class="keyword2"><span class="keyword">else</span></span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">x'</span> <span class="main">=</span> Syntax_Trans.mark_bound_body <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">Tx</span><span class="main">)</span><span class="main">;</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t'</span> <span class="main">=</span> subst_bound <span class="main">(</span><span class="entity">x'</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">;</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">P'</span> <span class="main">=</span> subst_bound <span class="main">(</span><span class="entity">x'</span><span class="main">,</span> <span class="entity">P</span><span class="main">)</span><span class="main">;</span>
          <span class="keyword2"><span class="keyword">in</span></span>
            Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_qsum"<span class="antiquote">}</span></span> $ Syntax_Trans.mark_bound_abs <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">Tx</span><span class="main">)</span> $ <span class="entity">P'</span> $ <span class="entity">t'</span>
          <span class="keyword2"><span class="keyword">end</span></span>
    <span class="main">|</span> <span class="entity">sum_tr'</span> <span class="main">_</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> Match<span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> sum_0<span class="antiquote">}</span></span><span class="main">,</span> K <span class="entity">sum_tr'</span><span class="main">)</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ab_semigroup_add_0<span class="main">)</span> sum_image_gen_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span> <span class="free">f</span><span class="main">`</span><span class="free">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">g</span> <span class="free">S</span> <span class="main">=</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span> <span class="free">f</span><span class="main">`</span><span class="free">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_0.swap_restrict <span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin finite_imageI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties in more restricted classes of structures›</span></span>

<span class="keyword1" id="Semigroups_Big-sum_Un2"><span class="command">lemma</span></span> sum_Un2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> sum_0 <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> sum_0 <span class="free">f</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> sum_0 <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">subst</span> sum_0.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">class</span></span> ordered_ab_semigroup_add_0 <span class="main">=</span> ab_semigroup_add_0 <span class="main">+</span> ordered_ab_semigroup_add
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Semigroups_Big-add_nonneg_nonneg"><span class="command">lemma</span></span> add_nonneg_nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Semigroups_Big-add_nonpos_nonpos"><span class="command">lemma</span></span> add_nonpos_nonpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ordered_ab_semigroup_add_0<span class="main">)</span> sum_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">K</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">K</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> add_mono <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ordered_ab_semigroup_add_0<span class="main">)</span> sum_mono_00<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">K</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">K</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> sum_0 <span class="free">f</span> <span class="skolem">F</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bb</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">f</span> <span class="skolem">bb</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">bb</span> <span class="main">+</span> <span class="main">0</span> <span class="main">∨</span> sum_0 <span class="free">f</span> <span class="skolem">F</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">0</span> <span class="main">+</span> <span class="bound">a</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">0</span> <span class="main">+</span> <span class="bound">aa</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">aa</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f5 a4 a2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_assoc insert_iff sum_0.insert sum_0.one_F<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ordered_ab_semigroup_add_0<span class="main">)</span> sum_mono_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">K</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono_00<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_mono zero_neutral<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> ordered_ab_semigroup_add_0
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Semigroups_Big-sum_nonneg"><span class="command">lemma</span></span> sum_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> sum_0 <span class="free">f</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> infinite
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> sum_0 <span class="free">f</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-sum_nonpos"><span class="command">lemma</span></span> sum_nonpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> sum_0 <span class="free">f</span> <span class="free">A</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> infinite
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> sum_0 <span class="free">f</span> <span class="skolem">F</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-sum_mono2"><span class="command">lemma</span></span> sum_mono2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">-</span><span class="free">A</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="free">A</span> <span class="main">≤</span> sum_0 <span class="free">f</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="free">A</span> <span class="main">≤</span> sum_0 <span class="free">f</span> <span class="free">A</span> <span class="main">+</span> sum_0 <span class="free">f</span> <span class="main">(</span><span class="free">B</span><span class="main">-</span><span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_left_mono sum_0.F_one nn sum_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin finite_subset<span class="main">[</span><span class="operator">OF</span> sub fin<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_0 <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_0.union_disjoint <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_Diff_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semigroups_Big-sum_le_included"><span class="command">lemma</span></span> sum_le_included<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">t</span><span class="main">.</span> <span class="free">i</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="free">s</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="free">s</span> <span class="main">≤</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">t</span> <span class="main">∧</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono_0<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">i</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="skolem">z</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_eq_empty_iff add_commute finite.simps add_left_mono sum_0.empty sum_0.insert_remove subset_insertI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">t</span><span class="main">.</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">t</span><span class="main">.</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sum_0 <span class="free">g</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">t</span> <span class="main">∧</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">`</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_mono2 sum_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum_0 <span class="free">g</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_image_gen_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Semigroups_Big-sum_comp_morphism"><span class="command">lemma</span></span> sum_comp_morphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> sum_0 <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span>sum_0 <span class="free">g</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Semigroups_Big-sum_cong_Suc"><span class="command">lemma</span></span> sum_cong_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Suc <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_0 <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> sum_0 <span class="free">g</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_0.cong<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Aggregation_Algebras">
<div class="head">
<h1>Theory Aggregation_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Algebras for Aggregation and Minimisation
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algebras for Aggregation and Minimisation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory gives algebras with operations for aggregation and minimisation.
In the weighted-graph model of matrices over (extended) numbers, the operations have the following meaning.
The binary operation $+$ adds the weights of corresponding edges of two graphs.
Addition does not have to be the standard addition on numbers, but can be any aggregation satisfying certain basic properties as demonstrated by various models of the algebras in another theory.
The unary operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum›</span></span></span></span> adds the weights of all edges of a graph.
The result is a single aggregated weight using the same aggregation as $+$ but applied internally to the edges of a single graph.
The unary operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc›</span></span></span></span> finds an edge with a minimal weight in a graph.
It yields the position of such an edge as a regular element of a Stone relation algebra.

We give axioms for these operations which are sufficient to prove the correctness of Prim's and Kruskal's minimum spanning tree algorithms.
The operations have been proposed and axiomatised first in \cite{Guttmann2016c} with simplified axioms given in \cite{Guttmann2018a}.
The present version adds two axioms to prove total correctness of the spanning tree algorithms as discussed in \cite{Guttmann2018b}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Aggregation_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Stone_Kleene_Relation_Algebras/Kleene_Relation_Algebras.html">Stone_Kleene_Relation_Algebras.Kleene_Relation_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> sup
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> plus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first introduce s-algebras as a class with the operations $+$ and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum›</span></span></span></span>.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum_plus_right_isotone›</span></span></span></span> states that for non-empty graphs, the operation $+$ is $\leq$-isotone in its second argument on the image of the aggregation operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum›</span></span></span></span>.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum_bot›</span></span></span></span> expresses that the empty graph contributes no weight.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum_plus›</span></span></span></span> generalises the inclusion-exclusion principle to sets of weights.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum_conv›</span></span></span></span> specifies that reversing edge directions does not change the aggregated weight.
In instances of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s_algebra›</span></span></span></span>, aggregated weights can be partially ordered.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> sum <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">sum</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> s_algebra <span class="main">=</span> stone_relation_algebra <span class="main">+</span> plus <span class="main">+</span> sum <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum_plus_right_isotone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">∧</span> sum <span class="free">x</span> <span class="main">≤</span> sum <span class="free">y</span> <span class="main">⟶</span> sum <span class="free">z</span> <span class="main">+</span> sum <span class="free">x</span> <span class="main">≤</span> sum <span class="free">z</span> <span class="main">+</span> sum <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">x</span> <span class="main">+</span> sum bot <span class="main">=</span> sum <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">x</span> <span class="main">+</span> sum <span class="free">y</span> <span class="main">=</span> sum <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> sum <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Aggregation_Algebras-sum_disjoint"><span class="command">lemma</span></span> sum_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_plus<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> assms inf.sup_monoid.add_assoc inf.sup_monoid.add_commute inf_bot_left inf_sup_distrib2 sum_bot<span class="main">)</span>

<span class="keyword1" id="Aggregation_Algebras-sum_disjoint_3"><span class="command">lemma</span></span> sum_disjoint_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf_sup_distrib2 sup_idem sum_disjoint<span class="main">)</span>

<span class="keyword1" id="Aggregation_Algebras-sum_symmetric"><span class="command">lemma</span></span> sum_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms sum_conv conv_dist_inf<span class="main">)</span>

<span class="keyword1" id="Aggregation_Algebras-sum_commute"><span class="command">lemma</span></span> sum_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum <span class="free">x</span> <span class="main">+</span> sum <span class="free">y</span> <span class="main">=</span> sum <span class="free">y</span> <span class="main">+</span> sum <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute sum_plus sup_commute<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We next introduce the operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc›</span></span></span></span>.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc_below›</span></span></span></span> expresses that the result of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc›</span></span></span></span> is contained in the graph ignoring the weights.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc_arc›</span></span></span></span> states that the result of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc›</span></span></span></span> is a single unweighted edge if the graph is not empty.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc_min›</span></span></span></span> specifies that any edge in the graph weighs at least as much as the edge at the position indicated by the result of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc›</span></span></span></span>, where weights of edges between different nodes are compared by applying the operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum›</span></span></span></span> to single-edge graphs.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum_linear›</span></span></span></span> requires that aggregated weights are linearly ordered, which is necessary for both Prim's and Kruskal's minimum spanning tree algorithms.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>finite_regular›</span></span></span></span> ensures that there are only finitely many unweighted graphs, and therefore only finitely many edges and nodes in a graph; again this is necessary for the minimum spanning tree algorithms we consider.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> minarc <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">minarc</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> m_algebra <span class="main">=</span> s_algebra <span class="main">+</span> minarc <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> minarc_below<span class="main">:</span> <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> minarc_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟶</span> arc <span class="main">(</span>minarc <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> minarc_min<span class="main">:</span> <span class="quoted"><span class="quoted">"arc <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟶</span> sum <span class="main">(</span>minarc <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum_linear<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">x</span> <span class="main">≤</span> sum <span class="free">y</span> <span class="main">∨</span> sum <span class="free">y</span> <span class="main">≤</span> sum <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_regular<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> regular <span class="bound">x</span> <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Axioms <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc_below›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minarc_arc›</span></span></span></span> suffice to derive the Tarski rule in Stone relation algebras.
›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> stone_relation_algebra_tarski
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"minarc <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arc <span class="var">?a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minarc_arc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">=</span> top <span class="main">*</span> <span class="var">?a</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minarc_below mult_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Aggregation_Algebras-minarc_bot"><span class="command">lemma</span></span> minarc_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"minarc bot <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_unique minarc_below regular_closed_bot<span class="main">)</span>

<span class="keyword1" id="Aggregation_Algebras-minarc_bot_iff"><span class="command">lemma</span></span> minarc_bot_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> covector_bot_closed inf_bot_right minarc_arc vector_bot_closed minarc_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Aggregation_Algebras-minarc_meet_bot"><span class="command">lemma</span></span> minarc_meet_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minarc_below inf_absorb1 inf_import_p inf_p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Aggregation_Algebras-minarc_meet_bot_minarc_iff"><span class="command">lemma</span></span> minarc_meet_bot_minarc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> bot <span class="main">⟷</span> minarc <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_inf.semiring.mult_not_zero minarc_meet_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Aggregation_Algebras-minarc_meet_bot_iff"><span class="command">lemma</span></span> minarc_meet_bot_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"minarc <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_bot_right minarc_bot_iff minarc_meet_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Aggregation_Algebras-minarc_regular"><span class="command">lemma</span></span> minarc_regular<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="main">(</span>minarc <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> bot"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minarc_bot<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_regular minarc_arc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Aggregation_Algebras-minarc_selection"><span class="command">lemma</span></span> minarc_selection<span class="main">:</span>
  <span class="quoted"><span class="quoted">"selection <span class="main">(</span>minarc <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_assoc minarc_regular selection_closed_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Aggregation_Algebras-minarc_below_regular"><span class="command">lemma</span></span> minarc_below_regular<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> minarc <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minarc_below<span class="main">)</span>

<span class="comment1">(*
lemma sum_bot: "sum bot = bot" nitpick [expect=genuine] oops
lemma plus_bot: "x + bot = x" nitpick [expect=genuine] oops
lemma "sum x = bot ⟶ x = bot" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> m_kleene_algebra <span class="main">=</span> m_algebra <span class="main">+</span> stone_kleene_relation_algebra

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Matrix_Aggregation_Algebras">
<div class="head">
<h1>Theory Matrix_Aggregation_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Matrix Algebras for Aggregation and Minimisation
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Matrix Algebras for Aggregation and Minimisation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory formalises aggregation orders and lattices as introduced in \cite{Guttmann2018a}.
Aggregation in these algebras is an associative and commutative operation satisfying additional properties related to the partial order and its least element.
We apply the aggregation operation to finite matrices over the aggregation algebras, which shows that they form an s-algebra.
By requiring the aggregation algebras to be linearly ordered, we also obtain that the matrices form an m-algebra.

This is an intermediate step in demonstrating that weighted graphs form an s-algebra and an m-algebra.
The present theory specifies abstract properties for the edge weights and shows that matrices over such weights form an instance of s-algebras and m-algebras.
A second step taken in a separate theory gives concrete instances of edge weights satisfying the abstract properties introduced here.

Lifting the aggregation to matrices requires finite sums over elements taken from commutative semigroups with an element that is a unit on the image of the semigroup operation.
Because standard sums assume a commutative monoid we have to derive a number of properties of these generalised sums as their statements or proofs are different.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Matrix_Aggregation_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Stone_Kleene_Relation_Algebras/Matrix_Kleene_Algebras.html">Stone_Kleene_Relation_Algebras.Matrix_Kleene_Algebras</a> <a href="Aggregation_Algebras.html">Aggregation_Algebras</a> <a href="Semigroups_Big.html">Semigroups_Big</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Aggregation Orders and Finite Sums›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An aggregation order is a partial order with a least element and an associative commutative operation satisfying certain properties.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>add_add_bot›</span></span></span></span> introduces almost a commutative monoid; we require that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span> is a unit only on the image of the aggregation operation.
This is necessary since it is not a unit of a number of aggregation operations we are interested in.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>add_right_isotone›</span></span></span></span> states that aggregation is $\leq$-isotone on the image of the aggregation operation.
Its assumption $x \neq bot$ is necessary because the introduction of new edges can decrease the aggregated value.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>add_bot›</span></span></span></span> expresses that aggregation is zero-sum-free.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> aggregation_order <span class="main">=</span> order_bot <span class="main">+</span> ab_semigroup_add <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_right_isotone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="free">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_add_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero</span> <span class="main">≡</span> bot <span class="main">+</span> bot"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> aggregation<span class="main">:</span> ab_semigroup_add_0 <span class="keyword2"><span class="keyword">where</span></span> plus <span class="main">=</span> <span class="quoted">plus</span> <span class="keyword2"><span class="keyword">and</span></span> zero <span class="main">=</span> <span class="quoted">zero</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> add_assoc add_add_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-add_bot_bot_bot"><span class="command">lemma</span></span> add_bot_bot_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> bot <span class="main">+</span> bot <span class="main">+</span> bot <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We introduce notation for finite sums over aggregation orders.
The index variable of the summation ranges over the finite universe of its type.
Finite sums are defined recursively using the binary aggregation and $\bot + \bot$ for the empty sum.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>xsymbols<span class="main">)</span>
  <span class="quoted">"_sum_ab_semigroup_add_0"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>bounded_semilattice_sup_bot <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">∑⇩</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">∑⇩</span><span class="free">x</span> <span class="free">t</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">XCONST</span> ab_semigroup_add_0.sum_0 <span class="keyword1">XCONST</span> plus <span class="main">(</span><span class="keyword1">XCONST</span> plus <span class="keyword1">XCONST</span> bot <span class="keyword1">XCONST</span> bot<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="main">.</span> <span class="free">t</span><span class="main">)</span> <span class="main">{</span> <span class="free">x</span> <span class="main">.</span> <span class="keyword1">CONST</span> True <span class="main">}</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following are basic properties of such sums.
›</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_bot"><span class="command">lemma</span></span> agg_sum_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> bot<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>aggregation_order<span class="main">)</span> <span class="main">=</span> bot <span class="main">+</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add_add_bot aggregation.sum_0.insert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_bot_bot"><span class="command">lemma</span></span> agg_sum_bot_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> bot <span class="main">+</span> bot<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>aggregation_order<span class="main">)</span> <span class="main">=</span> bot <span class="main">+</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aggregation.sum_0.neutral_const<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_not_bot_1"><span class="command">lemma</span></span> agg_sum_not_bot_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>aggregation_order"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms add_bot aggregation.sum_0.remove finite_code mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_not_bot"><span class="command">lemma</span></span> agg_sum_not_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms agg_sum_not_bot_1<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_distrib"><span class="command">lemma</span></span> agg_sum_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>aggregation_order"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aggregation.sum_0.distrib<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_distrib_2"><span class="command">lemma</span></span> agg_sum_distrib_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> aggregation.sum_0.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> aggregation.sum_0.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_add_bot"><span class="command">lemma</span></span> agg_sum_add_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>aggregation_order"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_add_bot aggregation.sum_0.F_one<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_add_bot_2"><span class="command">lemma</span></span> agg_sum_add_bot_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>aggregation_order"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> bot<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> bot<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span><span class="main">::</span><span class="tfree">'a</span> bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agg_sum_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>bot <span class="main">+</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> agg_sum_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_sum_commute"><span class="command">lemma</span></span> agg_sum_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aggregation.sum_0.swap<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_delta"><span class="command">lemma</span></span> agg_delta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>aggregation_order"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">l</span> <span class="keyword1">else</span> zero<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">j</span> <span class="main">+</span> bot"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> aggregation.sum_0.delta<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute add_add_bot mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_delta_1"><span class="command">lemma</span></span> agg_delta_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>aggregation_order"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">l</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">j</span> <span class="main">+</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">l</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">l</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> dj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∩</span> <span class="var">?B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> fAB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aggregation.sum_0 <span class="var">?f</span> <span class="var">?S</span> <span class="main">=</span> aggregation.sum_0 <span class="var">?f</span> <span class="var">?A</span> <span class="main">+</span> aggregation.sum_0 <span class="var">?f</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aggregation.sum_0.union_disjoint<span class="main">[</span><span class="operator">OF</span> fAB dj<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> aggregation.sum_0 <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="main">.</span> bot<span class="main">)</span> <span class="var">?A</span> <span class="main">+</span> aggregation.sum_0 <span class="var">?f</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> aggregation.sum_0.cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?B</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?A</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> zero <span class="main">+</span> aggregation.sum_0 <span class="var">?f</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.commute add_add_bot aggregation.sum_0.F_g_one aggregation.sum_0.neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> zero <span class="main">+</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span> <span class="main">+</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="free">j</span> <span class="main">+</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute add_add_bot<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_delta_2"><span class="command">lemma</span></span> agg_delta_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span> bot <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">+</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> agg_delta_1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span> bot <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span> bot <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aggregation.sum_0.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> agg_delta<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Matrix Aggregation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definitions introduce the matrix of unit elements, componentwise aggregation and aggregation on matrices.
The aggregation of a matrix is a single value, but because s-algebras are single-sorted the result has to be encoded as a matrix of the same type (size) as the input.
We store the aggregated matrix value in the `first' entry of a matrix, setting all other entries to the unit value.
The first entry is determined by requiring an enumeration of indices.
It does not have to be the first entry; any fixed location in the matrix would work as well.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>bot<span class="main">}</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">mzero</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">mzero</span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> bot <span class="main">+</span> bot<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">plus_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>plus<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_matrix</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sum_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>bot<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> _"</span> <span class="main">[</span>80<span class="main">]</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sum_matrix</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> hd enum_class.enum <span class="main">∧</span> <span class="bound">j</span> <span class="main">=</span> <span class="bound">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot <span class="main">+</span> bot<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Basic properties of these operations are given in the following.
›</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-bot_plus_bot"><span class="command">lemma</span></span> bot_plus_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">mbot</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">=</span> <span class="keyword1">mzero</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def bot_matrix_def zero_matrix_def<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-sum_bot"><span class="command">lemma</span></span> sum_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">mbot</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square<span class="main">)</span> <span class="main">=</span> <span class="keyword1">mzero</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square<span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> hd enum_class.enum <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="main">(</span><span class="bound"><span class="bound">k</span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∑⇩</span><span class="main">(</span><span class="bound"><span class="bound">l</span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> bot <span class="keyword1">else</span> bot <span class="main">+</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sum_matrix_def bot_matrix_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agg_sum_bot aggregation.sum_0.neutral <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mzero</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square<span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mzero</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-sum_plus_bot"><span class="command">lemma</span></span> sum_plus_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">=</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bot <span class="keyword1">else</span> zero <span class="main">+</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def bot_matrix_def sum_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_add_bot aggregation.sum_0.F_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-sum_plus_zero"><span class="command">lemma</span></span> sum_plus_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mzero</span> <span class="main">=</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def zero_matrix_def sum_matrix_def<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-agg_matrix_bot"><span class="command">lemma</span></span> agg_matrix_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bot_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We consider a different implementation of matrix aggregation which stores the aggregated value in all entries of the matrix instead of a particular one.
This does not require an enumeration of the indices.
All results continue to hold using this alternative implementation.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sum_matrix_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>bot<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> _"</span> <span class="main">[</span>80<span class="main">]</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sum_matrix_2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-sum_bot_2"><span class="command">lemma</span></span> sum_bot_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">mbot</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square<span class="main">)</span> <span class="main">=</span> <span class="keyword1">mzero</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square<span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="main">(</span><span class="bound"><span class="bound">k</span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∑⇩</span><span class="main">(</span><span class="bound"><span class="bound">l</span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sum_matrix_2_def bot_matrix_def<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agg_sum_bot aggregation.sum_0.neutral <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mzero</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square<span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="keyword1">mzero</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-sum_plus_bot_2"><span class="command">lemma</span></span> sum_plus_bot_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">=</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def bot_matrix_def sum_matrix_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_add_bot aggregation.sum_0.F_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-sum_plus_zero_2"><span class="command">lemma</span></span> sum_plus_zero_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_order<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mzero</span> <span class="main">=</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def zero_matrix_def sum_matrix_2_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Aggregation Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We extend aggregation orders to dense bounded distributive lattices.
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>add_lattice›</span></span></span></span> implements the inclusion-exclusion principle at the level of edge weights.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> aggregation_lattice <span class="main">=</span> bounded_distrib_lattice <span class="main">+</span> dense_lattice <span class="main">+</span> aggregation_order <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_lattice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Aggregation lattices form a Stone relation algebra by reusing the meet operation as composition, using identity as converse and a standard implementation of pseudocomplement.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> aggregation_algebra <span class="main">=</span> aggregation_lattice <span class="main">+</span> uminus <span class="main">+</span> one <span class="main">+</span> times <span class="main">+</span> conv <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uminus_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> top"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> times_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> stone_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> bot_meet_irreducible bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subclass</span></span> stone_relation_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 9 <span class="keyword1"><span class="command">using</span></span> bot_meet_irreducible <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc le_infI2 inf_sup_distrib1 inf_sup_distrib2 inf.commute inf.left_commute<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show that matrices over aggregation lattices form an s-algebra using the above operations.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> agg_square_s_algebra<span class="main">:</span> s_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">plus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> sum <span class="main">=</span> <span class="quoted">sum_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">∧</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">⟶</span> <span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">∧</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> agg_matrix_bot<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agg_sum_not_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_add_bot aggregation.sum_0.F_one<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> plus_matrix_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_right_isotone add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> zero<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> zero<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 inf.eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">=</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_bot sum_plus_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">=</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agg_sum_distrib_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_lattice aggregation.sum_0.cong <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def inf_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agg_sum_distrib_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> zero<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> agg_sum_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show the same for the alternative implementation that stores the result of aggregation in all elements of the matrix.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> agg_square_s_algebra_2<span class="main">:</span> s_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>aggregation_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">plus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> sum <span class="main">=</span> <span class="quoted">sum_matrix_2</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">∧</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">⟶</span> <span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">∧</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> agg_matrix_bot<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agg_sum_not_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted">True</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_add_bot aggregation.sum_0.F_one<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="skolem">h</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> plus_matrix_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">h</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_right_isotone add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">mbot</span> <span class="main">=</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_bot_2 sum_plus_zero_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">=</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agg_sum_distrib_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_lattice aggregation.sum_0.cong <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def inf_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agg_sum_distrib_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>M</sub></span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> agg_sum_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Matrix Minimisation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We construct an operation that finds the minimum entry of a matrix.
Because a matrix can have several entries with the same minimum value, we introduce a lexicographic order on the indices to make the operation deterministic.
The order is obtained by enumerating the universe of the index.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">enum_pos'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>enum <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">enum_pos'</span> Nil <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">enum_pos'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">+</span> <span class="free">enum_pos'</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-enum_pos'_inverse"><span class="command">lemma</span></span> enum_pos'_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"List.member <span class="free">xs</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="main">(</span>enum_pos' <span class="free">xs</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_add_inverse enum_pos'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_one member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_add_less1 nth_Cons'<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following function finds the position of an index in the enumerated universe.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">enum_pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>enum <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum_pos</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> enum_pos' <span class="main">(</span>enum_class.enum<span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-enum_pos_inverse"><span class="command">lemma</span></span> enum_pos_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"enum_class.enum<span class="main">!</span><span class="main">(</span>enum_pos <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> enum_pos.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> enum_pos'_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_enum List.member_def<span class="main">)</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-enum_pos_injective"><span class="command">lemma</span></span> enum_pos_injective <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"enum_pos <span class="free">x</span> <span class="main">=</span> enum_pos <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enum_pos_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The position in the enumerated universe determines the order.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">enum_pos_less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>enum <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum_pos_less_eq</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span>enum_pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> enum_pos <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">enum_pos_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>enum <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum_pos_less</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span>enum_pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> enum_pos <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> enum <span class="main">&lt;</span> enum_order<span class="main">:</span> order <span class="keyword2"><span class="keyword">where</span></span> less_eq <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> enum_pos_less_eq <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> enum_pos <span class="bound">x</span> <span class="main">&lt;</span> enum_pos <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Based on this, a lexicographic order is defined on pairs, which represent locations in a matrix.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">enum_lex_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>enum <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum_lex_less</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">.</span> enum_pos_less <span class="bound">i</span> <span class="bound">k</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">∧</span> enum_pos_less <span class="bound">j</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">enum_lex_less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>enum <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum_lex_less_eq</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">.</span> enum_pos_less <span class="bound">i</span> <span class="bound">k</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">∧</span> enum_pos_less_eq <span class="bound">j</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The $m$-operation determines the location of the non-$\bot$ minimum element which is first in the lexicographic order.
The result is returned as a regular matrix with $\top$ at that location and $\bot$ everywhere else.
In the weighted-graph model, this represents a single unweighted edge of the graph.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minarc_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>bot<span class="main">,</span>ord<span class="main">,</span>plus<span class="main">,</span>top<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> _"</span> <span class="main">[</span>80<span class="main">]</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minarc_matrix</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">d</span> <span class="main">≠</span> bot <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">d</span> <span class="main">+</span> bot <span class="main">∧</span> <span class="main">(</span>enum_lex_less <span class="bound">d</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">+</span> bot <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">d</span> <span class="main">+</span> bot<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-minarc_at_most_one"><span class="command">lemma</span></span> minarc_at_most_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>aggregation_order<span class="main">,</span>top<span class="main">}</span><span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">e</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">d</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">e</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="free">f</span> <span class="free">d</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms minarc_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">d</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="free">f</span> <span class="free">e</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms minarc_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">e</span> <span class="main">+</span> bot <span class="main">=</span> <span class="free">f</span> <span class="free">d</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enum_lex_less <span class="free">d</span> <span class="free">e</span> <span class="main">∧</span> <span class="main">¬</span> enum_lex_less <span class="free">e</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> minarc_matrix_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> enum_pos_injective less_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linear Aggregation Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We now assume that the aggregation order is linear and forms a bounded lattice.
It follows that these structures are aggregation lattices.
A linear order on matrix entries is necessary to obtain a unique minimum entry.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linear_aggregation_lattice <span class="main">=</span> linear_bounded_lattice <span class="main">+</span> aggregation_order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> aggregation_lattice
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute sup_inf_selective<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> heyting<span class="main">:</span> bounded_heyting_lattice <span class="keyword2"><span class="keyword">where</span></span> implies <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_less_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every non-empty set with a transitive total relation has a least element with respect to this relation.
›</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-least_order"><span class="command">lemma</span></span> least_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">.</span> <span class="free">le</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">le</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="free">le</span> <span class="bound">x</span> <span class="bound">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">le</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="free">le</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">le</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> singleton
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> total <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> insert
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff transitive total<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-minarc_at_least_one"><span class="command">lemma</span></span> minarc_at_least_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linear_aggregation_lattice<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="bound">e</span> <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nbe</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="free">f</span> <span class="bound">e</span><span class="main">)</span> <span class="main">|</span> <span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?nbe</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_code finite_image_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nbe</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms agg_matrix_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?le</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">e</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">,</span><span class="bound">fe</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="bound">d</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">,</span><span class="bound">fd</span><span class="main">)</span> <span class="main">.</span> <span class="bound">fe</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="bound">fd</span> <span class="main">+</span> bot"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">.</span> <span class="var">?le</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="var">?le</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="var">?le</span> <span class="bound">x</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="var">?le</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="var">?le</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?nbe</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="var">?nbe</span> <span class="main">⟶</span> <span class="var">?le</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> least_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 4<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">fe</span></span> <span class="keyword2"><span class="keyword">where</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">fe</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?nbe</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="var">?nbe</span> <span class="main">⟶</span> <span class="var">?le</span> <span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">fe</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?me</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">fe</span> <span class="main">+</span> bot <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?me</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_code finite_image_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?me</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">.</span> enum_lex_less_eq <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> enum_lex_less_eq <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟶</span> enum_lex_less_eq <span class="bound">x</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> enum_lex_less_eq <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> enum_lex_less_eq <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?me</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="var">?me</span> <span class="main">⟶</span> enum_lex_less_eq <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> least_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 8<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 9<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 6<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 7<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="var">?me</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="var">?me</span> <span class="main">⟶</span> enum_lex_less_eq <span class="skolem">m</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 10 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">≠</span> bot <span class="main">⟶</span> <span class="free">f</span> <span class="skolem">m</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 10 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">≠</span> bot <span class="main">∧</span> enum_lex_less <span class="bound">d</span> <span class="skolem">m</span> <span class="main">⟶</span> <span class="free">f</span> <span class="skolem">m</span> <span class="main">+</span> bot <span class="main">≠</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">+</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">f</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 11 12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minarc_matrix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Linear aggregation lattices form a Stone relation algebra by reusing the meet operation as composition, using identity as converse and a standard implementation of pseudocomplement.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linear_aggregation_algebra <span class="main">=</span> linear_aggregation_lattice <span class="main">+</span> uminus <span class="main">+</span> one <span class="main">+</span> times <span class="main">+</span> conv <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uminus_def_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_def_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> top"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> times_def_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv_def_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> aggregation_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> inf_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matrix_Aggregation_Algebras-regular_bot_top_2"><span class="command">lemma</span></span> regular_bot_top_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">sublocale</span></span> heyting<span class="main">:</span> heyting_stone_algebra <span class="keyword2"><span class="keyword">where</span></span> implies <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show that matrices over linear aggregation lattices form an m-algebra using the above operations.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> agg_square_m_algebra<span class="main">:</span> m_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linear_aggregation_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">plus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> sum <span class="main">=</span> <span class="quoted">sum_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> minarc <span class="main">=</span> <span class="quoted">minarc_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">f</span> <span class="skolem">e</span> <span class="main">≠</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minarc_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?at</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bounded_distrib_allegory_signature.arc <span class="keyword1">mone</span> times_matrix less_eq_matrix <span class="keyword1">mtop</span> conv_matrix"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">⟶</span> <span class="var">?at</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_bounded_idempotent_semiring.surjective_top_closed matrix_monoid.mult_assoc matrix_stone_relation_algebra.conv_dist_comp matrix_stone_relation_algebra.conv_top<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def conv_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_dist_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_left_zero comp_right_zero conv_bot prod.inject minarc_at_most_one<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mtop</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">from</span></span> minarc_at_least_one <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ei</span></span> <span class="skolem"><span class="skolem">ej</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ei</span><span class="main">,</span><span class="skolem">ej</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> top <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ei</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.ub_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ei</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> top <span class="main">*</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comp_inf.ub_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> top <span class="main">*</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff top_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_stone_relation_algebra.comp_associative matrix_stone_relation_algebra.conv_dist_comp matrix_stone_relation_algebra.conv_involutive matrix_stone_relation_algebra.conv_top matrix_bounded_idempotent_semiring.surjective_top_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def conv_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_dist_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sup_monoid.sum.cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_left_zero comp_right_zero conv_bot prod.inject minarc_at_most_one<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mtop</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_monoid.mult_assoc matrix_stone_relation_algebra.conv_dist_comp matrix_stone_relation_algebra.conv_top<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?at</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 3 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?at</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bounded_distrib_allegory_signature.arc <span class="keyword1">mone</span> times_matrix less_eq_matrix <span class="keyword1">mtop</span> conv_matrix"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?at</span> <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">⟶</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?at</span> <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> matrix_stone_relation_algebra.arc_regular <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">from</span></span> minarc_at_least_one <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ei</span></span> <span class="skolem"><span class="skolem">ej</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ei</span><span class="main">,</span><span class="skolem">ej</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">k</span> <span class="main">=</span> <span class="skolem">ei</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">ej</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> bot.extremum inf.bot_unique prod.inject minarc_at_most_one<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> agg_matrix_bot <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">di</span></span> <span class="skolem"><span class="skolem">dj</span></span> <span class="keyword2"><span class="keyword">where</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_left inf_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_matrix_def uminus_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_matrix_def inf_top.left_neutral<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="skolem">di</span> <span class="main">⟶</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
        <span class="keyword3"><span class="command">assume</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">di</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">n</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.ub_sum comp_right_dist_sum<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">m</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">n</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.ub_sum<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def top_matrix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_stone_relation_algebra.arc_expanded less_eq_matrix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> one_matrix_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">≠</span> top"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum conv_def inf.bot_unique mult.left_neutral one_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_def uminus_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">l</span> <span class="main">≠</span> <span class="skolem">dj</span> <span class="main">⟶</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
        <span class="keyword3"><span class="command">assume</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="skolem">dj</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_matrix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">n</span></span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.ub_sum comp_right_dist_sum<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">m</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">n</span></span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.ub_sum<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def top_matrix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_stone_relation_algebra.arc_expanded less_eq_matrix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> one_matrix_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">≠</span> top"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum comp_right_one conv_def one_def top.extremum_unique<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_def uminus_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">k</span> <span class="main">=</span> <span class="skolem">di</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">dj</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 9 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_left inf_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ei</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">ej</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ei</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">ej</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inf_matrix_def<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">ei</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">ej</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aggregation.sum_0.cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ei</span><span class="main">,</span><span class="skolem">ej</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> agg_delta_2<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">ei</span><span class="main">,</span><span class="skolem">ej</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">di</span><span class="main">,</span><span class="skolem">dj</span><span class="main">)</span> <span class="main">+</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 5 6 7 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minarc_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">di</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">dj</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> agg_delta_2<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">di</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">dj</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aggregation.sum_0.cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> 12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">∑⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">∨</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1<span class="main">:</span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sum_matrix_def<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sum_matrix_def<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">f</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">.</span> regular <span class="main">(</span><span class="bound">f</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> regular_bot_top_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_set_of_finite_funs_pred<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">f</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> matrix_p_algebra.regular <span class="bound">f</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> uminus_matrix_def<span class="main">)</span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show the same for the alternative implementation that stores the result of aggregation in all elements of the matrix.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> agg_square_m_algebra_2<span class="main">:</span> m_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linear_aggregation_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">plus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> sum <span class="main">=</span> <span class="quoted">sum_matrix_2</span> <span class="keyword2"><span class="keyword">and</span></span> minarc <span class="main">=</span> <span class="quoted">minarc_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agg_square_m_algebra.minarc_below<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?at</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bounded_distrib_allegory_signature.arc <span class="keyword1">mone</span> times_matrix less_eq_matrix <span class="keyword1">mtop</span> conv_matrix"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">⟶</span> <span class="var">?at</span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agg_square_m_algebra.minarc_arc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?at</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bounded_distrib_allegory_signature.arc <span class="keyword1">mone</span> times_matrix less_eq_matrix <span class="keyword1">mtop</span> conv_matrix"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?at</span> <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span> <span class="main">⟶</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≼</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?at</span> <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agg_square_m_algebra.minarc_min<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_matrix_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≼</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def sum_matrix_2_def less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd enum_class.enum"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">∨</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">≼</span> <span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agg_square_m_algebra.sum_linear<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">sum<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?h</span><span class="main">,</span><span class="var">?h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_matrix_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span> <span class="main">≼</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">∨</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">g</span> <span class="main">≼</span> <span class="keyword1">sum2<span class="hidden">⇩</span><sub>M</sub></span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_matrix_def sum_matrix_2_def less_eq_matrix_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">f</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">.</span> matrix_p_algebra.regular <span class="bound">f</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agg_square_m_algebra.finite_regular<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
By defining the Kleene star as $\top$ aggregation lattices form a Kleene algebra.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> aggregation_kleene_algebra <span class="main">=</span> aggregation_algebra <span class="main">+</span> star <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> stone_kleene_relation_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc le_infI2 inf_sup_distrib1 inf_sup_distrib2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> linear_aggregation_kleene_algebra <span class="main">=</span> linear_aggregation_algebra <span class="main">+</span> star <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_def_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> aggregation_kleene_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> agg_square_m_kleene_algebra<span class="main">:</span> m_kleene_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linear_aggregation_kleene_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> star <span class="main">=</span> <span class="quoted">star_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">plus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> sum <span class="main">=</span> <span class="quoted">sum_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> minarc <span class="main">=</span> <span class="quoted">minarc_matrix</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> agg_square_m_kleene_algebra_2<span class="main">:</span> m_kleene_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linear_aggregation_kleene_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> star <span class="main">=</span> <span class="quoted">star_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">plus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> sum <span class="main">=</span> <span class="quoted">sum_matrix_2</span> <span class="keyword2"><span class="keyword">and</span></span> minarc <span class="main">=</span> <span class="quoted">minarc_matrix</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Linear_Aggregation_Algebras">
<div class="head">
<h1>Theory Linear_Aggregation_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Algebras for Aggregation and Minimisation with a Linear Order
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algebras for Aggregation and Minimisation with a Linear Order›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory gives several classes of instances of linear aggregation lattices as described in \cite{Guttmann2018a}.
Each of these instances can be used as edge weights and the resulting graphs will form s-algebras and m-algebras as shown in a separate theory.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Linear_Aggregation_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="Matrix_Aggregation_Algebras.html">Matrix_Aggregation_Algebras</a> <a href="../../HOL/HOL/Real.html">HOL.Real</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linearly Ordered Commutative Semigroups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Any linearly ordered commutative semigroup extended by new least and greatest elements forms a linear aggregation lattice.
The extension is done so that the new least element is a unit of aggregation and the new greatest element is a zero of aggregation.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> ext <span class="main">=</span>
    Bot
  <span class="main">|</span> Val <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> Top

<span class="keyword1"><span class="command">instantiation</span></span> ext <span class="main">::</span> <span class="main">(</span><span class="quoted">linordered_ab_semigroup_add</span><span class="main">)</span> <span class="quoted">linear_aggregation_kleene_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_ext</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_ext</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_ext</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext</span> Top <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_ext</span> Bot <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_ext</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_ext</span> Top <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">star_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_ext</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">conv_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_ext</span> <span class="main">≡</span> Bot"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_ext</span> <span class="main">≡</span> Top"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_ext</span> <span class="main">≡</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> Top Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> Top <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext</span> Top Top <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext <span class="main">⇒</span> <span class="tfree">'a</span> ext <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_ext.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ext_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="skolem">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext_def add_right_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext_def top_ext_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> ext<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_ext_def top_ext_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ext_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An example of a linearly ordered commutative semigroup is the set of real numbers with standard addition as aggregation.
›</span></span>

<span class="keyword1" id="Linear_Aggregation_Algebras-example_real_ext_matrix"><span class="command">lemma</span></span> example_real_ext_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span>real ext<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">x</span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> agg_square_m_algebra.minarc_below<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Another example of a linearly ordered commutative semigroup is the set of real numbers with maximum as aggregation.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> real_max <span class="main">=</span> Rmax <span class="quoted">real</span>

<span class="keyword1"><span class="command">instantiation</span></span> real_max <span class="main">::</span> <span class="quoted">linordered_ab_semigroup_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_real_max</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_max</span> <span class="main">(</span>Rmax <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rmax <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_real_max</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_real_max</span> <span class="main">(</span>Rmax <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rmax <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_real_max</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_real_max</span> <span class="main">(</span>Rmax <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rmax <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Rmax <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">real_max</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Linear_Aggregation_Algebras-example_real_max_ext_matrix"><span class="command">lemma</span></span> example_real_max_ext_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span>real_max ext<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">x</span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> agg_square_m_algebra.minarc_below<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A third example of a linearly ordered commutative semigroup is the set of real numbers with minimum as aggregation.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> real_min <span class="main">=</span> Rmin <span class="quoted">real</span>

<span class="keyword1"><span class="command">instantiation</span></span> real_min <span class="main">::</span> <span class="quoted">linordered_ab_semigroup_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_real_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_min</span> <span class="main">(</span>Rmin <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rmin <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_real_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_real_min</span> <span class="main">(</span>Rmin <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rmin <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_real_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_real_min</span> <span class="main">(</span>Rmin <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rmin <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Rmin <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">real_min</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Linear_Aggregation_Algebras-example_real_min_ext_matrix"><span class="command">lemma</span></span> example_real_min_ext_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">,</span>real_min ext<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minarc<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">x</span> <span class="main">≼</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> agg_square_m_algebra.minarc_below<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linearly Ordered Commutative Monoids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Any linearly ordered commutative monoid extended by new least and greatest elements forms a linear aggregation lattice.
This is similar to linearly ordered commutative semigroups except that the aggregation $\bot + \bot$ produces the unit of the monoid instead of the least element.
Applied to weighted graphs, this means that the aggregation of the empty graph will be the unit of the monoid (for example, $0$ for real numbers under standard addition, instead of $\bot$).
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linordered_comm_monoid_add <span class="main">=</span> linordered_ab_semigroup_add <span class="main">+</span> comm_monoid_add

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> ext0 <span class="main">=</span>
    Bot
  <span class="main">|</span> Val <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> Top

<span class="keyword1"><span class="command">instantiation</span></span> ext0 <span class="main">::</span> <span class="main">(</span><span class="quoted">linordered_comm_monoid_add</span><span class="main">)</span> <span class="quoted">linear_aggregation_kleene_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_ext0</span> Bot Bot <span class="main">=</span> Val <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext0</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext0</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_ext0</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_ext0</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext0</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_ext0</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_ext0</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext0</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_ext0</span> Top <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_ext0</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_ext0</span> Bot <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_ext0</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_ext0</span> Top <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">star_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_ext0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">conv_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_ext0</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_ext0</span> <span class="main">≡</span> Bot"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_ext0</span> <span class="main">≡</span> Top"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_ext0</span> <span class="main">≡</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> Top Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> Top <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_ext0</span> Top Top <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_ext0</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0 <span class="main">⇒</span> <span class="tfree">'a</span> ext0 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_ext0</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ext0"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_ext0.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ext0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="skolem">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 11 <span class="keyword1"><span class="command">using</span></span> add_right_mono bot_ext0_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext0_def add_right_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_ext0_def top_ext0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> ext0<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_ext0_def top_ext0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ext0_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An example of a linearly ordered commutative monoid is the set of real numbers with standard addition and unit $0$.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> real <span class="main">::</span> <span class="quoted">linordered_comm_monoid_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linearly Ordered Commutative Monoids with a Least Element›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If a linearly ordered commutative monoid already contains a least element which is a unit of aggregation, only a new greatest element has to be added to obtain a linear aggregation lattice.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linordered_comm_monoid_add_bot <span class="main">=</span> linordered_ab_semigroup_add <span class="main">+</span> order_bot <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bot_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> linordered_comm_monoid_add <span class="keyword2"><span class="keyword">where</span></span> zero <span class="main">=</span> <span class="quoted">bot</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> extT <span class="main">=</span>
    Val <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> Top

<span class="keyword1"><span class="command">instantiation</span></span> extT <span class="main">::</span> <span class="main">(</span><span class="quoted">linordered_comm_monoid_add_bot</span><span class="main">)</span> <span class="quoted">linear_aggregation_kleene_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_extT</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extT</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extT</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_extT</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extT</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extT</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_extT</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extT</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extT</span> Top <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_extT</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extT</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Val bot <span class="keyword1">then</span> Top <span class="keyword1">else</span> Val bot<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">star_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_extT</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">conv_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_extT</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_extT</span> <span class="main">≡</span> Val bot"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_extT</span> <span class="main">≡</span> Top"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_extT</span> <span class="main">≡</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_extT</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extT</span> Top <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extT</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Top <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_extT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT <span class="main">⇒</span> <span class="tfree">'a</span> extT <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_extT</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extT"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="skolem">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extT_def add_right_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> add.commute add_right_mono bot.extremum bot.extremum_uniqueI bot_zero extT.inject plus_extT.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bot_extT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extT_def top_extT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> extT<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_extT_def top_extT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An example of a linearly ordered commutative monoid with a least element is the set of real numbers extended by minus infinity with maximum as aggregation.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> real_max_bot <span class="main">=</span>
    MInfty
  <span class="main">|</span> R <span class="quoted">real</span>

<span class="keyword1"><span class="command">instantiation</span></span> real_max_bot <span class="main">::</span> <span class="quoted">linordered_comm_monoid_add_bot</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">bot_real_max_bot</span></span> <span class="main">≡</span> MInfty"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_real_max_bot</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_max_bot</span> MInfty <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_max_bot</span> <span class="main">(</span>R <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> MInfty <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_max_bot</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_real_max_bot</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_real_max_bot</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> MInfty <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_real_max_bot</span> MInfty <span class="main">(</span>R <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_real_max_bot</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_real_max_bot</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_real_max_bot</span> MInfty <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_real_max_bot</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> MInfty <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_real_max_bot</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> R <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">real_max_bot</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_real_max_bot_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_real_max_bot_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linearly Ordered Commutative Monoids with a Greatest Element›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If a linearly ordered commutative monoid already contains a greatest element which is a unit of aggregation, only a new least element has to be added to obtain a linear aggregation lattice.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linordered_comm_monoid_add_top <span class="main">=</span> linordered_ab_semigroup_add <span class="main">+</span> order_top <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> top_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> linordered_comm_monoid_add <span class="keyword2"><span class="keyword">where</span></span> zero <span class="main">=</span> <span class="quoted">top</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-add_decreasing"><span class="command">lemma</span></span> add_decreasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_left_mono top.extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-t_min"><span class="command">lemma</span></span> t_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> min <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_commute add_decreasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> extB <span class="main">=</span>
    Bot
  <span class="main">|</span> Val <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword1"><span class="command">instantiation</span></span> extB <span class="main">::</span> <span class="main">(</span><span class="quoted">linordered_comm_monoid_add_top</span><span class="main">)</span> <span class="quoted">linear_aggregation_kleene_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_extB</span> Bot Bot <span class="main">=</span> Val top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extB</span> Bot <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extB</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extB</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_extB</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extB</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extB</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_extB</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extB</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extB</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_extB</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_extB</span> Bot <span class="main">=</span> Val top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extB</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">star_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_extB</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Val top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">conv_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_extB</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_extB</span> <span class="main">≡</span> Bot"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_extB</span> <span class="main">≡</span> Val top"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_extB</span> <span class="main">≡</span> Val top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_extB</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extB</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extB</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_extB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB <span class="main">⇒</span> <span class="tfree">'a</span> extB <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_extB</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extB"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extB_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extB_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="skolem">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 6 <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> plus_extB.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> top_extB_def add_right_mono less_eq_extB.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> top_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extB_def add_right_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extB_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extB_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extB_def top_extB_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> extB<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_extB_def top_extB_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extB_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An example of a linearly ordered commutative monoid with a greatest element is the set of real numbers extended by infinity with minimum as aggregation.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> real_min_top <span class="main">=</span>
    R <span class="quoted">real</span>
  <span class="main">|</span> PInfty

<span class="keyword1"><span class="command">instantiation</span></span> real_min_top <span class="main">::</span> <span class="quoted">linordered_comm_monoid_add_top</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">top_real_min_top</span></span> <span class="main">≡</span> PInfty"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_real_min_top</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_min_top</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> PInfty <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_min_top</span> PInfty <span class="main">(</span>R <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_min_top</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_real_min_top</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_real_min_top</span> PInfty <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_real_min_top</span> <span class="main">(</span>R <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> PInfty <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_real_min_top</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_real_min_top</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_real_min_top</span> PInfty <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_real_min_top</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> PInfty <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_real_min_top</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>R <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> R <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">real_min_top</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_real_min_top_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"top <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_real_min_top_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Another example of a linearly ordered commutative monoid with a greatest element is the unit interval of real numbers with any triangular norm (t-norm) as aggregation.
Ideally, we would like to show that the unit interval is an instance of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>linordered_comm_monoid_add_top›</span></span></span></span>.
However, this class has an addition operation, so the instantiation would require dependent types.
We therefore show only the order property in general and a particular instance of the class.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> unit <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> real set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_unit

<span class="keyword1"><span class="command">instantiation</span></span> unit <span class="main">::</span> <span class="quoted">bounded_linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_unit</span> <span class="main">::</span> <span class="quoted">unit</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_unit</span> <span class="main">::</span> <span class="quoted">unit</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit <span class="main">⇒</span> unit <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit <span class="main">⇒</span> unit <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command">using</span></span> bot_unit.rep_eq top_unit.rep_eq less_eq_unit.rep_eq less_unit.rep_eq unit.Rep_unit_inject unit.Rep_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We give the \L{}ukasiewicz t-norm as a particular instance.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> unit <span class="main">::</span> <span class="quoted">linordered_comm_monoid_add_top</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">tl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> max <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="Linear_Aggregation_Algebras-tl_assoc"><span class="command">lemma</span></span> tl_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> tl <span class="main">(</span>tl <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> tl <span class="free">x</span> <span class="main">(</span>tl <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-tl_top_zero"><span class="command">lemma</span></span> tl_top_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> tl <span class="main">1</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit <span class="main">⇒</span> unit <span class="main">⇒</span> unit"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">tl</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> plus_unit.rep_eq unit.Rep_unit_inject unit.Rep_unit tl_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> unit.Rep_unit_inject plus_unit.rep_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_unit.rep_eq plus_unit.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> top_unit.rep_eq unit.Rep_unit_inject unit.Rep_unit plus_unit.rep_eq tl_top_zero<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linearly Ordered Commutative Monoids with a Least Element and a Greatest Element›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If a linearly ordered commutative monoid already contains a least element which is a unit of aggregation and a greatest element, it forms a linear aggregation lattice.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linordered_bounded_comm_monoid_add_bot <span class="main">=</span> linordered_comm_monoid_add_bot <span class="main">+</span> order_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_linorder <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> aggregation_order
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_0_right add_left_mono bot.extremum bot.extremum_unique<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> linear_aggregation_kleene_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">max</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">min</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">min</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">id</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">top</span> <span class="keyword2"><span class="keyword">and</span></span> star <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> top"</span></span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-t_top"><span class="command">lemma</span></span> t_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> top <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_mono bot.extremum bot_zero top_unique<span class="main">)</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-add_increasing"><span class="command">lemma</span></span> add_increasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_left_mono bot.extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-t_max"><span class="command">lemma</span></span> t_max<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_commute add_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An example of a linearly ordered commutative monoid with a least and a greatest element is the unit interval of real numbers with any triangular conorm (t-conorm) as aggregation.
For the reason outlined above, we show just a particular instance of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>linordered_bounded_comm_monoid_add_bot›</span></span></span></span>.
Because the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>plus›</span></span></span></span> functions in the two instances given for the unit type are different, we work on a copy of the unit type.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> unit2 <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> real set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_unit2

<span class="keyword1"><span class="command">instantiation</span></span> unit2 <span class="main">::</span> <span class="quoted">bounded_linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_unit2</span> <span class="main">::</span> <span class="quoted">unit2</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_unit2</span> <span class="main">::</span> <span class="quoted">unit2</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_unit2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit2 <span class="main">⇒</span> unit2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_unit2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit2 <span class="main">⇒</span> unit2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command">using</span></span> bot_unit2.rep_eq top_unit2.rep_eq less_eq_unit2.rep_eq less_unit2.rep_eq unit2.Rep_unit2_inject unit2.Rep_unit2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We give the product t-conorm as a particular instance.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> unit2 <span class="main">::</span> <span class="quoted">linordered_bounded_comm_monoid_add_bot</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="Linear_Aggregation_Algebras-sp_assoc"><span class="command">lemma</span></span> sp_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sp <span class="main">(</span>sp <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> sp <span class="free">x</span> <span class="main">(</span>sp <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> left_diff_distrib right_diff_distrib distrib_left distrib_right<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Linear_Aggregation_Algebras-sp_mono"><span class="command">lemma</span></span> sp_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sp <span class="free">z</span> <span class="free">x</span> <span class="main">≤</span> sp <span class="free">z</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> left_diff_distrib right_diff_distrib distrib_left distrib_right<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_unit2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit2 <span class="main">⇒</span> unit2 <span class="main">⇒</span> unit2"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sp</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> atLeastAtMost_iff diff_ge_0_iff_ge left_diff_distrib' mult.commute mult.left_neutral mult_left_le<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastAtMost_iff le_iff_diff_le_0 mult_nonneg_nonpos<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> atLeastAtMost_iff diff_diff_eq2 diff_ge_0_iff_ge left_diff_distrib mult.commute mult.left_neutral order_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> plus_unit2.rep_eq unit2.Rep_unit2_inject sp_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> unit2.Rep_unit2_inject plus_unit2.rep_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> sp_mono unit2.Rep_unit2 less_eq_unit2.rep_eq plus_unit2.rep_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> bot_unit2.rep_eq unit2.Rep_unit2_inject plus_unit2.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Constant Aggregation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Any linear order with a constant element extended by new least and greatest elements forms a linear aggregation lattice where the aggregation returns the given constant.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> pointed_linorder <span class="main">=</span> linorder <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">const</span></span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> extC <span class="main">=</span>
    Bot
  <span class="main">|</span> Val <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> Top

<span class="keyword1"><span class="command">instantiation</span></span> extC <span class="main">::</span> <span class="main">(</span><span class="quoted">pointed_linorder</span><span class="main">)</span> <span class="quoted">linear_aggregation_kleene_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_extC</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Val const"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_extC</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extC</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extC</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extC</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extC</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_extC</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extC</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extC</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extC</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extC</span> Top <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_extC</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_extC</span> Bot <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extC</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extC</span> Top <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">star_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_extC</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">conv_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_extC</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_extC</span> <span class="main">≡</span> Bot"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_extC</span> <span class="main">≡</span> Top"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_extC</span> <span class="main">≡</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> Top Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> Top <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extC</span> Top Top <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_extC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC <span class="main">⇒</span> <span class="tfree">'a</span> extC <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_extC</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extC"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extC_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extC_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="skolem">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extC_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extC_def top_extC_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> extC<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_extC_def top_extC_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extC_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An example of a linear order is the set of real numbers.
Any real number can be chosen as the constant.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> real <span class="main">::</span> <span class="quoted">pointed_linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following instance shows that any linear order with a constant forms a linearly ordered commutative semigroup with the alpha-median operation as aggregation.
The alpha-median of two elements is the median of these elements and the given constant.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">median3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ord <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">median3</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">else</span>
     <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">else</span>
     <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span>
     <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">else</span>
     <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> alpha_median<span class="main">:</span> linordered_ab_semigroup_add <span class="keyword2"><span class="keyword">where</span></span> plus <span class="main">=</span> <span class="quoted"><span class="quoted">"median3 const"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"median3 const <span class="main">(</span>median3 const <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> median3 const <span class="skolem">a</span> <span class="main">(</span>median3 const <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">b</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"median3 const <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> median3 const <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">b</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"median3 const <span class="skolem">c</span> <span class="skolem">a</span> <span class="main">≤</span> median3 const <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">b</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"const <span class="main">≤</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Counting Aggregation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Any linear order extended by new least and greatest elements and a copy of the natural numbers forms a linear aggregation lattice where the aggregation counts non-$\bot$ elements using the copy of the natural numbers.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> extN <span class="main">=</span>
    Bot
  <span class="main">|</span> Val <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> N <span class="quoted">nat</span>
  <span class="main">|</span> Top

<span class="keyword1"><span class="command">instantiation</span></span> extN <span class="main">::</span> <span class="main">(</span><span class="quoted">linorder</span><span class="main">)</span> <span class="quoted">linear_aggregation_kleene_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Bot Bot <span class="main">=</span> N <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Bot <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Bot <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Bot Top <span class="main">=</span> N <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> N <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="numeral">2</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> N <span class="numeral">2</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> N <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> N <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Top Bot <span class="main">=</span> N <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Top <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="numeral">2</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Top <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">plus_extN</span> Top Top <span class="main">=</span> N <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> Bot <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Bot <span class="main">=</span> N <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sup_extN</span> Top <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inf_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Val <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> Top <span class="main">=</span> N <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inf_extN</span> Top <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_extN</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_extN</span> Bot <span class="main">=</span> Top"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Bot"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_extN</span> Top <span class="main">=</span> Bot"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">star_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">star_extN</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">conv_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_extN</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">bot_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_extN</span> <span class="main">≡</span> Bot"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_extN</span> <span class="main">≡</span> Top"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_extN</span> <span class="main">≡</span> Top"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> Bot <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> Top <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> Top Bot <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> Top <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> Top <span class="main">(</span>N <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_extN</span> Top Top <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_extN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN <span class="main">⇒</span> <span class="tfree">'a</span> extN <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_extN</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> extN"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="skolem">x</span> <span class="main">+</span> bot <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> bot <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linear<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_extN_def top_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> extN<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_extN_def top_extN_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_extN_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>