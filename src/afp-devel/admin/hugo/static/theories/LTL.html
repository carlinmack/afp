<div id="LTL">
<div class="head">
<h1>Theory LTL</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Salomon Sickert
    Author:   Benedikt Seidl
    Author:   Alexander Schimpf (original entry: CAVA/LTL.thy)
    Author:   Stephan Merz (original entry: Stuttering_Equivalence/PLTL.thy)
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Linear Temporal Logic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> LTL
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Omega_Words_Fun.html">HOL-Library.Omega_Words_Fun</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory provides a formalisation of linear temporal logic. It provides three variants:
    \begin{enumerate}
      \item LTL with syntactic sugar. This variant is the semantic reference and the included parser
            generates ASTs of this datatype.
      \item LTL in negation normal form without syntactic sugar. This variant is used by the included
            rewriting engine and is used for the translation to automata (implemented in other entries).
      \item LTL in restricted negation normal form without the rather uncommon operators ``weak until''
            and ``strong release''. It is used by the formalization of Gerth's algorithm.
      \item PLTL. A variant with a reduced set of operators.
    \end{enumerate}
    This theory subsumes (and partly reuses) the existing formalisation found in LTL\_to\_GBA and
    Stuttering\_Equivalence and unifies them.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹LTL with Syntactic Sugar›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we provide a formulation of LTL with explicit syntactic sugar deeply embedded.
    This formalization serves as a reference semantics.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>atoms_ltlc<span class="main">:</span> <span class="tfree">'a</span><span class="main">)</span> ltlc <span class="main">=</span>
    True_ltlc                               <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> False_ltlc                              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Prop_ltlc <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>                            <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Not_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>                      <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>85<span class="main">]</span> 85<span class="main">)</span>
  <span class="main">|</span> And_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>            <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>82<span class="main">,</span>82<span class="main">]</span> 81<span class="main">)</span>
  <span class="main">|</span> Or_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>             <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="main">|</span> Implies_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>        <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="main">|</span> Next_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>                     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
  <span class="main">|</span> Final_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>                    <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
  <span class="main">|</span> Global_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>                   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
  <span class="main">|</span> Until_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>          <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> Release_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>        <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> WeakUntil_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>      <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> StrongRelease_ltlc <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Iff_ltlc</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">iff<span class="hidden">⇩</span><sub>c</sub></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">iff<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">semantics_ltlc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set word<span class="main">,</span> <span class="tfree">'a</span> ltlc<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> _"</span> <span class="main">[</span>80<span class="main">,</span>80<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semantics_ltlc_sugar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">iff<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_ltlc_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">language_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> <span class="bound">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> language_ltlc_negate<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"language_ltlc <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> language_ltlc <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> language_ltlc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_true_or_con<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free">p</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_false_true_con<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_Next_Neg_con<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">― ‹The connection between dual operators›</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_Until_Release_con<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">¬</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">¬</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_WeakUntil_StrongRelease_con<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">¬</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">¬</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">― ‹The connection between weak and strong operators›</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_Release_StrongRelease_con<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exists_least_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exists_least_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> semantics_ltlc.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> not_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_Until_WeakUntil_con<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exists_least_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exists_least_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> semantics_ltlc.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> not_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_StrongRelease_Until_con<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_WeakUntil_Release_con<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ltl_Release_StrongRelease_con<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_StrongRelease_Until_con ltl_Until_WeakUntil_con<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> semantics_ltlc.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pw_eq_on</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">w'</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="bound">i</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w'</span></span></span> <span class="bound">i</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pw_eq_on_refl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pw_eq_on <span class="free">S</span> <span class="free">w</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pw_eq_on_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"pw_eq_on <span class="free">S</span> <span class="free">w</span> <span class="free">w'</span> <span class="main">⟹</span> pw_eq_on <span class="free">S</span> <span class="free">w'</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pw_eq_on_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>pw_eq_on <span class="free">S</span> <span class="free">w</span> <span class="free">w'</span><span class="main">;</span> pw_eq_on <span class="free">S</span> <span class="free">w'</span> <span class="free">w''</span><span class="main">⟧</span> <span class="main">⟹</span> pw_eq_on <span class="free">S</span> <span class="free">w</span> <span class="free">w''</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pw_eq_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pw_eq_on_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pw_eq_on <span class="free">S</span> <span class="free">w</span> <span class="free">w'</span> <span class="main">⟹</span> pw_eq_on <span class="free">S</span> <span class="main">(</span>suffix <span class="free">k</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>suffix <span class="free">k</span> <span class="free">w'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pw_eq_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pw_eq_on_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">S'</span> <span class="main">⟹</span> pw_eq_on <span class="free">S'</span> <span class="free">w</span> <span class="free">w'</span> <span class="main">⟹</span> pw_eq_on <span class="free">S</span> <span class="free">w</span> <span class="free">w'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pw_eq_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_eq_on_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pw_eq_on <span class="main">(</span>atoms_ltlc <span class="free">φ</span><span class="main">)</span> <span class="free">w</span> <span class="free">w'</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">w'</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Until_ltlc
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> Un_upper1 Un_upper2 pw_eq_on_subset pw_eq_on_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Release_ltlc
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Un_upper1 pw_eq_on_subset pw_eq_on_suffix sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> WeakUntil_ltlc
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> pw_eq_on_subset pw_eq_on_suffix sup.cobounded1 sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> StrongRelease_ltlc
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Un_upper1 pw_eq_on_subset pw_eq_on_suffix pw_eq_on_sym sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltlc <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> Un_upper1 inf_sup_ord<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> pw_eq_on_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltlc <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> Un_upper2 pw_eq_on_subset sup_ge1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Implies_ltlc <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> Un_upper1 Un_upper2 pw_eq_on_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"atoms_ltlc <span class="main"><span class="main"><span class="main">_</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"atoms_ltlc <span class="skolem"><span class="skolem"><span class="skolem">φ</span></span></span> <span class="main"><span class="main"><span class="main">∪</span></span></span> atoms_ltlc <span class="skolem"><span class="skolem"><span class="skolem">ψ</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span>  pw_eq_on_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pw_eq_on_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> suffix_nth<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_eq_on<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pw_eq_on <span class="main">(</span>atoms_ltlc <span class="free">φ</span><span class="main">)</span> <span class="free">w</span> <span class="free">w'</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w'</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltlc_eq_on_aux pw_eq_on_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> suffix_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>suffix <span class="free">k</span> <span class="free">w</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> suffix <span class="free">k</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> suffix_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>range <span class="free">ξ</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">APs</span> <span class="main">⟹</span> <span class="main">⋃</span><span class="main">(</span>range <span class="main">(</span>suffix <span class="free">k</span> <span class="free">ξ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">APs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_semantics_ltlc_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">APs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>range <span class="free">w</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">APs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atoms_ltlc <span class="free">φ</span> <span class="main">⊆</span> <span class="free">APs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="free">w</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> map_ltlc <span class="free">f</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prop_ltlc <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_le_iff inj_on_image_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltlc <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Next_ltlc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"suffix <span class="main">1</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">]</span> Next_ltlc<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Next_ltlc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> One_nat_def <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="main">⋃</span><span class="main">(</span>range <span class="main">(</span>suffix <span class="main">1</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">APs</span><span class="main">;</span> atoms_ltlc <span class="skolem">φ</span> <span class="main">⊆</span> <span class="free">APs</span><span class="main">⟧</span> <span class="main">⟹</span> suffix <span class="main">1</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="skolem">φ</span> <span class="main">=</span> suffix <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">w</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> map_ltlc <span class="free">f</span> <span class="skolem">φ</span>›</span></span> suffix_range<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Final_ltlc <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> Final_ltlc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"suffix <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">,</span> <span class="operator">OF</span> suffix_range<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Global_ltlc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Global_ltlc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"suffix <span class="main">_</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">,</span> <span class="operator">OF</span> suffix_range<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltlc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Until_ltlc<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"suffix <span class="main"><span class="main">_</span></span> <span class="skolem"><span class="skolem">w</span></span>"</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">,</span> <span class="operator">OF</span> suffix_range<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltlc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Release_ltlc<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"suffix <span class="main"><span class="main">_</span></span> <span class="skolem"><span class="skolem">w</span></span>"</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">,</span> <span class="operator">OF</span> suffix_range<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltlc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltlc<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"suffix <span class="main"><span class="main">_</span></span> <span class="skolem"><span class="skolem">w</span></span>"</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">,</span> <span class="operator">OF</span> suffix_range<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltlc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltlc<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"suffix <span class="main"><span class="main">_</span></span> <span class="skolem"><span class="skolem">w</span></span>"</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> suffix_comp comp_def<span class="main">,</span> <span class="operator">OF</span> suffix_range<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_props</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">APs</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">APs</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span> <span class="main">=</span> Some <span class="bound">i</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_semantics_ltlc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> INJ<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span>dom <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> DOM<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_ltlc <span class="free">φ</span> <span class="main">⊆</span> dom <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">(</span>map_props <span class="free">f</span> <span class="keyword1">o</span> <span class="free">ξ</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> map_ltlc <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ξr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">ξ</span> <span class="bound">i</span> <span class="main">∩</span> atoms_ltlc <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ξr'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">ξ</span> <span class="bound">i</span> <span class="main">∩</span> dom <span class="free">f</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>range <span class="var">?ξr</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltlc <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> INJ_the_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>dom <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def domIff<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> subset_inj_on<span class="main">[</span><span class="operator">OF</span> this DOM<span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="var">?ξr'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> map_props <span class="free">f</span> <span class="keyword1">o</span> <span class="free">ξ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DOM INJ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_props_def domIff image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff domI option.sel<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="var">?ξr</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ltlc_eq_on<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pw_eq_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> map_semantics_ltlc_aux<span class="main">[</span><span class="operator">OF</span> 2 1 subset_refl<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="var">?ξr</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> map_ltlc <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="var">?ξr'</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> map_ltlc <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ltlc_eq_on<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> DOM INJ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pw_eq_on_def ltlc.set_map domIff image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff contra_subsetD domD domI inj_on_eq_iff option.sel<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> 3
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_semantics_ltlc_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> INJ<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span>dom <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> DOM<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_ltlc <span class="free">φ</span> <span class="main">⊆</span> dom <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> map_ltlc <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>the <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">-`</span> <span class="free">ξ</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> map_semantics_ltlc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ltlc_eq_on<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pw_eq_on_def ltlc.set_map map_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DOM comp_apply contra_subsetD domD option.sel vimage_eq<span class="main">)</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹LTL in Negation Normal Form›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a type of LTL formula in negation normal form (NNF).›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>atoms_ltln<span class="main">:</span> <span class="tfree">'a</span><span class="main">)</span> ltln  <span class="main">=</span>
    True_ltln                               <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> False_ltln                              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Prop_ltln <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>                            <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Nprop_ltln <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>                           <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> And_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>            <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>82<span class="main">,</span>82<span class="main">]</span> 81<span class="main">)</span>
  <span class="main">|</span> Or_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>             <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> Next_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>                     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
  <span class="main">|</span> Until_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>          <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> Release_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>        <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> WeakUntil_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>      <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> StrongRelease_ltln <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">finally<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">F<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>input<span class="main">)</span> finally<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span><span class="quoted">"<span class="keyword1">♢<span class="hidden">⇩</span><sub>n</sub></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">globally<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">G<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>input<span class="main">)</span> globally<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span><span class="quoted">"<span class="keyword1">□<span class="hidden">⇩</span><sub>n</sub></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">semantics_ltln</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set word<span class="main">,</span> <span class="tfree">'a</span> ltln<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> _"</span> <span class="main">[</span>80<span class="main">,</span>80<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">language_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> <span class="bound">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semantics_ltln_ite_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">else</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltlc_to_ltln'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="tfree">'a</span> ltlc <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> False <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> False <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> True <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> True <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">ltlc_to_ltln'</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlc_to_ltln'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltlc_to_ltln</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> ltlc_to_ltln' False <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltln_to_ltlc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltlc"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">ltln_to_ltlc</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_to_ltln'_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>ltlc_to_ltln' True <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>ltlc_to_ltln' False <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>ltlc_to_ltln' True <span class="free">φ</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> size <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>ltlc_to_ltln' False <span class="free">φ</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> size <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_to_ltln_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> ltlc_to_ltln <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltlc_to_ltln'_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_to_ltln_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>ltlc_to_ltln <span class="free">φ</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> size <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltlc_to_ltln'_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_to_ltlc_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> ltln_to_ltlc <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_to_ltln_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>ltlc_to_ltln <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_ltlc <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>ltlc_to_ltln' True <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_ltlc <span class="free">φ</span>"</span></span>
    <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>ltlc_to_ltln' False <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_ltlc <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Negation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">not<span class="hidden">⇩</span><sub>n</sub></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> not<span class="hidden">⇩</span><sub>n</sub> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> not<span class="hidden">⇩</span><sub>n</sub>_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> size <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Subformulas›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subfrmlsn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsn</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> subfrmlsn <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subfrmlsn <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>subfrmlsn <span class="free">φ</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if subfrmlsn_finite<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">meson</span> add_le_mono card_Un_le dual_order.trans le_SucI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> subfrmlsn <span class="free">φ</span> <span class="main">⟹</span> subfrmlsn <span class="free">ψ</span> <span class="main">⊆</span> subfrmlsn <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsn_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> subfrmlsn <span class="free">φ</span> <span class="main">⟹</span> size <span class="free">ψ</span> <span class="main">&lt;</span> size <span class="free">φ</span> <span class="main">∨</span> <span class="free">ψ</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">size_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> size <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> size_set_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> <span class="free">S'</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> size_set <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">S'</span><span class="main">)</span> <span class="main">=</span> size_set <span class="free">S</span> <span class="main">-</span> size_set <span class="free">S'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_diff_nat finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Constant Folding›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> U_consts<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> R_consts<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> W_consts<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> M_consts<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Distributivity›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> until_and_left_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i1</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i1</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i2</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i2</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>min <span class="skolem">i1</span> <span class="skolem">i2</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>min <span class="skolem">i1</span> <span class="skolem">i2</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> until_or_right_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> release_and_right_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> release_or_left_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics until_and_left_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strong_release_and_right_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i1</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i1</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i2</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i2</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>min <span class="skolem">i1</span> <span class="skolem">i2</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>min <span class="skolem">i1</span> <span class="skolem">i2</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> strong_release_or_left_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> weak_until_and_left_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> weak_until_or_right_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics strong_release_and_right_distrib<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> next_until_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> next_release_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> next_weak_until_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> next_strong_release_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Nested operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finally_until<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> globally_release<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> globally_weak_until<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> finally_strong_release<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Weak and strong operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_weak_strong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">k</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">k</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_strong_weak<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln_weak_strong not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>8-11<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_strong_to_weak<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltln_weak_strong <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_weak_to_strong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">;</span> <span class="main">¬</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">;</span> <span class="main">¬</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">;</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltln_weak_strong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ψ</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> ltln_StrongRelease_to_Until<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_Release_to_WeakUntil<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ltln_StrongRelease_to_Until ltln_weak_strong semantics_ltln.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_WeakUntil_to_Release<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln_StrongRelease_to_Until not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_Until_to_StrongRelease<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln_Release_to_WeakUntil not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹GF and FG semantics›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GF_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add.left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> GF_Inf_many<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> INFM_nat_le
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_Suc_ex <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_add1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FG_Alm_all<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MOST_nat_le
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_Suc_ex <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_add1<span class="main">)</span>


<span class="comment1">(* TODO: move to Infinite_Set.thy ?? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> MOST_nat_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofinite_eq_sequentially<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> INFM_nat_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> MOST_nat_add not_MOST not_INFM <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> FG_suffix_G<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> globally_release semantics_ltln.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span>  <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> FG_Alm_all <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Alm_all_GF_F<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MOST_nat
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> GF_Inf_many INFM_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> suffix <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_add1<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> max <span class="keyword1"><span class="command">have</span></span> j_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> GF_Inf_many <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INFM_iff_infinite<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span>Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Max_ge not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> j_suffix j_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Alm_all_FG_G<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MOST_nat
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> FG_Alm_all INFM_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> suffix <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">j</span><span class="main">.</span> suffix <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_suffix_G<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span>"</span></span><span class="main">]</span> suffix_suffix
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">j</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MOST_nat_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INFM_iff_infinite<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> max <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Max_ge leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Expansion›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_expand_Until<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_0_disj suffix_singleton_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_expand_Release<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_0_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_expand_WeakUntil<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln_expand_Release ltln_expand_Until ltln_weak_strong<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_expand_StrongRelease<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> ltln_expand_WeakUntil <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> ltln_expand_WeakUntil not<span class="hidden">⇩</span><sub>n</sub>.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">)</span></span> not<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_Release_alterdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ψ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≡</span> Least <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">⟹</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True LeastI not_less_Least <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∧</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∧</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> linorder_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹LTL in restricted Negation Normal Form›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some algorithms do not handle the operators W and M,
    hence we also provide a datatype without these two operators.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>atoms_ltlr<span class="main">:</span> <span class="tfree">'a</span><span class="main">)</span> ltlr <span class="main">=</span>
    True_ltlr                               <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">true<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> False_ltlr                              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">false<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Prop_ltlr <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>                            <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">prop<span class="hidden">⇩</span><sub>r</sub>'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Nprop_ltlr <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>                           <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">nprop<span class="hidden">⇩</span><sub>r</sub>'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> And_ltlr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span>            <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>82<span class="main">,</span>82<span class="main">]</span> 81<span class="main">)</span>
  <span class="main">|</span> Or_ltlr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span>             <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> Next_ltlr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span>                     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
  <span class="main">|</span> Until_ltlr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span>          <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
  <span class="main">|</span> Release_ltlr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr"</span></span>        <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">semantics_ltlr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set word<span class="main">,</span> <span class="tfree">'a</span> ltlr<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> _"</span> <span class="main">[</span>80<span class="main">,</span>80<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltln_to_ltlr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltlr"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltln_to_ltlr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">ltln_to_ltlr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltlr_to_ltln</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlr_to_ltln</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">ltlr_to_ltln</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_to_ltlr_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> ltln_to_ltlr <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> ltln_WeakUntil_to_Release ltln_StrongRelease_to_Until<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltlr_to_ltln_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> ltlr_to_ltln <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Negation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">not<span class="hidden">⇩</span><sub>r</sub></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>r</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">not<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not<span class="hidden">⇩</span><sub>r</sub>_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> not<span class="hidden">⇩</span><sub>r</sub> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Subformulas›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subfrmlsr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlr <span class="main">⇒</span> <span class="tfree">'a</span> ltlr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subfrmlsr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsr</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subfrmlsr</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsr_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> subfrmlsr <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsr_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subfrmlsr <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsr_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> subfrmlsr <span class="free">φ</span> <span class="main">⟹</span> subfrmlsr <span class="free">ψ</span> <span class="main">⊆</span> subfrmlsr <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subfrmlsr_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> subfrmlsr <span class="free">φ</span> <span class="main">⟹</span> size <span class="free">ψ</span> <span class="main">&lt;</span> size <span class="free">φ</span> <span class="main">∨</span> <span class="free">ψ</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Expansion lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltlr_expand_Until<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ψ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln_expand_Until ltlr_to_ltln.simps<span class="main"><span class="main">(</span></span>5-8<span class="main"><span class="main">)</span></span> ltlr_to_ltln_semantics<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltlr_expand_Release<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ψ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln_expand_Release ltlr_to_ltln.simps<span class="main"><span class="main">(</span></span>5-7<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> ltlr_to_ltln_semantics<span class="main">)</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Propositional LTL›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the syntax and semantics of propositional linear-time
    temporal logic PLTL.
    PLTL formulas are built from atomic formulas, propositional connectives,
    and the temporal operators ``next'' and ``until''. The following data
    type definition is parameterized by the type of states over which
    formulas are evaluated.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> pltl  <span class="main">=</span>
    False_ltlp                       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">false<span class="hidden">⇩</span><sub>p</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Atom_ltlp <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">atom<span class="hidden">⇩</span><sub>p</sub>'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Implies_ltlp <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pltl"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pltl"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">implies<span class="hidden">⇩</span><sub>p</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="main">|</span> Next_ltlp <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pltl"</span></span>              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">X<span class="hidden">⇩</span><sub>p</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
  <span class="main">|</span> Until_ltlp <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pltl"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pltl"</span></span>   <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>

<span class="comment1">― ‹Further connectives of PLTL can be defined in terms of the existing syntax.›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Not_ltlp</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>85<span class="main">]</span> 85<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">not<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">True_ltlp</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">true<span class="hidden">⇩</span><sub>p</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">true<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="main">≡</span> <span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Or_ltlp</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">or<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">or<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">And_ltlp</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">and<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>82<span class="main">,</span>82<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">and<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Eventually_ltlp</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">F<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">F<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Always_ltlp</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">G<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>88<span class="main">]</span> 87<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">G<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Release_ltlp</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">R<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">R<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WeakUntil_ltlp</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">W<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">W<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">StrongRelease_ltlp</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">M<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>84<span class="main">,</span>84<span class="main">]</span> 83<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">M<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">semantics_pltl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> word<span class="main">,</span> <span class="tfree">'a</span> pltl<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> _"</span> <span class="main">[</span>80<span class="main">,</span>80<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="keyword1">atom<span class="hidden">⇩</span><sub>p</sub>(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span>suffix <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semantics_pltl_sugar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">∨</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">∧</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Not_ltlp_def True_ltlp_def Or_ltlp_def And_ltlp_def Eventually_ltlp_def Always_ltlp_def Release_ltlp_def WeakUntil_ltlp_def StrongRelease_ltlp_def<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> le_neq_implies_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">language_ltlp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">ξ</span><span class="main">.</span> <span class="bound">ξ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltlc_to_pltl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltlc <span class="main">⇒</span> <span class="tfree">'a</span> set pltl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="keyword1">prop<span class="hidden">⇩</span><sub>c</sub>(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">atom<span class="hidden">⇩</span><sub>p</sub>(</span><span class="main">(∈)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">F<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">G<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ltlc_to_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">ltlc_to_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltlc_to_pltl_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span>ltlc_to_pltl <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Atoms›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atoms_pltl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pltl <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">atoms_pltl</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_pltl</span> <span class="keyword1">atom<span class="hidden">⇩</span><sub>p</sub>(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">implies<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">atoms_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_pltl</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">atoms_pltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms_pltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">atoms_pltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> atoms_finite <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atoms_pltl <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> atoms_pltl_sugar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_pltl <span class="main">(</span><span class="keyword1">not<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_pltl <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"atoms_pltl <span class="keyword1">true<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"atoms_pltl <span class="main">(</span><span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> atoms_pltl <span class="free">φ</span> <span class="main">∪</span> atoms_pltl <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"atoms_pltl <span class="main">(</span><span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> atoms_pltl <span class="free">φ</span> <span class="main">∪</span> atoms_pltl <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"atoms_pltl <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_pltl <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"atoms_pltl <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_pltl <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Not_ltlp_def True_ltlp_def Or_ltlp_def And_ltlp_def Eventually_ltlp_def Always_ltlp_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Rewriting">
<div class="head">
<h1>Theory Rewriting</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Salomon Sickert
    Author:   Benedikt Seidl
    Author:   Alexander Schimpf (original entry: CAVA/LTL_Rewrite.thy)
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Rewrite Rules for LTL Simplification›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rewriting
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="LTL.html">LTL</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Extended_Nat.html">HOL-Library.Extended_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory provides rewrite rules for the simplification of LTL formulas. It supports:
  \begin{itemize}
    \item Constants Removal
    \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Next_ltln<span class="antiquote"><span class="antiquote">}</span></span></span></span>-Normalisation
    \item Modal Simplification (based on pure eventual, pure universal, or suspendable formulas)
    \item Syntactic Implication Checking
  \end{itemize}
  It reuses parts of LTL\_Rewrite.thy (CAVA, LTL\_TO\_GBA). Furthermore, some rules were taken from
  \cite{DBLP:conf/cav/SomenziB00} and \cite{DBLP:conf/tacas/BabiakKRS12}. All functions are defined for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> ltln<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Constant Eliminating Constructors›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_and</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_and</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_or</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_or</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">|</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove_strong_ops</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remove_strong_ops</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">remove_strong_ops</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_strong_ops</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_strong_ops</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">remove_strong_ops</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">remove_strong_ops</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_strong_ops</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove_weak_ops</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remove_weak_ops</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">remove_weak_ops</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_weak_ops</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_weak_ops</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">remove_weak_ops</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">remove_weak_ops</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_weak_ops</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_finally</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_finally</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>remove_strong_ops <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_globally</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_globally</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>remove_weak_ops <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_until</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_until</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>
    <span class="main">|</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> mk_finally <span class="free"><span class="bound"><span class="entity">y</span></span></span>
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_release</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_release</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>
    <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> mk_globally <span class="free"><span class="bound"><span class="entity">y</span></span></span>
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_weak_until</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_weak_until</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>
    <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> mk_globally <span class="free"><span class="bound"><span class="entity">x</span></span></span>
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_strong_release</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_strong_release</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>
    <span class="main">|</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> mk_finally <span class="free"><span class="bound"><span class="entity">x</span></span></span>
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_next</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_next</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_next_pow</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub>''</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_next_pow</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⇒</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span>Next_ltln <span class="main">^^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>



<span class="keyword1"><span class="command">lemma</span></span> mk_and_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_and <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_and_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_or_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_or <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_or_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_strong_ops_sound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>remove_strong_ops <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remove_weak_ops_sound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>remove_weak_ops <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_finally_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_finally <span class="free">x</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_finally_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> remove_strong_ops.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_globally_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_globally <span class="free">x</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_globally_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> remove_weak_ops.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_until_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_until <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>True_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> True_ltln mk_until_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>False_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_until_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_until_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_release_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_release <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>False_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> False_ltln mk_release_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>True_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_release_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_release_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_weak_until_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_weak_until <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>False_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> False_ltln mk_weak_until_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>True_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_weak_until_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_weak_until_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_strong_release_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_strong_release <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>True_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> True_ltln mk_strong_release_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>False_ltln<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_strong_release_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_strong_release_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_next <span class="free">x</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_next_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_pow_semantics <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> mk_next_pow <span class="free">i</span> <span class="free">x</span> <span class="main">⟷</span> suffix <span class="free">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_next_pow_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_pow_simp <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mk_next_pow <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"mk_next_pow <span class="main">1</span> <span class="free">x</span> <span class="main">=</span> mk_next <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_next_pow_def mk_next_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Constant Propagation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_constant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_constant</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_constant</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_constant</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_constant_constructorsI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="free">y</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_and <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_and <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="free">y</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_or <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_or <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span>  is_constant <span class="main">(</span>mk_finally <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span>  <span class="main">¬</span>is_constant <span class="main">(</span>mk_finally <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_globally <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span>  <span class="main">¬</span>is_constant <span class="main">(</span>mk_globally <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_until <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_until <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_release <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_release <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="free">y</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_weak_until <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_weak_until <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="free">y</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_strong_release <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_strong_release <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_next <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_constant <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span>is_constant <span class="main">(</span>mk_next <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">x</span> <span class="main">⟹</span> is_constant <span class="main">(</span>mk_next_pow <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_and_def mk_or_def mk_finally_def mk_globally_def mk_until_def mk_release_def mk_weak_until_def mk_strong_release_def mk_next_def mk_next_pow_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_constant_constructors_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mk_next_pow <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"mk_next_pow <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_next_pow <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_next_pow_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_constant_constructors_simps2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_and <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_or <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_finally <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_globally <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_until <span class="free">y</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_release <span class="free">y</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_next <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_and_def<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_or_def<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">meson</span> is_constant_constructorsI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_constant_constructors_simps3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_weak_until <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"is_constant <span class="main">(</span>mk_strong_release <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_weak_until_def mk_strong_release_def is_constant_constructors_simps2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_constant_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">φ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> until_constant_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> release_constant_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_constant <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_pow_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mk_next_pow <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="free">φ</span> <span class="main">=</span> mk_next_pow <span class="free">i</span> <span class="main">(</span>mk_next_pow <span class="free">j</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_next_pow_def funpow_add<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_pow_until<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>min <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="free">i</span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="free">j</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_next_pow_dist min_def add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_pow_release<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffix <span class="main">(</span>min <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="free">i</span> <span class="free">φ</span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span>mk_next_pow <span class="free">j</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_next_pow_dist min_def add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹X-Normalisation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following rewrite functions pulls the X-operator up in the syntax tree. This preprocessing
  step enables the removal of X-operators in front of suspendable formulas. Furthermore constants are
  removed as far as possible.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">the_enat_0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"enat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">the_enat_0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">the_enat_0</span> <span class="main">∞</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> the_enat_0_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"the_enat_0 <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"the_enat_0 <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_enat_def one_enat_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">combine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">*</span> enat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">*</span> enat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">*</span> enat<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">combine</span> <span class="free"><span class="bound"><span class="entity">binop</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span>
      <span class="bound">χ</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">binop</span></span></span> <span class="main">(</span>mk_next_pow <span class="main">(</span>the_enat_0 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span>mk_next_pow <span class="main">(</span>the_enat_0 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>
    <span class="keyword1">in</span>
      <span class="main">(</span><span class="bound">χ</span><span class="main">,</span> <span class="keyword1">if</span> is_constant <span class="bound">χ</span> <span class="keyword1">then</span> <span class="main">∞</span> <span class="keyword1">else</span> min <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_combine<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fst <span class="main">(</span>combine <span class="free">binop</span> <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">binop</span> <span class="main">(</span>mk_next_pow <span class="main">(</span>the_enat_0 <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>mk_next_pow <span class="main">(</span>the_enat_0 <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> combine.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fstI<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">to_ltln</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">*</span> enat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_ltln</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> mk_next_pow <span class="main">(</span>the_enat_0 <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rewrite_X_enat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">*</span> enat<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> combine mk_and <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> combine mk_or <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> combine mk_until <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> combine mk_release <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> combine mk_weak_until <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> combine mk_strong_release <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_X_enat</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">φ</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">φ</span><span class="main">,</span> eSuc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_X_enat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite_X</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> to_ltln <span class="main">(</span>rewrite_X_enat <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> combine_infinity_invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"combine mk_and <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"combine mk_or <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"combine mk_until <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"combine mk_release <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"combine mk_weak_until <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"combine mk_strong_release <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Let_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_constant_constructorsI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> combine_and_or_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>combine mk_and <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>combine mk_or <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def is_constant_constructors_simps is_constant_constructors_simps2 assms<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_constant.elims<span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> combine_until_release_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>combine mk_until <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>combine mk_release <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_constant_constructors_simps is_constant_constructors_simps2
       until_constant_simp release_constant_simp mk_next_pow_until mk_next_pow_release <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> semantics_ltln.simps<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_constant_semantics<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(* TODO this proof is a bit slow and could be optimized *)</span>
<span class="keyword1"><span class="command">lemma</span></span> combine_weak_until_strong_release_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>combine mk_weak_until <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>combine mk_strong_release <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span><span class="free">ψ</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def is_constant_constructors_simps is_constant_constructors_simps3 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> semantics_ltln.simps<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>



<span class="keyword1"><span class="command">lemma</span></span> rewrite_X_enat_infinity_invariant<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rewrite_X_enat <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> is_constant <span class="main">(</span>fst <span class="main">(</span>rewrite_X_enat <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> combine_infinity_invariant<span class="main"><span class="main">[</span></span><span class="operator">OF</span> And_ltln<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> prod.collapse<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> combine_infinity_invariant<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Or_ltln<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> prod.collapse<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> combine_infinity_invariant<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Until_ltln<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> prod.collapse<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> combine_infinity_invariant<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Release_ltln<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> prod.collapse<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> combine_infinity_invariant<span class="main"><span class="main">[</span></span><span class="operator">OF</span> WeakUntil_ltln<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> prod.collapse<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> combine_infinity_invariant<span class="main"><span class="main">[</span></span><span class="operator">OF</span> StrongRelease_ltln<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> prod.collapse<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> eSuc_infinity eSuc_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_X_enat_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>rewrite_X_enat <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> combine_and_or_semantics<span class="main">[</span><span class="operator">OF</span> rewrite_X_enat_infinity_invariant rewrite_X_enat_infinity_invariant<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> combine_and_or_semantics<span class="main">[</span><span class="operator">OF</span> rewrite_X_enat_infinity_invariant rewrite_X_enat_infinity_invariant<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rewrite_X_enat.simps combine_until_release_semantics<span class="main">[</span><span class="operator">OF</span> rewrite_X_enat_infinity_invariant rewrite_X_enat_infinity_invariant<span class="main">,</span> <span class="operator">unfolded</span> prod.collapse<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rewrite_X_enat.simps combine_until_release_semantics<span class="main">[</span><span class="operator">OF</span> rewrite_X_enat_infinity_invariant rewrite_X_enat_infinity_invariant<span class="main">,</span> <span class="operator">unfolded</span> prod.collapse<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rewrite_X_enat.simps combine_weak_until_strong_release_semantics<span class="main">[</span><span class="operator">OF</span> rewrite_X_enat_infinity_invariant rewrite_X_enat_infinity_invariant<span class="main">,</span> <span class="operator">unfolded</span> prod.collapse<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rewrite_X_enat.simps combine_weak_until_strong_release_semantics<span class="main">[</span><span class="operator">OF</span> rewrite_X_enat_infinity_invariant rewrite_X_enat_infinity_invariant<span class="main">,</span> <span class="operator">unfolded</span> prod.collapse<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>rewrite_X_enat <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> suffix <span class="main">1</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> to_ltln <span class="main">(</span>rewrite_X_enat <span class="skolem">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rewrite_X_enat <span class="skolem">φ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rewrite_X_enat_infinity_invariant eSuc_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_constant_semantics<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> semantics_ltln.simps<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_X_sound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> rewrite_X <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rewrite_X_enat_correct <span class="keyword1"><span class="command">unfolding</span></span> rewrite_X_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pure Eventual, Pure Universal, and Suspendable Formulas›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pure_eventual</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">∧</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">∧</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">∧</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">∧</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">∧</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">μ'</span></span></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">pure_eventual</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_eventual</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pure_universal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">∧</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">∧</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">∧</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">∧</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">∧</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">pure_universal</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pure_universal</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">suspendable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">∧</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">∧</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> pure_universal <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">∨</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> pure_eventual <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">∨</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">∨</span> pure_eventual <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">∨</span> pure_universal <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">suspendable</span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">suspendable</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pure_eventual_left_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pure_eventual <span class="free">μ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">μ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span> <span class="main">⌢</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">μ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">μ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">μ</span> <span class="skolem">μ'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> suffix_conc_length suffix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">μ'</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>›</span></span> Until_ltln<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prefix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">μ'</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">μ</span> <span class="skolem">μ'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> linear suffix_conc_snd gr0I not_less0 prefix_suffix suffix_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">μ</span> <span class="skolem">μ'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> zero_le le0 nat_le_linear prefix_suffix suffix_0 suffix_conc_length suffix_conc_snd suffix_subseq_join<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">μ</span> <span class="skolem">μ'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">μ'</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> suffix_conc_length suffix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">μ</span> <span class="main">⟹</span> pure_eventual <span class="skolem">μ'</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">μ'</span>›</span></span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prefix_suffix semantics_ltln.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">μ</span> <span class="main">⟹</span> pure_eventual <span class="skolem">μ'</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> diff_zero le_0_eq not_less_eq_eq suffix_conc_length suffix_conc_snd word_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pure_universal_suffix_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pure_universal <span class="free">ν</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span> <span class="main">⌢</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ν</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ν</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ν</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">ν</span> <span class="skolem">ν'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> semantics_ltln.simps<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Until_ltln<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> le_0_eq le_eq_less_or_eq le_less_linear prefix_suffix pure_universal.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> suffix_conc_fst suffix_conc_snd<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">ν</span> <span class="skolem">ν'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν'</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less0 prefix_suffix suffix_0 suffix_conc_length suffix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">ν</span> <span class="skolem">ν'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_antisym prefix_suffix semantics_ltln.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> suffix_0 suffix_conc_length suffix_suffix zero_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">ν</span> <span class="skolem">ν'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌢</span> <span class="skolem">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ν'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> semantics_ltln.simps<span class="main">(</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> StrongRelease_ltln<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> diff_is_0_eq nat_le_linear prefix_conc_length prefix_suffix pure_universal.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> subsequence_length suffix_conc_snd suffix_subseq_join<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">μ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prefix_suffix pure_universal.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> semantics_ltln.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> suffix_conc_length suffix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> suspendable_prefix_invariant<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suspendable <span class="free">ξ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span> <span class="main">⌢</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ξ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">ξ</span> <span class="skolem">ξ'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"suspendable <span class="skolem">ξ'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pure_universal <span class="skolem">ξ'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Until_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> linear pure_universal_suffix_closed suffix_conc_fst suffix_conc_length suffix_conc_snd suffix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> Until_ltln<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less0 prefix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">ξ</span> <span class="skolem">ξ'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"suspendable <span class="skolem">ξ'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">ξ'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Release_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> le_iff_add add_diff_cancel_left' linear pure_eventual_left_append suffix_0 suffix_conc_fst suffix_conc_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> Release_ltln<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less0 prefix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">ξ</span> <span class="skolem">ξ'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"suspendable <span class="skolem">ξ</span> <span class="main">∧</span> suspendable <span class="skolem">ξ'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ'</span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">ξ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> WeakUntil_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> le_iff_add add_diff_cancel_left' linear pure_eventual_left_append suffix_0 suffix_conc_fst suffix_conc_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> WeakUntil_ltln.IH prefix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">ξ</span> <span class="skolem">ξ'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"suspendable <span class="skolem">ξ</span> <span class="main">∧</span> suspendable <span class="skolem">ξ'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ'</span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pure_universal <span class="skolem">ξ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> StrongRelease_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> linear pure_universal_suffix_closed suffix_conc_fst suffix_conc_length suffix_conc_snd suffix_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> StrongRelease_ltln.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> StrongRelease_ltln.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prefix_suffix<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> prefix_suffix<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> pure_eventual_until_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="free">μ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">μ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">μ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">μ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pure_eventual_left_append<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> prefix_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pure_universal_release_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pure_universal <span class="free">ν</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ν</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ν</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ν</span> <span class="main">⟹</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pure_universal_suffix_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> prefix_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pure_universal_weak_until_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pure_universal <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pure_universal <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟹</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms pure_universal_suffix_closed prefix_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pure_eventual_strong_release_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pure_eventual <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms pure_eventual_left_append prefix_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> suspendable_formula_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suspendable <span class="free">ξ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t3</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suspendable_prefix_invariant<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> prefix_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="var"><span class="quoted"><span class="var">?t3</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> suspendable_formula_simp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suspendable <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suspendable <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms suspendable_prefix_invariant prefix_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rewrite_modal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> pure_eventual <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> suspendable <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> pure_universal <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> suspendable <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> pure_universal <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> pure_universal <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> suspendable <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> suspendable <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> pure_eventual <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> pure_eventual <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> suspendable <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> suspendable <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> suspendable <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">then</span> <span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">else</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_modal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_modal_sound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> rewrite_modal <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">ψ</span> <span class="main">∨</span> suspendable <span class="skolem">ψ</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> pure_eventual_until_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span><span class="main"><span class="main">]</span></span> suspendable_formula_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pure_universal <span class="skolem">ψ</span> <span class="main">∨</span> suspendable <span class="skolem">ψ</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> pure_universal_release_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span><span class="main"><span class="main">]</span></span> suspendable_formula_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeakUntil_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pure_universal <span class="skolem">φ</span> <span class="main">∧</span> pure_universal <span class="skolem">ψ</span> <span class="main">∨</span> suspendable <span class="skolem">φ</span> <span class="main">∧</span> suspendable <span class="skolem">ψ</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> pure_universal_weak_until_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span><span class="main"><span class="main">]</span></span> suspendable_formula_simp2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrongRelease_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pure_eventual <span class="skolem">φ</span> <span class="main">∧</span> pure_eventual <span class="skolem">ψ</span> <span class="main">∨</span> suspendable <span class="skolem">φ</span> <span class="main">∧</span> suspendable <span class="skolem">ψ</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> pure_eventual_strong_release_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span><span class="main"><span class="main">]</span></span> suspendable_formula_simp2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ψ</span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">φ</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"suspendable <span class="skolem">φ</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> suspendable_formula_simp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_modal_size<span class="main">:</span>
  <span class="quoted"><span class="quoted">"size <span class="main">(</span>rewrite_modal <span class="free">φ</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Syntactical Implication Based Simplification›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">syntactical_implies</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> _"</span> <span class="main">[</span>80<span class="main">,</span> 80<span class="main">]</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> syntactical_implies_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> syntactical_implies.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rewrite_syn_imp</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite_syn_imp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span>
      <span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">then</span>
      <span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">then</span>
      <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>
    <span class="keyword1">else</span>
      mk_and <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_syn_imp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span>
      <span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">then</span>
      <span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">then</span>
      <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>
    <span class="keyword1">else</span>
      mk_or <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_syn_imp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span>
      <span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">then</span>
      mk_finally <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span>
      mk_until <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_syn_imp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">then</span>
      <span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">then</span>
      mk_globally <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span>
      mk_release <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_syn_imp</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> mk_next <span class="main">(</span><span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rewrite_syn_imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_syn_imp_sound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> rewrite_syn_imp <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> And_ltln
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> syntactical_implies_correct not<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ψ</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> syntactical_implies_correct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"not<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">φ</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">ψ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">φ</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">φ</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> syntactical_implies_correct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"not<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">ψ</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> syntactical_implies_correct<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ψ</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Until_ltln <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> syntactical_implies_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">φ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ψ</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rewrite_syn_imp <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span><span class="main">)</span> <span class="main">=</span> mk_finally <span class="main">(</span>rewrite_syn_imp <span class="skolem">ψ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_less_Least <span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> LeastI <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>›</span></span> i_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> syntactical_implies_correct<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> rewrite_syn_imp.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> Until_ltln<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">φ</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Release_ltln <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> syntactical_implies_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>not<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">ψ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">φ</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rewrite_syn_imp <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span><span class="main">)</span> <span class="main">=</span> mk_globally <span class="main">(</span>rewrite_syn_imp <span class="skolem">ψ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">.</span> suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_less_Least <span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> LeastI <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>›</span></span> i_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">.</span> <span class="main">¬</span>suffix <span class="bound">j</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> suffix <span class="skolem">i</span> <span class="skolem">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> syntactical_implies_correct<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> rewrite_syn_imp.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> Release_ltln<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Iterated Rewriting›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">iterate</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iterate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">iterate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="bound">x'</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free">iterate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite_iter_fast</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> iterate <span class="main">(</span>rewrite_modal <span class="keyword1">o</span> rewrite_X<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span>size <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite_iter_slow</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> iterate <span class="main">(</span>rewrite_syn_imp <span class="keyword1">o</span> rewrite_modal <span class="keyword1">o</span> rewrite_X<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span>size <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The rewriting functions defined in the previous subsections can be used as-is. However, in the
  most cases one wants to iterate these rules until the formula cannot be simplified further.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rewrite_iter_fast<span class="antiquote"><span class="antiquote">}</span></span></span></span> pulls X operators up in the syntax tree and the uses the
  "modal" simplification rules. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rewrite_iter_slow<span class="antiquote"><span class="antiquote">}</span></span></span></span> additionally tries to simplify the
  formula using syntactic implication checking.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iterate_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">f</span> <span class="bound">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> iterate <span class="free">f</span> <span class="free">φ</span> <span class="free">n</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> rewrite_iter_fast_sound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> rewrite_iter_fast <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iterate_sound<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"rewrite_modal <span class="keyword1">o</span> rewrite_X"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> comp_def rewrite_modal_sound rewrite_X_sound rewrite_iter_fast_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> rewrite_iter_slow_sound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> rewrite_iter_slow <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iterate_sound<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"rewrite_syn_imp <span class="keyword1">o</span> rewrite_modal <span class="keyword1">o</span> rewrite_X"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> comp_def rewrite_modal_sound rewrite_X_sound rewrite_syn_imp_sound rewrite_iter_slow_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preservation of atoms›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iterate_atoms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> atoms_ltln <span class="main">(</span><span class="free">f</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="bound">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>iterate <span class="free">f</span> <span class="free">φ</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms in_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_modal_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>rewrite_modal <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_and_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_and <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span> <span class="main">∪</span> atoms_ltln <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_and_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_or_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_or <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span> <span class="main">∪</span> atoms_ltln <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_or_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_strong_ops_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>remove_strong_ops <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_weak_ops_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>remove_weak_ops <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_finally_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_finally <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_finally_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> remove_strong_ops_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_globally_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_globally <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_globally_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> remove_weak_ops_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_until_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_until <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span> <span class="main">∪</span> atoms_ltln <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_until_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> mk_finally_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_release_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_release <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span> <span class="main">∪</span> atoms_ltln <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_release_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> mk_globally_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_weak_until_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_weak_until <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span> <span class="main">∪</span> atoms_ltln <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_weak_until_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> mk_globally_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_strong_release_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_strong_release <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span> <span class="main">∪</span> atoms_ltln <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_strong_release_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> mk_finally_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_next <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_next_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_next_pow_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>mk_next_pow <span class="free">n</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_next_pow_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ltln.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> combine_atoms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">ψ</span><span class="main">.</span> atoms_ltln <span class="main">(</span><span class="free">f</span> <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="bound">φ</span> <span class="main">∪</span> atoms_ltln <span class="bound">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>fst <span class="main">(</span>combine <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> atoms_ltln <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fst_combine mk_next_pow_atoms prod.collapse<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> combine_mk_atoms <span class="main">=</span>
  combine_atoms<span class="main">[</span><span class="operator">OF</span> mk_and_atoms<span class="main">]</span>
  combine_atoms<span class="main">[</span><span class="operator">OF</span> mk_or_atoms<span class="main">]</span>
  combine_atoms<span class="main">[</span><span class="operator">OF</span> mk_until_atoms<span class="main">]</span>
  combine_atoms<span class="main">[</span><span class="operator">OF</span> mk_release_atoms<span class="main">]</span>
  combine_atoms<span class="main">[</span><span class="operator">OF</span> mk_weak_until_atoms<span class="main">]</span>
  combine_atoms<span class="main">[</span><span class="operator">OF</span> mk_strong_release_atoms<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_X_enat_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>fst <span class="main">(</span>rewrite_X_enat <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> combine_mk_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_X_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>rewrite_X <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rewrite_X_def mk_next_pow_atoms case_prod_beta<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> combine_mk_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_syn_imp_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>rewrite_syn_imp <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_and_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_or_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next_ltln <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_next_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_finally_atoms mk_until_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Release_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_globally_atoms mk_release_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_iter_fast_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>rewrite_iter_fast <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> atoms_ltln <span class="main">(</span>rewrite_modal <span class="main">(</span>rewrite_X <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="bound">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rewrite_modal_atoms rewrite_X_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rewrite_iter_fast_def 1 iterate_atoms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rewrite_iter_slow_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>rewrite_iter_slow <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> atoms_ltln <span class="main">(</span>rewrite_syn_imp <span class="main">(</span>rewrite_modal <span class="main">(</span>rewrite_X <span class="bound">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="bound">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rewrite_syn_imp_atoms rewrite_modal_atoms rewrite_X_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rewrite_iter_slow_def 1 iterate_atoms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simplifier›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define a convenience wrapper for the rewriting engine›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> mode <span class="main">=</span> Nop <span class="main">|</span> Fast <span class="main">|</span> Slow

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">simplify</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mode <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">simplify</span> Nop <span class="main">=</span> id"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">simplify</span> Fast <span class="main">=</span> rewrite_iter_fast"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">simplify</span> Slow <span class="main">=</span> rewrite_iter_slow"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> simplify_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> simplify <span class="free">m</span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> simplify_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"atoms_ltln <span class="main">(</span>simplify <span class="free">m</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⊆</span> atoms_ltln <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> rewrite_iter_fast_atoms rewrite_iter_slow_atoms<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Generation›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">syntactical_implies</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">simplify</span></span> <span class="keyword2"><span class="keyword">checking</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rewrite_iter_fast <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">G<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rewrite_iter_fast <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rewrite_iter_slow <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="keyword1">F<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Equivalence_Relations">
<div class="head">
<h1>Theory Equivalence_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Equivalence Relations for LTL formulas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Equivalence_Relations
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="LTL.html">LTL</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Language Equivalence›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltl_lang_equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span>"</span> 75<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">∼<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟷</span> <span class="bound">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_lang_equiv_equivp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivp <span class="keyword1">(∼<span class="hidden">⇩</span><sub>L</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equivpI reflp_def symp_def transp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_lang_equiv_and_true<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_lang_equiv_and_false<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_lang_equiv_or_false<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_lang_equiv_or_const<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_lang_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Propositional Equivalence›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ltl_prop_entailment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span>"</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_entailment_monotonI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">S'</span> <span class="main">⟹</span> <span class="free">S'</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_models_equiv_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">{</span><span class="bound">ψ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">ψ</span><span class="main">}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltl_prop_equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span>"</span> 75<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">∼<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="bound">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟷</span> <span class="bound">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltl_prop_implies</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span>"</span> 75<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">⟶<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="bound">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟶</span> <span class="bound">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_implies_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">φ</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">∧</span> <span class="free">ψ</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_prop_equiv_def ltl_prop_implies_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_equivp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivp <span class="keyword1">(∼<span class="hidden">⇩</span><sub>P</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def equivpI reflp_def symp_def transp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">χ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="main">{}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bot.extremum ltl_prop_entailment.simps<span class="main">(</span>1<span class="main">)</span> ltl_prop_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="main">¬</span> UNIV <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ltl_prop_entailment.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_prop_entailment_monotonI ltl_prop_equiv_def top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_true_implies_true<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def ltl_prop_implies_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_false_implied_by_false<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def ltl_prop_implies_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_implication_implies_ltl_implication<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_models_equiv_prop_entailment ltl_prop_implies_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_implies_ltl_lang_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_lang_equiv_def ltl_prop_implication_implies_ltl_implication ltl_prop_implies_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_lt_ltl_lang_equiv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>P</sub>)</span> <span class="main">≤</span> <span class="keyword1">(∼<span class="hidden">⇩</span><sub>L</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_prop_equiv_implies_ltl_lang_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Constants Equivalence›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> tvl <span class="main">=</span> Yes <span class="main">|</span> No <span class="main">|</span> Maybe

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval_and</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tvl <span class="main">⇒</span> tvl <span class="main">⇒</span> tvl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_and</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
      <span class="main">(</span>Yes<span class="main">,</span> Yes<span class="main">)</span> <span class="main">⇒</span> Yes
    <span class="main">|</span> <span class="main">(</span>No<span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> No
    <span class="main">|</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> No<span class="main">)</span> <span class="main">⇒</span> No
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> Maybe<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval_or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tvl <span class="main">⇒</span> tvl <span class="main">⇒</span> tvl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_or</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
      <span class="main">(</span>No<span class="main">,</span> No<span class="main">)</span> <span class="main">⇒</span> No
    <span class="main">|</span> <span class="main">(</span>Yes<span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> Yes
    <span class="main">|</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> Yes<span class="main">)</span> <span class="main">⇒</span> Yes
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> Maybe<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> tvl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> Yes"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> No"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> eval_and <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> eval_or <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> Maybe"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_and_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval_and <span class="free">φ</span> <span class="free">ψ</span> <span class="main">=</span> No <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> No <span class="main">∨</span> <span class="free">ψ</span> <span class="main">=</span> No"</span></span>
  <span class="quoted"><span class="quoted">"eval_and <span class="free">φ</span> <span class="free">ψ</span> <span class="main">=</span> Yes <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> Yes <span class="main">∧</span> <span class="free">ψ</span> <span class="main">=</span> Yes"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_and_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_or_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval_or <span class="free">φ</span> <span class="free">ψ</span> <span class="main">=</span> Yes <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> Yes <span class="main">∨</span> <span class="free">ψ</span> <span class="main">=</span> Yes"</span></span>
  <span class="quoted"><span class="quoted">"eval_or <span class="free">φ</span> <span class="free">ψ</span> <span class="main">=</span> No <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> No <span class="main">∧</span> <span class="free">ψ</span> <span class="main">=</span> No"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_or_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">ψ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval <span class="free">φ</span> <span class="main">=</span> Yes <span class="main">⟷</span> <span class="main">{}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"eval <span class="free">φ</span> <span class="main">=</span> No <span class="main">⟷</span> <span class="main">¬</span> UNIV <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltl_const_equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span>"</span> 75<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1"><span class="free">∼<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∨</span> <span class="main">(</span>eval <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> eval <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> eval <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≠</span> Maybe<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_equivp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivp <span class="keyword1">(∼<span class="hidden">⇩</span><sub>C</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equivpI reflpI sympI transpI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> eval <span class="free">φ</span> <span class="main">=</span> Yes"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> eval <span class="free">φ</span> <span class="main">=</span> No"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_and_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_or_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∨</span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_other<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="keyword1">prop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="keyword1">nprop<span class="hidden">⇩</span><sub>n</sub>(</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_const_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_no_const_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval <span class="free">ψ</span> <span class="main">=</span> Maybe <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_implies_prop_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_const eval_prop_entailment ltl_prop_equiv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_no_const_prop_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval <span class="free">ψ</span> <span class="main">=</span> Maybe <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_const_equiv_no_const_singleton equivp_reflp<span class="main">[</span><span class="operator">OF</span> ltl_prop_equiv_equivp<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_implies_ltl_prop_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ψ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">ψ1</span> <span class="skolem">ψ2</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval <span class="main">(</span><span class="skolem">ψ1</span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Yes

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> And_ltln.prems equivp_transp ltl_const_equiv_const<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_const_equiv_equivp<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Yes ltl_const_equiv_const<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_const_equiv_implies_prop_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_prop_equiv_trans ltl_prop_implies_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> No

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> And_ltln.prems equivp_transp ltl_const_equiv_const<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_const_equiv_equivp<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> No ltl_const_equiv_const<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_const_equiv_implies_prop_equiv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_prop_equiv_trans ltl_prop_implies_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Maybe

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> And_ltln.prems ltl_const_equiv_no_const_prop_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">ψ1</span> <span class="skolem">ψ2</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval <span class="main">(</span><span class="skolem">ψ1</span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">ψ2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Yes

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Or_ltln.prems equivp_transp ltl_const_equiv_const<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_const_equiv_equivp<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Yes ltl_const_equiv_const<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_const_equiv_implies_prop_equiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ltl_prop_equiv_trans ltl_prop_implies_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> No

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Or_ltln.prems equivp_transp ltl_const_equiv_const<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_const_equiv_equivp<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> No ltl_const_equiv_const<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_const_equiv_implies_prop_equiv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ltl_prop_equiv_trans ltl_prop_implies_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Maybe

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Or_ltln.prems ltl_const_equiv_no_const_prop_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_const_equiv_implies_prop_equiv equivp_reflp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ltl_prop_equiv_equivp<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_const_equiv_lt_ltl_prop_equiv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>C</sub>)</span> <span class="main">≤</span> <span class="keyword1">(∼<span class="hidden">⇩</span><sub>P</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_const_equiv_implies_ltl_prop_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quotient types›</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> <span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>L</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="main">/</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>L</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ltl_lang_equiv_equivp<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> ltln<span class="hidden">⇩</span><sub>L</sub> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ltln<span class="hidden">⇩</span><sub>L</sub>_eq_test <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>L</sub> <span class="main">⇒</span> <span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>L</sub> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln<span class="hidden">⇩</span><sub>L</sub>.abs_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  eq<span class="hidden">⇩</span><sub>L</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"equal_class.equal <span class="main">≡</span> ltln<span class="hidden">⇩</span><sub>L</sub>_eq_test"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="hidden">⇩</span><sub>L</sub> ltln<span class="hidden">⇩</span><sub>L</sub>_eq_test.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Quotient_ltln<span class="hidden">⇩</span><sub>L</sub> Quotient_rel_rep<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">quotient_type</span></span> <span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="main">/</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>P</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ltl_prop_equiv_equivp<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ltln<span class="hidden">⇩</span><sub>P</sub>_eq_test <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">⇒</span> <span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln<span class="hidden">⇩</span><sub>P</sub>.abs_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  eq<span class="hidden">⇩</span><sub>P</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"equal_class.equal <span class="main">≡</span> ltln<span class="hidden">⇩</span><sub>P</sub>_eq_test"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="hidden">⇩</span><sub>P</sub> ltln<span class="hidden">⇩</span><sub>P</sub>_eq_test.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Quotient_ltln<span class="hidden">⇩</span><sub>P</sub> Quotient_rel_rep<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">quotient_type</span></span> <span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln"</span></span> <span class="main">/</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>C</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ltl_const_equiv_equivp<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> ltln<span class="hidden">⇩</span><sub>C</sub> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ltln<span class="hidden">⇩</span><sub>C</sub>_eq_test <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> <span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ltln<span class="hidden">⇩</span><sub>C</sub>.abs_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  eq<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"equal_class.equal <span class="main">≡</span> ltln<span class="hidden">⇩</span><sub>C</sub>_eq_test"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="hidden">⇩</span><sub>C</sub> ltln<span class="hidden">⇩</span><sub>C</sub>_eq_test.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Quotient_ltln<span class="hidden">⇩</span><sub>C</sub> Quotient_rel_rep<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of propositional quotient sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sat_models</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">⇒</span> <span class="tfree">'a</span> ltln set set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sat_models</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">𝒜</span><span class="main">.</span> <span class="bound">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> rep_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_prop_entailment<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> rep_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Quotient3_ltln<span class="hidden">⇩</span><sub>P</sub> Quotient3_rep_abs ltl_prop_equiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_Abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">∈</span> sat_models <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sat_models_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj sat_models"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> injI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">ψ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln<span class="hidden">⇩</span><sub>P</sub>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sat_models <span class="skolem">φ</span> <span class="main">=</span> sat_models <span class="skolem">ψ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="skolem">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> rep_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sat_models_def ltl_prop_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Quotient3_ltln<span class="hidden">⇩</span><sub>P</sub> Quotient3_rel_rep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">prop_atoms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prop_atoms</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prop_atoms</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nested_prop_atoms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">X<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">U<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">R<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">W<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">M<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nested_prop_atoms</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prop_atoms_nested_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prop_atoms <span class="free">φ</span> <span class="main">⊆</span> nested_prop_atoms <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_atoms_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prop_atoms <span class="free">φ</span> <span class="main">⊆</span> subfrmlsn <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_subfrmlsn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">φ</span> <span class="main">⊆</span> subfrmlsn <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_atoms_notin<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∉</span> prop_atoms <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∉</span> prop_atoms <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> prop_atoms <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> prop_atoms <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_notin<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∉</span> nested_prop_atoms <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∉</span> nested_prop_atoms <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> nested_prop_atoms <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> nested_prop_atoms <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_atoms_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>prop_atoms <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nested_prop_atoms <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_atoms_entailment_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> prop_atoms <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">𝒜</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_atoms_entailment_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prop_atoms <span class="free">φ</span> <span class="main">⊆</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒜</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nested_prop_atoms_entailment_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nested_prop_atoms <span class="free">φ</span> <span class="main">⊆</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒜</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_inter_inj_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"prop_atoms <span class="free">φ</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"prop_atoms <span class="free">ψ</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"sat_models <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="free">φ</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="free">P</span> <span class="main">=</span> sat_models <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="free">ψ</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">(</span><span class="bound">𝒜</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">𝒜</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sat_models_Abs<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prop_atoms_entailment_inter ltl_prop_equiv_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_inter_inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> sat_models <span class="bound">φ</span> <span class="main">∩</span> Pow <span class="free">P</span><span class="main">)</span> <span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">φ</span> <span class="main">|</span><span class="bound">φ</span><span class="main">.</span> prop_atoms <span class="bound">φ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def sat_models_inter_inj_helper ltln<span class="hidden">⇩</span><sub>P</sub>.abs_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_pow_pow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span>sat_models <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">φ</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="free">P</span> <span class="main">|</span> <span class="bound">φ</span><span class="main">.</span> prop_atoms <span class="bound">φ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span> <span class="main">⊆</span> Pow <span class="main">(</span>Pow <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sat_models_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">⟹</span> finite <span class="main">{</span>sat_models <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">φ</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="free">P</span> <span class="main">|</span> <span class="bound">φ</span><span class="main">.</span> prop_atoms <span class="bound">φ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sat_models_pow_pow finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_models_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">⟹</span> card <span class="main">(</span><span class="main">{</span>sat_models <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">φ</span><span class="main">)</span> <span class="main">∩</span> Pow <span class="free">P</span> <span class="main">|</span> <span class="bound">φ</span><span class="main">.</span> prop_atoms <span class="bound">φ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sat_models_pow_pow Pow_def card_Pow card_mono finite_Collect_subsets<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> image_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="free">g</span> <span class="bound">a</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_equiv_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">⟹</span> finite <span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">ψ</span> <span class="main">|</span> <span class="bound">ψ</span><span class="main">.</span> prop_atoms <span class="bound">ψ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_filter sat_models_finite finite_imageD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sat_models_inter_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_equiv_card<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">⟹</span> card <span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">ψ</span> <span class="main">|</span> <span class="bound">ψ</span><span class="main">.</span> prop_atoms <span class="bound">ψ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_filter sat_models_card card_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sat_models_inter_inj<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> prop_equiv_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">ψ</span> <span class="main">|</span><span class="bound">ψ</span><span class="main">.</span> nested_prop_atoms <span class="bound">ψ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">ψ</span> <span class="main">|</span><span class="bound">ψ</span><span class="main">.</span> prop_atoms <span class="bound">ψ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop_atoms_nested_prop_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_equiv_finite'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">⟹</span> finite <span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">ψ</span> <span class="main">|</span> <span class="bound">ψ</span><span class="main">.</span> nested_prop_atoms <span class="bound">ψ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop_equiv_finite prop_equiv_subset finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> prop_equiv_card'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">P</span> <span class="main">⟹</span> card <span class="main">{</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="bound">ψ</span> <span class="main">|</span> <span class="bound">ψ</span><span class="main">.</span> nested_prop_atoms <span class="bound">ψ</span> <span class="main">⊆</span> <span class="free">P</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> card <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> prop_equiv_card prop_equiv_subset prop_equiv_finite card_mono le_trans<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitution›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">⇀</span> <span class="tfree">'a</span> ltln<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">of</span> Some <span class="bound">ψ</span> <span class="main">⇒</span> <span class="bound">ψ</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Based on Uwe Schoening's Translation Lemma (Logic for CS, p. 54)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_subst_S<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> subst <span class="free">φ</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> dom <span class="free">m</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">χ</span> <span class="main">|</span> <span class="bound">χ</span> <span class="bound">χ'</span><span class="main">.</span> <span class="bound">χ</span> <span class="main">∈</span> dom <span class="free">m</span> <span class="main">∧</span> <span class="free">m</span> <span class="bound">χ</span> <span class="main">=</span> Some <span class="bound">χ'</span> <span class="main">∧</span> <span class="free">S</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">χ'</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_respects_ltl_prop_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> subst <span class="free">φ</span> <span class="free">m</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> subst <span class="free">ψ</span> <span class="free">m</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> subst <span class="free">φ</span> <span class="free">m</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> subst <span class="free">ψ</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_prop_equiv_def ltl_prop_implies_def ltl_prop_equiv_subst_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> eval_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval <span class="free">φ</span> <span class="main">=</span> Yes <span class="main">⟹</span> eval <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Yes"</span></span>
  <span class="quoted"><span class="quoted">"eval <span class="free">φ</span> <span class="main">=</span> No <span class="main">⟹</span> eval <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> No"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> empty_subsetI eval_prop_entailment ltl_prop_entailment_monotonI ltl_prop_equiv_subst_S subset_UNIV<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_respects_ltl_const_entailment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> subst <span class="free">φ</span> <span class="free">m</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> subst <span class="free">ψ</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_const_equiv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval <span class="free">ψ</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> eval_subst<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> eval_subst<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Order of Equivalence Relations›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ltl_equivalence <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 75<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    eq_equivp<span class="main">:</span> <span class="quoted"><span class="quoted">"equivp <span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    ge_const_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>C</sub>)</span> <span class="main">≤</span> <span class="main"><span class="free">(∼)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    le_lang_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(∼)</span></span> <span class="main">≤</span> <span class="keyword1">(∼<span class="hidden">⇩</span><sub>L</sub>)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_implies_ltl_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">φ</span> <span class="main">=</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_lang_equiv ltl_lang_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> const_implies_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ge_const_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_implies_lang<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_lang_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_refl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eq_equivp equivp_reflp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_sym<span class="main">[</span><span class="operator">sym</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main"><span class="free">∼</span></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eq_equivp equivp_symp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main"><span class="free">∼</span></span> <span class="free">χ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main"><span class="free">∼</span></span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eq_equivp equivp_transp<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ltl_lang_equivalence<span class="main">:</span> ltl_equivalence <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>L</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_lang_equiv_equivp ltl_const_equiv_lt_ltl_prop_equiv ltl_prop_equiv_lt_ltl_lang_equiv
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ltl_prop_equivalence<span class="main">:</span> ltl_equivalence <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>P</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_prop_equiv_equivp ltl_const_equiv_lt_ltl_prop_equiv ltl_prop_equiv_lt_ltl_lang_equiv
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ltl_const_equivalence<span class="main">:</span> ltl_equivalence <span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>C</sub>)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_const_equiv_equivp ltl_const_equiv_lt_ltl_prop_equiv ltl_prop_equiv_lt_ltl_lang_equiv
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Disjunctive_Normal_Form">
<div class="head">
<h1>Theory Disjunctive_Normal_Form</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    Author:   Salomon Sickert
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Disjunctive Normal Form of LTL formulas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Disjunctive_Normal_Form
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="LTL.html">LTL</a> <a href="Equivalence_Relations.html">Equivalence_Relations</a> <span class="quoted">"<a href="../../HOL/HOL-Library/FSet.html">HOL-Library.FSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We use the propositional representation of LTL formulas to define
  the minimal disjunctive normal form of our formulas. For this purpose
  we define the minimal product <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊗<span class="hidden">⇩</span><sub>m</sub>›</span></span></span></span> and union <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∪<span class="hidden">⇩</span><sub>m</sub>›</span></span></span></span>.
  In the end we show that for a set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>𝒜›</span></span></span></span> of literals,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">𝒜</span></span> <span class="keyword1"><span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if, and only if, there exists a subset
  of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>𝒜›</span></span></span></span> in the minimal DNF of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>φ›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Minimum Sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ord<span class="main">)</span> <span class="entity">min_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_set</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> min_set <span class="free">X</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span>min_set <span class="free">X</span><span class="main">)</span> <span class="main">=</span> min_set <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_set_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> finite <span class="main">(</span>min_set <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_obtains_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">|⊆|</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">∈</span> min_set <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"fcard <span class="free">A</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">∉</span> <span class="free">B</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">A'</span> <span class="main">|⊆|</span> <span class="skolem">A</span> <span class="main">∨</span> <span class="bound">A'</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">|⊆|</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">A'</span> <span class="main">∈</span> min_set <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> dual_order.trans order.not_eq_order_implies_strict pfsubset_fcard_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> less.prems min_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_obtains<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">C</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">|⊆|</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> min_set <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_set_obtains_helper assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Minimal operators on sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fset set <span class="main">⇒</span> <span class="tfree">'a</span> fset set <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span> <span class="main">|</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fset set <span class="main">⇒</span> <span class="tfree">'a</span> fset set <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">⊗<span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> min_set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⊗</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fset set <span class="main">⇒</span> <span class="tfree">'a</span> fset set <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">∪<span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> min_set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">product_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fset set set <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⨂</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⨂</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> Finite_Set.fold product <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_product_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fset set set <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⨂<span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> Finite_Set.fold min_product <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> min_product_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span> <span class="main">=</span> min_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_product_def product_def min_set_def<span class="main">)</span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span> <span class="main">=</span> min_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_union_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> product_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊗</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊗</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{}</span> <span class="main">=</span> min_set <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span> <span class="main">=</span> min_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_union_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> product_empty_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊗</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">⊗</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_empty_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">=</span> min_set <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span> <span class="main">=</span> min_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> product_singleton_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊗</span> <span class="main">{</span><span class="main">{|</span><span class="free">x</span><span class="main">|}</span><span class="main">}</span> <span class="main">=</span> finsert <span class="free">x</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{|</span><span class="free">x</span><span class="main">|}</span><span class="main">}</span> <span class="main">⊗</span> <span class="free">A</span> <span class="main">=</span> finsert <span class="free">x</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> product_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⊗</span> <span class="free">C</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">lemma</span></span> product_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="free">B</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_def finite_image_set2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="free">B</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_product_def product_finite min_set_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="free">B</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_union_def min_set_finite<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> product_set_infinite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="free">X</span> <span class="main">⟹</span> <span class="main">⨂</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_infinite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="free">X</span> <span class="main">⟹</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_set_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> product_comm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">⊗</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_comm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_product_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_comm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_comm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_union_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> product_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span> <span class="main">|⊆|</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_product_def min_set_iff product_iff product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">|⊆|</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">b</span> <span class="main">|⊆|</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_union_def min_set_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> min_set_min_product_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>min_set <span class="free">A</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>min_set <span class="free">A</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> min_set <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">|∪|</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> min_set <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span> <span class="main">|⊆|</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">|∪|</span> <span class="bound">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> min_product_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="skolem">b'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">|∪|</span> <span class="skolem">b'</span> <span class="main">|⊆|</span> <span class="skolem">x</span>"</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a''</span> <span class="main">|⊆|</span> <span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a''</span> <span class="main">∈</span> min_set <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> min_set_obtains <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a''</span> <span class="main">|∪|</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">|∪|</span> <span class="skolem">b'</span> <span class="main">|⊆|</span> <span class="skolem">x</span>›</span></span> dual_order.trans le_sup_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">|∪|</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">|∪|</span> <span class="skolem">b'</span> <span class="main">|⊆|</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a''</span> <span class="main">|⊆|</span> <span class="skolem">a'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_product_iff min_set_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span><span class="main">.</span> <span class="bound">y</span> <span class="main">|⊆|</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> min_product_def min_set_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>min_set <span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span><span class="main">.</span> <span class="bound">y</span> <span class="main">|⊆|</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> product_iff min_set_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> min_set <span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 funion_mono min_set_obtains order_refl product_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> min_set <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2 min_product_def min_set_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_min_product<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>min_set <span class="free">A</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>min_set <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_product_comm min_set_min_product_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_min_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>min_set <span class="free">A</span><span class="main">)</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>min_set <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> min_union_def min_set_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xa</span> <span class="bound">xb</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∀</span><span class="bound">xa</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">|⊆|</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">B</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">|⊆|</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">xa</span> <span class="main">=</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="bound">xa</span> <span class="main">|⊆|</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">xb</span> <span class="main">|∈|</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">xb</span> <span class="main">|∈|</span> <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> UnCI dual_order.trans fequalityI min_set_def min_set_obtains<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xa</span> <span class="bound">xb</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∀</span><span class="bound">xa</span><span class="main">∈</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="bound">x</span> <span class="main">|⊆|</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">|⊆|</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">xa</span> <span class="main">=</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">xa</span> <span class="main">|⊆|</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">xb</span> <span class="main">|∈|</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">xb</span> <span class="main">|∈|</span> <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> UnCI dual_order.trans fequalityI min_set_def min_set_obtains<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> product_assoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊗</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> product_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">|∪|</span> <span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">b</span> <span class="main">|∪|</span> <span class="bound">c</span> <span class="main">|</span><span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a'</span> <span class="bound">bc</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">|∪|</span> <span class="skolem">b</span> <span class="main">|∪|</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">a'</span> <span class="main">|∪|</span> <span class="bound">bc</span> <span class="main">∧</span> <span class="bound">a'</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">bc</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">b</span> <span class="main">|∪|</span> <span class="bound">c</span> <span class="main">|</span><span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> sup_left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq sup_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_assoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_product_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> min_product_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_assoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_union_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> min_union_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_union_def sup_assoc<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> min_product_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">|⊆|</span> <span class="main">(</span><span class="free">a</span> <span class="main">|∪|</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq min_product_def product_def min_set_obtains<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">|⊆|</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff min_set_obtains min_union_def<span class="main">)</span>


<span class="keyword1"><span class="command">interpretation</span></span> product_set_thms<span class="main">:</span> Finite_Set.comp_fun_commute <span class="quoted">product</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊗</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊗</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> product_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> product_comm<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="bound">y</span> <span class="main">∘</span> <span class="main">(⊗)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(⊗)</span> <span class="bound">x</span> <span class="main">∘</span> <span class="main">(⊗)</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> min_product_set_thms<span class="main">:</span> Finite_Set.comp_fun_idem <span class="quoted">min_product</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="bound">y</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> min_product_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> min_product_comm<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">y</span> <span class="main">∘</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">∘</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">∘</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">(⊗<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> min_union_set_thms<span class="main">:</span> Finite_Set.comp_fun_idem <span class="quoted">min_union</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="bound">y</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> min_union_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> min_union_comm<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">y</span> <span class="main">∘</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">∘</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_union_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">∘</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">(∪<span class="hidden">⇩</span><sub>m</sub>)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> product_set_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⨂</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⨂</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⨂</span> <span class="main">{</span><span class="main">{</span><span class="main">{||}</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{</span><span class="main">{</span><span class="main">{||}</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> product_set_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⨂</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> fold product <span class="main">(</span>remdups <span class="free">xs</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_set_def product_set_thms.fold_set_fold_remdups<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> fold min_product <span class="main">(</span>remdups <span class="free">xs</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_set_def min_product_set_thms.fold_set_fold_remdups<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> product_set_insert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> <span class="main">⨂</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">⨂</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> product_set_def product_set_thms.fold_insert_remove <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_insert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_product_set_def min_product_set_thms.fold_insert_idem <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_subseteq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">|⊆|</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> funion_upper1 min_product_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_subseteq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">|⊆|</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> finite_insert insert_absorb min_product_set_insert min_product_subseteq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_product_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">A</span> <span class="main">=</span> min_set <span class="main">(</span><span class="main">⨂</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_set_def product_set_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> min_product_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> min_product_min_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span><span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_union_min_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span><span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_union_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_min_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> min_set <span class="main">(</span><span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_set_def min_set_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_min_product_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>min_set <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> finite <span class="free">Y</span> <span class="main">⟹</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">lemma</span></span> product_set_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> finite <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="main">⨂</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rotate_tac</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_set_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> product_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_product_set_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> finite <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rotate_tac</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_product_set_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> min_product_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Disjunctive Normal Form›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln fset set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{|</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">|}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">min_dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln fset set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_dnf</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">min_dnf</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">min_dnf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">min_dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="free">min_dnf</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">min_dnf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">min_dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="free">min_dnf</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">min_dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{|</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">|}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dnf_min_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_dnf <span class="free">φ</span> <span class="main">=</span> min_set <span class="main">(</span>dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> min_product_def min_union_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dnf_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> product_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_product_finite min_union_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dnf_Abs_fset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fset <span class="main">(</span>Abs_fset <span class="main">(</span>dnf <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dnf_finite Abs_fset_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_Abs_fset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fset <span class="main">(</span>Abs_fset <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_dnf_finite Abs_fset_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dnf_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Φ</span> <span class="main">∈</span> dnf <span class="free">φ</span> <span class="main">⟹</span> fset <span class="free">Φ</span> <span class="main">⊆</span> prop_atoms <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> product_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_prop_atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Φ</span> <span class="main">∈</span> min_dnf <span class="free">φ</span> <span class="main">⟹</span> fset <span class="free">Φ</span> <span class="main">⊆</span> prop_atoms <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dnf_min_set dnf_prop_atoms min_set_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_atoms_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Φ</span> <span class="main">∈</span> min_dnf <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> fset <span class="free">Φ</span> <span class="main">⟹</span> dnf <span class="free">φ</span> <span class="main">=</span> <span class="main">{</span><span class="main">{|</span><span class="free">φ</span><span class="main">|}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True_ltln
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dnf_prop_atoms prop_atoms_notin<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False_ltln
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dnf_prop_atoms prop_atoms_notin<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dnf_prop_atoms prop_atoms_notin<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dnf_prop_atoms prop_atoms_notin<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_min_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_set_def min_product_def min_union_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> min_dnf_iff_prop_assignment_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> fset <span class="bound">B</span> <span class="main">⊆</span> <span class="free">𝒜</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> min_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> fset <span class="bound">B</span> <span class="main">⊆</span> <span class="free">𝒜</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> min_dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">𝒜</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fset <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="skolem">𝒜</span> <span class="main">∧</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"fset <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> <span class="skolem">𝒜</span> <span class="main">∧</span> <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">|⊆|</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">|∪|</span> <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> min_product_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 2 le_sup_iff min_dnf.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> sup.absorb_iff1 sup_fset.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or_ltln <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fset <span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">𝒜</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Or_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">|⊆|</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> min_union_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 dual_order.trans less_eq_fset.rep_eq min_dnf.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"fset <span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">𝒜</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Or_ltln <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">|⊆|</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>m</sub></span> min_dnf <span class="skolem">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> min_union_comp min_union_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2 dual_order.trans less_eq_fset.rep_eq min_dnf.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Or_ltln.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> fset <span class="bound">B</span> <span class="main">⊆</span> <span class="free">𝒜</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> min_dnf <span class="free">φ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fset <span class="skolem">B</span> <span class="main">⊆</span> <span class="free">𝒜</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> min_dnf <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fset <span class="skolem">B</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_set_def min_product_def product_def min_union_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fset <span class="skolem">B</span> <span class="main">⊆</span> <span class="free">𝒜</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_implies_min_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> min_dnf <span class="free">φ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> min_dnf <span class="free">ψ</span><span class="main">.</span> <span class="bound">B</span> <span class="main">|⊆|</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_fset.rep_eq ltl_prop_implies_def min_dnf_iff_prop_assignment_subset order_refl dual_order.trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_min_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span> <span class="main">=</span> <span class="main">(</span>min_dnf <span class="free">φ</span> <span class="main">=</span> min_dnf <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> min_set <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">∈</span> min_set <span class="main">(</span>min_dnf <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltl_prop_implies_equiv ltl_prop_implies_min_dnf min_set_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min_dnf <span class="free">φ</span> <span class="main">=</span> min_dnf <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def min_dnf_iff_prop_assignment_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_rep_abs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_dnf <span class="main">(</span>rep_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="main">(</span>abs_ltln<span class="hidden">⇩</span><sub>P</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_min_dnf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Quotient3_ltln<span class="hidden">⇩</span><sub>P</sub> rep_abs_rsp_left<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Folding of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>and<span class="hidden">⇩</span><sub>n</sub>›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>or<span class="hidden">⇩</span><sub>n</sub>›</span></span></span></span> over Finite Sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">And<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">And<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">φ</span><span class="main">.</span> fold_graph And_ltln True_ltln <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="bound">φ</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Or<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">φ</span><span class="main">.</span> fold_graph Or_ltln False_ltln <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="bound">φ</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fold_graph_And<span class="hidden">⇩</span><sub>n</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> fold_graph And_ltln True_ltln <span class="free">Φ</span> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And<span class="hidden">⇩</span><sub>n</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI2_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_imp_fold_graph<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fold_graph_Or<span class="hidden">⇩</span><sub>n</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> fold_graph Or_ltln False_ltln <span class="free">Φ</span> <span class="main">(</span>Or<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI2_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_imp_fold_graph<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">{}</span> <span class="main">=</span> False_ltln"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_fold_graphE finite.emptyI fold_graph_Or<span class="hidden">⇩</span><sub>n</sub><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> And<span class="hidden">⇩</span><sub>n</sub>_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"And<span class="hidden">⇩</span><sub>n</sub> <span class="main">{}</span> <span class="main">=</span> True_ltln"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_fold_graphE finite.emptyI fold_graph_And<span class="hidden">⇩</span><sub>n</sub><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> dnf_union_thms<span class="main">:</span> Finite_Set.comp_fun_commute <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">interpretation</span></span> dnf_product_thms<span class="main">:</span> Finite_Set.comp_fun_commute <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_set_thms.comp_fun_commute<span class="main">)</span>

<span class="comment1">― ‹Copied from locale <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> comp_fun_commute<span class="antiquote">}</span></span>›</span>
<span class="keyword1"><span class="command">lemma</span></span> fold_graph_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fold_graph <span class="free">f</span> <span class="free">z</span> <span class="free">A</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Taking the DNF of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> And<span class="hidden">⇩</span><sub>n</sub><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Or<span class="hidden">⇩</span><sub>n</sub><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the same as folding over the individual DNFs.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> And<span class="hidden">⇩</span><sub>n</sub>_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> dnf <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">(</span>dnf <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">drule</span> fold_graph_And<span class="hidden">⇩</span><sub>n</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fold_graph.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">y</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> insertI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> dnf <span class="main">(</span>Or<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">(</span>dnf <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="free">Φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">drule</span> fold_graph_Or<span class="hidden">⇩</span><sub>n</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fold_graph.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">y</span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> insertI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> And<span class="hidden">⇩</span><sub>n</sub><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Or<span class="hidden">⇩</span><sub>n</sub><span class="antiquote"><span class="antiquote">}</span></span></span></span> are injective on finite sets.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> And<span class="hidden">⇩</span><sub>n</sub>_inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on And<span class="hidden">⇩</span><sub>n</sub> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> finite <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">y</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fold_graph And_ltln True_ltln <span class="skolem">x</span> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"fold_graph And_ltln True_ltln <span class="skolem">y</span> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_And<span class="hidden">⇩</span><sub>n</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"And<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">x</span> <span class="main">=</span> And<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">y</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fold_graph.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> emptyI
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 fold_graph.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fold_graph.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fold_graph.cases insertI1 ltln.distinct<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> ltln.inject<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> finite <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">y</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fold_graph Or_ltln False_ltln <span class="skolem">x</span> <span class="main">(</span>Or<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"fold_graph Or_ltln False_ltln <span class="skolem">y</span> <span class="main">(</span>Or<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_Or<span class="hidden">⇩</span><sub>n</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Or<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">x</span> <span class="main">=</span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="skolem">y</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fold_graph.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> emptyI
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 fold_graph.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fold_graph.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fold_graph.cases insertI1 ltln.distinct<span class="main"><span class="main">(</span></span>27<span class="main"><span class="main">)</span></span> ltln.inject<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The semantics of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> And<span class="hidden">⇩</span><sub>n</sub><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Or<span class="hidden">⇩</span><sub>n</sub><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be expressed using quantifiers.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> And<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> And<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ψ</span><span class="main">.</span> fold_graph And_ltln True_ltln <span class="free">Φ</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fold_graph.induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_And<span class="hidden">⇩</span><sub>n</sub><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ψ</span><span class="main">.</span> fold_graph Or_ltln False_ltln <span class="free">Φ</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fold_graph.induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_Or<span class="hidden">⇩</span><sub>n</sub><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> And<span class="hidden">⇩</span><sub>n</sub>_prop_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> And<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ψ</span><span class="main">.</span> fold_graph And_ltln True_ltln <span class="free">Φ</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fold_graph.induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_And<span class="hidden">⇩</span><sub>n</sub><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_prop_semantics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span> <span class="main">⟹</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="free">Φ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ψ</span><span class="main">.</span> fold_graph Or_ltln False_ltln <span class="free">Φ</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">ψ</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">.</span> <span class="free">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fold_graph.induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fold_graph_Or<span class="hidden">⇩</span><sub>n</sub><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_And<span class="hidden">⇩</span><sub>n</sub>_image_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Φ</span><span class="main">.</span> <span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span> <span class="main">⟹</span> finite <span class="bound">Φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="main">`</span> <span class="free">𝒜</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="bound">Φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="main">`</span> <span class="free">𝒜</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> And<span class="hidden">⇩</span><sub>n</sub> <span class="bound">Φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_semantics assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> And<span class="hidden">⇩</span><sub>n</sub>_semantics assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_And<span class="hidden">⇩</span><sub>n</sub>_image_prop_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Φ</span><span class="main">.</span> <span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span> <span class="main">⟹</span> finite <span class="bound">Φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="main">`</span> <span class="free">𝒜</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="bound">Φ</span><span class="main">.</span> <span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="main">`</span> <span class="free">𝒜</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> <span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> And<span class="hidden">⇩</span><sub>n</sub> <span class="bound">Φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_prop_semantics assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> And<span class="hidden">⇩</span><sub>n</sub>_prop_semantics assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹DNF to LTL conversion›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ltln_of_dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln fset set <span class="main">⇒</span> <span class="tfree">'a</span> ltln"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ltln_of_dnf</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">=</span> Or<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="main">`</span> fset <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_of_dnf_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> ltln_of_dnf <span class="free">𝒜</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">|∈|</span> <span class="bound">Φ</span> <span class="main">⟶</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fset <span class="main">`</span> <span class="free">𝒜</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> ltln_of_dnf <span class="free">𝒜</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> fset <span class="main">`</span> <span class="free">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="bound">Φ</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_of_dnf_def <span class="keyword1"><span class="command">using</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_And<span class="hidden">⇩</span><sub>n</sub>_image_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff notin_fset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_of_dnf_prop_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> ltln_of_dnf <span class="free">𝒜</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">|∈|</span> <span class="bound">Φ</span> <span class="main">⟶</span> <span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fset <span class="main">`</span> <span class="free">𝒜</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> ltln_of_dnf <span class="free">𝒜</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> fset <span class="main">`</span> <span class="free">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="bound">Φ</span><span class="main">.</span> <span class="free">ℐ</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_of_dnf_def <span class="keyword1"><span class="command">using</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_And<span class="hidden">⇩</span><sub>n</sub>_image_prop_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff notin_fset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ltln_of_dnf_prop_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ltln_of_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ltl_prop_equiv_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒜</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> ltln_of_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> min_dnf <span class="free">φ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">|∈|</span> <span class="bound">Φ</span> <span class="main">⟶</span> <span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ltln_of_dnf_prop_semantics min_dnf_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> min_dnf <span class="free">φ</span><span class="main">.</span> fset <span class="bound">Φ</span> <span class="main">⊆</span> <span class="skolem">𝒜</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_dnf_prop_atoms prop_atoms_entailment_iff notin_fset subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dnf_iff_prop_assignment_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> ltln_of_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">𝒜</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_ltln_of_dnf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_dnf <span class="main">(</span>ltln_of_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltl_prop_equiv_min_dnf ltln_of_dnf_prop_equiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitution in DNF formulas›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_clause</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln fset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">⇀</span> <span class="tfree">'a</span> ltln<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ltln fset set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_clause</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">{</span>min_dnf <span class="main">(</span>subst <span class="bound">φ</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> fset <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln fset set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">⇀</span> <span class="tfree">'a</span> ltln<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ltln fset set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_dnf</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">.</span> subst_clause <span class="bound">Φ</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause <span class="main">{||}</span> <span class="free">m</span> <span class="main">=</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_clause_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_dnf_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_dnf <span class="main">{}</span> <span class="free">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_dnf_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_inner_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">{</span>min_dnf <span class="main">(</span>subst <span class="bound">φ</span> <span class="free">m</span><span class="main">)</span> <span class="main">|</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">Φ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_clause <span class="free">Φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subst_clause_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> min_dnf_finite min_product_set_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_dnf_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">𝒜</span> <span class="main">⟹</span> finite <span class="main">(</span>subst_dnf <span class="free">𝒜</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf_def <span class="keyword1"><span class="command">using</span></span> subst_clause_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_dnf_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊆</span> <span class="free">ℬ</span> <span class="main">⟹</span> subst_dnf <span class="free">𝒜</span> <span class="free">m</span> <span class="main">⊆</span> subst_dnf <span class="free">ℬ</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_min_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span>subst_clause <span class="free">Φ</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> subst_clause <span class="free">Φ</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subst_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_finsert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause <span class="main">(</span>finsert <span class="free">φ</span> <span class="free">Φ</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>min_dnf <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>subst_clause <span class="free">Φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>min_dnf <span class="main">(</span>subst <span class="bound">ψ</span> <span class="free">m</span><span class="main">)</span> <span class="main">|</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> fset <span class="main">(</span>finsert <span class="free">φ</span> <span class="free">Φ</span><span class="main">)</span><span class="main">}</span>
    <span class="main">=</span> insert <span class="main">(</span>min_dnf <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>min_dnf <span class="main">(</span>subst <span class="bound">ψ</span> <span class="free">m</span><span class="main">)</span> <span class="main">|</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> fset <span class="free">Φ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_clause_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_funion<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause <span class="main">(</span><span class="free">Φ</span> <span class="main">|∪|</span> <span class="free">Ψ</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>subst_clause <span class="free">Φ</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>subst_clause <span class="free">Ψ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Ψ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> min_product_set_thms.fun_left_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For the proof of correctness, we redefine the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> product<span class="antiquote"><span class="antiquote">}</span></span></span></span> operator on lists.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">⊗<span class="hidden">⇩</span><sub>l</sub></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span> <span class="main">@</span> <span class="bound">b</span> <span class="main">|</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_product_fset_of_list<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fset_of_list <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fset_of_list <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>fset_of_list <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_product_def product_def image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> list_product_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="free">B</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_product_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_set2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_product_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">@</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> list_product_assoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_eq_iff list_product_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Furthermore, we introduct DNFs where the clauses are represented as lists.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list_dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln list set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_dnf</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_dnf</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_dnf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">list_dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span><span class="free">list_dnf</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_dnf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">list_dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">list_dnf</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_dnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_dnf_to_dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_dnf_to_dnf</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> fset_of_list <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_dnf_to_dnf_list_dnf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_dnf_to_dnf <span class="main">(</span>list_dnf <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> dnf <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_dnf_to_dnf_def image_Un<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_dnf_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>list_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_product_finite<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We use this to redefine <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> subst_clause<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> subst_dnf<span class="antiquote"><span class="antiquote">}</span></span></span></span> on list DNFs.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_clause'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">⇀</span> <span class="tfree">'a</span> ltln<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ltln list set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_clause'</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span> <span class="bound">acc</span><span class="main">.</span> <span class="bound">acc</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> list_dnf <span class="main">(</span>subst <span class="bound">φ</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_dnf'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> ltln <span class="main">⇀</span> <span class="tfree">'a</span> ltln<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ltln list set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_dnf'</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">.</span> subst_clause' <span class="bound">Φ</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause'_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subst_clause' <span class="free">Φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_clause'_def list_dnf_finite list_product_finite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause'_nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause' <span class="main">[]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_clause'_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause'_cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause' <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> subst_clause' <span class="free">xs</span> <span class="free">m</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> list_dnf <span class="main">(</span>subst <span class="free">x</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_clause'_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause'_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause' <span class="main">(</span><span class="free">A</span> <span class="main">@</span> <span class="free">B</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> subst_clause' <span class="free">A</span> <span class="free">m</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> subst_clause' <span class="free">B</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> append_assoc subst_clause'_cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_product_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> subst_dnf'_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subst_dnf' <span class="free">A</span> <span class="free">m</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Φ</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> subst_clause' <span class="bound">Φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_dnf'_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_dnf'_product<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_dnf' <span class="main">(</span><span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>subst_dnf' <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span>subst_dnf' <span class="free">B</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> set_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?lhs</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> subst_clause' <span class="skolem">Φ</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf'_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Φ</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_clause' <span class="skolem">a</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span>subst_clause' <span class="skolem">b</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> subst_clause' <span class="skolem">Φ</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> subst_clause' <span class="skolem">a</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> subst_clause' <span class="skolem">b</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_product_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> subst_dnf' <span class="free">A</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> subst_dnf' <span class="free">B</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf'_iff <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>subst_dnf' <span class="free">A</span> <span class="free">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span>subst_dnf' <span class="free">B</span> <span class="free">m</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">@</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_product_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?rhs</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> subst_dnf' <span class="free">A</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> subst_dnf' <span class="free">B</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_product_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> subst_clause' <span class="skolem">a'</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> subst_clause' <span class="skolem">b'</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf'_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>subst_clause' <span class="skolem">a'</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span>subst_clause' <span class="skolem">b'</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_product_iff <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">@</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">⊗<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_product_iff <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf'_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_dnf'_list_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_dnf' <span class="main">(</span>list_dnf <span class="free">φ</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> list_dnf <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And_ltln <span class="skolem">φ1</span> <span class="skolem">φ2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_dnf'_product<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_dnf'_def subst_clause'_def list_product_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> min_set_Union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> min_set <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>min_set <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_set <span class="main">(</span><span class="main">⋃</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fset set set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Sup_insert image_insert min_set_min_union min_union_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_Union_image<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> min_set <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> min_set <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_set <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> fset set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> min_set_Union <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_clause_fset_of_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst_clause <span class="main">(</span>fset_of_list <span class="free">Φ</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> min_set <span class="main">(</span>list_dnf_to_dnf <span class="main">(</span>subst_clause' <span class="free">Φ</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_dnf_to_dnf_def subst_clause'_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dnf_min_set list_dnf_to_dnf_def list_dnf_to_dnf_list_dnf min_product_comm min_product_def min_set_min_product<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> min_set_list_dnf_to_dnf_subst_dnf'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> min_set <span class="main">(</span>list_dnf_to_dnf <span class="main">(</span>subst_dnf' <span class="free">X</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_set <span class="main">(</span>subst_dnf <span class="main">(</span>list_dnf_to_dnf <span class="free">X</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_dnf'_def subst_dnf_def subst_clause_fset_of_list list_dnf_to_dnf_def min_set_Union_image image_Union<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_dnf_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span>subst_dnf <span class="main">(</span>dnf <span class="free">φ</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dnf_min_set
  <span class="keyword1"><span class="command">unfolding</span></span> list_dnf_to_dnf_list_dnf<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf'_list_dnf<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> min_set_list_dnf_to_dnf_subst_dnf'<span class="main">[</span><span class="operator">OF</span> list_dnf_finite<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is almost the lemma we need. However, we need to show that the same holds for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"min_dnf <span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, too.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fold_product<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">{</span><span class="main">{|</span><span class="bound">x</span><span class="main">|}</span><span class="main">}</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">(</span>fset <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> notin_fset<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> product_singleton_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fold_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>fset <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fset <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> notin_fset comp_fun_idem.fold_insert_idem comp_fun_idem_insert<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fold_union_fold_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Ψ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">Ψ</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">ψ</span> <span class="main">∈</span> fset <span class="bound">Ψ</span> <span class="main">⟹</span> dnf <span class="bound">ψ</span> <span class="main">=</span> <span class="main">{</span><span class="main">{|</span><span class="bound">ψ</span><span class="main">|}</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">(</span>Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">(</span>dnf <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">(</span>fset <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="free">X</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">(</span>Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">{</span><span class="main">{|</span><span class="bound">φ</span><span class="main">|}</span><span class="main">}</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">(</span>fset <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">Φ</span> <span class="skolem">X</span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> insert.prems <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Ψ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">Ψ</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">;</span> <span class="bound">ψ</span> <span class="main">∈</span> fset <span class="bound">Ψ</span><span class="main">⟧</span> <span class="main">⟹</span> dnf <span class="bound">ψ</span> <span class="main">=</span> <span class="main">{</span><span class="main">{|</span><span class="bound">ψ</span><span class="main">|}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">from</span></span> insert.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">(</span>dnf <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">(</span>fset <span class="skolem">Φ</span><span class="main">)</span> <span class="main">=</span> Finite_Set.fold <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(⊗)</span> <span class="main">{</span><span class="main">{|</span><span class="bound">φ</span><span class="main">|}</span><span class="main">}</span><span class="main">)</span> <span class="main">{</span><span class="main">{||}</span><span class="main">}</span> <span class="main">(</span>fset <span class="skolem">Φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> notin_fset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">with</span></span> insert 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fold_product <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fset_to_fset fold_union<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dnf_ltln_of_dnf_min_dnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dnf <span class="main">(</span>ltln_of_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>And<span class="hidden">⇩</span><sub>n</sub> <span class="main">`</span> fset <span class="main">`</span> min_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dnf_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on And<span class="hidden">⇩</span><sub>n</sub> <span class="main">(</span>fset <span class="main">`</span> min_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> And<span class="hidden">⇩</span><sub>n</sub>_inj f_inv_into_f fset inj_onI inj_on_contraD<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on fset <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fset_inject inj_onI<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ltln_of_dnf_def
    <span class="keyword1"><span class="command">unfolding</span></span> Or<span class="hidden">⇩</span><sub>n</sub>_dnf<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> fold_image<span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> fold_image<span class="main">[</span><span class="operator">OF</span> 3<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def
    <span class="keyword1"><span class="command">unfolding</span></span> And<span class="hidden">⇩</span><sub>n</sub>_dnf<span class="main">[</span><span class="operator">OF</span> finite_fset<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fold_union_fold_product min_dnf_finite min_dnf_atoms_dnf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_dnf_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_set <span class="main">(</span>subst_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> min_dnf <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ltln_of_dnf <span class="main">(</span>min_dnf <span class="free">φ</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> min_set <span class="main">(</span>subst_dnf <span class="main">(</span>dnf <span class="var">?φ'</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dnf_ltln_of_dnf_min_dnf <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> min_dnf <span class="main">(</span>subst <span class="var">?φ'</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subst_dnf_dnf <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> min_dnf <span class="main">(</span>subst <span class="free">φ</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ltl_prop_equiv_min_dnf ltln_of_dnf_prop_equiv subst_respects_ltl_prop_entailment<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Equations">
<div class="head">
<h1>Theory Code_Equations</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Benedikt Seidl
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code lemmas for abstract definitions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Equations
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="LTL.html">LTL</a> <a href="Equivalence_Relations.html">Equivalence_Relations</a>
  <a href="../Boolean_Expression_Checkers/Boolean_Expression_Checkers.html">Boolean_Expression_Checkers.Boolean_Expression_Checkers</a>
  <a href="../Boolean_Expression_Checkers/Boolean_Expression_Checkers_AList_Mapping.html">Boolean_Expression_Checkers.Boolean_Expression_Checkers_AList_Mapping</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Propositional Equivalence›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ifex_of_ltl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ltln <span class="main">⇒</span> <span class="tfree">'a</span> ltln ifex"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ifex_of_ltl</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> Trueif"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of_ltl</span> <span class="keyword1">false<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> Falseif"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of_ltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">and<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of_ltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">ifex_of_ltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> Falseif"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of_ltl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">or<span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of_ltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> Trueif <span class="main">(</span><span class="free">ifex_of_ltl</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of_ltl</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> IF <span class="free"><span class="bound"><span class="entity">φ</span></span></span> Trueif Falseif"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> val_ifex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"val_ifex <span class="main">(</span>ifex_of_ltl <span class="free">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="bound">x</span><span class="main">}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_Nil val_normif<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reduced_ifex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reduced <span class="main">(</span>ifex_of_ltl <span class="free">b</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> keys_empty reduced_normif<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ifex_of_ltl_reduced_bdt_checker<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reduced_bdt_checkers ifex_of_ltl <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>P</sub></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reduced_bdt_checkers_def
  <span class="keyword1"><span class="command">using</span></span> val_ifex reduced_ifex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_equiv_impl<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="keyword1">∼<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> equiv_test ifex_of_ltl <span class="free">φ</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_equiv_def reduced_bdt_checkers.equiv_test<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ifex_of_ltl_reduced_bdt_checker<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ltl_prop_implies_impl<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="keyword1">⟶<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> impl_test ifex_of_ltl <span class="free">φ</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltl_prop_implies_def reduced_bdt_checkers.impl_test<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ifex_of_ltl_reduced_bdt_checker<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="comment1">― ‹Check code export›</span>
<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1">(∼<span class="hidden">⇩</span><sub>P</sub>)</span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1">(⟶<span class="hidden">⇩</span><sub>P</sub>)</span>"</span></span></span> <span class="keyword2"><span class="keyword">checking</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Example">
<div class="head">
<h1>Theory Example</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:   Salomon Sickert
    License:  BSD
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Example
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="LTL.html">../LTL</a>"</span> <span class="quoted">"<a href="Rewriting.html">../Rewriting</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹The included parser always returns a <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"String.literal ltlc"</span><span class="antiquote">}</span></span>. If a different labelling
  is needed one can use <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> map_ltlc<span class="antiquote">}</span></span> to relabel the leafs. In our example we prepend a
  string to each atom.›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rewrite</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"String.literal ltlc <span class="main">⇒</span> String.literal ltlc"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rewrite</span> <span class="main">≡</span> ltln_to_ltlc <span class="keyword1">o</span> rewrite_iter_slow <span class="keyword1">o</span> ltlc_to_ltln <span class="keyword1">o</span> <span class="main">(</span>map_ltlc <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> String.implode <span class="inner_quoted">''prop(''</span> <span class="main">+</span> <span class="bound">s</span> <span class="main">+</span> String.implode <span class="inner_quoted">'')''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹Export rewriting engine (and also constructors)›</span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted"><span class="keyword1">true<span class="hidden">⇩</span><sub>c</sub></span></span></span> <span class="quoted"><span class="quoted">Iff_ltlc</span></span> <span class="quoted"><span class="quoted">rewrite</span></span> <span class="keyword2"><span class="keyword">in</span></span> SML <span class="keyword2"><span class="keyword">file_prefix</span></span> <span class="quoted">‹rewrite_example›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>