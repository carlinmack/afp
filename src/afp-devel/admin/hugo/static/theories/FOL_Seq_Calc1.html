<div id="Common">
<div class="head">
<h1>Theory Common</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author: Asta Halkjær From, DTU Compute, 2019-2021
    Contributors: Alexander Birch Jensen, Anders Schlichtkrull &amp; Jørgen Villadsen

    See also the Natural Deduction Assistant (NaDeA) and the Sequent Calculus Verifier (SeCaV):

      https://nadea.compute.dtu.dk/
      https://secav.compute.dtu.dk/
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Common Notation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Common <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../FOL-Fitting/FOL_Fitting.html">FOL-Fitting.FOL_Fitting</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> FF <span class="main">(</span><span class="quoted">‹<span class="keyword1">⊥</span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> TT <span class="main">(</span><span class="quoted">‹<span class="keyword1">⊤</span>›</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tableau">
<div class="head">
<h1>Theory Tableau</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author: Asta Halkjær From, DTU Compute, 2019-2021
    Contributors: Alexander Birch Jensen, Anders Schlichtkrull &amp; Jørgen Villadsen

    See also the Natural Deduction Assistant (NaDeA) and the Sequent Calculus Verifier (SeCaV):

      https://nadea.compute.dtu.dk/
      https://secav.compute.dtu.dk/
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Tableau Calculus›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tableau <span class="keyword2"><span class="keyword">imports</span></span> <a href="Common.html">Common</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">TC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">⊣</span> _›</span> 0<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  Basic<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Pred <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">#</span> Neg <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BasicFF<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> <span class="main">⊥</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BasicNegTT<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Neg <span class="main">⊤</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaNegNeg<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaAnd<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> And <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaNegOr<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaNegImpl<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BetaNegAnd<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BetaOr<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Or <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BetaImpl<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Impl <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> GammaForall<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Forall <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> GammaNegExists<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> DeltaExists<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> news <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Exists <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> DeltaNegForall<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> news <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> Neg <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> Order<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> set <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> set <span class="free"><span class="bound"><span class="entity">G'</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊣</span></span> <span class="free"><span class="bound"><span class="entity">G'</span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Shift<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> rotate1 <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊣</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Swap<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">B</span> <span class="main">#</span> <span class="free">A</span> <span class="main">#</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊣</span> <span class="free">A</span> <span class="main">#</span> <span class="free">B</span> <span class="main">#</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Order insert_commute<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tableauproof</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">tableauproof</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tableauNotAA<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="main">[</span>Neg <span class="main">(</span>Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> Basic<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> AndAnd<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="main">[</span>And <span class="main">(</span>Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Pred <span class="inner_quoted">''B''</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> Neg <span class="main">(</span>And <span class="main">(</span>Pred <span class="inner_quoted">''B''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> AlphaAnd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> BetaNegAnd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Basic<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Swap<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Basic<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC_soundness<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> TC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaExists <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Exists <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Exists <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span>shift <span class="free">e</span> <span class="main">0</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ball_set set_subset_Cons subsetCE upd_lemma<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaNegForall <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span>shift <span class="free">e</span> <span class="main">0</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span>
      <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> <span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ball_set set_subset_Cons subsetCE upd_lemma<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> tableau_soundness<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹tableauproof <span class="free">ps</span> <span class="free">p</span> <span class="main">⟹</span> list_all <span class="main">(</span>eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">ps</span> <span class="main">⟹</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> TC_soundness <span class="keyword1"><span class="command">unfolding</span></span> tableauproof_def list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness for Closed Formulas›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> infinite_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_in_conv infinite_imp_nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> TCd_consistency<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_param<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="main">{</span><span class="bound">S</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set<span class="main">.</span> <span class="main">∃</span><span class="bound">G</span><span class="main">.</span> <span class="bound">S</span> <span class="main">=</span> set <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="bound">G</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI notI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="main">{</span>set <span class="bound">G</span> <span class="main">|</span> <span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="bound">G</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> set <span class="skolem">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> * Basic Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊥</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> * BasicFF Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">⊤</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> * BasicNegTT Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">Z</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * AlphaNegNeg Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">Z</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * AlphaAnd Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * AlphaNegOr Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * AlphaNegImpl Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * BetaOr Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * BetaNegAnd Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * BetaImpl Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * GammaForall Order<span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * GammaNegExists Order <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_param Diff_infinite_finite finite_compl infinite_UNIV_listI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">x</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ball_set_list_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> subst <span class="skolem">P</span> <span class="main">(</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> Order DeltaExists <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_param Diff_infinite_finite finite_compl infinite_UNIV_listI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">x</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ball_set_list_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> Order DeltaNegForall <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="main">(</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tableau_completeness'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="free">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">0</span><span class="main">)</span> <span class="free">ps</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> list_all <span class="main">(</span>eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="free">ps</span> <span class="main">⟶</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tableauproof <span class="free">ps</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> tableauproof <span class="free">ps</span> <span class="free">p</span>›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>set <span class="main">(</span><span class="bound">G</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form list<span class="main">)</span> <span class="main">|</span> <span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">⊣</span> <span class="bound">G</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted">HApp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> Extend <span class="var">?S</span>
              <span class="main">(</span>mk_finite_char <span class="main">(</span>mk_alt_consistency <span class="main">(</span>close <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> from_nat<span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">0</span><span class="main">)</span> <span class="free">ps</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> closed <span class="main">0</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TCd_consistency <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> tableauproof <span class="free">ps</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tableauproof_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Compl_eq_Diff_UNIV infinite_UNIV_listI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> closed <span class="main">0</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> model_existence <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span> <span class="main">(</span>Neg <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span><span class="main">)</span> <span class="free">ps</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Open Formulas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TC_psubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊣</span> map <span class="main">(</span>psubst <span class="free">f</span><span class="main">)</span> <span class="free">G</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> TC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaExists <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∪</span> image <span class="skolem">f</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite.emptyI finite.insertI finite_UnI finite_imageI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * new_psubst_image news_psubst <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">=</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaExists
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ball_set insertCI list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> map_eq_conv psubst_upd<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> psubst <span class="var">?f</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>Exists <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC.DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaExists G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaNegForall <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∪</span> image <span class="skolem">f</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite.emptyI finite.insertI finite_UnI finite_imageI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * new_psubst_image news_psubst <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">=</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaNegForall
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ball_set insertCI list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> map_eq_conv psubst_upd<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> psubst <span class="var">?f</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="main">(</span>subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC.DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaNegForall G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Order <span class="skolem">G</span> <span class="skolem">G'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Order TC.Order set_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> TC.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subcs_map<span class="main">:</span> <span class="quoted"><span class="quoted">‹subcs <span class="free">c</span> <span class="free">s</span> <span class="free">G</span> <span class="main">=</span> map <span class="main">(</span>subc <span class="free">c</span> <span class="free">s</span><span class="main">)</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_subcs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊣</span> subcs <span class="free">c</span> <span class="free">s</span> <span class="free">G</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> TC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>GammaForall <span class="skolem">A</span> <span class="skolem">t</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> paramst <span class="skolem">t</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="skolem">s</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?g</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_away' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subc <span class="main">(</span><span class="var">?g</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="var">?g</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="var">?g</span> <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?g</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_upd_apply id_def subc_psubst UnCI fresh params.simps<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?g</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> s A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> GammaForall <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> new_subc_put subcs.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span> new_subc_same' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC.GammaForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Forall <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>GammaNegExists <span class="skolem">A</span> <span class="skolem">t</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> paramst <span class="skolem">t</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="skolem">s</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?g</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_away' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subc <span class="main">(</span><span class="var">?g</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="var">?g</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="var">?g</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?g</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_upd_apply id_def subc_psubst UnCI fresh params.simps<span class="main">(</span>7<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?g</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> s A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> GammaNegExists <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> new_subc_put subc.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subcs.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span> new_subc_same' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="main">(</span>subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC.GammaNegExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaExists <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Exists <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaExists TC.DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaExists True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_news<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">,</span> <span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?params</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">n</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_twist psubstt_upd<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_away' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> False fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      subc <span class="main">(</span><span class="var">?f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_subst psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaExists fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_A<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_G<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TC_psubst inf_params DeltaExists.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sub_A<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh new_subc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="skolem">s</span>›</span></span> news_subcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Exists <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TC.DeltaExists sub_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaNegForall <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaNegForall TC.DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaNegForall True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_news<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">,</span> <span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?params</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">n</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fun_upd_twist psubstt_upd<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_away' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> False fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      subc <span class="main">(</span><span class="var">?f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">A</span><span class="main">)</span><span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_subst psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaNegForall fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_A<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        Neg <span class="main">(</span>subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_G<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeltaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TC_psubst inf_params DeltaNegForall.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sub_A<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="main">(</span>subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">A</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh new_subc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="skolem">s</span>›</span></span> news_subcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="skolem">A</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TC.DeltaNegForall sub_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Order <span class="skolem">G</span> <span class="skolem">G'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> TC.Order set_map subcs_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> TC.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_map_subc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊣</span> map <span class="main">(</span>subc <span class="free">c</span> <span class="free">s</span><span class="main">)</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms TC_subcs subcs_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_all_closed<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> list_all <span class="main">(</span>closed <span class="bound">m</span><span class="main">)</span> <span class="free">G</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_all_def
    <span class="keyword1"><span class="command">using</span></span> ex_closed closed_mono
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ball_set list_all_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat_le_linear<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sub_consts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">sub_consts</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">sub_consts</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free">sub_consts</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_sub_consts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span><span class="free">e</span> <span class="main">::</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_sub' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">‹closedt <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> closedt <span class="free">m</span> <span class="main">(</span>substt <span class="free">t</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹closedts <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> closedts <span class="free">m</span> <span class="main">(</span>substts <span class="free">l</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_sub<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> closed <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> closed <span class="free">m</span> <span class="main">(</span>subst <span class="free">p</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_sub_consts<span class="main">:</span> <span class="quoted"><span class="quoted">‹length <span class="free">cs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟹</span> closed <span class="free">m</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> closed <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_sub_consts_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>sub_consts <span class="main">[]</span><span class="main">)</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">conjoin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">conjoin</span> <span class="main">[]</span> <span class="main">=</span> Neg <span class="main">⊥</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">conjoin</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span> And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">conjoin</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_conjoin<span class="main">:</span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">G</span> <span class="main">=</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>conjoin <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span> <span class="main">⟶</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>subst <span class="free">p</span> <span class="free">t</span> <span class="free">m</span><span class="main">)</span> <span class="main">⟶</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>subst <span class="free">q</span> <span class="free">t</span> <span class="free">m</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_sub_consts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span> <span class="main">⟶</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">q</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sub_consts.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subst_lemma<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_consts_And <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹sub_consts <span class="free">cs</span> <span class="main">(</span>And <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> sub_consts_conjoin<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="main">(</span>conjoin <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>conjoin <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="free">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_consts_And <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_sub_consts_conjoin<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="free">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="main">(</span>conjoin <span class="free">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_sub_consts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_all_sub_consts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> list_all <span class="main">(</span>eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="free">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟶</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eval_conjoin eval_sub_consts all_sub_consts_conjoin <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TC_vars_for_consts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊣</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> vars_for_consts <span class="bound">p</span> <span class="free">cs</span><span class="main">)</span> <span class="free">G</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⊣</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> vars_for_consts <span class="bound">p</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">⊣</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> subc <span class="skolem">c</span> <span class="main">(</span>Var <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vars_for_consts <span class="bound">p</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊣</span> map <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>Var <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> vars_for_consts <span class="bound">p</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊣</span> map <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>Var <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> vars_for_consts <span class="bound">p</span> <span class="skolem">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons TC_map_subc assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_for_consts_sub_consts<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>length <span class="free">cs</span><span class="main">)</span> <span class="free">p</span> <span class="main">⟹</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">cs</span> <span class="main">⟹</span> distinct <span class="free">cs</span> <span class="main">⟹</span>
   vars_for_consts <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span> <span class="free">cs</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> subst_new_all closed_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> all_vars_for_consts_sub_consts<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">(</span>length <span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟹</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> list_all <span class="main">(</span>new <span class="bound">c</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="free">cs</span> <span class="main">⟹</span> distinct <span class="free">cs</span> <span class="main">⟹</span>
   map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> vars_for_consts <span class="bound">p</span> <span class="free">cs</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="free">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> vars_for_consts_sub_consts <span class="keyword1"><span class="command">unfolding</span></span> list_all_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_conjoin<span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">c</span> <span class="main">(</span>conjoin <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> list_all <span class="main">(</span>new <span class="free">c</span><span class="main">)</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> all_fresh_constants<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> length <span class="bound">cs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> list_all <span class="main">(</span>new <span class="bound">c</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="bound">cs</span> <span class="main">∧</span> distinct <span class="bound">cs</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">cs</span> <span class="main">=</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="main">(</span>conjoin <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">cs</span>›</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">cs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fresh_constants <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> new_conjoin <span class="keyword1"><span class="command">unfolding</span></span> list_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_consts_Neg<span class="main">:</span> <span class="quoted"><span class="quoted">‹sub_consts <span class="free">cs</span> <span class="main">(</span>Neg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span>sub_consts <span class="free">cs</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tableau_completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form list›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> list_all <span class="main">(</span>eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟶</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tableauproof <span class="free">G</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_all_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span>
    <span class="quoted"><span class="quoted">‹length <span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">m</span>›</span></span>
    <span class="quoted"><span class="quoted">‹distinct <span class="skolem">cs</span>›</span></span>
    <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> list_all <span class="main">(</span>new <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">cs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_fresh_constants <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>sub_consts <span class="skolem">cs</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_sub_consts <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="skolem">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_sub_consts * <span class="quoted"><span class="quoted">‹length <span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> list_all <span class="main">(</span>eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="skolem">cs</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟶</span>
    eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="main">(</span>sub_consts <span class="skolem">cs</span> <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms valid_all_sub_consts <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="main">(</span>sub_consts <span class="skolem">cs</span> <span class="free">p</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>sub_consts <span class="skolem">cs</span><span class="main">)</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tableau_completeness' <span class="keyword1"><span class="command">unfolding</span></span> tableauproof_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> map <span class="main">(</span>sub_consts <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span>Neg <span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_consts_Neg<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> vars_for_consts <span class="bound">p</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>sub_consts <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span>Neg <span class="free">p</span> <span class="main">#</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TC_vars_for_consts <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tableauproof_def
    <span class="keyword1"><span class="command">using</span></span> all_vars_for_consts_sub_consts<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">‹Neg <span class="free">p</span> <span class="main">#</span> <span class="free">G</span>›</span></span><span class="main">]</span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="main">[</span>Neg <span class="free">p</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms tableau_completeness <span class="keyword1"><span class="command">unfolding</span></span> tableauproof_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sequent">
<div class="head">
<h1>Theory Sequent</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author: Asta Halkjær From, DTU Compute, 2019-2021
    Contributors: Alexander Birch Jensen, Anders Schlichtkrull &amp; Jørgen Villadsen

    See also the Natural Deduction Assistant (NaDeA) and the Sequent Calculus Verifier (SeCaV):

      https://nadea.compute.dtu.dk/
      https://secav.compute.dtu.dk/
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sequent Calculus›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sequent <span class="keyword2"><span class="keyword">imports</span></span> <a href="Tableau.html">Tableau</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">SC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">⊢</span> _›</span> 0<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  Basic<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Pred <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">#</span> Neg <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BasicNegFF<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Neg <span class="main">⊥</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BasicTT<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> <span class="main">⊤</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaNegNeg<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaNegAnd<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaOr<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> AlphaImpl<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Impl <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BetaAnd<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BetaNegOr<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> BetaNegImpl<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> GammaExists<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Exists <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> GammaNegForall<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> DeltaForall<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> news <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Forall <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> DeltaNegExists<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> news <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> Neg <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>›</span></span>
<span class="main">|</span> Order<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> set <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> set <span class="free"><span class="bound"><span class="entity">G'</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G'</span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Shift<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> rotate1 <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊢</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Swap<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="free">B</span> <span class="main">#</span> <span class="free">A</span> <span class="main">#</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊢</span> <span class="free">A</span> <span class="main">#</span> <span class="free">B</span> <span class="main">#</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Order insert_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="main">[</span>Neg <span class="main">(</span>Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> Basic<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="main">[</span>And <span class="main">(</span>Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Pred <span class="inner_quoted">''B''</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> Neg <span class="main">(</span>And <span class="main">(</span>Pred <span class="inner_quoted">''B''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Pred <span class="inner_quoted">''A''</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> BetaAnd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Swap<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> AlphaNegAnd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Swap<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Basic<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Swap<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> AlphaNegAnd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Basic<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SC_soundness<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">G</span><span class="main">.</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaForall <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> eval <span class="main">(</span>shift <span class="free">e</span> <span class="main">0</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> eval <span class="main">(</span>shift <span class="free">e</span> <span class="main">0</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">f</span> <span class="free">g</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Ball_set insert_iff list.set<span class="main">(</span>2<span class="main">)</span> upd_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaNegExists <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> eval <span class="main">(</span>shift <span class="free">e</span> <span class="main">0</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> eval <span class="main">(</span>shift <span class="free">e</span> <span class="main">0</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Ball_set insert_iff list.set<span class="main">(</span>2<span class="main">)</span> upd_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Tableau Calculus Equivalence›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">compl</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">compl</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compl<span class="main">:</span> <span class="quoted"><span class="quoted">‹compl <span class="free">p</span> <span class="main">=</span> Neg <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> compl <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> Neg <span class="bound">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> compl.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_compl<span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">n</span> <span class="free">p</span> <span class="main">⟹</span> new <span class="free">n</span> <span class="main">(</span>compl <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> compl.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> news_compl<span class="main">:</span> <span class="quoted"><span class="quoted">‹news <span class="free">n</span> <span class="free">G</span> <span class="main">⟹</span> news <span class="free">n</span> <span class="main">(</span>map compl <span class="free">G</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_compl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> TC_SC<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">⊢</span> map compl <span class="free">G</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> TC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basic <span class="skolem">i</span> <span class="skolem">l</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> SC.Basic Swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AlphaNegNeg <span class="skolem">A</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> SC.AlphaNegNeg compl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AlphaAnd <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="skolem">A</span> <span class="main">#</span> compl <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl AlphaNegNeg Swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> AlphaNegAnd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AlphaNegImpl <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl AlphaNegNeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> AlphaImpl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BetaOr <span class="skolem">A</span> <span class="skolem">G</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl AlphaNegNeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> BetaNegOr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BetaImpl <span class="skolem">A</span> <span class="skolem">G</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="skolem">B</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> compl AlphaNegNeg<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> BetaNegImpl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span> compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>GammaForall <span class="skolem">A</span> <span class="skolem">t</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="main">(</span>subst <span class="skolem">A</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl AlphaNegNeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GammaNegForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaExists <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> compl <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> Neg <span class="main">(</span>subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl AlphaNegNeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaExists news_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaNegExists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DeltaNegForall <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> subst <span class="skolem">A</span> <span class="main">(</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> map compl <span class="skolem">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">n</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> map compl <span class="skolem">G</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaNegForall news_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeltaForall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC.intros<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SC_completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> list_all <span class="main">(</span>eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="free">ps</span> <span class="main">⟶</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="free">p</span> <span class="main">#</span> map compl <span class="free">ps</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊣</span> Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms tableau_completeness <span class="keyword1"><span class="command">unfolding</span></span> tableauproof_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> TC_SC <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms SC_completeness list.map<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>