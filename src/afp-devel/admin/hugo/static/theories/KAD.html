<div id="Domain_Semiring">
<div class="head">
<h1>Theory Domain_Semiring</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Domain Semirings
   Author:     Victor B. F. Gomes, Walter Guttmann, Peter Höfner, Georg Struth, Tjark Weber
   Maintainer: Walter Guttmann &lt;walter.guttman at canterbury.ac.nz&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Domain Semirings›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Domain_Semiring
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Kleene_Algebra.html">Kleene_Algebra.Kleene_Algebra</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Semigroups and Domain Monoids›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">domain_op</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">d</span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we define the class of domain semigroups. Axioms are taken from~\cite{DesharnaisJipsenStruth}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_semigroup <span class="main">=</span> semigroup_mult <span class="main">+</span> domain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dsg1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsg2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsg3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsg4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Domain_Semiring-domain_invol"><span class="command">lemma</span></span> domain_invol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsg3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemmas show that domain elements form semilattices.›</span></span>

<span class="keyword1" id="Domain_Semiring-dom_el_idem"><span class="command">lemma</span></span> dom_el_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsg3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_mult_closed"><span class="command">lemma</span></span> dom_mult_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Domain_Semiring-dom_lc3"><span class="command">lemma</span></span> dom_lc3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsg3 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-d_fixpoint"><span class="command">lemma</span></span> d_fixpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Semiring-d_type"><span class="command">lemma</span></span> d_type<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="keyword1">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domain_invol<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the semilattice ordering on domain semigroups and explore the semilattice of domain elements from the order point of view.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ds_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="Domain_Semiring-ds_ord_refl"><span class="command">lemma</span></span> ds_ord_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-ds_ord_trans"><span class="command">lemma</span></span> ds_ord_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⊑</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊑</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a ds_ord_def mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-ds_ord_antisym"><span class="command">lemma</span></span> ds_ord_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⊑</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b ds_ord_def mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> b dsg3 dsg4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> b calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This relation is indeed an order.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span>  ds<span class="main">:</span> order <span class="quoted"><span class="quoted">"<span class="main">(⊑)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ds_ord_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ds_ord_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ds_ord_antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-ds_ord_eq"><span class="command">lemma</span></span> ds_ord_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Domain_Semiring-ds_ord_iso_right"><span class="command">lemma</span></span> ds_ord_iso_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsg1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_def dsg4 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The order on domain elements could as well be defined based on multiplication/meet.›</span></span>

<span class="keyword1" id="Domain_Semiring-ds_ord_sl_ord"><span class="command">lemma</span></span> ds_ord_sl_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ds_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Semiring-ds_ord_1"><span class="command">lemma</span></span> ds_ord_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_sl_ord dsg4<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-ds_subid_aux"><span class="command">lemma</span></span> ds_subid_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_def mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Domain_Semiring-ds_dom_iso"><span class="command">lemma</span></span> ds_dom_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_sl_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-ds_dom_llp"><span class="command">lemma</span></span> ds_dom_llp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_subid_aux ds.order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ds_ord_sl_ord dsg4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ds_ord_iso_right dsg1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-ds_dom_llp_strong"><span class="command">lemma</span></span> ds_dom_llp_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_dom_llp ds.eq_iff ds_subid_aux<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">refines</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">refines</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="Domain_Semiring-refines_refl"><span class="command">lemma</span></span> refines_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"refines <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> refines_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Domain_Semiring-refines_trans"><span class="command">lemma</span></span> refines_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"refines <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> refines <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> refines <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> refines_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domain_invol ds.dual_order.trans dsg1 dsg3 ds_ord_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-refines_antisym"><span class="command">lemma</span></span> refines_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"refines <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> refines <span class="free">y</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> refines_def
  <span class="keyword1"><span class="command">using</span></span> ds_dom_llp ds_ord_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">sublocale</span></span> ref<span class="main">:</span> order <span class="quoted"><span class="quoted">"refines"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>refines <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>refines <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>refines <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> refines <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> refines_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> refines <span class="bound">x</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refines_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> refines <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> refines <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> refines <span class="bound">x</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refines_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> refines <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> refines <span class="bound">y</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refines_antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We expand domain semigroups to domain monoids.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_monoid <span class="main">=</span> monoid_mult <span class="main">+</span> domain_semigroup
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Domain_Semiring-dom_one"><span class="command">lemma</span></span> dom_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsg1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-ds_subid_eq"><span class="command">lemma</span></span> ds_subid_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds_ord_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Near-Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The axioms for domain near-semirings are taken from~\cite{DesharnaisStruthAMAST}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_near_semiring <span class="main">=</span> ab_near_semiring <span class="main">+</span> plus_ord <span class="main">+</span> domain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dns1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dns2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dns3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dns4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dns5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Domain near-semirings are automatically dioids; addition is idempotent.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> near_dioid
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dns3 dns5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> dns3  dns4 dns5<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a dns1 dns4 distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prepare to show that domain near-semirings are domain semigroups.›</span></span>

<span class="keyword1" id="Domain_Semiring-dom_iso"><span class="command">lemma</span></span> dom_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Semiring-dom_add_closed"><span class="command">lemma</span></span> dom_add_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1 dns2 dns3 dns4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_absorp_2"><span class="command">lemma</span></span> dom_absorp_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem' dns5<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dns4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_add_closed dns4<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_1"><span class="command">lemma</span></span> dom_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1 dns2 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dns3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_add_closed add_idem'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_subid_aux2"><span class="command">lemma</span></span> dom_subid_aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dns1 dns3 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dns4 add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_glb"><span class="command">lemma</span></span> dom_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns5 less_eq_def mult_isor<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-dom_glb_eq"><span class="command">lemma</span></span> dom_glb_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">∧</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟶</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> dom_absorp_2 dom_glb dom_subid_aux2 local.dual_order.trans local.join.sup.coboundedI2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_ord"><span class="command">lemma</span></span> dom_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns5<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_export"><span class="command">lemma</span></span> dom_export <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dns1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1 dns2 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> dom_add_closed dom_glb dom_1 add_idem' dns2 dns4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a dom_glb_eq dom_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1 dns2 mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a dom_glb_eq dom_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_semigroup
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dns4<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We compare the domain semigroup ordering with that of the dioid.›</span></span>

<span class="keyword1" id="Domain_Semiring-d_two_orders"><span class="command">lemma</span></span> d_two_orders<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_ord ds_ord_sl_ord<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-two_orders"><span class="command">lemma</span></span> two_orders<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2 ds_ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove additional properties.›</span></span>

<span class="keyword1" id="Domain_Semiring-dom_subdist"><span class="command">lemma</span></span> dom_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Domain_Semiring-dom_distrib"><span class="command">lemma</span></span> dom_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> dns3 dns5 dsg4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_assoc' distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dsg4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_llp1"><span class="command">lemma</span></span> dom_llp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_glb_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_llp2"><span class="command">lemma</span></span> dom_llp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_two_orders local.ds_dom_llp two_orders <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Domain_Semiring-dom_llp"><span class="command">lemma</span></span> dom_llp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dom_llp1 dom_llp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We expand domain near-semirings by an additive unit, using slightly different axioms.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_near_semiring_one <span class="main">=</span> ab_near_semiring_one <span class="main">+</span> plus_ord <span class="main">+</span> domain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dnso1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dnso2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dnso3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dnso4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dnso5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The previous axioms are derivable.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_near_semiring
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">d</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.dnso3 local.distrib_right' local.dnso1 local.mult_onel<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="bound">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dnso5<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_commute dnso3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a dnso2 dnso4 dnso5 distrib_right' mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_monoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Domain_Semiring-dom_subid"><span class="command">lemma</span></span> dom_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We add a left unit of multiplication.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_near_semiring_one_zerol <span class="main">=</span> ab_near_semiring_one_zerol <span class="main">+</span> domain_near_semiring_one <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dnso6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Domain_Semiring-domain_very_strict"><span class="command">lemma</span></span> domain_very_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil dns1 dnso6<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-dom_weakly_local"><span class="command">lemma</span></span> dom_weakly_local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domain_very_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_very_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Pre-Dioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Pre-semirings with one and a left zero are automatically dioids.
  Hence there is no point defining domain pre-semirings separately from domain dioids. The axioms
are once again from~\cite{DesharnaisStruthAMAST}.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_pre_dioid_one <span class="main">=</span> pre_dioid_one <span class="main">+</span> domain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dpd1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dpd2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dpd3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dpd4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prepare to show that every domain pre-dioid with one is a domain near-dioid with one.›</span></span>

<span class="keyword1" id="Domain_Semiring-dns1''"><span class="command">lemma</span></span> dns1'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dpd3  mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dpd1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-d_iso"><span class="command">lemma</span></span> d_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dpd4 less_eq_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-domain_1''"><span class="command">lemma</span></span> domain_1''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> d_iso dpd3 mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-domain_export''"><span class="command">lemma</span></span> domain_export'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dpd2 domain_1'' mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_iso dpd3 mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1'' dpd2 mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isol_var one two <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dpd3  mult_1_right mult_isol order.trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1'' dpd2 mult_isol mult_oner<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_subid_aux1''"><span class="command">lemma</span></span> dom_subid_aux1''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dpd3 mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-dom_subid_aux2''"><span class="command">lemma</span></span> dom_subid_aux2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dpd3 mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Domain_Semiring-d_comm"><span class="command">lemma</span></span> d_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1'' domain_export''<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux1'' dom_subid_aux2'' mult_isol_var<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1'' domain_export''<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux1'' dom_subid_aux2'' mult_isol_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_near_semiring_one
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_comm local.join.sup.absorb2<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-domain_subid"><span class="command">lemma</span></span> domain_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dns1 mult_isol mult_oner<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-d_preserves_equation"><span class="command">lemma</span></span> d_preserves_equation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2'' local.antisym local.dom_el_idem local.dom_subid_aux2 local.order_prop local.subdistl mult_assoc<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-d_restrict_iff"><span class="command">lemma</span></span> d_restrict_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2 dsg1 less_eq_def order_trans subdistl<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-d_restrict_iff_1"><span class="command">lemma</span></span> d_restrict_iff_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2 domain_1'' domain_invol dsg1 mult_isol_var order_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We add once more a left unit of multiplication.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_pre_dioid_one_zerol <span class="main">=</span> domain_pre_dioid_one <span class="main">+</span> pre_dioid_one_zerol <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dpd5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_near_semiring_one_zerol
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We do not consider domain semirings without units separately at the moment. The axioms are taken from from~\cite{DesharnaisStruthSCP}›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_semiringl <span class="main">=</span> semiring_one_zerol <span class="main">+</span> plus_ord <span class="main">+</span> domain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dsr1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsr2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsr3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsr4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dsr5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every domain semiring is automatically a domain pre-dioid with one and left zero.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> dioid_one_zerol
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_commute dsr1 dsr3 distrib_left mult_oner<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> domain_pre_dioid_one_zerol
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_semiring <span class="main">=</span> domain_semiringl <span class="main">+</span> semiring_one_zero

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Algebra of Domain Elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that the domain elements of a domain semiring form a distributive lattice. Unfortunately we cannot prove this within the type class of domain semirings.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span>  <span class="tfree">'a</span> d_element <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> domain_semiring<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domain_subid order_class.eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_d_element

<span class="keyword1"><span class="command">instantiation</span></span> d_element <span class="main">::</span> <span class="main">(</span><span class="quoted">domain_semiring</span><span class="main">)</span> <span class="quoted">bounded_lattice</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_d_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> d_element <span class="main">⇒</span> <span class="tfree">'a</span> d_element <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_d_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> d_element <span class="main">⇒</span> <span class="tfree">'a</span> d_element <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_d_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> d_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_d_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> d_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_d_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> d_element <span class="main">⇒</span> <span class="tfree">'a</span> d_element <span class="main">⇒</span> <span class="tfree">'a</span> d_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dsg3<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_d_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> d_element <span class="main">⇒</span> <span class="tfree">'a</span> d_element <span class="main">⇒</span> <span class="tfree">'a</span> d_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2''<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid_aux2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dom_glb<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_subid<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> d_element <span class="main">::</span> <span class="main">(</span><span class="quoted">domain_semiring</span><span class="main">)</span> <span class="quoted">distrib_lattice</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> dom_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Semirings with a Greatest Element›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If there is a greatest element in the semiring, then we have another equality.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_semiring_top <span class="main">=</span> domain_semiring <span class="main">+</span> order_top

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-kat_equivalence_greatest"><span class="command">lemma</span></span> kat_equivalence_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dsg1 mult_isol_var top_greatest<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_glb_eq dom_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Forward Diamond Operators›</span></span>

<span class="keyword1"><span class="command">context</span></span> domain_semiringl

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a forward diamond operator over a domain semiring. A more modular consideration is not given at the moment.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">⟩</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_d_simp"><span class="command">lemma</span></span> fdia_d_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fdia_dom"><span class="command">lemma</span></span> fdia_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fdia_add1"><span class="command">lemma</span></span> fdia_add1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def distrib_left<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fdia_add2"><span class="command">lemma</span></span> fdia_add2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def distrib_right<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fdia_mult"><span class="command">lemma</span></span> fdia_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def mult_assoc<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fdia_one"><span class="command">lemma</span></span> fdia_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fdemodalisation1"><span class="command">lemma</span></span> fdemodalisation1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil dnso6 dsg1 dsg3 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_weakly_local <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdemodalisation2"><span class="command">lemma</span></span> fdemodalisation2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dsg1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a calculation dom_llp2 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_subid_aux2'' order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dom_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_1'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fd_iso1"><span class="command">lemma</span></span> fd_iso1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">z</span><span class="main">⟩</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">|</span><span class="free">z</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fd_def local.dom_iso local.mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Domain_Semiring-fd_iso2"><span class="command">lemma</span></span> fd_iso2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def dom_iso mult_isor<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fd_zero_var"><span class="command">lemma</span></span> fd_zero_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">0</span><span class="main">⟩</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fd_subdist_1"><span class="command">lemma</span></span> fd_subdist_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_iso1<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fd_subdist_2"><span class="command">lemma</span></span> fd_subdist_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_iso1 dom_subid_aux2''<span class="main">)</span>

<span class="keyword1" id="Domain_Semiring-fd_subdist"><span class="command">lemma</span></span> fd_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fd_def fd_iso1 fd_subdist_2 dom_glb dom_subid_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Domain_Semiring-fdia_export_1"><span class="command">lemma</span></span> fdia_export_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> domain_semiring

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_zero"><span class="command">lemma</span></span> fdia_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We add the Kleene star to our considerations. Special domain axioms are not needed.›</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_left_kleene_algebra <span class="main">=</span> left_kleene_algebra_zerol <span class="main">+</span> domain_semiringl

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Domain_Semiring-dom_star"><span class="command">lemma</span></span> dom_star <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dns3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute local.dsr3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_unfold"><span class="command">lemma</span></span> fdia_star_unfold <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.fdia_add2 local.fdia_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_unfoldr"><span class="command">lemma</span></span> fdia_star_unfoldr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fdia_add2 fdia_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_unfold_var"><span class="command">lemma</span></span> fdia_star_unfold_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fdia_add2 fdia_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_unfoldr_var"><span class="command">lemma</span></span> fdia_star_unfoldr_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="main">1</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fdia_add2 fdia_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_induct_var"><span class="command">lemma</span></span> fdia_star_induct_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdemodalisation2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_sim1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdemodalisation2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_induct"><span class="command">lemma</span></span> fdia_star_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.le_supE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fd_def fd_iso1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c fdia_star_induct_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Domain_Semiring-fdia_star_induct_eq"><span class="command">lemma</span></span> fdia_star_induct_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_star_induct<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> domain_kleene_algebra <span class="main">=</span> kleene_algebra <span class="main">+</span> domain_semiring

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> domain_left_kleene_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Antidomain_Semiring">
<div class="head">
<h1>Theory Antidomain_Semiring</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Antidomain Semirings
   Author:     Victor B. F. Gomes, Walter Guttmann, Peter Höfner, Georg Struth, Tjark Weber
   Maintainer: Walter Guttmann &lt;walter.guttman at canterbury.ac.nz&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Antidomain Semirings›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Antidomain_Semiring
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Domain_Semiring.html">Domain_Semiring</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antidomain Monoids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We axiomatise antidomain monoids, using the axioms of~\cite{DesharnaisJipsenStruth}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">antidomain_op</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">ad</span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> antidomain_left_monoid <span class="main">=</span> monoid_mult <span class="main">+</span> antidomain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> am1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> am2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> am3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> am4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> am5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> domain_op <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> zero_class.zero <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a zero element and operations of domain and addition.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">0</span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">am_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">d</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">am_add_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_d_zero"><span class="command">lemma</span></span> a_d_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am1 am2 a_zero_def am_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_d_one"><span class="command">lemma</span></span> a_d_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am1 am3 mult_1_right am_d_def am_add_op_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-n_annil"><span class="command">lemma</span></span> n_annil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_zero_def am_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am1 mult_assoc a_zero_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am1 am2 am3 mult_assoc a_zero_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_mult_idem"><span class="command">lemma</span></span> a_mult_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> am5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_add_idem"><span class="command">lemma</span></span> a_add_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am1 am3 am4 mult_1_right am_add_op_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next three axioms suffice to show that the domain elements form a Boolean algebra.›</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_add_comm"><span class="command">lemma</span></span> a_add_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊕</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> am2 am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_add_assoc"><span class="command">lemma</span></span> a_add_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊕</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_mult_idem am2 am4 mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_add_comm am_add_op_def local.am3 local.am4 mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-huntington"><span class="command">lemma</span></span> huntington <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_add_idem am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_absorb1"><span class="command">lemma</span></span> a_absorb1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_add_idem a_mult_idem am4 mult_assoc am_add_op_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_absorb2"><span class="command">lemma</span></span> a_absorb2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a_mult_idem local.am4 local.mult.semigroup_axioms semigroup.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a_add_idem am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The distributivity laws remain to be proved; our proofs follow those of Maddux~\cite{Maddux}.›</span></span>

<span class="keyword1" id="Antidomain_Semiring-prod_split"><span class="command">lemma</span></span> prod_split <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_add_idem am_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-sum_split"><span class="command">lemma</span></span> sum_split <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_add_idem am_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_comp_simp"><span class="command">lemma</span></span> a_comp_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> am_add_op_def am_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_add_idem am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a_absorb1 a_add_comm am_add_op_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> am_d_def local.am2 local.mult.semigroup_axioms semigroup.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_distrib1"><span class="command">lemma</span></span> a_distrib1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_add_idem am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.am5 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">a</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.am2 local.am4 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> am_add_op_def am_d_def local.am2 local.am4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_add_idem a_mult_idem local.am4 mult_assoc am_add_op_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am2 mult_assoc a_add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_add_idem a_mult_idem am4 am_d_def am_add_op_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_distrib2"><span class="command">lemma</span></span> a_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">ab</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">ab</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">ab</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_distrib1 am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_absorb2 a_mult_idem am_add_op_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> am_add_op_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-aa_loc"><span class="command">lemma</span></span> aa_loc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am3 mult_assoc am_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">w</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">w</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">w</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am5 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult_assoc am_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> am1 mult_assoc n_annil a_zero_def am_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_zero am_d_def f3 local.am1 local.am2 local.am3 local.am4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_loc"><span class="command">lemma</span></span> a_loc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> am_add_op_def am_d_def prod_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> aa_loc am_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-d_a_export"><span class="command">lemma</span></span> d_a_export <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_loc am_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_d_one am_add_op_def am_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">aa</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_distrib2 am_add_op_def local.mult_1_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> am_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every antidomain monoid is a domain monoid.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dm<span class="main">:</span> domain_monoid <span class="quoted">am_d</span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> am_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> am_d_def d_a_export <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> am_d_def local.am2<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-ds_ord_iso1"><span class="command">lemma</span></span> ds_ord_iso1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_very_costrict"><span class="command">lemma</span></span> a_very_costrict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_zero_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_zero_def am_d_def dm.dom_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_weak_loc"><span class="command">lemma</span></span> a_weak_loc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_very_costrict<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a_very_costrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_closure"><span class="command">lemma</span></span> a_closure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_add_idem am_add_op_def am_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_d_mult_closure"><span class="command">lemma</span></span> a_d_mult_closure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Antidomain_Semiring-kat_3'"><span class="command">lemma</span></span> kat_3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dm.dom_one local.am5 local.mult_1_left a_zero_def am_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-s4"><span class="command">lemma</span></span> s4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> am_d_def d_a_export <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">aa</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.am2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_comp_simp a_d_mult_closure am_add_op_def am_d_def local.am2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_monoid <span class="main">=</span> antidomain_left_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> am6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Antidomain_Semiring-kat_3_equiv"><span class="command">lemma</span></span> kat_3_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> kat_3'<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc a_zero_def am_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span> a_zero <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> am_d <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antidomain Near-Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define antidomain near-semirings. We do not consider units separately. The axioms are taken from~\cite{DesharnaisStruthAMAST}.›</span></span>

<span class="keyword1"><span class="command">notation</span></span> zero_class.zero <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> antidomain_near_semiring <span class="main">=</span> ab_near_semiring_one_zerol <span class="main">+</span> antidomain_op <span class="main">+</span> plus_ord <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ans1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ans2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ans3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ans4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ans_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">d</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_a_one"><span class="command">lemma</span></span> a_a_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">1</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ans1 mult_1_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_very_costrict'"><span class="command">lemma</span></span> a_very_costrict'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_a_one ans_d_def local.ans1 local.mult_1_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-one_idem"><span class="command">lemma</span></span> one_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_a_one ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ans_d_def local.ans2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every antidomain near-semiring is automatically a dioid, and therefore ordered.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> near_dioid_one_zerol
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-d1_a"><span class="command">lemma</span></span> d1_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_comm"><span class="command">lemma</span></span> a_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_commute ans4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_subid"><span class="command">lemma</span></span> a_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.ans3 local.join.sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_subid_aux1"><span class="command">lemma</span></span> a_subid_aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_subid mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_subdist"><span class="command">lemma</span></span> a_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux1 ans4 add_comm<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_antitone"><span class="command">lemma</span></span> a_antitone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_subdist local.order_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_mul_d"><span class="command">lemma</span></span> a_mul_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_comm ans_d_def local.ans1<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_gla1"><span class="command">lemma</span></span> a_gla1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid a_very_costrict' ans_d_def local.ans2 local.join.sup.order_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_comm ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_gla2"><span class="command">lemma</span></span> a_gla2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> join.le_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a2_eq"><span class="command">lemma</span></span> a2_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def local.less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_gla1 a_mul_d ans1 d1_a mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_export'"><span class="command">lemma</span></span> a_export' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_gla2 local.mult.semigroup_axioms semigroup.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_comm a_gla1 ans4 mult_assoc ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_commute ans3 ans4 distrib_right' mult_onel ans_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux1 a join.sup_mono ans_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2_eq a_antitone a_comm a_subid_aux1 join.sup_least ans_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every antidomain near-semiring is a domain near-semiring.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dnsz<span class="main">:</span> domain_near_semiring_one_zerol <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"ans_d"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> a2_eq ans_d_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_subid ans_d_def local.join.sup_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_comm ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> a_a_one a_very_costrict' ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Antidomain_Semiring-a_idem"><span class="command">lemma</span></span> a_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_3_var"><span class="command">lemma</span></span> a_3_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ans1 ans4<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_3"><span class="command">lemma</span></span> a_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_mul_d ans4<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_closure'"><span class="command">lemma</span></span> a_closure' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following counterexamples show that some of the antidomain monoid axioms do not need to hold.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Antidomain_Semiring-phl_seq_inv"><span class="command">lemma</span></span> phl_seq_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">d</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="keyword1">ad</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dnsz.dom_weakly_local local.ans1 mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">d</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="keyword1">ad</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_fixpoint"><span class="command">lemma</span></span> a_fixpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a_mul_d ans_d_def local.annil local.ans3 local.join.sup.idem local.mult_1_left<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> ans_d <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antidomain Pre-Dioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Antidomain pre-diods are based on a different set of axioms, which are again taken from~\cite{DesharnaisStruthAMAST}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_pre_dioid <span class="main">=</span> pre_dioid_one_zerol <span class="main">+</span> antidomain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> apd1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> apd2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> apd3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">apd_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">d</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_very_costrict''"><span class="command">lemma</span></span> a_very_costrict''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.add_zerol local.antisym local.apd1 local.apd3 local.join.bot_least local.mult_1_right local.phl_skip<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_subid'"><span class="command">lemma</span></span> a_subid'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.apd3 local.join.sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-d1_a'"><span class="command">lemma</span></span> d1_a' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apd_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_subid_aux1'"><span class="command">lemma</span></span> a_subid_aux1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_subid' mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_mul_d'"><span class="command">lemma</span></span> a_mul_d' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_very_costrict'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid' a_very_costrict'' apd_d_def local.antisym local.apd2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_d_closed"><span class="command">lemma</span></span> a_d_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apd_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apd_d_def local.distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_mul_d' apd_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid' mult_1_right mult_isol apd_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apd_d_def local.apd2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apd_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-meet_ord_def"><span class="command">lemma</span></span> meet_ord_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_closed a_subid_aux1' d1_a' eq_iff mult_1_right mult_isol<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-d_weak_loc"><span class="command">lemma</span></span> d_weak_loc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_very_costrict''<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apd1 apd2 a_subid' apd_d_def d1_a' eq_iff mult_1_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_very_costrict''<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-gla_1"><span class="command">lemma</span></span> gla_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_weak_loc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join.sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apd_d_def calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a join.sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apd_d_def a_subid' mult_1_right mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apd_d_def a_d_closed a_mul_d' distrib_right' less_eq_def no_trivial_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apd_d_def apd3 add_0_left distrib_right' mult_1_left<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute apd3 mult_oner subdistl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a2_eq'"><span class="command">lemma</span></span> a2_eq' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apd_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gla_1 apd1 a_mul_d' d1_a' mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_supdist_var"><span class="command">lemma</span></span> a_supdist_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gla_1 apd1 join.le_bot subdistl<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_antitone'"><span class="command">lemma</span></span> a_antitone'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_supdist_var local.order_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_comm_var"><span class="command">lemma</span></span> a_comm_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_subid' mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_antitone' a_subid_aux1' apd_d_def local.mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_comm'"><span class="command">lemma</span></span> a_comm'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_comm_var eq_iff<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_closed"><span class="command">lemma</span></span> a_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_antitone' a_subid_aux1'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2_eq' a_antitone' a_comm' a_d_closed apd_d_def f1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d1_a' meet_ord_def mult_assoc apd_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f1 a_comm' apd_d_def meet_ord_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_export''"><span class="command">lemma</span></span> a_export'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_weak_loc mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closed a_comm' apd_d_def gla_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apd3 a_comm' d1_a' distrib_right' mult_1_right apd_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux1' a join.sup_mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_antitone' a_subid_aux1'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apd_d_def a_mul_d' d1_a' gla_1 apd1 join.sup_least mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-d1_sum_var"><span class="command">lemma</span></span> d1_sum_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.distrib_right' local.join.sup_ge1 local.join.sup_ge2 local.join.sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> order_trans subdistl_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a4'"><span class="command">lemma</span></span> a4'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_closed a_supdist_var add_commute d1_a' local.mult_isol_var<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_def add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_closed a_export''<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_antitone' apd_d_def d1_sum_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Antidomain pre-dioids are domain pre-dioids and antidomain near-semirings, but still not antidomain monoids.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dpdz<span class="main">:</span> domain_pre_dioid_one_zerol <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> apd_d_def d1_a' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> a2_eq' apd_d_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_subid'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a4' apd_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_mul_d' a_very_costrict'' apd_d_def local.mult_onel<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> antidomain_near_semiring
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> local.apd2 local.less_eq_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a4'<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_supdist"><span class="command">lemma</span></span> a_supdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_supdist_var local.join.le_supI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_gla"><span class="command">lemma</span></span> a_gla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gla_1 a_gla2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Antidomain_Semiring-a_subid_aux2"><span class="command">lemma</span></span> a_subid_aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_subid' mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a42_var"><span class="command">lemma</span></span> a42_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apd_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-d1_weak"><span class="command">lemma</span></span> d1_weak <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute apd_d_def dpdz.dnso3 local.mult_1_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> apd_d <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antidomain Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Antidomain semirings are direct expansions of antidomain pre-dioids, but do not require idempotency of addition. Hence we give a slightly different axiomatisation, following~\cite{DesharnaisStruthSCP}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_semiringl <span class="main">=</span> semiring_one_zerol <span class="main">+</span> plus_ord <span class="main">+</span> antidomain_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> as2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> as3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ads_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">d</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Antidomain_Semiring-one_idem'"><span class="command">lemma</span></span> one_idem'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as1 as2 as3 add_zeror mult.right_neutral<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every antidomain semiring is a dioid and an antidomain pre-dioid.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> dioid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> distrib_left mult.right_neutral one_idem'<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> antidomain_pre_dioid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> local.less_eq_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-am5_lem"><span class="command">lemma</span></span> am5_lem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ads_d_def local.a2_eq' local.apd_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ans4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ads_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-am6_lem"><span class="command">lemma</span></span> am6_lem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ans1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ads_d_def local.a2_eq' local.apd_d_def local.distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="skolem">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute ads_d_def local.as3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_zero"><span class="command">lemma</span></span> a_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_very_costrict''<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_one"><span class="command">lemma</span></span> a_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_zero local.dpdz.dpd5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subclass</span></span> antidomain_left_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  local.a_comm'<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every antidomain left semiring is a domain left semiring.›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> domain_semiringl_class.fd <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">⟩</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fdia</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">⟩</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ds<span class="main">:</span> domain_semiringl <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"ds.fd <span class="free">x</span> <span class="free">y</span> <span class="main">≡</span> fdia <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.domain_semiringl <span class="main">(+)</span> <span class="main">(⋅)</span> <span class="main">1</span> <span class="numeral">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> local.dpdz.dpd4 ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ds<span class="main">:</span> domain_semiringl <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ds.fd <span class="free">x</span> <span class="free">y</span> <span class="main">≡</span> fdia <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fdia_def ds.fd_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-fd_eq_fdia"><span class="command">lemma</span></span> fd_eq_fdia <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"domain_semiringl.fd <span class="main">(⋅)</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≡</span> fdia <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"class.domain_semiringl <span class="main">(+)</span> <span class="main">(⋅)</span> <span class="main">1</span> <span class="numeral">0</span> <span class="keyword1">d</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ads_d_def local.ans_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"domain_semiringl.fd <span class="main">(⋅)</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="main">(⋅)</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> domain_semiringl.fd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ds.fd <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ds.fd_def ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_semiringl.fd <span class="main">(⋅)</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≡</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_semiring <span class="main">=</span> antidomain_semiringl <span class="main">+</span> semiring_one_zero

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every antidomain semiring is an antidomain monoid.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> antidomain_monoid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ans1 mult_1_right annir<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"a_zero <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_zero_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> ds<span class="main">:</span> domain_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"ds.fd <span class="free">x</span> <span class="free">y</span> <span class="main">≡</span> fdia <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Boolean Algebra of Domain Elements›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> a2_element <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> antidomain_semiring<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ads_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_a2_element

<span class="keyword1"><span class="command">instantiation</span></span> a2_element <span class="main">::</span> <span class="main">(</span><span class="quoted">antidomain_semiring</span><span class="main">)</span> <span class="quoted">boolean_algebra</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ads_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ads_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ads_d_def dpdz.dom_mult_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ads_d_def ds.dsr5<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">minus_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ads_d_def dpdz.domain_export''<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_a2_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> a2_element <span class="main">⇒</span> <span class="tfree">'a</span> a2_element"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">antidomain_op</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ads_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux2 ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a_subid_aux1' ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ads_d_def dpdz.dom_glb<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a_subid' ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ads_d_def dpdz.dom_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ads_d_def ans1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ads_d_def ans3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Further Properties›</span></span>

<span class="keyword1"><span class="command">context</span></span> antidomain_semiringl

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Antidomain_Semiring-a_2_var"><span class="command">lemma</span></span> a_2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.a_gla local.ads_d_def local.dpdz.dom_weakly_local <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two lemmas give the Galois connection of Heyting algebras.›</span></span>

<span class="keyword1" id="Antidomain_Semiring-da_shunt1"><span class="command">lemma</span></span> da_shunt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_subid_aux2 ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-da_shunt2"><span class="command">lemma</span></span> da_shunt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> da_shunt1 local.a_add_idem local.ads_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-d_a_galois1"><span class="command">lemma</span></span> d_a_galois1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc local.a_gla local.ads_d_def local.am2 local.ans4 local.ans_d_def local.dnsz.dnso4<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-d_a_galois2"><span class="command">lemma</span></span> d_a_galois2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a2_eq' local.apd_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_a_galois1 local.a_export' local.ads_d_def local.ans_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-d_cancellation_1"><span class="command">lemma</span></span> d_cancellation_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_closure' local.ads_d_def local.am2 local.ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_a_galois1 local.a_comm_var local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a add_commute local.ads_d_def local.am2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-d_cancellation_2"><span class="command">lemma</span></span> d_cancellation_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> da_shunt1<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_de_morgan"><span class="command">lemma</span></span> a_de_morgan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.ads_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_de_morgan_var_3"><span class="command">lemma</span></span> a_de_morgan_var_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.a_add_idem local.ads_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_de_morgan_var_4"><span class="command">lemma</span></span> a_de_morgan_var_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.a_add_idem local.ads_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_4"><span class="command">lemma</span></span> a_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.a_add_idem local.a_antitone' local.dpdz.domain_1'' am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_6"><span class="command">lemma</span></span> a_6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_de_morgan_var_4 local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-a_7"><span class="command">lemma</span></span> a_7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_de_morgan_var_3 local.mult.semigroup_axioms semigroup.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Antidomain_Semiring-a_d_add_closure"><span class="command">lemma</span></span> a_d_add_closure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.a_add_idem local.ads_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-d_6"><span class="command">lemma</span></span> d_6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left ads_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.ads_d_def local.ans_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-d_7"><span class="command">lemma</span></span> d_7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_d_add_closure local.ads_d_def local.ans4 local.s4<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_mult_add"><span class="command">lemma</span></span> a_mult_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-kat_2"><span class="command">lemma</span></span> kat_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.mult_isol mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.join.le_bot ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-kat_3"><span class="command">lemma</span></span> kat_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.a_zero_def local.ads_d_def local.am_d_def local.kat_3' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-kat_4"><span class="command">lemma</span></span> kat_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_subid_aux1 mult_assoc ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-kat_2_equiv"><span class="command">lemma</span></span> kat_2_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kat_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_subid_aux2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-kat_4_equiv"><span class="command">lemma</span></span> kat_4_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.ads_d_def local.dpdz.d_preserves_equation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-kat_3_equiv_opp"><span class="command">lemma</span></span> kat_3_equiv_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_commute local.add_zerol local.ads_d_def local.as3 local.distrib_right' local.mult_1_left mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_4 local.a_add_idem local.a_gla2 local.ads_d_def mult_assoc am_add_op_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-kat_4_equiv_opp"><span class="command">lemma</span></span> kat_4_equiv_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> kat_2_equiv kat_3_equiv_opp local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Forward Box and Diamond Operators›</span></span>

<span class="keyword1" id="Antidomain_Semiring-fdemodalisation22"><span class="command">lemma</span></span> fdemodalisation22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.a_gla local.ads_d_def local.ans4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dpdz.dom_weakly_local mult_assoc ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dpdz.dom_weakly_local ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-dia_diff_var"><span class="command">lemma</span></span> dia_diff_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dpdz.dom_glb_eq ds.fd_subdist fdia_def ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as3 add_comm ds.fdia_d_simp mult_1_right ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.distrib_left local.ds.fdia_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> local.join.sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def ads_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-dia_diff"><span class="command">lemma</span></span> dia_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fdia_def dia_diff_var d_a_galois2 ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Antidomain_Semiring-fdia_export_2"><span class="command">lemma</span></span> fdia_export_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.am_d_def local.d_a_export local.fdia_def mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fdia_split"><span class="command">lemma</span></span> fdia_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel ans3 distrib_right ads_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fbox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span> <span class="keyword1">|</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemmas establish the De Morgan duality between boxes and diamonds.›</span></span>

<span class="keyword1" id="Antidomain_Semiring-fdia_fbox_de_morgan_2"><span class="command">lemma</span></span> fdia_fbox_de_morgan_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_def local.a_closure local.a_loc local.am_d_def local.fdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_simp"><span class="command">lemma</span></span> fbox_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_def local.a_add_idem local.ads_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_dom"><span class="command">lemma</span></span> fbox_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="numeral">0</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_add1"><span class="command">lemma</span></span> fbox_add1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_de_morgan_var_4 fbox_def local.distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_add2"><span class="command">lemma</span></span> fbox_add2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">]</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_mult"><span class="command">lemma</span></span> fbox_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">]</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_def local.a2_eq' local.apd_d_def mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_zero"><span class="command">lemma</span></span> fbox_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="numeral">0</span><span class="main">]</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_one"><span class="command">lemma</span></span> fbox_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">]</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def ads_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_iso"><span class="command">lemma</span></span> fbox_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">z</span><span class="main">]</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">|</span><span class="free">z</span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_add_idem local.a_antitone' local.ads_d_def am_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">z</span><span class="main">]</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">|</span><span class="free">z</span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def a_antitone'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-fbox_antitone_var"><span class="command">lemma</span></span> fbox_antitone_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def a_antitone mult_isor<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_subdist_1"><span class="command">lemma</span></span> fbox_subdist_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_de_morgan_var_4 fbox_def local.a_supdist_var local.distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_subdist_2"><span class="command">lemma</span></span> fbox_subdist_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">≤</span><span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_iso ads_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_subdist"><span class="command">lemma</span></span> fbox_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_iso sup_least ads_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_diff_var"><span class="command">lemma</span></span> fbox_diff_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dpdz.dsg4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_subid_aux1' local.ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_add1 fbox_iso<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-fbox_diff"><span class="command">lemma</span></span> fbox_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_closure' local.ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="bound">aa</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">aa</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.am2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.ans4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">ab</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">aa</span> <span class="main">+</span> <span class="bound">ab</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">ab</span> <span class="main">+</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 local.distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">aa</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a_mult_add fbox_def fbox_subdist_1 local.a_gla2 local.ads_d_def local.ans4 local.distrib_left local.gla_1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f6 f4 f3 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def local.ads_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> antidomain_semiring

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Antidomain_Semiring-kat_1"><span class="command">lemma</span></span> kat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ads_d_def local.as3 local.distrib_right local.mult_1_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a add_iso mult_isor mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ads_d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_subid_aux2 local.dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-kat_1_equiv"><span class="command">lemma</span></span> kat_1_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> kat_1 kat_2 kat_3 kat_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Antidomain_Semiring-kat_3_equiv'"><span class="command">lemma</span></span> kat_3_equiv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kat_1_equiv local.kat_2_equiv local.kat_4_equiv<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-kat_1_equiv_opp"><span class="command">lemma</span></span> kat_1_equiv_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kat_1_equiv local.a_closure' local.ads_d_def local.ans_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-kat_2_equiv_opp"><span class="command">lemma</span></span> kat_2_equiv_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">x</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kat_1_equiv_opp local.kat_3_equiv_opp local.kat_4_equiv_opp<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_one_1"><span class="command">lemma</span></span> fbox_one_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_demodalisation3"><span class="command">lemma</span></span> fbox_demodalisation3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_def a_gla kat_2_equiv_opp mult_assoc ads_d_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antidomain Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_left_kleene_algebra <span class="main">=</span> antidomain_semiringl <span class="main">+</span> left_kleene_algebra_zerol

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dka<span class="main">:</span> domain_left_kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="keyword1">d</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">star</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"domain_semiringl.fd <span class="main">(⋅)</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≡</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.ads_d_def ans_d_def<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-a_star"><span class="command">lemma</span></span> a_star <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dka.dom_star local.a_very_costrict'' local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_unfold"><span class="command">lemma</span></span> fbox_star_unfold <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">]</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.conway.dagger_unfoldl_distr mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_closure' local.ans_d_def local.fbox_def local.fdia_def local.fdia_fbox_de_morgan_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_unfold_var"><span class="command">lemma</span></span> fbox_star_unfold_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_star_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_unfoldr"><span class="command">lemma</span></span> fbox_star_unfoldr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">1</span><span class="main">]</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_star_unfold fbox_mult star_slide_var<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_unfoldr_var"><span class="command">lemma</span></span> fbox_star_unfoldr_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">z</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fbox_star_unfoldr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_induct_var"><span class="command">lemma</span></span> fbox_star_induct_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_closure' local.ans_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dka.fdia_star_induct local.a_export' local.ads_d_def local.ans4 local.ans_d_def local.eq_refl local.fbox_def local.fdia_def local.meet_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> zero_class.zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_commute local.a_2_var local.ads_d_def local.ans4<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_2_var local.ads_d_def local.fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_induct"><span class="command">lemma</span></span> fbox_star_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.a_subid_aux2 local.dual_order.trans local.fbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a1 dka.dom_subid_aux2 local.dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fbox_star_induct_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a local.fbox_iso local.order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Antidomain_Semiring-fbox_star_induct_eq"><span class="command">lemma</span></span> fbox_star_induct_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_star_induct<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_export_1"><span class="command">lemma</span></span> fbox_export_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_6 local.fbox_def mult_assoc<span class="main">)</span>

<span class="keyword1" id="Antidomain_Semiring-fbox_export_2"><span class="command">lemma</span></span> fbox_export_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.ads_d_def local.ans_d_def local.fbox_def mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> antidomain_kleene_algebra <span class="main">=</span> antidomain_semiring <span class="main">+</span> kleene_algebra

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> antidomain_left_kleene_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="keyword1">d</span> <span class="free">t</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span>"</span></span>
<span class="comment1">(*nitpick [expect=genuine]*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Range_Semiring">
<div class="head">
<h1>Theory Range_Semiring</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Range and Antirange Semirings
   Author:     Victor B. F. Gomes, Walter Guttmann, Peter Höfner, Georg Struth, Tjark Weber
   Maintainer: Walter Guttmann &lt;walter.guttman at canterbury.ac.nz&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Range and Antirange Semirings›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Range_Semiring
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Antidomain_Semiring.html">Antidomain_Semiring</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Range Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We set up the duality between domain and antidomain semirings on the one hand and range and antirange semirings on the other hand.›</span></span>

<span class="keyword1"><span class="command">class</span></span> range_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">range_op</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">r</span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> range_semiring <span class="main">=</span> semiring_one_zero <span class="main">+</span> plus_ord <span class="main">+</span> range_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rsr1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rsr2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="main">(</span><span class="keyword1">r</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">r</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rsr3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rsr4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rsr5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">r</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">r</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">|</span> _"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">r</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> range_op <span class="main">(</span><span class="quoted">"<span class="keyword1">r</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> range_semiring <span class="main">⊆</span> rdual<span class="main">:</span> domain_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">range_op</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"rdual.fd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.domain_semiring <span class="main">(+)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span> <span class="main">0</span> range_op <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_assoc distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> rdual<span class="main">:</span> domain_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">range_op</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rdual.fd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rdual.fd_def bd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> domain_semiring <span class="main">⊆</span> ddual<span class="main">:</span> range_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">domain_op</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"ddual.bd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> domain_semiringl_class.fd <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.range_semiring <span class="main">(+)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span> <span class="main">0</span> domain_op <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_assoc distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ddual<span class="main">:</span> range_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">domain_op</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ddual.bd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> domain_semiringl_class.fd <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ddual.bd_def fd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antirange Semirings›</span></span>

<span class="keyword1"><span class="command">class</span></span> antirange_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">antirange_op</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">ar</span></span></span> _"</span> <span class="main">[</span>999<span class="main">]</span> 1000<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> antirange_semiring <span class="main">=</span> semiring_one_zero <span class="main">+</span> plus_ord <span class="main">+</span> antirange_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ars1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ar</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ars2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ar</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ar</span> <span class="main">(</span><span class="keyword1">ar</span> <span class="keyword1">ar</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ar</span> <span class="main">(</span><span class="keyword1">ar</span> <span class="keyword1">ar</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ars3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ar</span> <span class="keyword1">ar</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ar</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> bd <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">|</span> _"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ars_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">r</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">r</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">ar</span> <span class="main">(</span><span class="keyword1">ar</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bdia</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">|</span> _"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">ar</span> <span class="keyword1">ar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bbox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">|</span> _"</span> <span class="main">[</span>61<span class="main">,</span>81<span class="main">]</span> 82<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">ar</span> <span class="main">(</span><span class="keyword1">ar</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> antirange_semiring <span class="main">⊆</span> ardual<span class="main">:</span> antidomain_semiring <span class="quoted">antirange_op</span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"ardual.ads_d <span class="free">x</span> <span class="main">=</span> <span class="keyword1">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ardual.fdia <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ardual.fbox <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">|</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.antidomain_semiring antirange_op <span class="main">(+)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span> <span class="main">0</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_assoc distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ardual<span class="main">:</span> antidomain_semiring <span class="quoted">antirange_op</span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ardual.ads_d <span class="free">x</span> <span class="main">=</span> <span class="keyword1">r</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ardual.ads_d_def local.ars_r_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ardual.fdia <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ardual.fdia_def bdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ardual.fbox <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">|</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ardual.fbox_def bbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> antirange_semiring

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> rs<span class="main">:</span> range_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">ar</span> <span class="keyword1">ar</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> antidomain_semiring <span class="main">⊆</span> addual<span class="main">:</span> antirange_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted">antidomain_op</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"addual.ars_r <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"addual.bdia <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"addual.bbox <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.antirange_semiring <span class="main">(+)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span> <span class="numeral">0</span> antidomain_op <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_assoc distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> addual<span class="main">:</span> antirange_semiring <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted">antidomain_op</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"addual.ars_r <span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addual.ars_r_def local.ads_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"addual.bdia <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> addual.bdia_def fdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"addual.bbox <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> addual.bbox_def fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antirange Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">class</span></span> antirange_kleene_algebra <span class="main">=</span> antirange_semiring <span class="main">+</span> kleene_algebra

<span class="keyword1"><span class="command">sublocale</span></span> antirange_kleene_algebra <span class="main">⊆</span> dual<span class="main">:</span> antidomain_kleene_algebra <span class="quoted">antirange_op</span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> local.star_inductr' local.star_inductl<span class="main">)</span>


<span class="keyword1"><span class="command">sublocale</span></span> antidomain_kleene_algebra <span class="main">⊆</span> dual<span class="main">:</span> antirange_kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span> <span class="quoted">antidomain_op</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_inductr star_inductl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Hence all range theorems have been derived by duality in a generic way.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Modal_Kleene_Algebra">
<div class="head">
<h1>Theory Modal_Kleene_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Modal Kleene Algebras
   Author:     Victor B. F. Gomes, Walter Guttmann, Peter Höfner, Georg Struth, Tjark Weber
   Maintainer: Walter Guttmann &lt;walter.guttman at canterbury.ac.nz&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Modal Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section studies laws that relate antidomain and antirange semirings and Kleene algebra,
notably Galois connections and conjugations as those studied in~\cite{MoellerStruth,DesharnaisStruthSCP}.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Modal_Kleene_Algebra
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Range_Semiring.html">Range_Semiring</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> modal_semiring <span class="main">=</span> antidomain_semiring <span class="main">+</span> antirange_semiring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> domrange <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">r</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rangedom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">r</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These axioms force that the domain algebra and the range algebra coincide.›</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra-domrangefix"><span class="command">lemma</span></span> domrangefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="keyword1">r</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domrange rangedom<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_diamond_galois_1"><span class="command">lemma</span></span> box_diamond_galois_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms domrangefix local.ardual.ds.fdemodalisation2 local.ars_r_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fbox_demodalisation3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_diamond_galois_2"><span class="command">lemma</span></span> box_diamond_galois_2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">[</span><span class="free">x</span><span class="main">|</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.ads_d_def local.ds.fdemodalisation2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms domrangefix local.ardual.fbox_demodalisation3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra-diamond_conjugation_var_1"><span class="command">lemma</span></span> diamond_conjugation_var_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">q</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.ads_d_def local.ds.fdemodalisation2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.ads_d_def local.kat_1_equiv_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms box_diamond_galois_1 local.ads_d_def local.fbox_demodalisation3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra-diamond_conjungation_aux"><span class="command">lemma</span></span> diamond_conjungation_aux<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.a_antitone' local.a_gla local.ads_d_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">⋅</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">=</span> zero_class.zero"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> domrangefix local.a_gla local.ads_d_def local.antisym local.ardual.a_gla2 local.ardual.gla_1 local.ars_r_def local.bdia_def local.eq_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra-diamond_conjugation"><span class="command">lemma</span></span> diamond_conjugation<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">q</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">q</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">q</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.a_gla local.ads_d_def local.am2 local.fdia_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms diamond_conjugation_var_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms diamond_conjungation_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_conjugation_var_1"><span class="command">lemma</span></span> box_conjugation_var_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">[</span><span class="free">x</span><span class="main">|</span> <span class="free">q</span> <span class="main">⟷</span> <span class="keyword1">ad</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms box_diamond_galois_1 box_diamond_galois_2 diamond_conjugation_var_1 local.ads_d_def<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_diamond_cancellation_1"><span class="command">lemma</span></span> box_diamond_cancellation_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> box_diamond_galois_1 domrangefix local.ars_r_def local.bdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_diamond_cancellation_2"><span class="command">lemma</span></span> box_diamond_cancellation_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">[</span><span class="free">x</span><span class="main">|</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> box_diamond_galois_2 local.ads_d_def local.dpdz.domain_invol local.eq_refl local.fdia_def<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_diamond_cancellation_3"><span class="command">lemma</span></span> box_diamond_cancellation_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">[</span><span class="free">x</span><span class="main">|</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> box_diamond_galois_2 domrangefix local.ardual.fdia_fbox_de_morgan_2 local.ars_r_def local.bbox_def local.bdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Modal_Kleene_Algebra-box_diamond_cancellation_4"><span class="command">lemma</span></span> box_diamond_cancellation_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span><span class="main">|</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> box_diamond_galois_1 local.ads_d_def local.fbox_def local.fdia_def local.fdia_fbox_de_morgan_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> modal_kleene_algebra <span class="main">=</span> modal_semiring <span class="main">+</span> kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> antidomain_kleene_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> antirange_kleene_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Modal_Kleene_Algebra_Models">
<div class="head">
<h1>Theory Modal_Kleene_Algebra_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Models of Modal Kleene Algebras
   Author:     Victor B. F. Gomes, Walter Guttmann, Peter Höfner, Georg Struth, Tjark Weber
   Maintainer: Walter Guttmann &lt;walter.guttman at canterbury.ac.nz&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models of Modal Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Modal_Kleene_Algebra_Models
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Kleene_Algebra_Models.html">Kleene_Algebra.Kleene_Algebra_Models</a>
  <a href="Modal_Kleene_Algebra.html">Modal_Kleene_Algebra</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section develops the relation model. We also briefly develop the trace model for
  antidomain Kleene algebras, but not for antirange or full modal Kleene algebras.
  The reason is that traces are implemented as lists; we therefore expect tedious inductive
  proofs in the presence of range. The language model is not particularly interesting.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_ad</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_ad</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_antidomain_kleene_algebra<span class="main">:</span> antidomain_kleene_algebra <span class="quoted">rel_ad</span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_ad_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trace_a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">trace_a</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">|</span> <span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> first <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> trace_antidomain_kleene_algebra<span class="main">:</span> antidomain_kleene_algebra <span class="quoted">trace_a</span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">t_prod</span> <span class="quoted">t_one</span> <span class="quoted">t_zero</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">t_star</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> t_prod <span class="main">(</span>trace_a <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> t_zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_a_def t_prod_def t_fusion_def t_zero_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> trace_a <span class="main">(</span>t_prod <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∪</span> trace_a <span class="main">(</span>t_prod <span class="bound">x</span> <span class="main">(</span>trace_a <span class="main">(</span>trace_a <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> trace_a <span class="main">(</span>t_prod <span class="bound">x</span> <span class="main">(</span>trace_a <span class="main">(</span>trace_a <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_a_def t_prod_def t_fusion_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> trace_a <span class="main">(</span>trace_a <span class="bound">x</span><span class="main">)</span> <span class="main">∪</span> trace_a <span class="bound">x</span> <span class="main">=</span> t_one"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_a_def t_one_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The trace model should be extended to cover modal Kleene algebras in the future.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_ar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_ar</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_antirange_kleene_algebra<span class="main">:</span> antirange_semiring <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted">rel_ar</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_ar_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_modal_kleene_algebra<span class="main">:</span> modal_kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted">rel_ad</span> <span class="quoted">rel_ar</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> rel_antidomain_kleene_algebra.a_d_closed rel_antidomain_kleene_algebra.a_one rel_antidomain_kleene_algebra.addual.ars_r_def rel_antidomain_kleene_algebra.am5_lem rel_antidomain_kleene_algebra.am6_lem rel_antidomain_kleene_algebra.apd_d_def rel_antidomain_kleene_algebra.dka.dns1 rel_antidomain_kleene_algebra.dpdz.dom_one rel_antirange_kleene_algebra.ardual.a_comm' rel_antirange_kleene_algebra.ardual.a_d_closed rel_antirange_kleene_algebra.ardual.a_mul_d' rel_antirange_kleene_algebra.ardual.a_mult_idem rel_antirange_kleene_algebra.ardual.a_zero rel_antirange_kleene_algebra.ardual.ads_d_def rel_antirange_kleene_algebra.ardual.am6_lem rel_antirange_kleene_algebra.ardual.apd_d_def rel_antirange_kleene_algebra.ardual.s4<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rel_antidomain_kleene_algebra.a_zero rel_antidomain_kleene_algebra.addual.ars1 rel_antidomain_kleene_algebra.addual.ars_r_def rel_antidomain_kleene_algebra.am5_lem rel_antidomain_kleene_algebra.am6_lem rel_antidomain_kleene_algebra.ds.ddual.mult_oner rel_antidomain_kleene_algebra.s4 rel_antirange_kleene_algebra.ardual.ads_d_def rel_antirange_kleene_algebra.ardual.am6_lem rel_antirange_kleene_algebra.ardual.apd1 rel_antirange_kleene_algebra.ardual.dpdz.dns1''<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Modal_Kleene_Algebra_Applications">
<div class="head">
<h1>Theory Modal_Kleene_Algebra_Applications</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Applications of Modal Kleene Algebras
   Author:     Victor B. F. Gomes, Walter Guttmann, Peter Höfner, Georg Struth, Tjark Weber
   Maintainer: Walter Guttmann &lt;walter.guttman at canterbury.ac.nz&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Applications of Modal Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Modal_Kleene_Algebra_Applications
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Antidomain_Semiring.html">Antidomain_Semiring</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This file collects some applications of the theories developed so far. These are described
 in~\cite{guttmannstruthweber11algmeth}.›</span></span>

<span class="keyword1"><span class="command">context</span></span> antidomain_kleene_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A Reachability Result›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This example is taken from~\cite{desharnaismoellerstruth06kad}.›</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-opti_iterate_var"><span class="command">lemma</span></span> opti_iterate_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_subid_aux1' ds.fd_iso2 star_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.ads_d_def local.d_6 local.fdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_export_2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dka.fd_def local.dka.fdia_star_induct_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-opti_iterate"><span class="command">lemma</span></span> opti_iterate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conway.dagger_slide local.ds.fdia_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-opti_iterate_var_2"><span class="command">lemma</span></span> opti_iterate_var_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="keyword1">ad</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dka.fdia_star_unfold_var opti_iterate_var<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derivation of Segerberg's Formula›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This example is taken from~\cite{DesharnaisMoellerStruthLMCS}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Alpha</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">A</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">A</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-A_dom"><span class="command">lemma</span></span> A_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Alpha_def local.a_d_closed local.ads_d_def local.apd_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-A_fdia"><span class="command">lemma</span></span> A_fdia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Alpha_def local.dka.fd_def<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-A_fdia_var"><span class="command">lemma</span></span> A_fdia_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_fdia<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-a_A"><span class="command">lemma</span></span> a_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">A</span> <span class="free">x</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Alpha_def local.a_6 local.a_d_closed local.apd_d_def local.fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-fsegerberg"><span class="command">lemma</span></span> fsegerberg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_fdia add_assoc local.ds.fdia_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.am2 local.d_6 local.dka.fd_def local.fdia_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_dom A_fdia add_assoc local.dka.fdia_star_unfold_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.a_d_add_closure local.ads_d_def local.dka.fdia_star_induct_eq local.fdia_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_fdia<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dpdz.domain_1'' local.ds.fd_iso1 local.join.sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">A</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-fbox_segerberg"><span class="command">lemma</span></span> fbox_segerberg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_d_closed local.ads_d_def local.apd_d_def local.fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">A</span> <span class="free">x</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_A local.fdia_fbox_de_morgan_2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">A</span> <span class="free">x</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">ad</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fsegerberg local.a_d_closed local.ads_d_def local.apd_d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f1 local.ads_d_def local.ans4 local.fbox_simp local.fdia_fbox_de_morgan_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Wellfoundedness and Loeb's Formula›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This example is taken from~\cite{DesharnaisStruthSCP}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Omega</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Ω</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Ω</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $y$ is a set, then $\Omega(x,y)$ describes those elements in $y$ from which no further $x$ transitions are possible.›</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_fdia"><span class="command">lemma</span></span> omega_fdia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Omega_def local.a_d_closed local.ads_d_def local.apd_d_def local.dka.fd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_fbox"><span class="command">lemma</span></span> omega_fbox<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_fbox_de_morgan_2 omega_fdia<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_absorb1"><span class="command">lemma</span></span> omega_absorb1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">)</span> <span class="main">=</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc omega_fdia<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_absorb2"><span class="command">lemma</span></span> omega_absorb2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Omega_def mult_assoc<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_le_1"><span class="command">lemma</span></span> omega_le_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Omega_def d_a_galois1<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_subid"><span class="command">lemma</span></span> omega_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Omega_def local.a_subid_aux2<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_le_2"><span class="command">lemma</span></span> omega_le_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dka.dom_subid_aux2 omega_fdia<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_dom"><span class="command">lemma</span></span> omega_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Omega_def local.a_d_closed local.ads_d_def local.apd_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-a_omega"><span class="command">lemma</span></span> a_omega<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Omega_def local.a_6 local.ds.fd_def<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_fdia_3"><span class="command">lemma</span></span> omega_fdia_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Omega_def local.ads_d_def local.fdia_def local.s4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-omega_zero_equiv_1"><span class="command">lemma</span></span> omega_zero_equiv_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Omega_def local.a_gla local.ads_d_def local.fdia_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Loebian</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Loebian</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PreLoebian</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">PreLoebian</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Noetherian</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Noetherian</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">Ω</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟶</span> <span class="keyword1">d</span> <span class="bound">y</span> <span class="main">=</span> <span class="numeral">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-noetherian_alt"><span class="command">lemma</span></span> noetherian_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">d</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="keyword1">d</span> <span class="bound">y</span> <span class="main">=</span> <span class="numeral">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Noetherian_def omega_zero_equiv_1<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-Noetherian_iff_PreLoebian"><span class="command">lemma</span></span> Noetherian_iff_PreLoebian<span class="main">:</span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span> <span class="main">⟷</span> PreLoebian <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dka.fdia_star_unfold_var omega_dom<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ans4 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dka.dom_subid_aux2 local.mult_isor<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dia_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp local.ads_d_def local.dpdz.dom_mult_closed local.fdia_def noetherian_alt<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_gla local.ads_d_def local.dka.fd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"PreLoebian <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> PreLoebian_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"PreLoebian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">d</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> omega_zero_equiv_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> PreLoebian_def a b a_one a_zero add_zeror annir fdia_def less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Noetherian_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-Loebian_imp_Noetherian"><span class="command">lemma</span></span> Loebian_imp_Noetherian<span class="main">:</span> <span class="quoted"><span class="quoted">"Loebian <span class="free">x</span> <span class="main">⟹</span> Noetherian <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Loebian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">d</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> omega_zero_equiv_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Loebian_def a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="skolem">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b local.antisym local.fdia_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Noetherian <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Noetherian_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-d_transitive"><span class="command">lemma</span></span> d_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.dka.fd_def local.dka.fdia_star_induct_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.dka.fd_def local.order_prop opti_iterate <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a local.antisym local.dka.fd_def local.dka.fdia_star_induct_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-d_transitive_var"><span class="command">lemma</span></span> d_transitive_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> d_transitive local.dka.fd_def local.dka.fdia_d_simp local.star_slide_var mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-d_transitive_PreLoebian_imp_Loebian"><span class="command">lemma</span></span> d_transitive_PreLoebian_imp_Loebian<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> PreLoebian <span class="free">x</span> <span class="main">⟹</span> Loebian <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> wt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"PreLoebian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> PreLoebian_def local.ads_d_def local.dka.fd_def local.ds.fd_iso1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wt d_transitive_var<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Loebian <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Loebian_def fdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-d_transitive_Noetherian_iff_Loebian"><span class="command">lemma</span></span> d_transitive_Noetherian_iff_Loebian<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">⟹</span> Noetherian <span class="free">x</span> <span class="main">⟷</span> Loebian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Loebian_imp_Noetherian Noetherian_iff_PreLoebian d_transitive_PreLoebian_imp_Loebian <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-Loeb_iff_box_Loeb"><span class="command">lemma</span></span> Loeb_iff_box_Loeb<span class="main">:</span> <span class="quoted"><span class="quoted">"Loebian <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="bound">y</span> <span class="main">)</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Loebian <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Loebian_def omega_fbox <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">d</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="bound">y</span> <span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_antitone' fdia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_fbox_de_morgan_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.ads_d_def local.fbox_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.a_d_closed local.ads_d_def local.apd_d_def local.fbox_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Divergence Kleene Algebras and Separation of Termination›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The notion of divergence has been added to modal Kleene algebras in~\cite{DesharnaisMoellerStruthLMCS}.
More facts about divergence could be added in the future. Some could be adapted from omega algebras.›</span></span>

<span class="keyword1"><span class="command">class</span></span> nabla_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">nabla</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">∇</span></span></span>_"</span> <span class="main">[</span>999<span class="main">]</span> 1000<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> fdivergence_kleene_algebra <span class="main">=</span> antidomain_kleene_algebra <span class="main">+</span> nabla_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nabla_closure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nabla_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nabla_coinduction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_coinduction_var"><span class="command">lemma</span></span> nabla_coinduction_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nabla_coinduction <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_unfold_eq"><span class="command">lemma</span></span> nabla_unfold_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">∇</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.ds.fd_def local.join.sup.order_iff local.nabla_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="main">∇</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ads_d_def local.dpdz.dns5 local.dpdz.dsg4 local.join.sup_commute local.nabla_closure<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ads_d_def local.ds.fd_def local.ds.fd_subdist_2 local.join.sup.order_iff local.join.sup_commute nabla_coinduction_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_subdist"><span class="command">lemma</span></span> nabla_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ds.fd_iso2 local.join.sup.cobounded1 local.nabla_closure nabla_coinduction_var nabla_unfold_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_iso"><span class="command">lemma</span></span> nabla_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_def nabla_subdist<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_omega"><span class="command">lemma</span></span> nabla_omega<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="keyword1">d</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> omega_zero_equiv_1 nabla_coinduction_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_noether"><span class="command">lemma</span></span> nabla_noether<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> Noetherian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.join.le_bot local.noetherian_alt nabla_coinduction_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_preloeb"><span class="command">lemma</span></span> nabla_preloeb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> PreLoebian <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Noetherian_iff_PreLoebian nabla_noether <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-star_nabla_1"><span class="command">lemma</span></span> star_nabla_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dka.fdia_star_induct_var local.eq_iff local.nabla_closure nabla_unfold_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ds.fd_iso2 local.star_ext nabla_unfold_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_sum_expand"><span class="command">lemma</span></span> nabla_sum_expand <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dka.fd_def nabla_unfold_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dka.fd_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-wagner_3"><span class="command">lemma</span></span> wagner_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute nabla_closure nabla_coinduction<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">z</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dka.fdia_star_induct local.nabla_closure<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_least nabla_subdist<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_sum_unfold"><span class="command">lemma</span></span> nabla_sum_unfold <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.dka.fd_def local.ds.fd_def local.ds.fdia_d_simp wagner_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-nabla_separation"><span class="command">lemma</span></span> nabla_separation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> quasi_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quasicomm_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span> <span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ds.fdia_mult local.join.sup_commute nabla_sum_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a local.ds.fd_iso2 local.join.sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_nabla_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute nabla_closure nabla_coinduction<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dpdz.dom_iso eq_refl fdia_def join.sup_ge2 join.sup_mono mult_isol nabla_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nabla_sum_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemma is a separation of termination theorem by Bachmair and Dershowitz~\cite{bachmair86commutation}.›</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-bachmair_dershowitz"><span class="command">lemma</span></span> bachmair_dershowitz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> quasi_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">|</span><span class="bound">x</span><span class="main">⟩</span> <span class="numeral">0</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span><span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟹</span> <span class="main">∇</span><span class="free">x</span> <span class="main">+</span> <span class="main">∇</span><span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quasi_comm nabla_separation <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute local.join.le_bot nabla_subdist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemma is a more complex separation of termination theorem by Doornbos,
Backhouse and van der Woude~\cite{doornbos97calculational}.›</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-separation_of_termination"><span class="command">lemma</span></span> separation_of_termination<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span> <span class="main">⟷</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xy_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">+</span> <span class="main">∇</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x_preloeb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PreLoebian_def no_trivial_inverse nabla_closure nabla_preloeb<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> y_div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute no_trivial_inverse xy_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.da_shunt1 local.dka.fd_def local.join.sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def omega_fdia<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dpdz.dom_iso local.ds.fd_iso1 x_preloeb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.ds.fd_iso2 local.lazycomm_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dka.fd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">⟩</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.add_iso local.dpdz.domain_1'' local.ds.fd_iso1 local.omega_fdia <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⟩</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fdia_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_nabla_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">⟩</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.da_shunt1 local.dka.fd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">y</span><span class="main">⟩</span> <span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> omega_fdia mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Ω</span> <span class="free">x</span> <span class="main">∇</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> noetherian_alt omega_dom nabla_noether y_div<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dka.fd_def local.join.le_bot x_preloeb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∇</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∇</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.le_bot local.join.sup.order_iff local.join.sup_commute nabla_subdist<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final examples can be found in~\cite{guttmannstruthweber11algmeth}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">↝</span> _ <span class="keyword1">↝</span> _"</span> <span class="main">[</span>61<span class="main">,</span>61<span class="main">,</span>61<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">↝</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">↝</span></span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="keyword1">ad</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="keyword1">d</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-T_d"><span class="command">lemma</span></span> T_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> T_def local.a_d_add_closure local.fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-T_p"><span class="command">lemma</span></span> T_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_d local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> T_def add_commute local.a_mult_add local.ads_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-T_a"><span class="command">lemma</span></span> T_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_d T_def local.a_d_closed local.ads_d_def local.apd_d_def local.dpdz.dns5 local.join.sup.left_idem<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-T_seq"><span class="command">lemma</span></span> T_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">y</span><span class="main">↝</span><span class="free">s</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="main">↝</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">↝</span><span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="free">q</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.fbox_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">y</span><span class="main">↝</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_subid_aux2 local.add_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">y</span><span class="main">↝</span><span class="free">s</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">y</span><span class="main">↝</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_d T_def f1 local.distrib_right' local.fbox_add1 local.fbox_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_def T_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">y</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> local.dka.dom_subid_aux2 local.dka.dsg3 local.eq_iff local.fbox_iso local.join.sup.mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def fbox_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-T_square"><span class="command">lemma</span></span> T_square<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_seq<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-T_segerberg"><span class="command">lemma</span></span> T_segerberg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> T_def add_commute local.fbox_segerberg local.fbox_simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-lookahead"><span class="command">lemma</span></span> lookahead <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> local.dka.dsg3 local.fbox_add1 local.fbox_mult local.fbox_simp local.fbox_star_unfold_var local.star_slide_var local.star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Modal_Kleene_Algebra_Applications-alternation"><span class="command">lemma</span></span> alternation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fbox_simp_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">p</span><span class="main">.</span> <span class="main">|</span><span class="bound">x</span><span class="main">]</span><span class="bound">p</span> <span class="main">=</span> <span class="keyword1">d</span><span class="main">(</span> <span class="main">|</span><span class="bound">x</span><span class="main">]</span> <span class="bound">p</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_d_closed local.ads_d_def local.apd_d_def local.fbox_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dka.domain_1'' local.fbox_iso local.order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_seq local.dka.dom_iso local.fbox_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">1</span><span class="main">+</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> fbox_mult meyer_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fbox_simp_2 fbox_mult fbox_add2 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fbox_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_d fbox_simp_2 local.dka.dom_mult_closed local.fbox_add1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> T_d fbox_simp_2 local.dka.dsg3<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> fbox_simp_2 local.fbox_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute local.fbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> T_d fbox_simp_2 local.fbox_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 fbox_simp_2 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.ans4 local.fbox_add1 local.fbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> T_d fbox_simp_2 local.dka.dsg3 local.fbox_add1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_simp_2 local.dka.dns5 local.dka.dsg4 local.join.sup.absorb2 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_segerberg local.a_d_closed local.ads_d_def local.apd_d_def local.distrib_left local.fbox_def mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_p<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_d T_p fbox_simp_2 fbox_add1 fbox_simp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.fbox_def local.fbox_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def local.a_de_morgan_var_4 local.fbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="keyword1">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.a_de_morgan_var_4 local.fbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ad</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">q</span> <span class="main">+</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.am2 local.fbox_def mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def local.am2 local.fbox_def mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.a_d_closed local.ads_d_def local.apd_d_def local.distrib_left local.fbox_def mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_d fbox_simp_2 local.dka.dom_mult_closed local.fbox_add1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="main">|</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_d local.fbox_add1 local.fbox_simp lookahead<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fbox_mult star_slide<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="keyword1">ad</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="keyword1">ad</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ad</span> <span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alternation local.a_d_closed local.ads_d_def local.apd_d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">|</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">]</span><span class="main">(</span><span class="free">p</span><span class="main">↝</span><span class="free">x</span><span class="main">↝</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alternation<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>