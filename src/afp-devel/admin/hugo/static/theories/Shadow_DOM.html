<div id="ShadowRootClass">
<div class="head">
<h1>Theory ShadowRootClass</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ********************************************************************************\***)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Shadow DOM Data Model›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ShadowRootClass
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Core_DOM/ShadowRootPointer.html">Core_DOM.ShadowRootPointer</a>
    <a href="../Core_DOM/DocumentClass.html">Core_DOM.DocumentClass</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ShadowRoot›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> shadow_root_mode <span class="main">=</span> Open <span class="main">|</span> Closed
<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">)</span> RShadowRoot <span class="main">=</span> <span class="quoted">RObject</span> <span class="main">+</span>
  nothing <span class="main">::</span> <span class="quoted">unit</span>
  mode <span class="main">::</span> <span class="quoted">shadow_root_mode</span>
  child_nodes <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">)</span> node_ptr list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'ShadowRoot</span><span class="main">)</span> ShadowRoot
  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'ShadowRoot</span> option<span class="main">)</span> RShadowRoot_scheme"</span></span>
<span class="keyword1"><span class="command">register_default_tvars</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'node_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'element_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'character_data_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'ShadowRoot</span></span><span class="main"><span class="main">)</span></span> ShadowRoot"</span></span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'shadow_root_ptr</span><span class="main">,</span> <span class="tfree">'Object</span><span class="main">,</span> <span class="tfree">'Node</span><span class="main">,</span>
    <span class="tfree">'Element</span><span class="main">,</span> <span class="tfree">'CharacterData</span><span class="main">,</span> <span class="tfree">'Document</span><span class="main">,</span>
    <span class="tfree">'ShadowRoot</span><span class="main">)</span> Object
  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'shadow_root_ptr</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span>
<span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'ShadowRoot</span> option<span class="main">)</span>
      RShadowRoot_ext <span class="main">+</span> <span class="tfree">'Object</span><span class="main">,</span> <span class="tfree">'Node</span><span class="main">,</span> <span class="tfree">'Element</span><span class="main">,</span> <span class="tfree">'CharacterData</span><span class="main">,</span> <span class="tfree">'Document</span><span class="main">)</span> Object"</span></span>
<span class="keyword1"><span class="command">register_default_tvars</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'node_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'element_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'character_data_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'shadow_root_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Object</span></span><span class="main"><span class="main">,</span></span>
<span class="tfree"><span class="tfree">'Node</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Element</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'CharacterData</span></span><span class="main"><span class="main">,</span></span>
    <span class="tfree"><span class="tfree">'Document</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'ShadowRoot</span></span><span class="main"><span class="main">)</span></span> Object"</span></span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'object_ptr</span><span class="main">,</span> <span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'document_ptr</span><span class="main">,</span>
    <span class="tfree">'shadow_root_ptr</span><span class="main">,</span> <span class="tfree">'Object</span><span class="main">,</span> <span class="tfree">'Node</span><span class="main">,</span>
    <span class="tfree">'Element</span><span class="main">,</span> <span class="tfree">'CharacterData</span><span class="main">,</span> <span class="tfree">'Document</span><span class="main">,</span> <span class="tfree">'ShadowRoot</span><span class="main">)</span> heap
  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'object_ptr</span><span class="main">,</span> <span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'document_ptr</span><span class="main">,</span> <span class="tfree">'shadow_root_ptr</span><span class="main">,</span>
<span class="main">(</span><span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span>
      <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'ShadowRoot</span> option<span class="main">)</span> RShadowRoot_ext <span class="main">+</span> <span class="tfree">'Object</span><span class="main">,</span> <span class="tfree">'Node</span><span class="main">,</span> <span class="tfree">'Element</span><span class="main">,</span>
<span class="tfree">'CharacterData</span><span class="main">,</span> <span class="tfree">'Document</span><span class="main">)</span> heap"</span></span>
<span class="keyword1"><span class="command">register_default_tvars</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'object_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'node_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'element_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'character_data_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'document_ptr</span></span><span class="main"><span class="main">,</span></span>
<span class="tfree"><span class="tfree">'shadow_root_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Object</span></span><span class="main"><span class="main">,</span></span>
    <span class="tfree"><span class="tfree">'Node</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Element</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'CharacterData</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Document</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'ShadowRoot</span></span><span class="main"><span class="main">)</span></span> heap"</span></span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub>"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> heap"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shadow_root_ptr_kinds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr fset"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr_kinds</span> <span class="free"><span class="bound"><span class="entity">heap</span></span></span> <span class="main">=</span>
the <span class="main">|`|</span> <span class="main">(</span>cast <span class="main">|`|</span> <span class="main">(</span>ffilter is_shadow_root_ptr_kind <span class="main">(</span>object_ptr_kinds <span class="free"><span class="bound"><span class="entity">heap</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="main">(</span>Heap <span class="main">(</span>fmupd <span class="main">(</span>cast <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="free">shadow_root</span> <span class="main">(</span>the_heap <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
<span class="main">{|</span><span class="free">shadow_root_ptr</span><span class="main">|}</span> <span class="main">|∪|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shadow_root_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr fset"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptrs</span> <span class="free"><span class="bound"><span class="entity">heap</span></span></span> <span class="main">=</span> ffilter is_shadow_root_ptr <span class="main">(</span>shadow_root_ptr_kinds <span class="free"><span class="bound"><span class="entity">heap</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> Object <span class="main">⇒</span> <span class="main">(_)</span> ShadowRoot option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">obj</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> RObject.more <span class="free"><span class="bound"><span class="entity">obj</span></span></span> <span class="keyword1">of</span>
      Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="bound">shadow_root</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>RObject.extend <span class="main">(</span>RObject.truncate <span class="free"><span class="bound"><span class="entity">obj</span></span></span><span class="main">)</span> <span class="bound">shadow_root</span><span class="main">)</span>
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">adhoc_overloading</span></span> cast <span class="quoted">cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> ShadowRoot <span class="main">⇒</span> <span class="main">(_)</span> Object"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root</span></span></span> <span class="main">=</span>
<span class="main">(</span>RObject.extend <span class="main">(</span>RObject.truncate <span class="free"><span class="bound"><span class="entity">shadow_root</span></span></span><span class="main">)</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="main">(</span>RObject.more <span class="free"><span class="bound"><span class="entity">shadow_root</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">adhoc_overloading</span></span> cast <span class="quoted">cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_shadow_root_kind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> Object <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">is_shadow_root_kind</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">⟷</span> cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">≠</span> None"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_heap_upd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="main">(</span>Heap <span class="main">(</span>fmupd <span class="main">(</span>cast <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="free">shadow_root</span> <span class="main">(</span>the_heap <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
<span class="main">{|</span><span class="free">shadow_root_ptr</span><span class="main">|}</span> <span class="main">|∪|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_commutes <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">⟷</span> <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_def shadow_root_ptr_kinds_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> shadow_root_ptr_casts_commute2 shadow_root_ptr_shadow_root_ptr_cast
      ffmember_filter fimage_eqI
      fset.map_comp option.sel<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> ShadowRoot option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> Option.bind <span class="main">(</span>get <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> cast"</span></span>
<span class="keyword1"><span class="command">adhoc_overloading</span></span> get <span class="quoted">get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span>

<span class="keyword1"><span class="command">locale</span></span> l_type_wf_def<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_type_wf</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="main">(</span>DocumentClass.type_wf <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">.</span>
get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">shadow_root_ptr</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">≠</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">global_interpretation</span></span> l_type_wf_def<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="keyword2"><span class="keyword">defines</span></span> type_wf <span class="main">=</span> <span class="quoted">a_type_wf</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> type_wf_defs <span class="main">=</span> a_type_wf_def

<span class="keyword1"><span class="command">locale</span></span> l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">=</span> l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span>"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> ShadowRootClass.type_wf <span class="free">h</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">⊆</span> l_type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ShadowRootClass.type_wf_def a_type_wf_def l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_axioms
      l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_implies_previous<span class="main">:</span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">⟹</span> DocumentClass.type_wf <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> l_get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="main">=</span> l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> l_get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">lemma</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">⟷</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_axioms assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_none_bind is_none_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_none_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf notin_fset
      shadow_root_ptr_kinds_commutes<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="quoted">type_wf</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_)</span> ShadowRoot <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">shadow_root</span></span></span> <span class="main">=</span> put <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">)</span> <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">shadow_root</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">adhoc_overloading</span></span> put <span class="quoted">put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span>

<span class="keyword1"><span class="command">lemma</span></span> put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root</span> <span class="free">h</span> <span class="main">=</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> shadow_root_ptr_kinds_commutes put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_put_ptrs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root</span> <span class="free">h</span> <span class="main">=</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="free">shadow_root_ptr</span><span class="main">|}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_put_ptrs<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_inject <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">x</span> <span class="main">=</span> cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def RObject.extend_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> RObject.surjective old.unit.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_none <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">obj</span> <span class="main">=</span> None <span class="main">⟷</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">shadow_root</span><span class="main">.</span> cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">shadow_root</span> <span class="main">=</span> <span class="free">obj</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def RObject.extend_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> RObject.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> RObject.surjective old.unit.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_some <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">obj</span> <span class="main">=</span> Some <span class="free">shadow_root</span> <span class="main">⟷</span> cast <span class="free">shadow_root</span> <span class="main">=</span> <span class="free">obj</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def RObject.extend_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">shadow_root</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cast_shadow_root_not_node <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">node</span>"</span></span>
  <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">node</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cast<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def cast<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def RObject.extend_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">shadow_root</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">shadow_root_ptr'</span>
   <span class="main">⟹</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">shadow_root</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span>
get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_simp8 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_element_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_character_data_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_document_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">create_shadow_root_obj</span> <span class="free"><span class="bound"><span class="entity">mode_arg</span></span></span> <span class="free"><span class="bound"><span class="entity">child_nodes_arg</span></span></span>
  <span class="main">≡</span> <span class="main">⦇</span> RObject.nothing <span class="main">=</span> <span class="main">()</span><span class="main">,</span> RShadowRoot.nothing <span class="main">=</span> <span class="main">()</span><span class="main">,</span> mode <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mode_arg</span></span></span><span class="main">,</span>
RShadowRoot.child_nodes <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">child_nodes_arg</span></span></span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> None <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span>heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> shadow_root_ptr <span class="main">×</span> <span class="main">(_)</span> heap<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">new_shadow_root_ptr</span> <span class="main">=</span>
shadow_root_ptr.Ref <span class="main">(</span>Suc <span class="main">(</span>fMax <span class="main">(</span>shadow_root_ptr.the_ref <span class="main">|`|</span> <span class="main">(</span>shadow_root_ptrs <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
      <span class="main">(</span><span class="bound">new_shadow_root_ptr</span><span class="main">,</span> put <span class="bound">new_shadow_root_ptr</span> <span class="main">(</span>create_shadow_root_obj Open <span class="main">[]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">new_shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def
  <span class="keyword1"><span class="command">using</span></span> put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_ptr_new<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shadow_root_ptr.Ref <span class="main">(</span>Suc <span class="main">(</span>fMax <span class="main">(</span>finsert <span class="main">0</span> <span class="main">(</span>shadow_root_ptr.the_ref <span class="main">|`|</span> shadow_root_ptrs <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|∉|</span>
shadow_root_ptrs <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_n_not_le_n shadow_root_ptr.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fMax_ge fimage_finsert finsertI1 finsertI2 set_finsert<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_not_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">new_shadow_root_ptr</span> <span class="main">|∉|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject shadow_root_ptrs_def fMax_finsert fempty_iff ffmember_filter
      fimage_is_fempty is_shadow_root_ptr_ref max_0L new_shadow_root_ptr_new<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_new_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="free">new_shadow_root_ptr</span><span class="main">|}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_put_ptrs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_is_shadow_root_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> cast <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">new_shadow_root_ptr</span><span class="main">,</span> <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def<span class="main">)</span>


<span class="keyword1"><span class="command">locale</span></span> l_known_ptr<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_known_ptr</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> <span class="main">(</span>known_ptr <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">∨</span> is_shadow_root_ptr <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> known_ptr_not_shadow_root_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"a_known_ptr <span class="free">ptr</span> <span class="main">⟹</span> <span class="main">¬</span>is_shadow_root_ptr <span class="free">ptr</span> <span class="main">⟹</span> known_ptr <span class="free">ptr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_known_ptr_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> known_ptr_new_shadow_root_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"a_known_ptr <span class="free">ptr</span> <span class="main">⟹</span> <span class="main">¬</span>known_ptr <span class="free">ptr</span> <span class="main">⟹</span> is_shadow_root_ptr <span class="free">ptr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_known_ptr<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>.known_ptr_not_shadow_root_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">global_interpretation</span></span> l_known_ptr<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="keyword2"><span class="keyword">defines</span></span> known_ptr <span class="main">=</span> <span class="quoted">a_known_ptr</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> known_ptr_defs <span class="main">=</span> a_known_ptr_def

<span class="keyword1"><span class="command">locale</span></span> l_known_ptrs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">=</span> l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_known_ptrs</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ptr</span> <span class="main">∈</span> fset <span class="main">(</span>object_ptr_kinds <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free">known_ptr</span> <span class="bound">ptr</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> known_ptrs_known_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"a_known_ptrs <span class="free">h</span> <span class="main">⟹</span> <span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_known_ptrs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> notin_fset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> known_ptrs_preserved<span class="main">:</span>
  <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span> <span class="main">⟹</span> a_known_ptrs <span class="free">h</span> <span class="main">=</span> a_known_ptrs <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_known_ptrs_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> known_ptrs_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">|⊆|</span> object_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> a_known_ptrs <span class="free">h</span> <span class="main">⟹</span> a_known_ptrs <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_fset.rep_eq local.a_known_ptrs_def subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> known_ptrs_new_ptr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="free">new_ptr</span><span class="main">|}</span> <span class="main">⟹</span> <span class="free">known_ptr</span> <span class="free">new_ptr</span> <span class="main">⟹</span>
a_known_ptrs <span class="free">h</span> <span class="main">⟹</span> a_known_ptrs <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_known_ptrs_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">global_interpretation</span></span> l_known_ptrs<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="quoted">known_ptr</span> <span class="keyword2"><span class="keyword">defines</span></span> known_ptrs <span class="main">=</span> <span class="quoted">a_known_ptrs</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> known_ptrs_defs <span class="main">=</span> a_known_ptrs_def

<span class="keyword1"><span class="command">lemma</span></span> known_ptrs_is_l_known_ptrs  <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_known_ptrs known_ptr known_ptrs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> known_ptrs_known_ptr known_ptrs_preserved l_known_ptrs_def known_ptrs_subset
    known_ptrs_new_ptr
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">shadow_root</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_different_get_put <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">shadow_root_ptr'</span> <span class="main">⟹</span>
get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">shadow_root</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">character_data_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">character_data_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> known_ptrs_implies<span class="main">:</span> <span class="quoted"><span class="quoted">"DocumentClass.known_ptrs <span class="free">h</span> <span class="main">⟹</span> ShadowRootClass.known_ptrs <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentClass.known_ptrs_defs DocumentClass.known_ptr_defs
      ShadowRootClass.known_ptrs_defs ShadowRootClass.known_ptr_defs<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">=</span> delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_removed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∉|</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_removed delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def shadow_root_ptr_kinds_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_ptr_in_heap delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_ptr_in_heap
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">h</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_ok delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h'</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_different_delete_get <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">shadow_root_ptr'</span> <span class="main">⟹</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span>
get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span> <span class="free">object_ptr</span> <span class="main">≠</span> cast <span class="free">shadow_root_ptr</span> <span class="main">⟹</span>
get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span> get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">node_ptr</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">node_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span>
get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_delete_get_7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">h</span> <span class="main">=</span> Some <span class="free">h'</span> <span class="main">⟹</span> <span class="free">shadow_root_ptr'</span> <span class="main">≠</span> <span class="free">shadow_root_ptr</span> <span class="main">⟹</span>
get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">h'</span> <span class="main">=</span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ShadowRootMonad">
<div class="head">
<h1>Theory ShadowRootMonad</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Shadow Root Monad›</span></span>
<span class="keyword1"><span class="command">theory</span></span> ShadowRootMonad
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../Core_DOM/DocumentMonad.html">Core_DOM.DocumentMonad</a>"</span>
    <span class="quoted">"<a href="ShadowRootClass.html">../classes/ShadowRootClass</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'object_ptr</span><span class="main">,</span> <span class="tfree">'node_ptr</span><span class="main">,</span> <span class="tfree">'element_ptr</span><span class="main">,</span> <span class="tfree">'character_data_ptr</span><span class="main">,</span> <span class="tfree">'document_ptr</span><span class="main">,</span>
    <span class="tfree">'shadow_root_ptr</span><span class="main">,</span> <span class="tfree">'Object</span><span class="main">,</span> <span class="tfree">'Node</span><span class="main">,</span> <span class="tfree">'Element</span><span class="main">,</span> <span class="tfree">'CharacterData</span><span class="main">,</span> <span class="tfree">'Document</span><span class="main">,</span> <span class="tfree">'ShadowRoot</span><span class="main">,</span> <span class="tfree">'result</span><span class="main">)</span> dom_prog
  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="tfree">'result</span><span class="main">)</span> prog"</span></span>
<span class="keyword1"><span class="command">register_default_tvars</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'object_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'node_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'element_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'character_data_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'document_ptr</span></span><span class="main"><span class="main">,</span></span>
<span class="tfree"><span class="tfree">'shadow_root_ptr</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Object</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Node</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Element</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'CharacterData</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'Document</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'ShadowRoot</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'result</span></span><span class="main"><span class="main">)</span></span> dom_prog"</span></span></span>



<span class="keyword1"><span class="command">global_interpretation</span></span> l_ptr_kinds_M <span class="quoted">shadow_root_ptr_kinds</span> <span class="keyword2"><span class="keyword">defines</span></span> shadow_root_ptr_kinds_M <span class="main">=</span> <span class="quoted">a_ptr_kinds_M</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> shadow_root_ptr_kinds_M_defs <span class="main">=</span> a_ptr_kinds_M_def

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_M_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> shadow_root_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> shadow_root_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_M_defs object_ptr_kinds_M_defs shadow_root_ptr_kinds_def<span class="main">)</span>



<span class="keyword1"><span class="command">global_interpretation</span></span> l_dummy <span class="keyword2"><span class="keyword">defines</span></span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_M.a_get_M get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_is_l_get_M<span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_M get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> type_wf shadow_root_ptr_kinds"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf l_get_M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectClass.get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf ObjectClass.type_wf_defs bind_eq_None_conv
      shadow_root_ptr_kinds_commutes get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_M_defs <span class="main">=</span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">[</span><span class="operator">unfolded</span> l_get_M.a_get_M_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_M_is_l_get_M<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span> get_M <span class="quoted">get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="main">=</span> l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> l_get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_lemmas <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">interpretation</span></span> l_get_M <span class="quoted">get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted">shadow_root_ptr_kinds</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf local.type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ShadowRootMonad.get_M_is_l_get_M l_get_M_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok <span class="main">=</span> get_M_ok<span class="main">[</span><span class="operator">folded</span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap <span class="main">=</span> get_M_ptr_in_heap<span class="main">[</span><span class="operator">folded</span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="quoted">type_wf</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


<span class="keyword1"><span class="command">global_interpretation</span></span> l_put_M <span class="quoted">type_wf</span> <span class="quoted">shadow_root_ptr_kinds</span> <span class="quoted">get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="quoted">put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword2"><span class="keyword">rewrites</span></span>
  <span class="quoted"><span class="quoted">"a_get_M <span class="main">=</span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>"</span></span> <span class="keyword2"><span class="keyword">defines</span></span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">=</span> <span class="quoted">a_put_M</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_M_is_l_get_M l_put_M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> put_M_defs <span class="main">=</span> a_put_M_def
<span class="keyword1"><span class="command">adhoc_overloading</span></span> put_M <span class="quoted">put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span>


<span class="keyword1"><span class="command">locale</span></span> l_put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="main">=</span> l_type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> l_put_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_lemmas <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">interpretation</span></span> l_put_M <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted">shadow_root_ptr_kinds</span> <span class="quoted">get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="quoted">put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf local.type_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ShadowRootMonad.get_M_is_l_get_M l_get_M_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok <span class="main">=</span> put_M_ok<span class="main">[</span><span class="operator">folded</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def<span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas <span class="quoted">type_wf</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">getter</span> <span class="main">(</span><span class="free">setter</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">shadow_root_ptr'</span>
    <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
   <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">getter</span> <span class="main">(</span><span class="free">setter</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">getter</span> <span class="bound">x</span><span class="main">)</span>
   <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">=</span> <span class="free">shadow_root_ptr'</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">node_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs NodeMonad.get_M_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">object_ptr</span>
   <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
   <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def ObjectMonad.get_M_defs
      preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved4  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
   <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">getter</span> <span class="main">(</span>cast <span class="main">(</span><span class="free">setter</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">getter</span> <span class="main">(</span>cast <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
   <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">object_ptr</span>"</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      ObjectMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits bind_splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">object_ptr</span>
  <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
  <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ObjectMonad.put_M_defs get_M_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def ObjectMonad.get_M_defs
      preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs ElementMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.put_M_defs get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved8 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs CharacterDataMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved9 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CharacterDataMonad.put_M_defs get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> get_M_Mshadow_root_preserved10 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">getter</span> <span class="main">(</span>cast <span class="main">(</span><span class="free">setter</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">getter</span> <span class="main">(</span>cast <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root_ptr</span> <span class="main">=</span> <span class="free">object_ptr</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs ObjectMonad.get_M_defs NodeMonad.get_M_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def preserved_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def bind_eq_Some_conv
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_element_def get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_character_data_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_character_data_def get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_document_def get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">h</span> <span class="main">←</span> get_heap<span class="main">;</span>
    <span class="main">(</span><span class="keyword1">case</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="bound">h</span> <span class="keyword1">of</span>
      Some <span class="bound">h</span> <span class="main">⇒</span> return_heap <span class="bound">h</span> <span class="main">|</span>
      None <span class="main">⇒</span> error HierarchyRequestError<span class="main">)</span>
  <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">adhoc_overloading</span></span> delete_M <span class="quoted">delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M</span>

<span class="keyword1"><span class="command">lemma</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ok <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span>delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_not_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∉|</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply fmdom_notI fmdrop_lookup heap.sel object_ptr_kinds_def shadow_root_ptr_kinds_commutes<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_pointers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="free">shadow_root_ptr</span><span class="main">|}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ObjectClass.a_type_wf_def ObjectClass.get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def
      delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_ptr_in_heap fmlookup_drop get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def heap.sel option.sel
      shadow_root_ptr_kinds_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ObjectClass.a_type_wf_def ObjectClass.get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def
      delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_pointer_ptr_in_heap fmlookup_drop get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def heap.sel option.sel
      shadow_root_ptr_kinds_commutes<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
<span class="free">ptr</span> <span class="main">≠</span> cast <span class="free">shadow_root_ptr</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def ObjectMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def NodeMonad.get_M_defs ObjectMonad.get_M_defs
      preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def ElementMonad.get_M_defs NodeMonad.get_M_defs
      ObjectMonad.get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def CharacterDataMonad.get_M_defs
      NodeMonad.get_M_defs ObjectMonad.get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def DocumentMonad.get_M_defs ObjectMonad.get_M_defs
      preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
<span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">shadow_root_ptr'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def get_M_defs ObjectMonad.get_M_defs
      preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">≠</span> <span class="free">shadow_root_ptr'</span> <span class="main">⟹</span>
<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">getter</span> <span class="main">(</span><span class="free">setter</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">getter</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr'</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">=</span> <span class="free">shadow_root_ptr'</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs ElementMonad.get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">element_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.put_M_defs get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs CharacterDataMonad.get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">character_data_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CharacterDataMonad.put_M_defs get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs DocumentMonad.get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_8 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">document_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentMonad.put_M_defs get_M_defs preserved_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> get_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> shadow_root_put_get_9 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">getter</span> <span class="main">(</span>cast <span class="main">(</span><span class="free">setter</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">getter</span> <span class="main">(</span>cast <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">h</span> <span class="main">⊢</span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="free">setter</span> <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">object_ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root_ptr</span> <span class="main">=</span> <span class="free">object_ptr</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_M_defs get_M_defs
      ObjectMonad.get_M_defs NodeMonad.get_M_defs get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def preserved_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      put<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub>_def bind_eq_Some_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹new\_M›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">h</span> <span class="main">←</span> get_heap<span class="main">;</span>
      <span class="main">(</span><span class="bound">new_ptr</span><span class="main">,</span> <span class="bound">h'</span><span class="main">)</span> <span class="main">←</span> return <span class="main">(</span>new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">h</span><span class="main">)</span><span class="main">;</span>
      return_heap <span class="bound">h'</span><span class="main">;</span>
      return <span class="bound">new_ptr</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ok <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">new_shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap is_OK_returns_result_I
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_not_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">new_shadow_root_ptr</span> <span class="main">|∉|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_not_in_heap
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_new_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="free">new_shadow_root_ptr</span><span class="main">|}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_new_ptr
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_is_shadow_root_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_is_shadow_root_ptr
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_mode<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> get_M <span class="free">new_shadow_root_ptr</span> mode <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Open"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_M_defs new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits prod.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_children<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> get_M <span class="free">new_shadow_root_ptr</span> child_nodes <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_M_defs new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits prod.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
    <span class="main">⟹</span> <span class="free">ptr</span> <span class="main">≠</span> cast <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def ObjectMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
    <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def NodeMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
     <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def ElementMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
    <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def CharacterDataMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
     <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def DocumentMonad.get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">ptr</span> <span class="main">≠</span> <span class="free">new_shadow_root_ptr</span>
     <span class="main">⟹</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">getter</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def get_M_defs preserved_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹modified heaps›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_get_put_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">shadow_root_ptr</span> <span class="main">(</span>put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">obj</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">ptr</span> <span class="main">=</span> cast <span class="free">shadow_root_ptr</span>
<span class="keyword1">then</span> cast <span class="free">obj</span> <span class="keyword1">else</span> get <span class="free">shadow_root_ptr</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits Option.bind_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_new<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="main">(</span>put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">obj</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span>
<span class="main">(</span><span class="keyword1">if</span> is_shadow_root_ptr_kind <span class="free">ptr</span> <span class="keyword1">then</span> <span class="main">{|</span>the <span class="main">(</span>cast <span class="free">ptr</span><span class="main">)</span><span class="main">|}</span> <span class="keyword1">else</span> <span class="main">{||}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_put_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"DocumentClass.type_wf <span class="main">(</span>put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">obj</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr_kind <span class="free">ptr</span> <span class="main">⟹</span> is_shadow_root_kind <span class="free">obj</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="main">(</span>put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">obj</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs is_shadow_root_kind_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_put_ptr_not_in_heap_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="main">(</span>put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">obj</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> DocumentMonad.type_wf_put_ptr_not_in_heap_E
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_put_ptr_in_heap_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="main">(</span>put<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="free">ptr</span> <span class="free">obj</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"DocumentClass.type_wf <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr_kind <span class="free">ptr</span> <span class="main">⟹</span> is_shadow_root_kind <span class="main">(</span>the <span class="main">(</span>get <span class="free">ptr</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> DocumentMonad.type_wf_put_ptr_in_heap_E
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> ObjectClass.a_type_wf_def ObjectClass.get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf
      bind.bind_lunit finite_set_in get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def is_shadow_root_kind_def option.exhaust_sel<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹type\_wf›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_element_ptr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_element_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_OK_returns_heap_I is_OK_returns_result_E<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_element_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_new_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.new_element_def type_wf_defs Let_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_tag_name_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">element_ptr</span> tag_name_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_child_nodes_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">element_ptr</span> RElement.child_nodes_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_attrs_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">element_ptr</span> attrs_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_shadow_root_opt_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">element_ptr</span> shadow_root_opt_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ElementMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_character_data_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_character_data_ptr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_character_data_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_OK_returns_heap_I is_OK_returns_result_E<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_character_data_new_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CharacterDataMonad.new_character_data_def type_wf_defs Let_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>_val_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">character_data_ptr</span> val_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CharacterDataMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_document_ptr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_document_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_OK_returns_heap_I is_OK_returns_result_E<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_document_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_document_new_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentMonad.new_document_def type_wf_defs Let_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_doctype_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">document_ptr</span> doctype_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_document_element_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">document_ptr</span> document_element_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_disconnected_nodes_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">document_ptr</span> disconnected_nodes_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_singleton assms object_ptr_kinds_preserved <span class="keyword1"><span class="command">unfolding</span></span> all_args_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shadow_root_ptr_kinds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentMonad.put_M_defs type_wf_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_mode_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">shadow_root_ptr</span> mode_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_M_defs is_shadow_root_kind_def type_wf_defs ElementClass.type_wf_defs
      NodeClass.type_wf_defs ElementMonad.get_M_defs ObjectClass.type_wf_defs
      CharacterDataClass.type_wf_defs DocumentClass.type_wf_defs put_M_defs
      put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> get_heap_E
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E2
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> type_wf_put_I DocumentMonad.type_wf_put_I CharacterDataMonad.type_wf_put_I
      ElementMonad.type_wf_put_I NodeMonad.type_wf_put_I ObjectMonad.type_wf_put_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_child_nodes_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> put_M <span class="free">shadow_root_ptr</span> RShadowRoot.child_nodes_update <span class="free">v</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_M_defs is_shadow_root_kind_def type_wf_defs ElementClass.type_wf_defs
      NodeClass.type_wf_defs ElementMonad.get_M_defs ObjectClass.type_wf_defs
      CharacterDataClass.type_wf_defs DocumentClass.type_wf_defs put_M_defs
      put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> get_heap_E
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E2
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> type_wf_put_I DocumentMonad.type_wf_put_I CharacterDataMonad.type_wf_put_I
      ElementMonad.type_wf_put_I NodeMonad.type_wf_put_I ObjectMonad.type_wf_put_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_small<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">object_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">object_ptr</span> RObject.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def preserved_def object_ptr_kinds_preserved_small<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_ptr_kinds_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"writes <span class="free">SW</span> <span class="free">setter</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">setter</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span><span class="main">.</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">object_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">object_ptr</span> RObject.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def preserved_def shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms object_ptr_kinds_preserved<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_known_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"known_ptr <span class="main">(</span>cast <span class="free">new_shadow_root_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def a_known_ptr_def
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_is_shadow_root_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def put<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def put<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_def
      ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub>  ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>
      is_node_ptr_kind_none new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_not_in_heap
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E type_wf_put_ptr_not_in_heap_E
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> type_wf_put_I DocumentMonad.type_wf_put_I ElementMonad.type_wf_put_I
      CharacterDataMonad.type_wf_put_I
      NodeMonad.type_wf_put_I ObjectMonad.type_wf_put_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs DocumentClass.type_wf_defs ElementClass.type_wf_defs
      CharacterDataClass.type_wf_defs
      NodeClass.type_wf_defs ObjectClass.type_wf_defs is_shadow_root_kind_def is_document_kind_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root <span class="main">=</span> l_type_wf <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_shadow_root_types_preserved<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_is_l_new_shadow_root  <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_new_shadow_root type_wf"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_new_shadow_root.intro new_shadow_root_type_wf_preserved
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_preserved_small<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">object_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">object_ptr</span> RObject.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">node_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="bound">node_ptr</span> RNode.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">element_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">element_ptr</span> RElement.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">character_data_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="bound">character_data_ptr</span> RCharacterData.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">document_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">document_ptr</span> RDocument.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">shadow_root_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">shadow_root_ptr</span> RShadowRoot.nothing<span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> type_wf_preserved_small<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    allI<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">id</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> shadow_root_ptr_kinds_small<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs preserved_def get_M_defs shadow_root_ptr_kinds_small<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_is_l_new_element <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_element type_wf"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_new_element.intro new_element_type_wf_preserved
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> new_character_data_is_l_new_character_data <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_character_data type_wf"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_new_character_data.intro new_character_data_type_wf_preserved
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_is_l_new_document <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_document type_wf"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_new_document.intro new_document_type_wf_preserved
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"writes <span class="free">SW</span> <span class="free">setter</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">setter</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
<span class="main">∀</span><span class="bound">object_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">object_ptr</span> RObject.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
<span class="main">∀</span><span class="bound">node_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>N</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub> <span class="bound">node_ptr</span> RNode.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
<span class="main">∀</span><span class="bound">element_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">element_ptr</span> RElement.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
<span class="main">∀</span><span class="bound">character_data_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub> <span class="bound">character_data_ptr</span> RCharacterData.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
<span class="main">∀</span><span class="bound">document_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">document_ptr</span> RDocument.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
<span class="main">∀</span><span class="bound">shadow_root_ptr</span><span class="main">.</span> preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">shadow_root_ptr</span> RShadowRoot.nothing<span class="main">)</span> <span class="bound">h</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">=</span> type_wf <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">SW</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span> type_wf <span class="bound">h</span> <span class="main">=</span> type_wf <span class="bound">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms type_wf_preserved_small <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> type_wf_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span> <span class="main">⟹</span> type_wf <span class="main">(</span>Heap <span class="main">(</span>fmdrop <span class="free">ptr</span> <span class="main">(</span>the_heap <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_defs<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> type_wf_drop
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DocumentClass.type_wf<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> ElementClass.get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_type_wf
      ElementMonad.type_wf_drop fmember.rep_eq fmlookup_drop get<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def get<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def
      object_ptr_kinds_code5 shadow_root_ptr_kinds_commutes<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delete_shadow_root_type_wf_preserved <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"type_wf <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> type_wf_drop
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def delete<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM">
<div class="head">
<h1>Theory Shadow_DOM</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Shadow DOM›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="ShadowRootMonad.html">monads/ShadowRootMonad</a>"</span>
    <a href="../Core_DOM/Core_DOM.html">Core_DOM.Core_DOM</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">safe_shadow_root_element_types</span> <span class="main">≡</span> <span class="main">{</span><span class="inner_quoted">''article''</span><span class="main">,</span> <span class="inner_quoted">''aside''</span><span class="main">,</span> <span class="inner_quoted">''blockquote''</span><span class="main">,</span> <span class="inner_quoted">''body''</span><span class="main">,</span>
  <span class="inner_quoted">''div''</span><span class="main">,</span> <span class="inner_quoted">''footer''</span><span class="main">,</span> <span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">,</span> <span class="inner_quoted">''h3''</span><span class="main">,</span> <span class="inner_quoted">''h4''</span><span class="main">,</span> <span class="inner_quoted">''h5''</span><span class="main">,</span> <span class="inner_quoted">''h6''</span><span class="main">,</span> <span class="inner_quoted">''header''</span><span class="main">,</span> <span class="inner_quoted">''main''</span><span class="main">,</span>
  <span class="inner_quoted">''nav''</span><span class="main">,</span> <span class="inner_quoted">''p''</span><span class="main">,</span> <span class="inner_quoted">''section''</span><span class="main">,</span> <span class="inner_quoted">''span''</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Function Definitions›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  CD<span class="main">:</span> l_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> unit
    <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> get_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> RShadowRoot.child_nodes"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_child_nodes_tups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> unit
    <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog<span class="main">)</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_get_child_nodes_tups</span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span>is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">,</span> get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_get_child_nodes</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> invoke <span class="main">(</span>CD.a_get_child_nodes_tups <span class="main">@</span> a_get_child_nodes_tups<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">()</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_get_child_nodes_locs</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="keyword1">if</span> is_shadow_root_ptr_kind <span class="free"><span class="bound"><span class="entity">ptr</span></span></span>
    <span class="keyword1">then</span> <span class="main">{</span>preserved <span class="main">(</span>get_M <span class="main">(</span>the <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span><span class="main">)</span> RShadowRoot.child_nodes<span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span>
    CD.a_get_child_nodes_locs <span class="free"><span class="bound"><span class="entity">ptr</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">first_child</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">first_child</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">children</span> <span class="main">←</span> a_get_child_nodes <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
      return <span class="main">(</span><span class="keyword1">case</span> <span class="bound">children</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> None <span class="main">|</span> <span class="bound">child</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> Some <span class="bound">child</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="keyword2"><span class="keyword">defines</span></span>
  get_child_nodes <span class="main">=</span> <span class="quoted">l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_child_nodes</span> <span class="keyword2"><span class="keyword">and</span></span>
  get_child_nodes_locs <span class="main">=</span> <span class="quoted">l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span> <span class="main">+</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_child_nodes_defs <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  CD<span class="main">:</span> l_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> ShadowRootClass.known_ptr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_child_nodes_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_child_nodes</span> <span class="main">=</span> a_get_child_nodes"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_child_nodes_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_child_nodes_locs</span> <span class="main">=</span> a_get_child_nodes_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_child_nodes_def <span class="main">=</span> get_child_nodes_impl<span class="main">[</span><span class="operator">unfolded</span> a_get_child_nodes_def get_child_nodes_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_child_nodes_locs_def <span class="main">=</span> get_child_nodes_locs_impl<span class="main">[</span><span class="operator">unfolded</span> a_get_child_nodes_locs_def
    get_child_nodes_locs_def<span class="main">,</span> <span class="operator">folded</span> CD.get_child_nodes_locs_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_child_nodes</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> known_ptr_impl type_wf_impl<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">using</span></span> ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> CD.get_child_nodes_ok CD.known_ptr_impl CD.type_wf_impl
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.known_ptr_impl a_get_child_nodes_tups_def get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
      get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> known_ptr_new_shadow_root_ptr <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_I2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_shadow_root_ptr_kind_none l_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas.get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok
      l_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_lemmas_axioms option.case_eq_if shadow_root_ptr_casts_commute3
      shadow_root_ptr_kinds_commutes<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_def invoke_ptr_in_heap <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_OK_returns_result_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_child_nodes</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_child_nodes_def a_get_child_nodes_tups_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">ptr</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">ptr</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span>invoke <span class="main">[</span><span class="main">(</span>is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">,</span>
       get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span><span class="main">]</span>
     <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bind_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> invoke_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_reads<span class="main">:</span> <span class="quoted"><span class="quoted">"reads <span class="main">(</span><span class="free">get_child_nodes_locs</span> <span class="free">ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">get_child_nodes</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_def a_get_child_nodes_tups_def get_child_nodes_locs_def
      CD.get_child_nodes_locs_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> CD.get_child_nodes_reads<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">unfolded</span> CD.get_child_nodes_locs_def<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reads_singleton<span class="main"><span class="main">]</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> check_in_heap_reads<span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reads_bind_pure reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> return_reads<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_child_nodes<span class="main">?</span><span class="main">:</span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_is_l_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_child_nodes type_wf known_ptr
    get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_child_nodes_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads get_child_nodes_ok get_child_nodes_ptr_in_heap get_child_nodes_pure
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_document_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_new_document_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="main">+</span> l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes</span></span>
  <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_new_document<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> cast <span class="free">new_document_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_document_ptr</span>
  <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_new_document
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> document_ptr_casts_commute3 empty_iff is_document_ptr_kind_none
      new_document_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> option.case_eq_if shadow_root_ptr_casts_commute3
      singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_child_nodes_new_document<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_no_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_document_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="free">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.new_document_no_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DocumentClass.a_known_ptr_def CD.known_ptr_impl known_ptr_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> new_document_is_document_ptr<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> i_new_document_get_child_nodes<span class="main">?</span><span class="main">:</span>
  l_new_document_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_document_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_get_child_nodes_is_l_new_document_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_document_get_child_nodes type_wf known_ptr get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_document_is_l_new_document get_child_nodes_is_l_get_child_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_document_get_child_nodes_def l_new_document_get_child_nodes_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> get_child_nodes_new_document new_document_no_child_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes</span></span>
  <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_new_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> cast <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
     <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> document_ptr_casts_commute3 insert_absorb insert_not_empty is_document_ptr_kind_none
      new_shadow_root_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> option.case_eq_if shadow_root_ptr_casts_commute3 singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_child_nodes_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> insertCI new_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> singleton_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> document_ptr_casts_commute3 empty_iff new_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_no_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="free">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_def <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_child_nodes_def CD.a_get_child_nodes_tups_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">using</span></span> NodeClass.a_known_ptr_def known_ptr_not_character_data_ptr known_ptr_not_document_ptr
    known_ptr_not_element_ptr local.CD.known_ptr_impl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_document_ptr_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits document_ptr.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_character_data_ptr_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits document_ptr.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_element_ptr_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits document_ptr.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_get_child_nodes_tups_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_shadow_root_ptr_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> shadow_root_ptr.splits
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_is_shadow_root_ptr<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_in_heap<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def document_ptr_kinds_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> check_in_heap_ptr_in_heap is_OK_returns_result_E old.unit.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span>  new_shadow_root_children
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_shadow_root_children get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> i_new_shadow_root_get_child_nodes<span class="main">?</span><span class="main">:</span>
  l_new_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_child_nodes <span class="main">=</span> l_get_child_nodes <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_child_nodes_new_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> cast <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
     <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_shadow_root_no_child_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="free">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_child_nodes_is_l_new_shadow_root_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_shadow_root_get_child_nodes type_wf known_ptr get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_shadow_root_get_child_nodes_def l_new_shadow_root_get_child_nodes_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> get_child_nodes_new_shadow_root new_shadow_root_no_child_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_element›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_element_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_new_element_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_new_element<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> cast <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def CD.get_child_nodes_locs_def new_element_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>
      new_element_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> new_element_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> new_element_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_no_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
   <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="free">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_def a_get_child_nodes_tups_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.new_element_no_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invoke_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_element_ptr_in_heap get_child_nodes<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def check_in_heap_def
      new_element_child_nodes <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> new_element_is_element_ptr <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> new_element_ptr_in_heap<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">new_element_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="free">new_element_ptr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_is_element_ptr <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> known_ptr_impl ShadowRootClass.a_known_ptr_def DocumentClass.a_known_ptr_def
        CharacterDataClass.a_known_ptr_def ElementClass.a_known_ptr_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> known_ptr_impl CD.known_ptr_impl ShadowRootClass.a_known_ptr_def
        is_document_ptr_kind_none<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_new_element_get_child_nodes<span class="main">?</span><span class="main">:</span>
  l_new_element_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_element_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_get_child_nodes_is_l_new_element_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_element_get_child_nodes type_wf known_ptr get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_element_is_l_new_element get_child_nodes_is_l_get_child_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_element_get_child_nodes_def l_new_element_get_child_nodes_axioms_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_child_nodes_new_element new_element_no_child_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>




<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹delete\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_child_nodes_delete_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> cast <span class="free">shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
    <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def CD.get_child_nodes_locs_def
      delete_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
      delete_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_shadow_root_ptr_kind_obtains<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_child_nodes <span class="main">=</span> l_get_child_nodes_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_child_nodes_delete_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> cast <span class="free">shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
      <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> l_delete_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l_delete_shadow_root_get_child_nodes_get_child_nodes_locs <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_delete_shadow_root_get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_child_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_child_nodes_delete_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  CD<span class="main">:</span> l_set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list
    <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">=</span> put_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> RShadowRoot.child_nodes_update"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_child_nodes_tups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list
    <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog<span class="main">)</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_set_child_nodes_tups</span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span>is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">,</span> set_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_set_child_nodes</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">children</span></span></span> <span class="main">=</span> invoke <span class="main">(</span>CD.a_set_child_nodes_tups <span class="main">@</span> a_set_child_nodes_tups<span class="main">)</span>
    <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">children</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_set_child_nodes_locs</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">≡</span>
      <span class="main">(</span><span class="keyword1">if</span> is_shadow_root_ptr_kind <span class="free"><span class="bound"><span class="entity">ptr</span></span></span>
      <span class="keyword1">then</span> all_args <span class="main">(</span>put_M <span class="main">(</span>the <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span><span class="main">)</span> RShadowRoot.child_nodes_update<span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> CD.a_set_child_nodes_locs <span class="free"><span class="bound"><span class="entity">ptr</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="keyword2"><span class="keyword">defines</span></span>
  set_child_nodes <span class="main">=</span> <span class="quoted">l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_set_child_nodes</span> <span class="keyword2"><span class="keyword">and</span></span>
  set_child_nodes_locs <span class="main">=</span> <span class="quoted">l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_set_child_nodes_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span> <span class="main">+</span>
  l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_set_child_nodes_defs <span class="quoted"><span class="free">set_child_nodes</span></span> <span class="quoted"><span class="free">set_child_nodes_locs</span></span> <span class="main">+</span>
  CD<span class="main">:</span> l_set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="quoted"><span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> ShadowRootClass.known_ptr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_child_nodes_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_child_nodes</span> <span class="main">=</span> a_set_child_nodes"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_child_nodes_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_child_nodes_locs</span> <span class="main">=</span> a_set_child_nodes_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> set_child_nodes_def <span class="main">=</span> set_child_nodes_impl<span class="main">[</span><span class="operator">unfolded</span> a_set_child_nodes_def set_child_nodes_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> set_child_nodes_locs_def <span class="main">=</span> set_child_nodes_locs_impl<span class="main">[</span><span class="operator">unfolded</span> a_set_child_nodes_locs_def
    set_child_nodes_locs_def<span class="main">,</span> <span class="operator">folded</span> CD.set_child_nodes_locs_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_writes<span class="main">:</span> <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_child_nodes_locs</span> <span class="free">ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_child_nodes</span> <span class="free">ptr</span> <span class="free">children</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes_def a_set_child_nodes_tups_def set_child_nodes_locs_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.set_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_child_nodes_writes writes_union_right_I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_set_child_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> writes_bind_pure
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> writes_union_right_I writes_union_left_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_shadow_root_ptr_kind_none<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_pointers_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">object_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> object_ptr_kinds_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_child_nodes_locs_def CD.set_child_nodes_locs_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_types_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">object_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> type_wf_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def type_wf_impl a_set_child_nodes_tups_def set_child_nodes_locs_def
      CD.set_child_nodes_locs_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_child_nodes<span class="main">?</span><span class="main">:</span> l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.set_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.set_child_nodes_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes_def set_child_nodes_locs_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_is_l_set_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_set_child_nodes type_wf set_child_nodes
    set_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span>  set_child_nodes_writes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_pointers_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_types_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="main">+</span> l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_child_nodes</span></span> <span class="quoted"><span class="free">set_child_nodes_locs</span></span>
  <span class="quoted"><span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="main">+</span> CD<span class="main">:</span> l_set_child_nodes_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="quoted"><span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_child_nodes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">set_child_nodes</span> <span class="free">ptr</span> <span class="free">children</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> check_in_heap <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">()</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms set_child_nodes_def invoke_ptr_in_heap
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> check_in_heap_ptr_in_heap is_OK_returns_heap_I is_OK_returns_result_E
        old.unit.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ptr_in_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_in_heap_ptr_in_heap is_OK_returns_result_I<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">id</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> type_wf_preserved<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> set_child_nodes_writes assms<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span>
            <span class="operator">unfolded</span> all_args_def<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> type_wf_impl<span class="main"><span class="main">]</span></span> set_child_nodes_locs_def
        CD.set_child_nodes_locs_def
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> check_in_heap <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">()</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_in_heap_reads set_child_nodes_writes assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> check_in_heap <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">()</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_separate_forwards<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_child_nodes_locs_def CD.set_child_nodes_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> check_in_heap_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms ptr_in_h <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_wf_impl known_ptr_impl  get_child_nodes_def a_get_child_nodes_tups_def
        set_child_nodes_def a_set_child_nodes_tups_def
        <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I2
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_child_nodes_splits<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.set_child_nodes_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_child_nodes_get_child_nodes type_wf_impl CD.type_wf_impl
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_child_nodes_get_child_nodes type_wf_impl CD.type_wf_impl
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.set_child_nodes_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> known_ptr_impl CD.known_ptr_impl set_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        get_child_nodes<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def CD.type_wf_impl ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> known_ptr_new_shadow_root_ptr<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_child_nodes_different_pointers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> <span class="free">ptr'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes_locs_def CD.set_child_nodes_locs_def
      get_child_nodes_locs_def CD.get_child_nodes_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_document_ptr_kind_obtains is_shadow_root_ptr_kind_obtains
      is_element_ptr_kind_obtains
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_child_nodes_get_child_nodes<span class="main">?</span><span class="main">:</span> l_set_child_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes</span> <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span> <span class="quoted">set_child_nodes</span>
  <span class="quoted">set_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.set_child_nodes</span> <span class="quoted">Core_DOM_Functions.set_child_nodes_locs</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_child_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_child_nodes_is_l_set_child_nodes_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_child_nodes_get_child_nodes type_wf known_ptr get_child_nodes get_child_nodes_locs
    set_child_nodes set_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">instances</span></span> l_set_child_nodes_get_child_nodes_def
      l_set_child_nodes_get_child_nodes_axioms_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_get_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_get_child_nodes_different_pointers <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_tag\_type›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_set_tag_name<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> tag_name <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> set_tag_name_def <span class="main">=</span> CD.set_tag_name_impl<span class="main">[</span><span class="operator">unfolded</span> CD.a_set_tag_name_def set_tag_name_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> set_tag_name_locs_def <span class="main">=</span> CD.set_tag_name_locs_impl<span class="main">[</span><span class="operator">unfolded</span> CD.a_set_tag_name_locs_def
    set_tag_name_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_tag_name</span> <span class="free">element_ptr</span> <span class="free">tag</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_tag_name_impl<span class="main">[</span><span class="operator">unfolded</span> a_set_tag_name_def<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ok put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ok
  <span class="keyword1"><span class="command">using</span></span> CD.set_tag_name_ok CD.type_wf_impl ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_writes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_tag_name_locs</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_tag_name</span> <span class="free">element_ptr</span> <span class="free">tag</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.set_tag_name_writes <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_pointers_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_tag_name_locs</span> <span class="free">element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_tag_name_pointers_preserved<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_typess_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_tag_name_locs</span> <span class="free">element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> type_wf_preserved<span class="main"><span class="main">[</span></span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> set_tag_name_locs_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_tag_name_locs_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_tag_name<span class="main">?</span><span class="main">:</span> l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_tag_name</span>
  <span class="quoted">set_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_is_l_set_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_tag_name type_wf set_tag_name set_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_writes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_pointers_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_typess_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_tag_name_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  CD<span class="main">:</span> l_set_tag_name_get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span>
  <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_tag_name_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_tag_name_locs_def all_args_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.set_tag_name_get_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> CD.set_tag_name_get_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_tag_name_get_child_nodes<span class="main">?</span><span class="main">:</span> l_set_tag_name_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_tag_name</span> <span class="quoted">set_tag_name_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.known_ptr</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_tag_name_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_child_nodes_is_l_set_tag_name_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_tag_name_get_child_nodes type_wf set_tag_name set_tag_name_locs known_ptr get_child_nodes
                                         get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_is_l_set_tag_name get_child_nodes_is_l_get_child_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name_get_child_nodes_def
      l_set_tag_name_get_child_nodes_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_get_child_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">=</span> get_M <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> shadow_root_opt"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_shadow_root_locs</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">≡</span> <span class="main">{</span>preserved <span class="main">(</span>get_M <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> shadow_root_opt<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="keyword2"><span class="keyword">defines</span></span> get_shadow_root <span class="main">=</span> <span class="quoted">a_get_shadow_root</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_shadow_root_locs <span class="main">=</span> <span class="quoted">a_get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_shadow_root</span> <span class="main">=</span> a_get_shadow_root"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_shadow_root_locs</span> <span class="main">=</span> a_get_shadow_root_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_shadow_root_def <span class="main">=</span> get_shadow_root_impl<span class="main">[</span><span class="operator">unfolded</span> get_shadow_root_def a_get_shadow_root_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_shadow_root_locs_def <span class="main">=</span> get_shadow_root_locs_impl<span class="main">[</span><span class="operator">unfolded</span> get_shadow_root_locs_def
    a_get_shadow_root_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_shadow_root_def type_wf_impl
  <span class="keyword1"><span class="command">using</span></span> ShadowRootMonad.get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ok <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_shadow_root_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_def get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_OK_returns_result_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_reads<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reads <span class="main">(</span><span class="free">get_shadow_root_locs</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_def get_shadow_root_locs_def reads_bind_pure
      reads_insert_writes_set_right<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_shadow_root<span class="main">?</span><span class="main">:</span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root <span class="main">=</span> l_type_wf <span class="main">+</span> l_get_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_reads<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reads <span class="main">(</span><span class="free">get_shadow_root_locs</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_ok<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_is_l_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_shadow_root type_wf get_shadow_root get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_shadow_root_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_locs_def get_shadow_root_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_shadow_root <span class="main">=</span>
  l_set_disconnected_nodes_defs <span class="main">+</span>
  l_get_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_disconnected_nodes_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_disconnected_nodes_get_shadow_root<span class="main">?</span><span class="main">:</span> l_set_disconnected_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_shadow_root_is_l_set_disconnected_nodes_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_shadow_root set_disconnected_nodes_locs get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_shadow_root_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_tag\_type›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_tag_name_get_shadow_root<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_tag_name_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_tag_name_locs_def
      get_shadow_root_locs_def all_args_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">tag_name_update</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> getter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">shadow_root_opt</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_tag_name_get_shadow_root <span class="main">=</span> l_set_tag_name <span class="main">+</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_tag_name_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_tag_name_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_tag_name_get_shadow_root<span class="main">?</span><span class="main">:</span> l_set_tag_name_get_shadow_root<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">set_tag_name</span> <span class="quoted">set_tag_name_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name_get_shadow_root<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_tag_name_get_shadow_root<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_shadow_root_is_l_set_tag_name_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_tag_name_get_shadow_root type_wf set_tag_name set_tag_name_locs get_shadow_root
                                  get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_is_l_set_tag_name get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name_get_shadow_root_def l_set_tag_name_get_shadow_root_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_get_shadow_root
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_child_nodes</span></span>
  <span class="quoted"><span class="free">set_child_nodes_locs</span></span> <span class="quoted"><span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_shadow_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes_locs_def get_shadow_root_locs_def CD.set_child_nodes_locs_def
      all_args_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> getter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">shadow_root_opt</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
        setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">RElement.child_nodes_update</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes_get_shadow_root <span class="main">=</span> l_set_child_nodes_defs <span class="main">+</span> l_get_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_child_nodes_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_child_nodes_get_shadow_root<span class="main">?</span><span class="main">:</span> l_set_child_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span>
  <span class="quoted">Core_DOM_Functions.set_child_nodes</span> <span class="quoted">Core_DOM_Functions.set_child_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_child_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_shadow_root_is_l_set_child_nodes_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_child_nodes_get_shadow_root set_child_nodes_locs get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_shadow_root_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_get_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹delete\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_delete_shadow_root<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_locs_def delete_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_shadow_root <span class="main">=</span> l_get_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_delete_shadow_root<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> l_delete_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l_delete_shadow_root_get_shadow_root_get_shadow_root_locs <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_delete_shadow_root_get_shadow_root get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_shadow_root_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_delete_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_character\_data›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_character_data_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_new_character_data<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_character_data_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_locs_def new_character_data_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub>
      new_character_data_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_character_data_get_shadow_root <span class="main">=</span> l_new_character_data <span class="main">+</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_new_character_data<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_character_data_ptr</span>
            <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> i_new_character_data_get_shadow_root<span class="main">?</span><span class="main">:</span>
  l_new_character_data_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_character_data_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_character_data_get_shadow_root_is_l_new_character_data_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_character_data_get_shadow_root type_wf get_shadow_root get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_character_data_is_l_new_character_data get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_character_data_get_shadow_root_def
      l_new_character_data_get_shadow_root_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_new_character_data
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_document_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_new_document<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_document_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_locs_def new_document_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> new_document_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_document_get_shadow_root <span class="main">=</span> l_new_document <span class="main">+</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_new_document<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_document_ptr</span>
            <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> i_new_document_get_shadow_root<span class="main">?</span><span class="main">:</span>
  l_new_document_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_document_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_get_shadow_root_is_l_new_document_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_document_get_shadow_root type_wf get_shadow_root get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_document_is_l_new_document get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_document_get_shadow_root_def l_new_document_get_shadow_root_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_new_document
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_element›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_element_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_new_element<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_locs_def new_element_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> new_element_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      new_element_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_no_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
   <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">new_element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_def new_element_shadow_root_opt<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_element_get_shadow_root <span class="main">=</span> l_new_element <span class="main">+</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_new_element<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span>
            <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_element_no_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
            <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">new_element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> i_new_element_get_shadow_root<span class="main">?</span><span class="main">:</span>
  l_new_element_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_element_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_get_shadow_root_is_l_new_element_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_element_get_shadow_root type_wf get_shadow_root get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_element_is_l_new_element get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_element_get_shadow_root_def l_new_element_get_shadow_root_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_new_element new_element_no_shadow_root
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_new_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_locs_def new_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> new_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_shadow_root <span class="main">=</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_new_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
            <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_new_shadow_root_get_shadow_root<span class="main">?</span><span class="main">:</span>
  l_new_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_shadow_root_is_l_new_shadow_root_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_shadow_root_get_shadow_root type_wf get_shadow_root get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_shadow_root_get_shadow_root_def
      l_new_shadow_root_get_shadow_root_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_new_shadow_root
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_set_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">=</span> put_M <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> shadow_root_opt_update"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_,</span> unit<span class="main">)</span> dom_prog<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_set_shadow_root_locs</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">≡</span> all_args <span class="main">(</span>put_M <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> shadow_root_opt_update<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="keyword2"><span class="keyword">defines</span></span> set_shadow_root <span class="main">=</span> <span class="quoted">a_set_shadow_root</span>
    <span class="keyword2"><span class="keyword">and</span></span> set_shadow_root_locs <span class="main">=</span> <span class="quoted">a_set_shadow_root_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_set_shadow_root_defs <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="main">+</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_shadow_root</span> <span class="main">=</span> a_set_shadow_root"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_shadow_root_locs</span> <span class="main">=</span> a_set_shadow_root_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> set_shadow_root_def <span class="main">=</span> set_shadow_root_impl<span class="main">[</span><span class="operator">unfolded</span> set_shadow_root_def
    a_set_shadow_root_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> set_shadow_root_locs_def <span class="main">=</span> set_shadow_root_locs_impl<span class="main">[</span><span class="operator">unfolded</span> set_shadow_root_locs_def
    a_set_shadow_root_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_ok<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
  <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="free">tag</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_shadow_root_def <span class="keyword1"><span class="command">using</span></span> get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ok put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ok
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ShadowRootMonad.put_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>_ok<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_ptr_in_heap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="free">shadow_root</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_def ElementMonad.put_M_ptr_in_heap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_writes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_shadow_root_locs</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="free">tag</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_def set_shadow_root_locs_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> writes_bind_pure<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_pointers_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> object_ptr_kinds_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_shadow_root_locs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_types_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> type_wf_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_shadow_root_locs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_shadow_root<span class="main">?</span><span class="main">:</span> l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">set_shadow_root</span>
  <span class="quoted">set_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root <span class="main">=</span> l_type_wf <span class="main">+</span>l_set_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_writes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_shadow_root_locs</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="free">disc_nodes</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_ok<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="free">shadow_root</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="free">shadow_root</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_pointers_preserved<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
      object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_types_preserved<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_is_l_set_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_shadow_root type_wf set_shadow_root set_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_writes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_pointers_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_types_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">set_shadow_root</span> <span class="free">ptr</span> <span class="free">shadow_root_ptr_opt</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
  <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">shadow_root_ptr_opt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_def get_shadow_root_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_shadow_root_different_pointers<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> <span class="free">ptr'</span> <span class="main">⟹</span>
  <span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_locs_def get_shadow_root_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_shadow_root_get_shadow_root<span class="main">?</span><span class="main">:</span> l_set_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_shadow_root_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_shadow_root <span class="main">=</span>
  l_type_wf <span class="main">+</span>
  l_set_shadow_root_defs <span class="main">+</span>
  l_get_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">set_shadow_root</span> <span class="free">ptr</span> <span class="free">shadow_root_ptr_opt</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
      <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">shadow_root_ptr_opt</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_get_shadow_root_different_pointers<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
      <span class="free">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_shadow_root_is_l_set_shadow_root_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_shadow_root_get_shadow_root type_wf set_shadow_root set_shadow_root_locs get_shadow_root
  get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_shadow_root_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_get_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_get_shadow_root_different_pointers <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_mode›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_set_mode</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">=</span> put_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> mode_update"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_set_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_,</span> unit<span class="main">)</span> dom_prog<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_set_mode_locs</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">≡</span> all_args <span class="main">(</span>put_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> mode_update<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="keyword2"><span class="keyword">defines</span></span> set_mode <span class="main">=</span> <span class="quoted">a_set_mode</span>
    <span class="keyword2"><span class="keyword">and</span></span> set_mode_locs <span class="main">=</span> <span class="quoted">a_set_mode_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">set_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">set_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_set_mode_defs <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="main">+</span>
  l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_mode</span> <span class="main">=</span> a_set_mode"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_mode_locs</span> <span class="main">=</span> a_set_mode_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> set_mode_def <span class="main">=</span> set_mode_impl<span class="main">[</span><span class="operator">unfolded</span> set_mode_def a_set_mode_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> set_mode_locs_def <span class="main">=</span> set_mode_locs_impl<span class="main">[</span><span class="operator">unfolded</span> set_mode_locs_def a_set_mode_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_mode</span> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_mode_def <span class="keyword1"><span class="command">using</span></span> get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ShadowRootMonad.put_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_ptr_in_heap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_mode</span> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_def put_M_ptr_in_heap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_writes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_mode_locs</span> <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_mode</span> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_def set_mode_locs_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> writes_bind_pure<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_pointers_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> object_ptr_kinds_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_mode_locs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_types_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> type_wf_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def set_mode_locs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_mode<span class="main">?</span><span class="main">:</span> l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode <span class="main">=</span> l_type_wf <span class="main">+</span>l_set_mode_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_writes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_mode_locs</span> <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_mode</span> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_ok<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_mode</span> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_mode</span> <span class="free">shadow_root_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_pointers_preserved<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">shadow_root_ptr</span> <span class="main">⟹</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_types_preserved<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_is_l_set_mode <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_set_mode type_wf set_mode set_mode_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_mode_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_writes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_pointers_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_types_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def set_shadow_root_locs_def CD.get_child_nodes_locs_def
      all_args_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">shadow_root_opt_update</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_shadow_root_get_child_nodes<span class="main">?</span><span class="main">:</span> l_set_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">Core_DOM_Functions.get_child_nodes</span> <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span> <span class="quoted">set_shadow_root</span>
  <span class="quoted">set_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_child_nodes <span class="main">=</span> l_set_shadow_root <span class="main">+</span> l_get_child_nodes <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_get_child_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_child_nodes_is_l_set_shadow_root_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_shadow_root_get_child_nodes type_wf set_shadow_root set_shadow_root_locs known_ptr
    get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_child_nodes_def
      l_set_shadow_root_get_child_nodes_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_get_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root›</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_locs_def get_shadow_root_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_mode_get_shadow_root<span class="main">?</span><span class="main">:</span> l_set_mode_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_mode_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_shadow_root <span class="main">=</span> l_set_mode <span class="main">+</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_shadow_root_is_l_set_mode_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_mode_get_shadow_root type_wf set_mode set_mode_locs get_shadow_root
                                         get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_is_l_set_mode get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_mode_get_shadow_root_def
      l_set_mode_get_shadow_root_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_get_shadow_root
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_child_nodes_locs_def CD.get_child_nodes_locs_def set_mode_locs_def
      all_args_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_mode_get_child_nodes<span class="main">?</span><span class="main">:</span> l_set_mode_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">set_mode</span>
  <span class="quoted">set_mode_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span> <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_mode_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_child_nodes <span class="main">=</span> l_set_mode <span class="main">+</span> l_get_child_nodes <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_get_child_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_child_nodes_is_l_set_mode_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_mode_get_child_nodes type_wf set_mode set_mode_locs known_ptr get_child_nodes
                                         get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_is_l_set_mode get_child_nodes_is_l_get_child_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_mode_get_child_nodes_def
      l_set_mode_get_child_nodes_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_get_child_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_host›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_shadow_root</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> dom_prog"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_get_host</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">host_ptrs</span> <span class="main">←</span> element_ptr_kinds_M <span class="main">⤜</span> filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">element_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">shadow_root_opt</span> <span class="main">←</span> <span class="free">get_shadow_root</span> <span class="bound">element_ptr</span><span class="main">;</span>
        return <span class="main">(</span><span class="bound">shadow_root_opt</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">)</span>
      <span class="main">}</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="bound">host_ptrs</span> <span class="keyword1">of</span> <span class="bound">host_ptr</span><span class="main">#</span><span class="main">[]</span> <span class="main">⇒</span> return <span class="bound">host_ptr</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> error HierarchyRequestError<span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">a_get_host_locs</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">element_ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">get_shadow_root_locs</span> <span class="bound">element_ptr</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
  <span class="main">(</span><span class="main">⋃</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">{</span>preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">ptr</span> RObject.nothing<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> get_host <span class="main">=</span> <span class="quoted"><span class="quoted">"a_get_host"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_host_locs <span class="main">=</span> <span class="quoted"><span class="quoted">"a_get_host_locs"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_host_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_host_defs <span class="main">+</span>
  l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_host_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_host</span> <span class="main">=</span> a_get_host"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_host_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_host_locs</span> <span class="main">=</span> a_get_host_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_host_def <span class="main">=</span> get_host_impl<span class="main">[</span><span class="operator">unfolded</span> a_get_host_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_host_locs_def <span class="main">=</span> get_host_locs_impl<span class="main">[</span><span class="operator">unfolded</span> a_get_host_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_host</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_host_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I filter_M_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_reads<span class="main">:</span> <span class="quoted"><span class="quoted">"reads <span class="free">get_host_locs</span> <span class="main">(</span><span class="free">get_host</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads<span class="main">[</span><span class="operator">unfolded</span> reads_def<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_host_def get_host_locs_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reads_bind_pure reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> check_in_heap_reads<span class="main"><span class="main">]</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> error_reads<span class="main"><span class="main">]</span></span>
      reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_shadow_root_reads<span class="main"><span class="main">]</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> return_reads<span class="main"><span class="main">]</span></span>
      reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> element_ptr_kinds_M_reads<span class="main"><span class="main">]</span></span> filter_M_reads filter_M_pure_I
      bind_pure_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_host <span class="main">=</span> l_get_host_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_host_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_host</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_host_reads<span class="main">:</span> <span class="quoted"><span class="quoted">"reads <span class="free">get_host_locs</span> <span class="main">(</span><span class="free">get_host</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> i_get_host<span class="main">?</span><span class="main">:</span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_host</span>
  <span class="quoted">get_host_locs</span> <span class="quoted">type_wf</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def get_host_def get_host_locs_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_is_l_get_host <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_host get_host get_host_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_host_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_host_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_mode›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> shadow_root_mode<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_mode</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">=</span> get_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> mode"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_mode_locs</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">≡</span> <span class="main">{</span>preserved <span class="main">(</span>get_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> mode<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="keyword2"><span class="keyword">defines</span></span> get_mode <span class="main">=</span> <span class="quoted">a_get_mode</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_mode_locs <span class="main">=</span> <span class="quoted">a_get_mode_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_mode_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> shadow_root_mode<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_mode_defs <span class="quoted"><span class="free">get_mode</span></span> <span class="quoted"><span class="free">get_mode_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> shadow_root_mode<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_mode_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_mode</span> <span class="main">=</span> a_get_mode"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_mode_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_mode_locs</span> <span class="main">=</span> a_get_mode_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_mode_def <span class="main">=</span> get_mode_impl<span class="main">[</span><span class="operator">unfolded</span> get_mode_def a_get_mode_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_mode_locs_def <span class="main">=</span> get_mode_locs_impl<span class="main">[</span><span class="operator">unfolded</span> get_mode_locs_def a_get_mode_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_mode_ok<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
  <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_mode</span> <span class="free">shadow_root_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_mode_def type_wf_impl
  <span class="keyword1"><span class="command">using</span></span> ShadowRootMonad.get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ok <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> get_mode_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_mode</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_mode_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> get_mode_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_mode</span> <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_mode_def get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_ptr_in_heap <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_OK_returns_result_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_mode_reads<span class="main">:</span> <span class="quoted"><span class="quoted">"reads <span class="main">(</span><span class="free">get_mode_locs</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">get_mode</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_mode_def get_mode_locs_def reads_bind_pure reads_insert_writes_set_right<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_mode<span class="main">?</span><span class="main">:</span> l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_mode</span> <span class="quoted">get_mode_locs</span> <span class="quoted">type_wf</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_get_mode <span class="main">=</span> l_type_wf <span class="main">+</span> l_get_mode_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_mode_reads<span class="main">:</span> <span class="quoted"><span class="quoted">"reads <span class="main">(</span><span class="free">get_mode_locs</span> <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">get_mode</span> <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_mode_ok<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_mode</span> <span class="free">shadow_root_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_mode_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_mode</span> <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_mode_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_mode</span> <span class="free">shadow_root_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_mode_is_l_get_mode <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_mode type_wf get_mode get_mode_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_mode_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_mode_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_mode_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_mode_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root\_safe›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_get_mode_defs <span class="quoted"><span class="free">get_mode</span></span> <span class="quoted"><span class="free">get_mode_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> shadow_root_mode<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_shadow_root_safe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_shadow_root_safe</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">shadow_root_ptr_opt</span> <span class="main">←</span> <span class="free">get_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="bound">shadow_root_ptr_opt</span> <span class="keyword1">of</span>
        Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">mode</span> <span class="main">←</span> <span class="free">get_mode</span> <span class="bound">shadow_root_ptr</span><span class="main">;</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="bound">mode</span> <span class="main">=</span> Open <span class="keyword1">then</span>
            return <span class="main">(</span>Some <span class="bound">shadow_root_ptr</span><span class="main">)</span>
          <span class="keyword1">else</span>
            return None
          <span class="main">)</span>
        <span class="main">}</span> <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_shadow_root_safe_locs</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_get_shadow_root_safe_locs</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="free">get_shadow_root_locs</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">get_mode_locs</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="quoted">get_mode</span> <span class="quoted">get_mode_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> get_shadow_root_safe <span class="main">=</span> <span class="quoted">a_get_shadow_root_safe</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_shadow_root_safe_locs <span class="main">=</span> <span class="quoted">a_get_shadow_root_safe_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root_safe_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_shadow_root_safe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_shadow_root_safe_locs</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_mode</span></span> <span class="quoted"><span class="free">get_mode_locs</span></span> <span class="main">+</span>
  l_get_shadow_root_safe_defs <span class="quoted"><span class="free">get_shadow_root_safe</span></span> <span class="quoted"><span class="free">get_shadow_root_safe_locs</span></span> <span class="main">+</span>
  l_get_shadow_root  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_get_mode  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_mode</span></span> <span class="quoted"><span class="free">get_mode_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_safe</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_safe_locs</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> shadow_root_mode<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_safe_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_shadow_root_safe</span> <span class="main">=</span> a_get_shadow_root_safe"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_safe_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_shadow_root_safe_locs</span> <span class="main">=</span> a_get_shadow_root_safe_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_shadow_root_safe_def <span class="main">=</span>
  get_shadow_root_safe_impl<span class="main">[</span><span class="operator">unfolded</span> get_shadow_root_safe_def a_get_shadow_root_safe_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_shadow_root_safe_locs_def <span class="main">=</span>
  get_shadow_root_safe_locs_impl<span class="main">[</span><span class="operator">unfolded</span> get_shadow_root_safe_locs_def a_get_shadow_root_safe_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_safe_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_shadow_root_safe</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_shadow_root_safe_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> bind_returns_heap_E is_OK_returns_heap_E local.get_mode_pure local.get_shadow_root_pure
      option.case_eq_if pure_def pure_returns_heap_eq return_pure<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_shadow_root_safe<span class="main">?</span><span class="main">:</span> l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root_safe</span>
  <span class="quoted">get_shadow_root_safe_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_mode</span> <span class="quoted">get_mode_locs</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      get_shadow_root_safe_def get_shadow_root_safe_locs_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root_safe <span class="main">=</span> l_get_shadow_root_safe_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_shadow_root_safe_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_shadow_root_safe</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_safe_is_l_get_shadow_root_safe <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_shadow_root_safe get_shadow_root_safe"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_shadow_root_safe_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="free">node_ptrs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.set_disconnected_nodes_ok CD.type_wf_impl ShadowRootClass.type_wf_defs local.type_wf_impl
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_typess_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">object_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> type_wf_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def CD.set_disconnected_nodes_locs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes<span class="main">?</span><span class="main">:</span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def
      l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_is_l_set_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes type_wf set_disconnected_nodes set_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_disconnected_nodes.set_disconnected_nodes_writes<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_disconnected_nodes.set_disconnected_nodes_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_set_disconnected_nodes.set_disconnected_nodes_pointers_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_typess_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes</span></span>
  <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span>
    prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_child_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_locs_def get_child_nodes_locs_def
      CD.get_child_nodes_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes_get_child_nodes<span class="main">?</span><span class="main">:</span>
  l_set_disconnected_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">set_disconnected_nodes</span>
  <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span> <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_child_nodes_is_l_set_disconnected_nodes_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_child_nodes set_disconnected_nodes_locs get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_child_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_child_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_host›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_host<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_host_locs</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_disconnected_nodes_locs_def get_shadow_root_locs_def get_host_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes_get_host<span class="main">?</span><span class="main">:</span> l_set_disconnected_nodes_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_host <span class="main">=</span> l_set_disconnected_nodes_defs <span class="main">+</span> l_get_host_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_disconnected_nodes_get_host<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_host_locs</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_host_is_l_set_disconnected_nodes_get_host <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_host set_disconnected_nodes_locs get_host_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_host_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_host
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_tag\_name›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_get_tag_name<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> tag_name<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_tag_name</span> <span class="free">element_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl get_tag_name_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> a_get_tag_name_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> CD.get_tag_name_ok CD.type_wf_impl ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_tag_name<span class="main">?</span><span class="main">:</span> l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_is_l_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_tag_name type_wf get_tag_name
  get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_tag_name_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_tag_name<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_disconnected_nodes_locs_def CD.get_tag_name_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes_get_tag_name<span class="main">?</span><span class="main">:</span> l_set_disconnected_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_tag_name_is_l_set_disconnected_nodes_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_tag_name type_wf set_disconnected_nodes set_disconnected_nodes_locs
  get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_tag_name_def
      l_set_disconnected_nodes_get_tag_name_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_tag_name
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_tag_name<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_child_nodes_locs_def set_child_nodes_locs_def CD.get_tag_name_locs_def
      all_args_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> getter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">tag_name</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
        setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">RElement.child_nodes_update</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_child_nodes_get_tag_name<span class="main">?</span><span class="main">:</span> l_set_child_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span>
  <span class="quoted">Core_DOM_Functions.set_child_nodes</span> <span class="quoted">Core_DOM_Functions.set_child_nodes_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_child_nodes_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_tag_name_is_l_set_child_nodes_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_child_nodes_get_tag_name type_wf set_child_nodes set_child_nodes_locs get_tag_name
  get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_tag_name_def l_set_child_nodes_get_tag_name_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_get_tag_name
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹delete\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_delete_shadow_root<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_tag_name_locs_def delete_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_tag_name <span class="main">=</span> l_get_tag_name_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_tag_name_delete_shadow_root<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> l_delete_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l_delete_shadow_root_get_tag_name_get_tag_name_locs <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_delete_shadow_root_get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_tag_name_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_delete_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_tag_name<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_locs_def CD.get_tag_name_locs_def all_args_def
      element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">shadow_root_opt_update</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_shadow_root_get_tag_name<span class="main">?</span><span class="main">:</span> l_set_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_tag_name <span class="main">=</span> l_set_shadow_root_defs <span class="main">+</span> l_get_tag_name_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_get_tag_name<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_tag_name_is_l_set_shadow_root_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_shadow_root_get_tag_name set_shadow_root_locs get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_is_l_set_shadow_root get_tag_name_is_l_get_tag_name
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_tag_name_def <span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_get_tag_name
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_element›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_element_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> tag_name<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_new_element<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_tag_name_locs_def new_element_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> new_element_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      new_element_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_empty_tag_name<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
   <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">new_element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="inner_quoted">''''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_tag_name_def new_element_tag_name<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_element_get_tag_name <span class="main">=</span> l_new_element <span class="main">+</span> l_get_tag_name <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_tag_name_new_element<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">≠</span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span>
            <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_element_empty_tag_name<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
            <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">new_element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="inner_quoted">''''</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> i_new_element_get_tag_name<span class="main">?</span><span class="main">:</span>
  l_new_element_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_element_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_element_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_element_get_tag_name_is_l_new_element_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_element_get_tag_name type_wf get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_element_is_l_new_element get_tag_name_is_l_get_tag_name
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_element_get_tag_name_def l_new_element_get_tag_name_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_new_element new_element_empty_tag_name
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_tag_name<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_locs_def CD.get_tag_name_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_mode_get_tag_name<span class="main">?</span><span class="main">:</span> l_set_mode_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span>  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_mode_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_tag_name <span class="main">=</span> l_set_mode <span class="main">+</span> l_get_tag_name <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_get_tag_name<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_tag_name_is_l_set_mode_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_mode_get_tag_name type_wf set_mode set_mode_locs get_tag_name
                                         get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_is_l_set_mode get_tag_name_is_l_get_tag_name
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_mode_get_tag_name_def
      l_set_mode_get_tag_name_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_get_tag_name
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_document_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> tag_name<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_new_document<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_document_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
       <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_tag_name_locs_def new_document_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_document_get_tag_name <span class="main">=</span> l_get_tag_name_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_tag_name_new_document<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_document_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
       <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_new_document_get_tag_name<span class="main">?</span><span class="main">:</span>
  l_new_document_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_document_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_document_get_tag_name_is_l_new_document_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_document_get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> l_new_document_get_tag_name_def
  <span class="keyword1"><span class="command">unfolding</span></span> get_tag_name_locs_def
  <span class="keyword1"><span class="command">using</span></span> new_document_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_new_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
     <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_tag_name_locs_def new_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> new_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits if_splits option.splits
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E bind_returns_heap_E <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_element_ptr_kind_obtains<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_tag_name <span class="main">=</span> l_get_tag_name <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_tag_name_new_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>
            <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_new_shadow_root_get_tag_name<span class="main">?</span><span class="main">:</span>
  l_new_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_tag_name_is_l_new_shadow_root_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_shadow_root_get_tag_name type_wf get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_is_l_get_tag_name
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_shadow_root_get_tag_name_def l_new_shadow_root_get_tag_name_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_new_shadow_root
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_character\_data›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_character_data_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> tag_name<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_tag_name_new_character_data<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_character_data_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
       <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_tag_name_locs_def new_character_data_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_character_data_get_tag_name <span class="main">=</span> l_get_tag_name_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_tag_name_new_character_data<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_character_data_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
       <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_new_character_data_get_tag_name<span class="main">?</span><span class="main">:</span>
  l_new_character_data_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_character_data_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> new_character_data_get_tag_name_is_l_new_character_data_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_character_data_get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> l_new_character_data_get_tag_name_def
  <span class="keyword1"><span class="command">unfolding</span></span> get_tag_name_locs_def
  <span class="keyword1"><span class="command">using</span></span> new_character_data_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_tag\_type›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_tag_name_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="main">+</span> l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_tag_name<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> CD.a_set_tag_name <span class="free">element_ptr</span> <span class="free">tag</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> CD.a_get_tag_name <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">tag</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_tag_name_def CD.a_set_tag_name_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_tag_name_different_pointers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> <span class="free">ptr'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> CD.a_set_tag_name_locs <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> CD.a_get_tag_name_locs <span class="free">ptr'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def CD.a_set_tag_name_locs_def CD.a_get_tag_name_locs_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits <span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_tag_name_get_tag_name<span class="main">?</span><span class="main">:</span>
  l_set_tag_name_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">set_tag_name</span> <span class="quoted">set_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_tag_name_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_tag_name_is_l_set_tag_name_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_tag_name_get_tag_name  type_wf get_tag_name get_tag_name_locs
                                                    set_tag_name set_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_is_l_set_tag_name get_tag_name_is_l_get_tag_name
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name_get_tag_name_def
      l_set_tag_name_get_tag_name_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_get_tag_name
    set_tag_name_get_tag_name_different_pointers
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹attach\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_set_shadow_root_defs <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="main">+</span>
  l_set_mode_defs <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="main">+</span>
  l_get_tag_name_defs <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> char list<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_attach_shadow_root</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_attach_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">shadow_root_mode</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">tag</span> <span class="main">∉</span> safe_shadow_root_element_types <span class="keyword1">then</span> error NotSupportedError <span class="keyword1">else</span> return <span class="main">()</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">prev_shadow_root</span> <span class="main">←</span> <span class="free">get_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">prev_shadow_root</span> <span class="main">≠</span> None <span class="keyword1">then</span> error NotSupportedError <span class="keyword1">else</span> return <span class="main">()</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">new_shadow_root_ptr</span> <span class="main">←</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M<span class="main">;</span>
      <span class="free">set_mode</span> <span class="bound">new_shadow_root_ptr</span> <span class="free"><span class="bound"><span class="entity">shadow_root_mode</span></span></span><span class="main">;</span>
      <span class="free">set_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">(</span>Some <span class="bound">new_shadow_root_ptr</span><span class="main">)</span><span class="main">;</span>
      return <span class="bound">new_shadow_root_ptr</span>
    <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_attach_shadow_root_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">attach_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr<span class="main">)</span> dom_prog"</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span>
  <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> attach_shadow_root <span class="main">=</span> <span class="quoted">a_attach_shadow_root</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span>
  <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_attach_shadow_root_defs <span class="quoted"><span class="free">attach_shadow_root</span></span> <span class="main">+</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="main">+</span>
  l_set_mode <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="main">+</span>
  l_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">attach_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> char list<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> a_known_ptr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> attach_shadow_root_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">attach_shadow_root</span> <span class="main">=</span> a_attach_shadow_root"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> attach_shadow_root_def <span class="main">=</span> a_attach_shadow_root_def<span class="main">[</span><span class="operator">folded</span> attach_shadow_root_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> attach_shadow_root_element_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">shadow_root_mode</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">shadow_root_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">h3</span></span> <span class="skolem"><span class="skolem">new_shadow_root_ptr</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    new_shadow_root_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_shadow_root_ptr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">set_mode</span> <span class="skolem">new_shadow_root_ptr</span> <span class="free">shadow_root_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="main">(</span>Some <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> attach_shadow_root_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_tag_name_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_shadow_root_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_shadow_root_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_new_ptr new_shadow_root_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_mode_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_mode_pointers_preserved
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def node_ptr_kinds_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> create_shadow_root_known_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">shadow_root_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">new_shadow_root_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> attach_shadow_root_def known_ptr_impl ShadowRootClass.a_known_ptr_def
      new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_def new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_def Let_def
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_attach_shadow_root <span class="main">=</span> l_attach_shadow_root_defs

<span class="keyword1"><span class="command">interpretation</span></span>
  i_attach_shadow_root<span class="main">?</span><span class="main">:</span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span>
  <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span> <span class="quoted">attach_shadow_root</span> <span class="quoted">type_wf</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      attach_shadow_root_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_parent›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> get_parent <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_parent get_child_nodes"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_parent_locs <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_parent_locs get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_parent<span class="main">?</span><span class="main">:</span> l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def get_parent_def
      get_parent_locs_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_parent_is_l_get_parent <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_parent type_wf known_ptr known_ptrs get_parent
    get_parent_locs get_child_nodes get_child_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_def l_get_parent_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> get_parent_reads get_parent_ok get_parent_ptr_in_heap get_parent_pure
    get_parent_parent_in_heap get_parent_child_dual get_parent_reads_pointers
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_parent<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes_get_child_nodes
  <span class="main">+</span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="main">+</span> l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_parent <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_parent_locs</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_parent_locs_def CD.set_disconnected_nodes_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes_get_parent<span class="main">?</span><span class="main">:</span> l_set_disconnected_nodes_get_parent<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_parent<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_parent_is_l_set_disconnected_nodes_get_parent <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_parent set_disconnected_nodes_locs get_parent_locs"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_parent_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> get_root_node <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_root_node get_parent"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_root_node_locs <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_root_node_locs get_parent_locs"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_ancestors <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_ancestors get_parent"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_ancestors_locs <span class="main">=</span> <span class="quoted"><span class="quoted">"l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_ancestors_locs get_parent_locs"</span></span>
  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">declare</span></span> a_get_ancestors.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_root_node<span class="main">?</span><span class="main">:</span> l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span>
  <span class="quoted">get_parent_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_ancestors</span> <span class="quoted">get_ancestors_locs</span>
  <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def get_root_node_def
      get_root_node_locs_def get_ancestors_def get_ancestors_locs_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_root_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_is_l_get_ancestors <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_ancestors get_ancestors"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_ancestors_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_is_l_get_root_node <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_root_node get_root_node get_parent"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_def Shadow_DOM.i_get_root_node.get_root_node_no_parent<span class="main">)</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node\_si›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_parent_defs <span class="quoted"><span class="free">get_parent</span></span> <span class="quoted"><span class="free">get_parent_locs</span></span> <span class="main">+</span>
  l_get_host_defs <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_parent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_parent_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>dom_prog<span class="main">)</span> <span class="entity">a_get_ancestors_si</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_ancestors_si</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      check_in_heap <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
      <span class="bound">ancestors</span> <span class="main">←</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
        Some <span class="bound">node_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">parent_ptr_opt</span> <span class="main">←</span> <span class="free">get_parent</span> <span class="bound">node_ptr</span><span class="main">;</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="bound">parent_ptr_opt</span> <span class="keyword1">of</span>
            Some <span class="bound">parent_ptr</span> <span class="main">⇒</span> <span class="free">a_get_ancestors_si</span> <span class="bound">parent_ptr</span>
          <span class="main">|</span> None <span class="main">⇒</span> return <span class="main">[]</span><span class="main">)</span>
        <span class="main">}</span>
      <span class="main">|</span> None <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
          Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
            <span class="bound">host</span> <span class="main">←</span> <span class="free">get_host</span> <span class="bound">shadow_root_ptr</span><span class="main">;</span>
            <span class="free">a_get_ancestors_si</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span>
          <span class="main">}</span> <span class="main">|</span>
          None <span class="main">⇒</span> return <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      return <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">#</span> <span class="bound">ancestors</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">a_get_ancestors_si_locs</span> <span class="main">=</span> <span class="free">get_parent_locs</span> <span class="main">∪</span> <span class="free">get_host_locs</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_root_node_si</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_root_node_si</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">ancestors</span> <span class="main">←</span> a_get_ancestors_si <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
      return <span class="main">(</span>last <span class="bound">ancestors</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">a_get_root_node_si_locs</span> <span class="main">=</span> a_get_ancestors_si_locs"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_ancestors_si_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_ancestors_si</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_ancestors_si_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_root_node_si_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_root_node_si</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_root_node_si_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_parent <span class="main">+</span>
  l_get_host <span class="main">+</span>
  l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_ancestors_si_defs <span class="main">+</span>
  l_get_root_node_si_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_ancestors_si_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_ancestors_si</span> <span class="main">=</span> a_get_ancestors_si"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_ancestors_si_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_ancestors_si_locs</span> <span class="main">=</span> a_get_ancestors_si_locs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_root_node_si_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_root_node_si</span> <span class="main">=</span> a_get_root_node_si"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_root_node_si_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_root_node_si_locs</span> <span class="main">=</span> a_get_root_node_si_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_ancestors_si_def <span class="main">=</span> a_get_ancestors_si.simps<span class="main">[</span><span class="operator">folded</span> get_ancestors_si_impl<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_ancestors_si_locs_def <span class="main">=</span> a_get_ancestors_si_locs_def<span class="main">[</span><span class="operator">folded</span> get_ancestors_si_locs_impl<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_root_node_si_def <span class="main">=</span>
  a_get_root_node_si_def<span class="main">[</span><span class="operator">folded</span> get_root_node_si_impl get_ancestors_si_impl<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_root_node_si_locs_def <span class="main">=</span>
  a_get_root_node_si_locs_def<span class="main">[</span><span class="operator">folded</span> get_root_node_si_locs_impl get_ancestors_si_locs_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_ancestors_si</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ptr</span> <span class="bound">h</span> <span class="bound">h'</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟶</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> a_get_ancestors_si.fixp_induct<span class="main"><span class="main">[</span></span><span class="operator">folded</span> get_ancestors_si_impl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> admissible_dom_prog<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> get_parent_pure get_host_pure
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pure_returns_heap_eq pure_def
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_result_E
          <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pure_returns_heap_eq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> check_in_heap_pure<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> returns_result_eq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> get_parent_pure pure_returns_heap_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> get_host_pure pure_returns_heap_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> pure_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_root_node_si</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def bind_pure_I<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_ancestors_si</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def check_in_heap_ptr_in_heap <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_E
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_OK_returns_result_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_never_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ancestors</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_no_parent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_root_node_si</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> cast <span class="free">node_ptr</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check_in_heap_def get_root_node_si_def get_ancestors_si_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_parent_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_root_not_shadow_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_root_node_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">root</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">root</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">(</span>last <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">root</span> <span class="main">=</span> last <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ptr</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> get_ancestors_si_never_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">ptr</span></span><span class="main"><span class="main">]</span></span>
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_never_empty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">(</span>last <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">root</span> <span class="main">=</span> last <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> get_root_node_si <span class="main">=</span> <span class="quoted">a_get_root_node_si</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_root_node_si_locs <span class="main">=</span> <span class="quoted">a_get_root_node_si_locs</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_ancestors_si <span class="main">=</span> <span class="quoted">a_get_ancestors_si</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_ancestors_si_locs <span class="main">=</span> <span class="quoted">a_get_ancestors_si_locs</span>
  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">declare</span></span> a_get_ancestors_si.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_root_node_si<span class="main">?</span><span class="main">:</span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span>
  <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def get_root_node_si_locs_def get_ancestors_si_def
      get_ancestors_si_locs_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_is_l_get_ancestors <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_ancestors get_ancestors_si"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> l_get_ancestors_def
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_pure get_ancestors_si_ptr get_ancestors_si_ptr_in_heap
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_is_l_get_root_node <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_root_node get_root_node_si get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> get_root_node_si_no_parent
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_ancestors_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes_get_parent
  <span class="main">+</span> l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="main">+</span> l_set_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="main">+</span> l_set_disconnected_nodes_get_host
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_ancestors_si<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_ancestors_si_locs</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_parent_locs_def set_disconnected_nodes_locs_def
      set_disconnected_nodes_get_host get_ancestors_si_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_disconnected_nodes_get_ancestors_si <span class="main">=</span>
  l_set_disconnected_nodes_defs <span class="main">+</span>
  l_get_ancestors_si_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_disconnected_nodes_get_ancestors_si<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_disconnected_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_ancestors_si_locs</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes_get_ancestors_si<span class="main">?</span><span class="main">:</span>
  l_set_disconnected_nodes_get_ancestors_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">get_root_node_si</span>
  <span class="quoted">get_root_node_si_locs</span> <span class="quoted">DocumentClass.type_wf</span>

  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_ancestors_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_disconnected_nodes_get_ancestors_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_ancestors_si_is_l_set_disconnected_nodes_get_ancestors_si <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_ancestors_si set_disconnected_nodes_locs get_ancestors_si_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_ancestors_si_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_ancestors_si
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_attribute›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_attribute_is_l_get_attribute <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_attribute type_wf get_attribute get_attribute_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_attribute_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_get_attribute.get_attribute_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> i_get_attribute.get_attribute_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_attribute.get_attribute_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹to\_tree\_order›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_to_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="keyword2"><span class="keyword">defines</span></span>
  to_tree_order <span class="main">=</span> <span class="quoted"><span class="quoted">"l_to_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_to_tree_order get_child_nodes"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">declare</span></span> a_to_tree_order.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order<span class="main">?</span><span class="main">:</span> l_to_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">ShadowRootClass.known_ptr</span>
  <span class="quoted">ShadowRootClass.type_wf</span> <span class="quoted">Shadow_DOM.get_child_nodes</span> <span class="quoted">Shadow_DOM.get_child_nodes_locs</span> <span class="quoted">to_tree_order</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_to_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def to_tree_order_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_to_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹to\_tree\_order\_si›</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_to_tree_order_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_child_nodes_defs <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>dom_prog<span class="main">)</span> <span class="entity">a_to_tree_order_si</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_to_tree_order_si</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">children</span> <span class="main">←</span> <span class="free">get_child_nodes</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
      <span class="bound">shadow_root_part</span> <span class="main">←</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
        Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">shadow_root_opt</span> <span class="main">←</span> <span class="free">get_shadow_root</span> <span class="bound">element_ptr</span><span class="main">;</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="bound">shadow_root_opt</span> <span class="keyword1">of</span>
            Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> return <span class="main">[</span>cast <span class="bound">shadow_root_ptr</span><span class="main">]</span>
            <span class="main">|</span> None <span class="main">⇒</span> return <span class="main">[]</span><span class="main">)</span>
        <span class="main">}</span> <span class="main">|</span>
        None <span class="main">⇒</span> return <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">treeorders</span> <span class="main">←</span> map_M <span class="free">a_to_tree_order_si</span> <span class="main">(</span><span class="main">(</span>map <span class="main">(</span>cast<span class="main">)</span> <span class="bound">children</span><span class="main">)</span> <span class="main">@</span> <span class="bound">shadow_root_part</span><span class="main">)</span><span class="main">;</span>
      return <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">#</span> concat <span class="bound">treeorders</span><span class="main">)</span>
    <span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_to_tree_order_si_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">to_tree_order_si</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr list<span class="main">)</span> dom_prog"</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_to_tree_order_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> to_tree_order_si <span class="main">=</span> <span class="quoted"><span class="quoted">"a_to_tree_order_si"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">declare</span></span> a_to_tree_order_si.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>


<span class="keyword1"><span class="command">locale</span></span> l_to_tree_order_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_to_tree_order_si_defs <span class="main">+</span>
  l_to_tree_order_si<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_child_nodes <span class="main">+</span>
  l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> to_tree_order_si_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">to_tree_order_si</span> <span class="main">=</span> a_to_tree_order_si"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> to_tree_order_si_def <span class="main">=</span> a_to_tree_order_si.simps<span class="main">[</span><span class="operator">folded</span> to_tree_order_si_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_si_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">to_tree_order_si</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ptr</span> <span class="bound">h</span> <span class="bound">h'</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="free">to_tree_order_si</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="free">to_tree_order_si</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟶</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> a_to_tree_order_si.fixp_induct<span class="main"><span class="main">[</span></span><span class="operator">folded</span> to_tree_order_si_impl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> admissible_dom_prog<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">h</span><span class="main">.</span> pure <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_E is_OK_returns_result_E pure_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span> <span class="bound">h</span><span class="main">.</span> pure <span class="main">(</span>map_M <span class="skolem">f</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> map_M_pure_I<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pure_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_E is_OK_returns_result_E<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order_si<span class="main">?</span><span class="main">:</span> l_to_tree_order_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">to_tree_order_si</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_to_tree_order_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      to_tree_order_si_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_to_tree_order_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹first\_in\_tree\_order›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">to_tree_order</span> <span class="keyword2"><span class="keyword">defines</span></span>
  first_in_tree_order <span class="main">=</span> <span class="quoted"><span class="quoted">"l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_first_in_tree_order to_tree_order"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_first_in_tree_order<span class="main">?</span><span class="main">:</span> l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">to_tree_order</span> <span class="quoted">first_in_tree_order</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def first_in_tree_order_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_is_l_to_tree_order <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_to_tree_order to_tree_order"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹first\_in\_tree\_order›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_dummy <span class="keyword2"><span class="keyword">defines</span></span>
  first_in_tree_order_si <span class="main">=</span> <span class="quoted"><span class="quoted">"l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_first_in_tree_order to_tree_order_si"</span></span>
  <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_element\_by›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">to_tree_order</span> <span class="quoted">first_in_tree_order</span> <span class="quoted">get_attribute</span>
  <span class="quoted">get_attribute_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span>
    get_element_by_id <span class="main">=</span>
    <span class="quoted"><span class="quoted">"l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_element_by_id first_in_tree_order get_attribute"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    get_elements_by_class_name <span class="main">=</span>
    <span class="quoted"><span class="quoted">"l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_elements_by_class_name to_tree_order get_attribute"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    get_elements_by_tag_name <span class="main">=</span>
    <span class="quoted"><span class="quoted">"l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_elements_by_tag_name to_tree_order"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_element_by<span class="main">?</span><span class="main">:</span> l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">to_tree_order</span> <span class="quoted">first_in_tree_order</span>
  <span class="quoted">get_attribute</span> <span class="quoted">get_attribute_locs</span> <span class="quoted">get_element_by_id</span> <span class="quoted">get_elements_by_class_name</span>
  <span class="quoted">get_elements_by_tag_name</span> <span class="quoted">type_wf</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      get_element_by_id_def get_elements_by_class_name_def get_elements_by_tag_name_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> get_element_by_is_l_get_element_by <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_element_by get_element_by_id get_elements_by_tag_name to_tree_order"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_element_by_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_element_by_id_result_in_tree_order <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_element\_by\_si›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_dummy <span class="keyword2"><span class="keyword">defines</span></span>
  get_element_by_id_si <span class="main">=</span>
  <span class="quoted"><span class="quoted">"l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_element_by_id first_in_tree_order_si get_attribute"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  get_elements_by_class_name_si <span class="main">=</span>
  <span class="quoted"><span class="quoted">"l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_elements_by_class_name to_tree_order_si get_attribute"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  get_elements_by_tag_name_si <span class="main">=</span>
  <span class="quoted"><span class="quoted">"l_get_element_by<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_elements_by_tag_name to_tree_order_si"</span></span>
  <span class="keyword1"><span class="command">.</span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹find\_slot›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_parent_defs <span class="quoted"><span class="free">get_parent</span></span> <span class="quoted"><span class="free">get_parent_locs</span></span> <span class="main">+</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_get_mode_defs <span class="quoted"><span class="free">get_mode</span></span> <span class="quoted"><span class="free">get_mode_locs</span></span> <span class="main">+</span>
  l_get_attribute_defs <span class="quoted"><span class="free">get_attribute</span></span> <span class="quoted"><span class="free">get_attribute_locs</span></span> <span class="main">+</span>
  l_get_tag_name_defs <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_first_in_tree_order_defs <span class="quoted"><span class="free">first_in_tree_order</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_parent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_parent_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> shadow_root_mode<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_attribute</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_attribute_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">first_in_tree_order</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> prog<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> prog"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_find_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_find_slot</span> <span class="free"><span class="bound"><span class="entity">open_flag</span></span></span> <span class="free"><span class="bound"><span class="entity">slotable</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">parent_opt</span> <span class="main">←</span> <span class="free">get_parent</span> <span class="free"><span class="bound"><span class="entity">slotable</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="bound">parent_opt</span> <span class="keyword1">of</span>
        Some <span class="bound">parent</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> is_element_ptr_kind <span class="bound">parent</span>
          <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
            <span class="bound">shadow_root_ptr_opt</span> <span class="main">←</span> <span class="free">get_shadow_root</span> <span class="main">(</span>the <span class="main">(</span>cast <span class="bound">parent</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
            <span class="main">(</span><span class="keyword1">case</span> <span class="bound">shadow_root_ptr_opt</span> <span class="keyword1">of</span>
              Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
                <span class="bound">shadow_root_mode</span> <span class="main">←</span> <span class="free">get_mode</span> <span class="bound">shadow_root_ptr</span><span class="main">;</span>
                <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">open_flag</span></span></span> <span class="main">∧</span> <span class="bound">shadow_root_mode</span> <span class="main">≠</span> Open
                <span class="keyword1">then</span> return None
                <span class="keyword1">else</span> <span class="free">first_in_tree_order</span> <span class="main">(</span>cast <span class="bound">shadow_root_ptr</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="keyword1">if</span> is_element_ptr_kind <span class="bound">ptr</span>
                  <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
                    <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="main">(</span>the <span class="main">(</span>cast <span class="bound">ptr</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                    <span class="bound">name_attr</span> <span class="main">←</span> <span class="free">get_attribute</span> <span class="main">(</span>the <span class="main">(</span>cast <span class="bound">ptr</span><span class="main">)</span><span class="main">)</span> <span class="inner_quoted">''name''</span><span class="main">;</span>
                    <span class="bound">slotable_name_attr</span> <span class="main">←</span> <span class="main">(</span><span class="keyword1">if</span> is_element_ptr_kind <span class="free"><span class="bound"><span class="entity">slotable</span></span></span>
                                           <span class="keyword1">then</span> <span class="free">get_attribute</span> <span class="main">(</span>the <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">slotable</span></span></span><span class="main">)</span><span class="main">)</span> <span class="inner_quoted">''slot''</span>
                                           <span class="keyword1">else</span> return None<span class="main">)</span><span class="main">;</span>
                    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">tag</span> <span class="main">=</span> <span class="inner_quoted">''slot''</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">name_attr</span> <span class="main">=</span> <span class="bound">slotable_name_attr</span> <span class="main">∨</span>
                        <span class="main">(</span><span class="bound">name_attr</span> <span class="main">=</span> None <span class="main">∧</span> <span class="bound">slotable_name_attr</span> <span class="main">=</span> Some <span class="inner_quoted">''''</span><span class="main">)</span> <span class="main">∨</span>
                        <span class="main">(</span><span class="bound">name_attr</span> <span class="main">=</span> Some <span class="inner_quoted">''''</span> <span class="main">∧</span> <span class="bound">slotable_name_attr</span> <span class="main">=</span> None<span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="keyword1">then</span> return <span class="main">(</span>Some <span class="main">(</span>the <span class="main">(</span>cast <span class="bound">ptr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="keyword1">else</span> return None<span class="main">)</span><span class="main">}</span>
                  <span class="keyword1">else</span> return None<span class="main">)</span><span class="main">}</span>
              <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span>
          <span class="keyword1">else</span> return None
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_assigned_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_assigned_slot</span> <span class="main">=</span> a_find_slot True"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_mode</span> <span class="quoted">get_mode_locs</span> <span class="quoted">get_attribute</span> <span class="quoted">get_attribute_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">first_in_tree_order</span>
  <span class="keyword2"><span class="keyword">defines</span></span> find_slot <span class="main">=</span> <span class="quoted">a_find_slot</span>
    <span class="keyword2"><span class="keyword">and</span></span> assigned_slot <span class="main">=</span> <span class="quoted">a_assigned_slot</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_find_slot_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">find_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">assigned_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> dom_prog"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_find_slot_defs <span class="main">+</span>
  l_get_parent <span class="main">+</span>
  l_get_shadow_root <span class="main">+</span>
  l_get_mode <span class="main">+</span>
  l_get_attribute <span class="main">+</span>
  l_get_tag_name <span class="main">+</span>
  l_to_tree_order <span class="main">+</span>
  l_first_in_tree_order<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> find_slot_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_slot</span> <span class="main">=</span> a_find_slot"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assigned_slot_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">assigned_slot</span> <span class="main">=</span> a_assigned_slot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> find_slot_def <span class="main">=</span> find_slot_impl<span class="main">[</span><span class="operator">unfolded</span> a_find_slot_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> assigned_slot_def <span class="main">=</span> assigned_slot_impl<span class="main">[</span><span class="operator">unfolded</span> a_assigned_slot_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> find_slot_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">find_slot</span> <span class="free">open_flag</span> <span class="free">slotable</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">slot_opt</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">slotable</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_slot_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_parent_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> find_slot_slot_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">find_slot</span> <span class="free">open_flag</span> <span class="free">slotable</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">slot</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">slot</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_slot_def first_in_tree_order_def
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 map_filter_M_pure_E<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">slot</span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits list.splits
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_filter_M_pure bind_pure_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_tag_name_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_slot_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">find_slot</span> <span class="free">open_flag</span> <span class="free">slotable</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_slot_def first_in_tree_order_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I map_filter_M_pure
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits list.splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_find_slot<span class="main">?</span><span class="main">:</span> l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_mode</span> <span class="quoted">get_mode_locs</span> <span class="quoted">get_attribute</span> <span class="quoted">get_attribute_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">first_in_tree_order</span> <span class="quoted">find_slot</span> <span class="quoted">assigned_slot</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">to_tree_order</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_slot_def assigned_slot_def l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def
      l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_find_slot<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_find_slot <span class="main">=</span> l_find_slot_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> find_slot_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">find_slot</span> <span class="free">open_flag</span> <span class="free">slotable</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">slot_opt</span> <span class="main">⟹</span> <span class="free">slotable</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> find_slot_slot_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">find_slot</span> <span class="free">open_flag</span> <span class="free">slotable</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">slot</span> <span class="main">⟹</span> <span class="free">slot</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> find_slot_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">find_slot</span> <span class="free">open_flag</span> <span class="free">slotable</span><span class="main">)</span> <span class="free">h</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_slot_is_l_find_slot <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_find_slot find_slot"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_find_slot_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> find_slot_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> find_slot_slot_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_get_disconnected_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_nodes_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl get_disconnected_nodes_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> a_get_disconnected_nodes_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_ok CD.type_wf_impl ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_disconnected_nodes<span class="main">?</span><span class="main">:</span> l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_nodes_is_l_get_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_disconnected_nodes type_wf get_disconnected_nodes get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_disconnected_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_get_disconnected_nodes.get_disconnected_nodes_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_disconnected_nodes.get_disconnected_nodes_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_child_nodes_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_disconnected_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_child_nodes_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes_locs_def CD.set_child_nodes_locs_def
      CD.get_disconnected_nodes_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_child_nodes_get_disconnected_nodes<span class="main">?</span><span class="main">:</span> l_set_child_nodes_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span>
  <span class="quoted">Core_DOM_Functions.set_child_nodes</span> <span class="quoted">Core_DOM_Functions.set_child_nodes_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_child_nodes_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_child_nodes_get_disconnected_nodes_is_l_set_child_nodes_get_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_child_nodes_get_disconnected_nodes type_wf set_child_nodes set_child_nodes_locs
    get_disconnected_nodes get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_is_l_set_child_nodes get_disconnected_nodes_is_l_get_disconnected_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_child_nodes_get_disconnected_nodes_def
      l_set_child_nodes_get_disconnected_nodes_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_child_nodes_get_disconnected_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_disconnected_nodes_l_set_disconnected_nodes_get_disconnected_nodes
  <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_disconnected_nodes ShadowRootClass.type_wf get_disconnected_nodes
    get_disconnected_nodes_locs set_disconnected_nodes set_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_disconnected_nodes_def
      l_set_disconnected_nodes_get_disconnected_nodes_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_set_disconnected_nodes_get_disconnected_nodes.set_disconnected_nodes_get_disconnected_nodes
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> i_set_disconnected_nodes_get_disconnected_nodes.set_disconnected_nodes_get_disconnected_nodes_different_pointers
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹delete\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_nodes_delete_shadow_root<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_disconnected_nodes_locs_def delete_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_delete_shadow_root_get_disconnected_nodes <span class="main">=</span> l_get_disconnected_nodes_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_nodes_delete_shadow_root<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> l_delete_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l_delete_shadow_root_get_disconnected_nodes_get_disconnected_nodes_locs <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_delete_shadow_root_get_disconnected_nodes get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_delete_shadow_root_get_disconnected_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_delete_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_disconnected_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_locs_def CD.get_disconnected_nodes_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_shadow_root_get_disconnected_nodes<span class="main">?</span><span class="main">:</span>
  l_set_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_shadow_root_get_disconnected_nodes <span class="main">=</span>
  l_set_shadow_root_defs <span class="main">+</span>
  l_get_disconnected_nodes_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_shadow_root_get_disconnected_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_shadow_root_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_shadow_root_get_disconnected_nodes_is_l_set_shadow_root_get_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_shadow_root_get_disconnected_nodes set_shadow_root_locs get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_is_l_set_shadow_root get_disconnected_nodes_is_l_get_disconnected_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_shadow_root_get_disconnected_nodes_def <span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_shadow_root_get_disconnected_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹set\_mode›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_mode<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_disconnected_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_locs_def
      CD.get_disconnected_nodes_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_get_disconnected_nodes_locs_def<span class="main"><span class="main">]</span></span>
      all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_mode_get_disconnected_nodes<span class="main">?</span><span class="main">:</span> l_set_mode_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_mode_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_set_mode_get_disconnected_nodes <span class="main">=</span> l_set_mode <span class="main">+</span> l_get_disconnected_nodes <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_mode_get_disconnected_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_mode_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_mode_get_disconnected_nodes_is_l_set_mode_get_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_mode_get_disconnected_nodes type_wf set_mode set_mode_locs get_disconnected_nodes
                                         get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_is_l_set_mode get_disconnected_nodes_is_l_get_disconnected_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_mode_get_disconnected_nodes_def
      l_set_mode_get_disconnected_nodes_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_mode_get_disconnected_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹new\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_nodes_new_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_disconnected_nodes_locs_def new_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_new_shadow_root_get_disconnected_nodes<span class="main">?</span><span class="main">:</span>
  l_new_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_new_shadow_root_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_new_shadow_root_get_disconnected_nodes <span class="main">=</span> l_get_disconnected_nodes_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_nodes_new_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_shadow_root_get_disconnected_nodes_is_l_new_shadow_root_get_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_new_shadow_root_get_disconnected_nodes get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_new_shadow_root_get_disconnected_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_new_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹remove\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_child_nodes_defs <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_set_shadow_root_defs <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="main">+</span>
  l_get_disconnected_nodes_defs <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_remove_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_remove_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">shadow_root_ptr_opt</span> <span class="main">←</span> <span class="free">get_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="bound">shadow_root_ptr_opt</span> <span class="keyword1">of</span>
      Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">children</span> <span class="main">←</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">shadow_root_ptr</span><span class="main">)</span><span class="main">;</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="bound">children</span> <span class="main">=</span> <span class="main">[]</span>
        <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="free">set_shadow_root</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> None<span class="main">;</span>
          delete_M <span class="bound">shadow_root_ptr</span>
        <span class="main">}</span> <span class="keyword1">else</span> <span class="keyword1">do</span> <span class="main">{</span>
          error HierarchyRequestError
        <span class="main">}</span><span class="main">)</span>
      <span class="main">}</span> <span class="main">|</span>
      None <span class="main">⇒</span> error HierarchyRequestError<span class="main">)</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_remove_shadow_root_locs</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_,</span> unit<span class="main">)</span> dom_prog<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_remove_shadow_root_locs</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main">≡</span>
      <span class="free">set_shadow_root_locs</span> <span class="free"><span class="bound"><span class="entity">element_ptr</span></span></span> <span class="main">∪</span> <span class="main">{</span>delete_M <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> remove_shadow_root <span class="main">=</span> <span class="quoted"><span class="quoted">"a_remove_shadow_root"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> remove_shadow_root_locs <span class="main">=</span> <span class="quoted">a_remove_shadow_root_locs</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">remove_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">remove_shadow_root_locs</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_,</span> unit<span class="main">)</span> dom_prog<span class="main">)</span> set"</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_remove_shadow_root_defs <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_set_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_child_nodes <span class="main">+</span>
  l_get_disconnected_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> remove_shadow_root_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">remove_shadow_root</span> <span class="main">=</span> a_remove_shadow_root"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> remove_shadow_root_locs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">remove_shadow_root_locs</span> <span class="main">=</span> a_remove_shadow_root_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> remove_shadow_root_def <span class="main">=</span>
  remove_shadow_root_impl<span class="main">[</span><span class="operator">unfolded</span> remove_shadow_root_def a_remove_shadow_root_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> remove_shadow_root_locs_def <span class="main">=</span>
  remove_shadow_root_locs_impl<span class="main">[</span><span class="operator">unfolded</span> remove_shadow_root_locs_def a_remove_shadow_root_locs_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_shadow_root_writes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">remove_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="main">(</span>the <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">remove_shadow_root</span> <span class="free">element_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove_shadow_root_locs_def remove_shadow_root_def all_args_def
      writes_union_right_I writes_union_left_I set_shadow_root_writes
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> writes_bind writes_bind_pure<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_shadow_root_pure<span class="main"><span class="main">]</span></span>
      writes_bind_pure<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_child_nodes_pure<span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> writes_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_shadow_root_writes<span class="main"><span class="main">]</span></span> writes_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> writes_singleton2<span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span>  writes_union_left_I<span class="main">[</span><span class="operator">OF</span> set_shadow_root_writes<span class="main">]</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> insert_is_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> writes_union_right_I<span class="main">[</span><span class="operator">OF</span> writes_singleton<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> insert_is_Un writes_singleton2 writes_union_left_I<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_shadow_root<span class="main">?</span><span class="main">:</span> l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">remove_shadow_root</span> <span class="quoted">remove_shadow_root_locs</span>
  <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      remove_shadow_root_def remove_shadow_root_locs_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_child\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remove_shadow_root_get_child_nodes_different_pointers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> cast <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">remove_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def get_child_nodes_locs_def CD.get_child_nodes_locs_def
      remove_shadow_root_locs_def set_shadow_root_locs_def
      delete_shadow_root_get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>
      delete_shadow_root_get_M<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub> delete_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      delete_shadow_root_get_M<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
      element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">shadow_root_opt_update</span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_shadow_root_ptr_kind_obtains
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_document_ptr_kind_obtains is_shadow_root_ptr_kind_obtains
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root_get_child_nodes <span class="main">=</span> l_get_child_nodes_defs <span class="main">+</span> l_remove_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> remove_shadow_root_get_child_nodes_different_pointers<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> cast <span class="free">shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">∈</span> <span class="free">remove_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="free">shadow_root_ptr</span> <span class="main">⟹</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">get_child_nodes_locs</span> <span class="free">ptr</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_shadow_root_get_child_nodes<span class="main">?</span><span class="main">:</span> l_remove_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">Core_DOM_Functions.get_child_nodes</span> <span class="quoted">Core_DOM_Functions.get_child_nodes_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">remove_shadow_root</span> <span class="quoted">remove_shadow_root_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_remove_shadow_root_get_child_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_shadow_root_get_child_nodes_is_l_remove_shadow_root_get_child_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_remove_shadow_root_get_child_nodes get_child_nodes_locs remove_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_shadow_root_get_child_nodes_def <span class="dynamic"><span class="dynamic">instances</span></span> <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> remove_shadow_root_get_child_nodes_different_pointers <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_tag\_name›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remove_shadow_root_get_tag_name<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">remove_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def remove_shadow_root_locs_def set_shadow_root_locs_def
      CD.get_tag_name_locs_def delete_shadow_root_get_M<span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub>
      element_put_get_preserved<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> setter<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">shadow_root_opt_update</span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root_get_tag_name <span class="main">=</span> l_get_tag_name_defs <span class="main">+</span> l_remove_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> remove_shadow_root_get_tag_name<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">remove_shadow_root_locs</span> <span class="free">element_ptr</span> <span class="free">shadow_root_ptr</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
    <span class="free">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_shadow_root_get_tag_name<span class="main">?</span><span class="main">:</span> l_remove_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">remove_shadow_root</span> <span class="quoted">remove_shadow_root_locs</span> <span class="quoted">known_ptr</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_remove_shadow_root_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_shadow_root_get_tag_name_is_l_remove_shadow_root_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_remove_shadow_root_get_tag_name get_tag_name_locs remove_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_shadow_root_get_tag_name_def <span class="dynamic"><span class="dynamic">instances</span></span> <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> remove_shadow_root_get_tag_name <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_owner\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_host_defs <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="main">+</span>
  CD<span class="main">:</span> l_get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted"><span class="free">get_root_node</span></span> <span class="quoted"><span class="free">get_root_node_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_root_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> unit <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">host</span> <span class="main">←</span> <span class="free">get_host</span> <span class="free"><span class="bound"><span class="entity">shadow_root_ptr</span></span></span><span class="main">;</span>
      CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span> <span class="main">()</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_owner_document_tups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">⇒</span> unit
  <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> dom_prog<span class="main">)</span><span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_owner_document_tups</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>is_shadow_root_ptr<span class="main">,</span> a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_owner_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_owner_document</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> invoke <span class="main">(</span>CD.a_get_owner_document_tups <span class="main">@</span> a_get_owner_document_tups<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">()</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> get_owner_document_tups <span class="main">=</span> <span class="quoted">a_get_owner_document_tups</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_owner_document <span class="main">=</span> <span class="quoted">a_get_owner_document</span>
    <span class="keyword2"><span class="keyword">and</span></span> get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">=</span> <span class="quoted">a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_owner_document_tups<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
      <span class="quoted"><span class="quoted">"l_get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_owner_document_tups
        get_root_node_si get_disconnected_nodes"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">=</span>
      <span class="quoted"><span class="quoted">"l_get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>
        get_root_node_si get_disconnected_nodes"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span> <span class="main">+</span>
  l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted"><span class="free">get_root_node_si</span></span> <span class="quoted"><span class="free">get_root_node_si_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="main">+</span>
  l_get_owner_document_defs <span class="quoted"><span class="free">get_owner_document</span></span> <span class="main">+</span>
  l_get_host <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="main">+</span>
  CD<span class="main">:</span> l_get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">get_parent</span></span> <span class="quoted"><span class="free">get_parent_locs</span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">get_root_node_si</span></span> <span class="quoted"><span class="free">get_root_node_si_locs</span></span> <span class="quoted"><span class="free">get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_parent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_parent_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node_si</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node_si_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_owner_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> a_known_ptr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_owner_document_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">get_owner_document</span> <span class="main">=</span> a_get_owner_document"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> known_ptr_def <span class="main">=</span> known_ptr_impl<span class="main">[</span><span class="operator">unfolded</span> a_known_ptr_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_owner_document_def <span class="main">=</span> a_get_owner_document_def<span class="main">[</span><span class="operator">folded</span> get_owner_document_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_owner_document</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">shadow_root_ptr</span><span class="main">.</span> pure <span class="main">(</span>a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">shadow_root_ptr</span> <span class="main">()</span><span class="main">)</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I filter_M_pure_I
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I filter_M_pure_I
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_owner_document_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> CD.get_owner_document_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_get_owner_document_tups_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_owner_document</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_owner_document_def invoke_ptr_in_heap <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_OK_returns_heap_I<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_owner_document<span class="main">?</span><span class="main">:</span> l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.known_ptr</span>
  <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">type_wf</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span> <span class="quoted">CD.a_get_owner_document</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="quoted">get_owner_document</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">instances</span></span> l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      l_get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_owner_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      get_owner_document_def Core_DOM_Functions.get_owner_document_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_is_l_get_owner_document <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_owner_document get_owner_document"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_owner_document_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_owner_document_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>




<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹remove\_child›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">set_child_nodes</span>
  <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_owner_document</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> remove <span class="main">=</span> <span class="quoted"><span class="quoted">"l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_remove get_child_nodes set_child_nodes get_parent
    get_owner_document get_disconnected_nodes set_disconnected_nodes"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> remove_child <span class="main">=</span> <span class="quoted"><span class="quoted">"l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_remove_child get_child_nodes set_child_nodes
    get_owner_document get_disconnected_nodes set_disconnected_nodes"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> remove_child_locs <span class="main">=</span> <span class="quoted"><span class="quoted">"l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_remove_child_locs set_child_nodes_locs
    set_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_child<span class="main">?</span><span class="main">:</span> l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">Shadow_DOM.get_child_nodes</span>
  <span class="quoted">Shadow_DOM.get_child_nodes_locs</span> <span class="quoted">Shadow_DOM.set_child_nodes</span> <span class="quoted">Shadow_DOM.set_child_nodes_locs</span>
  <span class="quoted">Shadow_DOM.get_parent</span> <span class="quoted">Shadow_DOM.get_parent_locs</span> <span class="quoted">Shadow_DOM.get_owner_document</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_disconnected_nodes</span>
  <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">remove</span> <span class="quoted">ShadowRootClass.type_wf</span>
  <span class="quoted">ShadowRootClass.known_ptr</span> <span class="quoted">ShadowRootClass.known_ptrs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def remove_child_def
      remove_child_locs_def remove_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_disconnected\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_disconnected_nodes_defs <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_get_disconnected_document</span> <span class="free"><span class="bound"><span class="entity">node_ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      check_in_heap <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">node_ptr</span></span></span><span class="main">)</span><span class="main">;</span>
      <span class="bound">ptrs</span> <span class="main">←</span> document_ptr_kinds_M<span class="main">;</span>
      <span class="bound">candidates</span> <span class="main">←</span> filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">disconnected_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">;</span>
        return <span class="main">(</span><span class="free"><span class="bound"><span class="entity">node_ptr</span></span></span> <span class="main">∈</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span>
      <span class="main">}</span><span class="main">)</span> <span class="bound">ptrs</span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="bound">candidates</span> <span class="keyword1">of</span>
        Cons <span class="bound">document_ptr</span> <span class="main">[]</span> <span class="main">⇒</span> return <span class="bound">document_ptr</span> <span class="main">|</span>
        <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> error HierarchyRequestError
      <span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">a_get_disconnected_document_locs</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">⋃</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="free">get_disconnected_nodes_locs</span> <span class="bound">document_ptr</span><span class="main">)</span> <span class="main">∪</span>
  <span class="main">(</span><span class="main">⋃</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">{</span>preserved <span class="main">(</span>get_M<span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub> <span class="bound">ptr</span> RObject.nothing<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_disconnected_document_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_::</span>linorder<span class="main">)</span> document_ptr<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_disconnected_document_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">+</span>
  l_get_disconnected_document_defs <span class="main">+</span>
  l_get_disconnected_nodes <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_document_impl<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">get_disconnected_document</span> <span class="main">=</span> a_get_disconnected_document"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_document_locs_impl<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">get_disconnected_document_locs</span> <span class="main">=</span> a_get_disconnected_document_locs"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> get_disconnected_document_def <span class="main">=</span>
  get_disconnected_document_impl<span class="main">[</span><span class="operator">unfolded</span> a_get_disconnected_document_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> get_disconnected_document_locs_def <span class="main">=</span>
  get_disconnected_document_locs_impl<span class="main">[</span><span class="operator">unfolded</span> a_get_disconnected_document_locs_def<span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_document_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_pure
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_disconnected_document_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I filter_M_pure_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_document_ptr_in_heap <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_document_def is_OK_returns_result_I check_in_heap_ptr_in_heap
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bind_returns_heap_E get_disconnected_document_pure
      node_ptr_kinds_commutes pure_pure<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_document_disconnected_document_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_document</span> <span class="free">child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disconnected_document</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">disconnected_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms get_disconnected_nodes_pure
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_disconnected_document_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_not_more_elements<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">disconnected_document</span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_pure_I bind_pure_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_document_reads<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reads <span class="free">get_disconnected_document_locs</span> <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads<span class="main">[</span><span class="operator">unfolded</span> reads_def<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_disconnected_document_def get_disconnected_document_locs_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reads_bind_pure reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> check_in_heap_reads<span class="main"><span class="main">]</span></span>
      reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> error_reads<span class="main"><span class="main">]</span></span>
      reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_disconnected_nodes_reads<span class="main"><span class="main">]</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> return_reads<span class="main"><span class="main">]</span></span>
      reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> document_ptr_kinds_M_reads<span class="main"><span class="main">]</span></span> filter_M_reads filter_M_pure_I
      bind_pure_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_disconnected_document <span class="main">=</span> l_get_disconnected_document_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_document_reads<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reads <span class="free">get_disconnected_document_locs</span> <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_document_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_document_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_disconnected_document_disconnected_document_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_document</span> <span class="free">child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disconnected_document</span> <span class="main">⟹</span>
    <span class="free">disconnected_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="keyword2"><span class="keyword">defines</span></span>
  get_disconnected_document <span class="main">=</span> <span class="quoted">a_get_disconnected_document</span> <span class="keyword2"><span class="keyword">and</span></span>
  get_disconnected_document_locs <span class="main">=</span> <span class="quoted">a_get_disconnected_document_locs</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_disconnected_document<span class="main">?</span><span class="main">:</span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">type_wf</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      get_disconnected_document_def get_disconnected_document_locs_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_document_is_l_get_disconnected_document <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_disconnected_document get_disconnected_document get_disconnected_document_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_disconnected_document_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_disconnected_document_ptr_in_heap get_disconnected_document_pure
    get_disconnected_document_disconnected_document_in_heap get_disconnected_document_reads
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_tag_name_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_disconnected_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_tag_name_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_disconnected_nodes_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_tag_name_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_set_tag_name_locs_def<span class="main"><span class="main">]</span></span>
      CD.get_disconnected_nodes_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_get_disconnected_nodes_locs_def<span class="main"><span class="main">]</span></span>
      all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_tag_name_get_disconnected_nodes<span class="main">?</span><span class="main">:</span> l_set_tag_name_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_tag_name</span> <span class="quoted">set_tag_name_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_tag_name_get_disconnected_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_tag_name_get_disconnected_nodes_is_l_set_tag_name_get_disconnected_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_tag_name_get_disconnected_nodes type_wf set_tag_name set_tag_name_locs
    get_disconnected_nodes get_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_is_l_set_tag_name get_disconnected_nodes_is_l_get_disconnected_nodes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_tag_name_get_disconnected_nodes_def
      l_set_tag_name_get_disconnected_nodes_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_tag_name_get_disconnected_nodes
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹adopt\_node›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_owner_document</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> adopt_node <span class="main">=</span> <span class="quoted">a_adopt_node</span>
    <span class="keyword2"><span class="keyword">and</span></span> adopt_node_locs <span class="main">=</span> <span class="quoted">a_adopt_node_locs</span>
  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> i_adopt_node<span class="main">?</span><span class="main">:</span> l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_owner_document</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">remove</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def adopt_node_def
      adopt_node_locs_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> adopt_node_is_l_adopt_node <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_adopt_node type_wf known_ptr known_ptrs get_parent
  adopt_node adopt_node_locs get_child_nodes get_owner_document"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node_def l_adopt_node_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_writes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_pointers_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_types_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_child_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_children_subset <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_adopt_node_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_child_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_set_disconnected_nodes_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> adopt_node_get_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">adopt_node_locs</span> <span class="free">parent</span> <span class="free">owner_document</span> <span class="free">document_ptr</span><span class="main">.</span>
    <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def all_args_def
      set_disconnected_nodes_get_shadow_root set_child_nodes_get_shadow_root<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_adopt_node_get_shadow_root <span class="main">=</span> l_adopt_node_defs <span class="main">+</span> l_get_shadow_root_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> adopt_node_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">adopt_node_locs</span> <span class="free">parent</span> <span class="free">owner_document</span> <span class="free">document_ptr</span><span class="main">.</span>
    <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_adopt_node_get_shadow_root<span class="main">?</span><span class="main">:</span> l_adopt_node_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span>
  <span class="quoted">Core_DOM_Functions.set_child_nodes</span> <span class="quoted">Core_DOM_Functions.set_child_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_owner_document</span>
  <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">known_ptrs</span> <span class="quoted">remove</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_adopt_node_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> adopt_node_get_shadow_root_is_l_adopt_node_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_adopt_node_get_shadow_root adopt_node_locs get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node_get_shadow_root_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_get_shadow_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹insert\_before›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_insert_before<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span>
  <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_owner_document</span>
  <span class="keyword2"><span class="keyword">defines</span></span>
    next_sibling <span class="main">=</span> <span class="quoted">a_next_sibling</span> <span class="keyword2"><span class="keyword">and</span></span>
    insert_node <span class="main">=</span> <span class="quoted">a_insert_node</span> <span class="keyword2"><span class="keyword">and</span></span>
    ensure_pre_insertion_validity <span class="main">=</span> <span class="quoted">a_ensure_pre_insertion_validity</span> <span class="keyword2"><span class="keyword">and</span></span>
    insert_before <span class="main">=</span> <span class="quoted">a_insert_before</span> <span class="keyword2"><span class="keyword">and</span></span>
    insert_before_locs <span class="main">=</span> <span class="quoted">a_insert_before_locs</span>
  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">global_interpretation</span></span> l_append_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">insert_before</span>
  <span class="keyword2"><span class="keyword">defines</span></span> append_child <span class="main">=</span> <span class="quoted"><span class="quoted">"l_append_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs.a_append_child insert_before"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_insert_before<span class="main">?</span><span class="main">:</span> l_insert_before<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span>
  <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_owner_document</span> <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">type_wf</span>
  <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_insert_before<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_insert_before<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def insert_before_def
      insert_before_locs_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_insert_before<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_append_child<span class="main">?</span><span class="main">:</span> l_append_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">append_child</span> <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_append_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span> append_child_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_append_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_assigned\_nodes›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">map_filter_M2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'heap</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'y</span> option<span class="main">)</span> prog<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'x</span> list
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'heap</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'y</span> list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">map_filter_M2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="main">=</span> return <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">map_filter_M2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">res</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span>
      <span class="bound">remainder</span> <span class="main">←</span> <span class="free">map_filter_M2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">;</span>
      return <span class="main">(</span><span class="main">(</span><span class="keyword1">case</span> <span class="bound">res</span> <span class="keyword1">of</span>  Some <span class="bound">r</span> <span class="main">⇒</span> <span class="main">[</span><span class="bound">r</span><span class="main">]</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main">[]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">remainder</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_filter_M2_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> pure <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span>map_filter_M2 <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_filter_pure_no_monad<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> pure <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> map_filter_M2 <span class="free">f</span> <span class="free">xs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> map the <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">f</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_filter_pure_foo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> pure <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> map_filter_M2 <span class="free">f</span> <span class="free">xs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">f</span> <span class="free">x</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> map_filter_M2_in_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> map_filter_M2 <span class="free">P</span> <span class="free">xs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> pure <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">P</span> <span class="free">a</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="main">)</span>


<span class="keyword1"><span class="command">locale</span></span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  l_get_tag_name_defs <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_get_root_node_defs <span class="quoted"><span class="free">get_root_node</span></span> <span class="quoted"><span class="free">get_root_node_locs</span></span> <span class="main">+</span>
  l_get_host_defs <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="main">+</span>
  l_get_child_nodes_defs <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  l_find_slot_defs <span class="quoted"><span class="free">find_slot</span></span> <span class="quoted"><span class="free">assigned_slot</span></span> <span class="main">+</span>
  l_remove_defs <span class="quoted"><span class="free">remove</span></span> <span class="main">+</span>
  l_insert_before_defs <span class="quoted"><span class="free">insert_before</span></span> <span class="quoted"><span class="free">insert_before_locs</span></span> <span class="main">+</span>
  l_append_child_defs <span class="quoted"><span class="free">append_child</span></span> <span class="main">+</span>
  l_remove_shadow_root_defs <span class="quoted"><span class="free">remove_shadow_root</span></span> <span class="quoted"><span class="free">remove_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">find_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">assigned_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">remove</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">insert_before</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr option <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">insert_before_locs</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_)</span> document_ptr <span class="main">⇒</span>
    <span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">append_child</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">remove_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">remove_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span>
    <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_assigned_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_assigned_nodes</span> <span class="free"><span class="bound"><span class="entity">slot</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">tag</span> <span class="main">≠</span> <span class="inner_quoted">''slot''</span>
      <span class="keyword1">then</span> error HierarchyRequestError
      <span class="keyword1">else</span> return <span class="main">()</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">root</span> <span class="main">←</span> <span class="free">get_root_node</span> <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1">if</span> is_shadow_root_ptr_kind <span class="bound">root</span>
      <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">host</span> <span class="main">←</span> <span class="free">get_host</span> <span class="main">(</span>the <span class="main">(</span>cast <span class="bound">root</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">children</span> <span class="main">←</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span><span class="main">;</span>
        filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">slotable</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">found_slot</span> <span class="main">←</span> <span class="free">find_slot</span> False <span class="bound">slotable</span><span class="main">;</span>
          return <span class="main">(</span><span class="bound">found_slot</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="bound">children</span><span class="main">}</span>
      <span class="keyword1">else</span> return <span class="main">[]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>dom_prog<span class="main">)</span> <span class="entity">a_assigned_nodes_flatten</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_assigned_nodes_flatten</span> <span class="free"><span class="bound"><span class="entity">slot</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">tag</span> <span class="main">≠</span> <span class="inner_quoted">''slot''</span>
      <span class="keyword1">then</span> error HierarchyRequestError
      <span class="keyword1">else</span> return <span class="main">()</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">root</span> <span class="main">←</span> <span class="free">get_root_node</span> <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> is_shadow_root_ptr_kind <span class="bound">root</span>
      <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">slotables</span> <span class="main">←</span> a_assigned_nodes <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">;</span>
        <span class="bound">slotables_or_child_nodes</span> <span class="main">←</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">slotables</span> <span class="main">=</span> <span class="main">[]</span>
        <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="free"><span class="bound"><span class="entity">slot</span></span></span><span class="main">)</span>
        <span class="main">}</span> <span class="keyword1">else</span> <span class="keyword1">do</span> <span class="main">{</span>
          return <span class="bound">slotables</span>
        <span class="main">}</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">list_of_lists</span> <span class="main">←</span> map_M <span class="main">(</span><span class="main">λ</span><span class="bound">node_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="main">(</span><span class="keyword1">case</span> cast <span class="bound">node_ptr</span> <span class="keyword1">of</span>
            Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
              <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="bound">element_ptr</span><span class="main">;</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="bound">tag</span> <span class="main">=</span> <span class="inner_quoted">''slot''</span>
              <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
                <span class="bound">root</span> <span class="main">←</span> <span class="free">get_root_node</span> <span class="main">(</span>cast <span class="bound">element_ptr</span><span class="main">)</span><span class="main">;</span>
                <span class="main">(</span><span class="keyword1">if</span> is_shadow_root_ptr_kind <span class="bound">root</span>
                <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
                  <span class="free">a_assigned_nodes_flatten</span> <span class="bound">element_ptr</span>
                <span class="main">}</span> <span class="keyword1">else</span> <span class="keyword1">do</span> <span class="main">{</span>
                  return <span class="main">[</span><span class="bound">node_ptr</span><span class="main">]</span>
                <span class="main">}</span><span class="main">)</span>
              <span class="main">}</span> <span class="keyword1">else</span> <span class="keyword1">do</span> <span class="main">{</span>
                return <span class="main">[</span><span class="bound">node_ptr</span><span class="main">]</span>
              <span class="main">}</span><span class="main">)</span>
            <span class="main">}</span>
            <span class="main">|</span> None <span class="main">⇒</span> return <span class="main">[</span><span class="bound">node_ptr</span><span class="main">]</span><span class="main">)</span>
        <span class="main">}</span><span class="main">)</span> <span class="bound">slotables_or_child_nodes</span><span class="main">;</span>
        return <span class="main">(</span>concat <span class="bound">list_of_lists</span><span class="main">)</span>
      <span class="main">}</span> <span class="keyword1">else</span> return <span class="main">[]</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_flatten_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_flatten_dom</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">tups</span> <span class="main">←</span> element_ptr_kinds_M <span class="main">⤜</span> map_filter_M2 <span class="main">(</span><span class="main">λ</span><span class="bound">element_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="bound">element_ptr</span><span class="main">;</span>
      <span class="bound">assigned_nodes</span> <span class="main">←</span> a_assigned_nodes <span class="bound">element_ptr</span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">tag</span> <span class="main">=</span> <span class="inner_quoted">''slot''</span> <span class="main">∧</span> <span class="bound">assigned_nodes</span> <span class="main">≠</span> <span class="main">[]</span>
       <span class="keyword1">then</span> return <span class="main">(</span>Some <span class="main">(</span><span class="bound">element_ptr</span><span class="main">,</span> <span class="bound">assigned_nodes</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> return None<span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">;</span>
    forall_M <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">slot</span><span class="main">,</span> <span class="bound">assigned_nodes</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">slot</span><span class="main">)</span> <span class="main">⤜</span> forall_M <span class="free">remove</span><span class="main">;</span>
      forall_M <span class="main">(</span><span class="free">append_child</span> <span class="main">(</span>cast <span class="bound">slot</span><span class="main">)</span><span class="main">)</span> <span class="bound">assigned_nodes</span>
    <span class="main">}</span><span class="main">)</span> <span class="bound">tups</span><span class="main">;</span>
    shadow_root_ptr_kinds_M <span class="main">⤜</span> forall_M <span class="main">(</span><span class="main">λ</span><span class="bound">shadow_root_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">host</span> <span class="main">←</span> <span class="free">get_host</span> <span class="bound">shadow_root_ptr</span><span class="main">;</span>
      <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span> <span class="main">⤜</span> forall_M <span class="free">remove</span><span class="main">;</span>
      <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">shadow_root_ptr</span><span class="main">)</span> <span class="main">⤜</span> forall_M <span class="main">(</span><span class="free">append_child</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="free">remove_shadow_root</span> <span class="bound">host</span>
    <span class="main">}</span><span class="main">)</span><span class="main">;</span>
    return <span class="main">()</span>
  <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">find_slot</span>
  <span class="quoted">assigned_slot</span> <span class="quoted">remove</span> <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">remove_shadow_root</span>
  <span class="quoted">remove_shadow_root_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> assigned_nodes <span class="main">=</span> <span class="quoted">a_assigned_nodes</span>
    <span class="keyword2"><span class="keyword">and</span></span> assigned_nodes_flatten <span class="main">=</span> <span class="quoted">a_assigned_nodes_flatten</span>
    <span class="keyword2"><span class="keyword">and</span></span> flatten_dom <span class="main">=</span> <span class="quoted">a_flatten_dom</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">declare</span></span> a_assigned_nodes_flatten.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_assigned_nodes_defs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">assigned_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">assigned_nodes_flatten</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">flatten_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_assigned_nodes_defs
  <span class="quoted"><span class="free">assigned_nodes</span></span> <span class="quoted"><span class="free">assigned_nodes_flatten</span></span> <span class="quoted"><span class="free">flatten_dom</span></span>
  <span class="main">+</span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">get_root_node</span></span>
  <span class="quoted"><span class="free">get_root_node_locs</span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">find_slot</span></span> <span class="quoted"><span class="free">assigned_slot</span></span> <span class="quoted"><span class="free">remove</span></span> <span class="quoted"><span class="free">insert_before</span></span>
  <span class="quoted"><span class="free">insert_before_locs</span></span> <span class="quoted"><span class="free">append_child</span></span> <span class="quoted"><span class="free">remove_shadow_root</span></span> <span class="quoted"><span class="free">remove_shadow_root_locs</span></span>
  <span class="main">+</span> l_get_shadow_root
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="main">+</span> l_set_shadow_root
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span>
  <span class="main">+</span> l_remove
  <span class="main">+</span> l_insert_before
  <span class="quoted"><span class="free">insert_before</span></span> <span class="quoted"><span class="free">insert_before_locs</span></span>
  <span class="main">+</span> l_find_slot
  <span class="quoted"><span class="free">find_slot</span></span> <span class="quoted"><span class="free">assigned_slot</span></span>
  <span class="main">+</span> l_get_tag_name
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="main">+</span> l_get_root_node
  <span class="quoted"><span class="free">get_root_node</span></span> <span class="quoted"><span class="free">get_root_node_locs</span></span> <span class="quoted"><span class="free">get_parent</span></span> <span class="quoted"><span class="free">get_parent_locs</span></span>
  <span class="main">+</span> l_get_host
  <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span>
  <span class="main">+</span> l_get_child_nodes
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
  <span class="main">+</span> l_to_tree_order
  <span class="quoted"><span class="free">to_tree_order</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">assigned_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">assigned_nodes_flatten</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">flatten_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_root_node_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">find_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">assigned_slot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">remove</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">insert_before</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr option <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">insert_before_locs</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_)</span> document_ptr <span class="main">⇒</span>
    <span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">append_child</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">remove_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">remove_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span>
    <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_parent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_parent_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">to_tree_order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> object_ptr list<span class="main">)</span> prog"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assigned_nodes_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">assigned_nodes</span> <span class="main">=</span> a_assigned_nodes"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> flatten_dom_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">flatten_dom</span> <span class="main">=</span> a_flatten_dom"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> assigned_nodes_def <span class="main">=</span> assigned_nodes_impl<span class="main">[</span><span class="operator">unfolded</span> a_assigned_nodes_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> flatten_dom_def <span class="main">=</span> flatten_dom_impl<span class="main">[</span><span class="operator">unfolded</span> a_flatten_dom_def<span class="main">,</span> <span class="operator">folded</span> assigned_nodes_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> assigned_nodes_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">assigned_nodes</span> <span class="free">slot</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigned_nodes_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I filter_M_pure_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assigned_nodes_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">assigned_nodes</span> <span class="free">slot</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">slot</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigned_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bind_is_OK_E is_OK_returns_result_I local.get_tag_name_ptr_in_heap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assigned_nodes_slot_is_slot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">assigned_nodes</span> <span class="free">slot</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">slot</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="inner_quoted">''slot''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigned_nodes_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_E <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assigned_nodes_different_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">assigned_nodes</span> <span class="free">slot</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">nodes</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">assigned_nodes</span> <span class="free">slot'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">nodes'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">slot</span> <span class="main">≠</span> <span class="free">slot'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">nodes</span> <span class="main">∩</span> set <span class="free">nodes'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="free">nodes</span> <span class="main">∩</span> set <span class="free">nodes'</span> <span class="main">≠</span> <span class="main">{}</span> "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">common_ptr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">common_ptr</span> <span class="main">∈</span> set <span class="free">nodes</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">common_ptr</span> <span class="main">∈</span> set <span class="free">nodes'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">find_slot</span> False <span class="skolem">common_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">slot</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">common_ptr</span> <span class="main">∈</span> set <span class="free">nodes</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigned_nodes_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_holds_for_result<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">common_ptr</span></span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">find_slot</span> False <span class="skolem">common_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">slot'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">common_ptr</span> <span class="main">∈</span> set <span class="free">nodes'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigned_nodes_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_holds_for_result<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">common_ptr</span></span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> option.inject returns_result_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_assigned_nodes<span class="main">?</span><span class="main">:</span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">assigned_nodes</span>
  <span class="quoted">assigned_nodes_flatten</span> <span class="quoted">flatten_dom</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">find_slot</span>
  <span class="quoted">assigned_slot</span> <span class="quoted">remove</span> <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">remove_shadow_root</span>
  <span class="quoted">remove_shadow_root_locs</span> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_shadow_root</span>
  <span class="quoted">set_shadow_root_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">to_tree_order</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">instances</span></span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      assigned_nodes_def flatten_dom_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_assigned_nodes <span class="main">=</span> l_assigned_nodes_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assigned_nodes_pure <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pure <span class="main">(</span><span class="free">assigned_nodes</span> <span class="free">slot</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assigned_nodes_ptr_in_heap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">assigned_nodes</span> <span class="free">slot</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">slot</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assigned_nodes_slot_is_slot<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">assigned_nodes</span> <span class="free">slot</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> get_tag_name <span class="free">slot</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="inner_quoted">''slot''</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assigned_nodes_different_ptr<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">assigned_nodes</span> <span class="free">slot</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">nodes</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">assigned_nodes</span> <span class="free">slot'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">nodes'</span> <span class="main">⟹</span>
  <span class="free">slot</span> <span class="main">≠</span> <span class="free">slot'</span> <span class="main">⟹</span> set <span class="free">nodes</span> <span class="main">∩</span> set <span class="free">nodes'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> assigned_nodes_is_l_assigned_nodes <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_assigned_nodes assigned_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_assigned_nodes_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> assigned_nodes_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> assigned_nodes_slot_is_slot <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> assigned_nodes_different_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_val›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_val<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_set_val<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">set_val</span></span> <span class="quoted"><span class="free">set_val_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>  <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="main">=</span> ShadowRootClass.type_wf"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_ok<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">character_data_ptr</span> <span class="main">|∈|</span> character_data_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
  <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">set_val</span> <span class="free">character_data_ptr</span> <span class="free">tag</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.set_val_ok CD.type_wf_impl ShadowRootClass.type_wf<span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub> local.type_wf_impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_writes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"writes <span class="main">(</span><span class="free">set_val_locs</span> <span class="free">character_data_ptr</span><span class="main">)</span> <span class="main">(</span><span class="free">set_val</span> <span class="free">character_data_ptr</span> <span class="free">tag</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.set_val_writes <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_pointers_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_val_locs</span> <span class="free">character_data_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms CD.set_val_pointers_preserved <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_typess_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">set_val_locs</span> <span class="free">character_data_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span> <span class="main">=</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> type_wf_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> type_wf_preserved<span class="main">[</span><span class="operator">OF</span> writes_singleton2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_args_def CD.set_val_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_set_val_locs_def<span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_val<span class="main">?</span><span class="main">:</span> l_set_val<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_val</span> <span class="quoted">set_val_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_val_def set_val_locs_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_val<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_is_l_set_val <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_set_val type_wf set_val set_val_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_val_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_val_ok set_val_writes set_val_pointers_preserved set_val_typess_preserved
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_val_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_val<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_val_get_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_val_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_val_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_set_val_locs_def<span class="main"><span class="main">]</span></span>
      get_shadow_root_locs_def all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_val_get_shadow_root <span class="main">=</span> l_set_val <span class="main">+</span> l_get_shadow_root <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_val_get_shadow_root<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_val_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_val_get_shadow_root<span class="main">?</span><span class="main">:</span> l_set_val_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="quoted">set_val</span> <span class="quoted">set_val_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_val_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def  <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> l_set_val<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_val_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_get_shadow_root_is_l_set_val_get_shadow_root <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_val_get_shadow_root type_wf set_val set_val_locs get_shadow_root
                                  get_shadow_root_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_val_is_l_set_val get_shadow_root_is_l_get_shadow_root
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_val_get_shadow_root_def l_set_val_get_shadow_root_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_val_get_shadow_root
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_tag\_type›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_val_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_val<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> set_val_get_tag_name<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_val_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.set_val_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_set_val_locs_def<span class="main"><span class="main">]</span></span>
      CD.get_tag_name_locs_impl<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CD.a_get_tag_name_locs_def<span class="main"><span class="main">]</span></span>
      all_args_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_set_val_get_tag_name <span class="main">=</span> l_set_val <span class="main">+</span> l_get_tag_name <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_val_get_tag_name<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">set_val_locs</span> <span class="free">ptr</span><span class="main">.</span> <span class="main">(</span><span class="free">h</span> <span class="main">⊢</span> <span class="bound">w</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">get_tag_name_locs</span> <span class="free">ptr'</span><span class="main">.</span> <span class="bound">r</span> <span class="free">h</span> <span class="free">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span>
  i_set_val_get_tag_name<span class="main">?</span><span class="main">:</span> l_set_val_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_val</span>
  <span class="quoted">set_val_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> l_set_val_get_tag_name<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_val_get_tag_name_is_l_set_val_get_tag_name <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_val_get_tag_name type_wf set_val set_val_locs get_tag_name get_tag_name_locs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_val_is_l_set_val get_tag_name_is_l_get_tag_name
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_val_get_tag_name_def l_set_val_get_tag_name_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> set_val_get_tag_name
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹create\_character\_data›</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_create_character_data<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_create_character_data<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> _ _ _ _ _ _ <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> _ <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="main">+</span>
  l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> a_known_ptr"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> create_character_data_document_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">create_character_data</span> <span class="free">document_ptr</span> <span class="free">text</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms CD.create_character_data_document_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> create_character_data_known_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_character_data</span> <span class="free">document_ptr</span> <span class="free">text</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_character_data_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="free">new_character_data_ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms CD.create_character_data_known_ptr
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> known_ptr_impl CD.known_ptr_impl ShadowRootClass.a_known_ptr_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_create_character_data <span class="main">=</span> l_create_character_data_defs

<span class="keyword1"><span class="command">interpretation</span></span> i_create_character_data<span class="main">?</span><span class="main">:</span> l_create_character_data<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">set_val</span> <span class="quoted">set_val_locs</span>
  <span class="quoted">create_character_data</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_create_character_data<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_create_character_data<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_create_character_data<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹create\_element›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_create_element<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  CD<span class="main">:</span> l_create_element<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">create_element</span></span>
  <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="main">+</span>
  l_known_ptr <span class="quoted"><span class="free">known_ptr</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_element</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> a_known_ptr"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> create_element_def <span class="main">=</span> CD.create_element_def

<span class="keyword1"><span class="command">lemma</span></span> create_element_document_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">create_element</span> <span class="free">document_ptr</span> <span class="free">tag</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.create_element_document_in_heap assms <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> create_element_known_ptr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_element</span> <span class="free">document_ptr</span> <span class="free">tag</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">new_element_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="free">new_element_ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_element_ptr <span class="free">new_element_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> create_element_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_is_element_ptr
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> known_ptr_impl known_ptr_defs DocumentClass.known_ptr_defs
        CharacterDataClass.known_ptr_defs ElementClass.known_ptr_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_create_element<span class="main">?</span><span class="main">:</span> l_create_element<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">set_tag_name</span>
  <span class="quoted">set_tag_name_locs</span> <span class="quoted">type_wf</span> <span class="quoted">create_element</span> <span class="quoted">known_ptr</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">DocumentClass.known_ptr</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_create_element<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_create_element<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_create_element<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A wellformed heap (Core DOM)›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹wellformed\_heap›</span></span>


<span class="keyword1"><span class="command">locale</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="main">=</span>
  CD<span class="main">:</span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_get_shadow_root_defs <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_get_tag_name_defs <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_host_shadow_root_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_host_shadow_root_rel</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>cast <span class="bound">x</span><span class="main">,</span> cast <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">host</span><span class="main">,</span> <span class="bound">shadow_root</span><span class="main">)</span><span class="main">.</span>
      <span class="bound">host</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∧</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="bound">shadow_root</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> a_host_shadow_root_rel_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> set <span class="main">(</span>concat <span class="main">(</span>map
  <span class="main">(</span><span class="main">λ</span><span class="bound">host</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
    Some <span class="bound">shadow_root</span> <span class="main">⇒</span> <span class="main">[</span><span class="main">(</span>cast <span class="bound">host</span><span class="main">,</span> cast <span class="bound">shadow_root</span><span class="main">)</span><span class="main">]</span> <span class="main">|</span>
    None <span class="main">⇒</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>sorted_list_of_fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_all_ptrs_in_heap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_all_ptrs_in_heap</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">host</span> <span class="bound">shadow_root_ptr</span><span class="main">.</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">shadow_root_ptr</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="bound">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_distinct_lists</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_distinct_lists</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> distinct <span class="main">(</span>concat <span class="main">(</span>
      map <span class="main">(</span><span class="main">λ</span><span class="bound">element_ptr</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">element_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
        Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> <span class="main">[</span><span class="bound">shadow_root_ptr</span><span class="main">]</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>
        <span class="main">|</span><span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> element_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>
    <span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_shadow_root_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a_shadow_root_valid</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">host</span> <span class="main">∈</span> fset<span class="main">(</span>element_ptr_kinds <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span><span class="main">.</span>
       <span class="main">|</span><span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span>
       <span class="main">|</span><span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="bound">shadow_root_ptr</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a_heap_is_wellformed</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⟷</span> CD.a_heap_is_wellformed <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∧</span>
      acyclic <span class="main">(</span>CD.a_parent_child_rel <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">∧</span>
      a_all_ptrs_in_heap <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∧</span>
      a_distinct_lists <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∧</span>
      a_shadow_root_valid <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> heap_is_wellformed <span class="main">=</span> <span class="quoted">a_heap_is_wellformed</span>
    <span class="keyword2"><span class="keyword">and</span></span> parent_child_rel <span class="main">=</span> <span class="quoted">CD.a_parent_child_rel</span>
    <span class="keyword2"><span class="keyword">and</span></span> host_shadow_root_rel <span class="main">=</span> <span class="quoted">a_host_shadow_root_rel</span>
    <span class="keyword2"><span class="keyword">and</span></span> all_ptrs_in_heap <span class="main">=</span> <span class="quoted">a_all_ptrs_in_heap</span>
    <span class="keyword2"><span class="keyword">and</span></span> distinct_lists <span class="main">=</span> <span class="quoted">a_distinct_lists</span>
    <span class="keyword2"><span class="keyword">and</span></span> shadow_root_valid <span class="main">=</span> <span class="quoted">a_shadow_root_valid</span>
    <span class="keyword2"><span class="keyword">and</span></span> heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> <span class="quoted">CD.a_heap_is_wellformed</span>
    <span class="keyword2"><span class="keyword">and</span></span> parent_child_rel<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> <span class="quoted">CD.a_parent_child_rel</span>
    <span class="keyword2"><span class="keyword">and</span></span> acyclic_heap<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> <span class="quoted">CD.a_acyclic_heap</span>
    <span class="keyword2"><span class="keyword">and</span></span> all_ptrs_in_heap<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> <span class="quoted">CD.a_all_ptrs_in_heap</span>
    <span class="keyword2"><span class="keyword">and</span></span> distinct_lists<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> <span class="quoted">CD.a_distinct_lists</span>
    <span class="keyword2"><span class="keyword">and</span></span> owner_document_valid<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span> <span class="quoted">CD.a_owner_document_valid</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">parent_child_rel</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def parent_child_rel_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_heap_is_wellformed <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_heap_is_wellformed type_wf known_ptr heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> parent_child_rel get_child_nodes
  get_disconnected_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_heap_is_wellformed_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_children_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_disc_nodes_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_one_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_one_disc_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_children_disc_nodes_different <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_disconnected_nodes_distinct <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_children_distinct <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_is_wellformed_children_disc_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_finite <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_acyclic <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_node_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_parent_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_child_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">locale</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_defs
  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="main">+</span> CD<span class="main">:</span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">parent_child_rel</span></span>
  <span class="main">+</span> l_heap_is_wellformed_defs
  <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span>
  <span class="main">+</span> l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">type_wf</span></span>
  <span class="main">+</span> l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_disconnected_document</span></span> <span class="quoted"><span class="free">get_disconnected_document_locs</span></span> <span class="quoted"><span class="free">type_wf</span></span>
  <span class="main">+</span> l_get_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> heap_is_wellformed_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="main">=</span> a_heap_is_wellformed"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> heap_is_wellformed_def <span class="main">=</span>
  heap_is_wellformed_impl<span class="main">[</span><span class="operator">unfolded</span> a_heap_is_wellformed_def<span class="main">,</span>
    <span class="operator">folded</span> CD.heap_is_wellformed_impl CD.parent_child_rel_impl<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> a_distinct_lists_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_shadow_root</span> <span class="bound">host</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
    Some <span class="bound">shadow_root_ptr</span> <span class="main">⇒</span> <span class="bound">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">|</span>
    None <span class="main">⇒</span> True<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_OK_returns_result_I local.get_shadow_root_ptr_in_heap notin_fset select_result_I2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_shadow_root_shadow_root_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def a_all_ptrs_in_heap_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">host</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms get_shadow_root_shadow_root_ptr_in_heap
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_host_def
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_holds_for_result
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_same_host<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">host'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">host</span> <span class="main">=</span> <span class="free">host'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">host</span> <span class="main">≠</span> <span class="free">host'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">host</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_OK_returns_result_I local.get_shadow_root_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">host'</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_OK_returns_result_I local.get_shadow_root_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def a_distinct_lists_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">host</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">host'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">host</span> <span class="main">≠</span> <span class="free">host'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shadow_root_host_dual<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">host</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_host_def
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> filter_M_holds_for_result
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> disc_doc_disc_node_dual<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_document</span> <span class="free">disc_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_doc</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">disc_nodes</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">disc_doc</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">disc_node</span> <span class="main">∈</span> set <span class="free">disc_nodes</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms get_disconnected_nodes_pure
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_disconnected_document_def bind_pure_I
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_holds_for_result
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_pure_I
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_valid_tag_name<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="free">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">host</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">tag</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">tag</span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">host'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">host'</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">host'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def a_shadow_root_valid_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_set_in get_host_ptr_in_heap local.get_shadow_root_ok
        returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">host</span> <span class="main">=</span> <span class="skolem">host'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> shadow_root_host_dual shadow_root_same_host<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">host'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">host'</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span><span class="main">;</span>
      <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types<span class="main">;</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> select_result_I2
        shadow_root_same_host<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> a_host_shadow_root_rel_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
      Some <span class="bound">shadow_root</span> <span class="main">⇒</span> <span class="main">{</span><span class="main">(</span>cast <span class="bound">host</span><span class="main">,</span> cast <span class="bound">shadow_root</span><span class="main">)</span><span class="main">}</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="bound">host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
      Some <span class="bound">shadow_root</span> <span class="main">⇒</span> <span class="main">{</span><span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">host</span><span class="main">,</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">shadow_root</span><span class="main">)</span><span class="main">}</span> <span class="main">|</span>
      None <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_children_in_heap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span> <span class="main">⟹</span> <span class="free">child</span> <span class="main">∈</span> set <span class="free">children</span> <span class="main">⟹</span>
  <span class="free">child</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_children_in_heap local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_disc_nodes_in_heap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span> <span class="main">⟹</span>
  <span class="free">node</span> <span class="main">∈</span> set <span class="free">disc_nodes</span> <span class="main">⟹</span> <span class="free">node</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_disc_nodes_in_heap local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_one_parent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span> <span class="main">⟹</span>
  <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children'</span> <span class="main">⟹</span> set <span class="free">children</span> <span class="main">∩</span> set <span class="free">children'</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">ptr</span> <span class="main">=</span> <span class="free">ptr'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_one_parent local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_one_disc_parent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span> <span class="main">⟹</span>
  <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes'</span> <span class="main">⟹</span> set <span class="free">disc_nodes</span> <span class="main">∩</span> set <span class="free">disc_nodes'</span> <span class="main">≠</span> <span class="main">{}</span>
  <span class="main">⟹</span> <span class="free">document_ptr</span> <span class="main">=</span> <span class="free">document_ptr'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_one_disc_parent local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_children_disc_nodes_different<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span> <span class="main">⟹</span>
  <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span> <span class="main">⟹</span> set <span class="free">children</span> <span class="main">∩</span> set <span class="free">disc_nodes</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_children_disc_nodes_different local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_disconnected_nodes_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span> <span class="main">⟹</span>
  distinct <span class="free">disc_nodes</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_disconnected_nodes_distinct local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_children_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span> <span class="main">⟹</span> distinct <span class="free">children</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_children_distinct local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_children_disc_nodes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span> <span class="main">⟹</span>
  <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">parent</span> <span class="main">∈</span> fset <span class="main">(</span>object_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">document_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
    <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_children_disc_nodes local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> parent_child_rel_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> parent_child_rel_acyclic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_acyclic heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> parent_child_rel_child_in_heap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">known_ptr</span> <span class="free">parent</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">parent</span><span class="main">,</span> <span class="free">child_ptr</span><span class="main">)</span> <span class="main">∈</span> <span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">child_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_child_in_heap local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_heap_is_wellformed<span class="main">?</span><span class="main">:</span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">heap_is_wellformed</span>
  <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def parent_child_rel_def heap_is_wellformed_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> heap_is_wellformed_is_l_heap_is_wellformed <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_heap_is_wellformed ShadowRootClass.type_wf ShadowRootClass.known_ptr
    Shadow_DOM.heap_is_wellformed Shadow_DOM.parent_child_rel Shadow_DOM.get_child_nodes
    get_disconnected_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_heap_is_wellformed_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_children_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_disc_nodes_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_one_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_one_disc_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_children_disc_nodes_different <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_disconnected_nodes_distinct <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_children_distinct <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_children_disc_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_finite <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> parent_child_rel_acyclic <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_node_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_parent_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> parent_child_rel_child_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_parent›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span> l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="quoted">parent_child_rel</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> i_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span> l_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="quoted">parent_child_rel</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> i_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_get_parent_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_parent_wf type_wf known_ptr
  known_ptrs heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> parent_child_rel get_child_nodes get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_wf_def l_get_parent_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.child_parent_dual <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_wellformed_induct <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.heap_wellformed_induct_rev <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_parent_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_disconnected\_nodes›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹set\_disconnected\_nodes›</span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_disconnected\_nodes›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span>
  l_set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_disconnected_nodes</span>
  <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">parent_child_rel</span> <span class="quoted">get_child_nodes</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> i_set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_set_disconnected_nodes_get_disconnected_nodes_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_disconnected_nodes_wf type_wf known_ptr heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
    parent_child_rel get_child_nodes get_disconnected_nodes get_disconnected_nodes_locs
    set_disconnected_nodes set_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_disconnected_nodes_wf_def
      l_set_disconnected_nodes_get_disconnected_nodes_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_set_disconnected_nodes_get_disconnected_nodes_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_from_disconnected_nodes_removes
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span>l_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptrs</span>
  <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">parent_child_rel</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_ancestors</span> <span class="quoted">get_ancestors_locs</span>
  <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_get_ancestors_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_ancestors_wf heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> parent_child_rel known_ptr known_ptrs type_wf
  get_ancestors get_ancestors_locs get_child_nodes get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_ancestors_wf_def l_get_ancestors_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_never_empty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_ptrs_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_remains_not_in_ancestors <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_also_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_obtains_children <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_parent_child_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_parent_child_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_get_root_node_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_root_node_wf heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> get_root_node type_wf known_ptr known_ptrs
    get_ancestors get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_wf_def l_get_root_node_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_root_node_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_root_node_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_root_node_root_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_ancestors_same_root_node <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_root_node_same_no_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="comment1">(* using i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_root_node_not_node_same apply blast *)</span>
  <span class="keyword1"><span class="command">using</span></span> i_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.get_root_node_parent_same <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹to\_tree\_order›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span> l_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">to_tree_order</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="quoted">parent_child_rel</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">declare</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_to_tree_order_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_to_tree_order_wf heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> parent_child_rel type_wf known_ptr known_ptrs
  to_tree_order get_parent get_child_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf_def l_to_tree_order_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_ptrs_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_parent_child_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_child2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_node_ptrs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_ptr_in_result <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_subset <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span> l_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptrs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">parent_child_rel</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="quoted">get_ancestors</span> <span class="quoted">get_ancestors_locs</span> <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span> <span class="quoted">to_tree_order</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> i_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_to_tree_order_wf_get_root_node_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_to_tree_order_wf_get_root_node_wf type_wf known_ptr known_ptrs to_tree_order get_root_node
    heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf_get_root_node_wf_def
      l_to_tree_order_wf_get_root_node_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_get_root_node <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> i_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.to_tree_order_same_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹remove\_child›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub><span class="main">:</span> l_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_parent</span>
  <span class="quoted">get_parent_locs</span> <span class="quoted">get_owner_document</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">remove</span> <span class="quoted">type_wf</span>
  <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">parent_child_rel</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">declare</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.l_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_is_l_remove_child_wf2 <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_remove_child_wf2 type_wf known_ptr
  known_ptrs remove_child heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> get_child_nodes remove"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_child_wf2_def l_remove_child_wf2_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_child_heap_is_wellformed_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_heap_is_wellformed_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_child_removes_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_child_removes_first_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_removes_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> i_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.remove_for_all_empty_children <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A wellformed heap›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_parent›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_parent_wf<span class="main">?</span><span class="main">:</span> l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span>
  <span class="quoted">get_disconnected_nodes</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="dynamic"><span class="dynamic">instances</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_parent_wf_is_l_get_parent_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_parent_wf ShadowRootClass.type_wf ShadowRootClass.known_ptr ShadowRootClass.known_ptrs
  heap_is_wellformed parent_child_rel Shadow_DOM.get_child_nodes Shadow_DOM.get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_wf_def l_get_parent_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> child_parent_dual <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> heap_wellformed_induct <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> heap_wellformed_induct_rev <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> parent_child_rel_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹remove\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_tag_name <span class="main">+</span>
  l_get_disconnected_nodes  <span class="main">+</span>
  l_set_shadow_root_get_tag_name <span class="main">+</span>
  l_get_child_nodes  <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_remove_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_delete_shadow_root_get_disconnected_nodes <span class="main">+</span>
  l_delete_shadow_root_get_child_nodes <span class="main">+</span>
  l_set_shadow_root_get_disconnected_nodes <span class="main">+</span>
  l_set_shadow_root_get_child_nodes <span class="main">+</span>
  l_delete_shadow_root_get_tag_name <span class="main">+</span>
  l_set_shadow_root_get_shadow_root <span class="main">+</span>
  l_delete_shadow_root_get_shadow_root <span class="main">+</span>
  l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remove_shadow_root_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">shadow_root_ptr</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">shadow_root_ptr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">set_shadow_root</span> <span class="free">ptr</span> None <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> delete_M <span class="skolem">shadow_root_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove_shadow_root_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_shadow_root_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_child_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_shadow_root_writes h2<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> set_shadow_root_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' delete_shadow_root_type_wf_preserved local.type_wf_impl
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_shadow_root_writes h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_shadow_root_pointers_preserved
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="free">h</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> object_ptr_kinds_eq_h known_ptrs_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">|⊆|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' delete_shadow_root_pointers
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">shadow_root_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' delete_shadow_root_pointers
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> node_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def delete_shadow_root_pointers<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def delete_shadow_root_pointers<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h'</span> <span class="main">|⊆|</span> shadow_root_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="skolem">shadow_root_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq2_h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">shadow_root_ptr</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        fset.map_comp local.get_shadow_root_shadow_root_ptr_in_heap object_ptr_kinds_eq_h
        shadow_root_ptr_kinds_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2 <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> known_ptrs_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads set_shadow_root_writes h2 set_shadow_root_get_disconnected_nodes
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads get_disconnected_nodes_delete_shadow_root<span class="main">[</span><span class="operator">OF</span> h'<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_shadow_root_writes h2 set_shadow_root_get_tag_name
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads get_tag_name_delete_shadow_root<span class="main">[</span><span class="operator">OF</span> h'<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="keyword1"><span class="command">have</span></span> children_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads set_shadow_root_writes h2 set_shadow_root_get_child_nodes
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="keyword1"><span class="command">have</span></span> children_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">shadow_root_ptr</span> <span class="main">⟹</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span>
      <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads h' get_child_nodes_delete_shadow_root
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">shadow_root_ptr</span> <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span>
    <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' delete<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_not_in_heap
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> get_shadow_root_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">shadow_root_opt</span> <span class="bound">ptr'</span><span class="main">.</span> <span class="free">ptr</span> <span class="main">≠</span> <span class="bound">ptr'</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span> <span class="main">=</span>
    <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_shadow_root_writes h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_shadow_root_get_shadow_root_different_pointers
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">have</span></span> get_shadow_root_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">shadow_root_opt</span> <span class="bound">ptr'</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span> <span class="main">=</span>
    <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads get_shadow_root_delete_shadow_root<span class="main">[</span><span class="operator">OF</span> h'<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> get_shadow_root_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span>
    <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h children_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">⊆</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span> children_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acyclic_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h disconnected_nodes_eq2_h document_ptr_kinds_eq_h
        CD.a_all_ptrs_in_heap_def object_ptr_kinds_eq_h node_ptr_kinds_def
        children_eq_h disconnected_nodes_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq_h2 children_eq_h2
        disconnected_nodes_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ptr</span> <span class="main">=</span> cast <span class="skolem">shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2 children_eq_h2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span>
        is_OK_returns_result_I local.get_child_nodes_ptr_in_heap<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> children_eq2_h2 fin_mono finite_set_in object_ptr_kinds_eq_h2
        subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h disconnected_nodes_eq2_h2
        document_ptr_kinds_eq_h document_ptr_kinds_eq_h2 local.get_disconnected_nodes_ok
        local.heap_is_wellformed_disc_nodes_in_heap node_ptr_kinds_eq_h node_ptr_kinds_eq_h2
        returns_result_select_result<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def object_ptr_kinds_eq_h document_ptr_kinds_eq_h
        children_eq2_h disconnected_nodes_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def document_ptr_kinds_eq_h2
        disconnected_nodes_eq2_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> cast <span class="skolem">shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> children_eq_h2 concat_map_all_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> children_eq2_h2 finite_fset fmember.rep_eq fset_mp
        object_ptr_kinds_eq_h2 set_sorted_list_of_set<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> cast <span class="skolem">shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">y</span> <span class="main">=</span> cast <span class="skolem">shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> children_eq_h2 distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> IntI children_eq2_h2 empty_iff finite_fset fmember.rep_eq fset_mp
        object_ptr_kinds_eq_h2 set_sorted_list_of_set<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">=</span> cast <span class="skolem">shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> children_eq2_h2 disconnected_nodes_eq_h2
        fset_mp is_OK_returns_result_E local.CD.distinct_lists_no_parent
        local.get_disconnected_nodes_ok object_ptr_kinds_eq_h2 select_result_I2<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def object_ptr_kinds_eq_h document_ptr_kinds_eq_h
        node_ptr_kinds_eq_h children_eq2_h disconnected_nodes_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def  document_ptr_kinds_eq_h2 node_ptr_kinds_eq_h2
        disconnected_nodes_eq2_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">node_ptr</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">node_ptr</span><span class="main">∈</span>fset <span class="main">(</span>node_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="bound">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span> <span class="main">∧</span>
      <span class="bound">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">parent_ptr</span><span class="main">.</span> <span class="bound">parent_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span> <span class="main">∧</span>
      <span class="bound">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">parent_ptr</span><span class="main">.</span> <span class="bound">parent_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span> <span class="main">⟶</span>
        <span class="skolem">node_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">parent_ptr</span><span class="main">.</span> <span class="bound">parent_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span> <span class="main">⟶</span>
      <span class="skolem">node_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">parent_ptr</span> <span class="main">=</span> cast <span class="skolem">shadow_root_ptr</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> children_eq_h
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> children_eq2_h2 object_ptr_kinds_eq_h2 h' delete_shadow_root_pointers
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fempty_iff finsert_iff funionE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="bound">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span> <span class="main">∧</span>
      <span class="skolem">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.heap_is_wellformed_def<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">⊆</span> a_host_shadow_root_rel <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">aa</span> <span class="main">=</span> <span class="free">ptr</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h2 local.get_shadow_root_ok
          local.type_wf_impl option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq
          returns_result_select_result set_shadow_root_get_shadow_root<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> get_shadow_root_eq_h
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> image_eqI is_OK_returns_result_E
          local.get_shadow_root_ok mem_Collect_eq prod.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>›</span></span>
          acyclic_subset order_refl sup_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h'</span> <span class="main">⊆</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h2 get_shadow_root_eq2_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">⊆</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span>
        <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> acyclic_subset sup_mono
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">host</span> <span class="main">=</span> <span class="free">ptr</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h2 local.type_wf_impl option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq
        set_shadow_root_get_shadow_root<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_eq_h
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def get_shadow_root_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_eq2_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">shadow_root_ptr</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> get_shadow_root_eq_h get_shadow_root_eq_h2 h2 local.shadow_root_same_host
        local.type_wf_impl option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> select_result_I2 set_shadow_root_get_shadow_root<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="free">ptr</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h2 is_OK_returns_result_I
        l_set_shadow_root_get_shadow_root.set_shadow_root_get_shadow_root
        l_set_shadow_root_get_shadow_root_axioms local.type_wf_impl option.discI
        returns_result_eq returns_result_select_result<span class="main">)</span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">y</span> <span class="main">=</span> <span class="free">ptr</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h2 is_OK_returns_result_I
        l_set_shadow_root_get_shadow_root.set_shadow_root_get_shadow_root
        l_set_shadow_root_get_shadow_root_axioms local.type_wf_impl option.discI
        returns_result_eq returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> get_shadow_root_eq_h local.get_shadow_root_ok
        local.shadow_root_same_host returns_result_select_result<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h2 get_shadow_root_eq2_h2<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_shadow_root_valid_def shadow_root_ptr_kinds_eq_h element_ptr_kinds_eq_h
        tag_name_eq2_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_eq2_h2 element_ptr_kinds_eq_h2 tag_name_eq2_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_eq_h get_shadow_root_eq_h2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">shadow_root_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">shadow_root_ptr</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> element_ptr_kinds_eq_h
        element_ptr_kinds_eq_h2 finite_set_in local.get_shadow_root_ok option.inject
        returns_result_select_result select_result_I2 shadow_root_ptr_kinds_commutes<span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_shadow_root_wf<span class="main">?</span><span class="main">:</span> l_remove_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span>
  <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">remove_shadow_root</span>
  <span class="quoted">remove_shadow_root_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_remove_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_root_node_wf<span class="main">?</span><span class="main">:</span> l_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptrs</span>
  <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_ancestors</span> <span class="quoted">get_ancestors_locs</span>
  <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms<span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_wf_is_l_get_ancestors_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_ancestors_wf heap_is_wellformed parent_child_rel known_ptr known_ptrs type_wf get_ancestors
  get_ancestors_locs get_child_nodes get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_ancestors_wf_def l_get_ancestors_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_never_empty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_reads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_ptrs_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_remains_not_in_ancestors <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_also_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_obtains_children <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_parent_child_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_parent_child_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_wf_is_l_get_root_node_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_root_node_wf heap_is_wellformed get_root_node type_wf known_ptr known_ptrs get_ancestors
    get_parent"</span></span>
  <span class="keyword1"><span class="command">using</span></span> known_ptrs_is_l_known_ptrs
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_wf_def l_get_root_node_wf_axioms_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_root_node_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_root_node_ptr_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_root_node_root_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_same_root_node <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> get_root_node_same_no_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="comment1">(* using get_root_node_not_node_same apply blast *)</span>
  <span class="keyword1"><span class="command">using</span></span> get_root_node_parent_same <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_parent\_get\_host›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_parent_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_parent_wf <span class="main">+</span>
  l_get_shadow_root <span class="main">+</span>
  l_get_host <span class="main">+</span>
  l_get_child_nodes
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> host_shadow_root_rel_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
    Some <span class="bound">shadow_root</span> <span class="main">⇒</span> <span class="main">{</span><span class="main">(</span>cast <span class="bound">host</span><span class="main">,</span> cast <span class="bound">shadow_root</span><span class="main">)</span><span class="main">}</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="bound">host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">of</span>
    Some <span class="bound">shadow_root</span> <span class="main">⇒</span> <span class="main">{</span><span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">host</span><span class="main">,</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">shadow_root</span><span class="main">)</span><span class="main">}</span> <span class="main">|</span>
    None <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> host_shadow_root_rel_shadow_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">shadow_root_option</span> <span class="main">⟹</span>
   <span class="free">shadow_root_option</span> <span class="main">=</span> Some <span class="free">shadow_root</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span>cast <span class="free">host</span><span class="main">,</span> cast <span class="free">shadow_root</span><span class="main">)</span> <span class="main">∈</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prodI is_OK_returns_result_I
      l_get_shadow_root.get_shadow_root_ptr_in_heap local.l_get_shadow_root_axioms
      mem_Collect_eq pair_imageI select_result_I2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> host_shadow_root_rel_host<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="free">shadow_root</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">host</span> <span class="main">⟹</span>
  <span class="main">(</span>cast <span class="free">host</span><span class="main">,</span> cast <span class="free">shadow_root</span><span class="main">)</span> <span class="main">∈</span> a_host_shadow_root_rel <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> shadow_root_host_dual
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong host_shadow_root_rel_shadow_root
      local.a_host_shadow_root_rel_def split_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> heap_wellformed_induct_si <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">parent</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">children</span> <span class="bound">child</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">⟹</span>
    <span class="bound">child</span> <span class="main">∈</span> set <span class="bound">children</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>cast <span class="bound">child</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">shadow_root</span> <span class="bound">host</span><span class="main">.</span> <span class="bound">parent</span> <span class="main">=</span> cast <span class="bound">host</span> <span class="main">⟹</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">shadow_root</span> <span class="main">⟹</span>  <span class="free">P</span> <span class="main">(</span>cast <span class="bound">shadow_root</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">parent</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">ptr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ptr</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> host_shadow_root_rel_finite
    <span class="keyword1"><span class="command">using</span></span> local.CD.parent_child_rel_finite local.CD.parent_child_rel_impl
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_acyclic_wf_converse local.CD.parent_child_rel_impl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">parent</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms host_shadow_root_rel_shadow_root local.CD.parent_child_rel_child
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> heap_wellformed_induct_rev_si <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">child</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">parent</span> <span class="bound">child_node</span><span class="main">.</span> <span class="bound">child</span> <span class="main">=</span> cast <span class="bound">child_node</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="bound">child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">parent</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">parent</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">host</span> <span class="bound">shadow_root</span><span class="main">.</span> <span class="bound">child</span> <span class="main">=</span> cast <span class="bound">shadow_root</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="bound">shadow_root</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">host</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">child</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">ptr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ptr</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> host_shadow_root_rel_finite
    <span class="keyword1"><span class="command">using</span></span> local.CD.parent_child_rel_finite local.CD.parent_child_rel_impl
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_acyclic_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">parent</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> parent_child_rel_parent host_shadow_root_rel_host
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_parent_get_host_wf<span class="main">?</span><span class="main">:</span> l_get_parent_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span>
  <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_parent_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">locale</span></span> l_get_parent_get_host_wf <span class="main">=</span>
  l_heap_is_wellformed_defs <span class="main">+</span>
  l_get_parent_defs <span class="main">+</span>
  l_get_shadow_root_defs <span class="main">+</span>
  l_get_host_defs <span class="main">+</span>
  l_get_child_nodes_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> heap_wellformed_induct_si <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">parent</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">children</span> <span class="bound">child</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">⟹</span> <span class="bound">child</span> <span class="main">∈</span> set <span class="bound">children</span>
      <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>cast <span class="bound">child</span><span class="main">)</span><span class="main">)</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">shadow_root</span> <span class="bound">host</span><span class="main">.</span> <span class="bound">parent</span> <span class="main">=</span> cast <span class="bound">host</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">shadow_root</span>
    <span class="main">⟹</span>  <span class="free">P</span> <span class="main">(</span>cast <span class="bound">shadow_root</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟹</span> <span class="free">P</span> <span class="bound">parent</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="free">ptr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> heap_wellformed_induct_rev_si <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">child</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">parent</span> <span class="bound">child_node</span><span class="main">.</span> <span class="bound">child</span> <span class="main">=</span> cast <span class="bound">child_node</span> <span class="main">⟹</span>
      <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="bound">child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">parent</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">parent</span><span class="main">)</span>
      <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">host</span> <span class="bound">shadow_root</span><span class="main">.</span> <span class="bound">child</span> <span class="main">=</span> cast <span class="bound">shadow_root</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="bound">shadow_root</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">host</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟹</span> <span class="free">P</span> <span class="bound">child</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="free">ptr</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l_get_parent_get_host_wf_is_get_parent_get_host_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_parent_get_host_wf heap_is_wellformed get_parent get_shadow_root get_host get_child_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_parent_get_host_wf_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> heap_wellformed_induct_si <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> heap_wellformed_induct_rev_si <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_host›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span> <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_host</span></span>
  <span class="quoted"><span class="free">get_host_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_get_host<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_ok <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_host</span> <span class="free">shadow_root_ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">host</span></span> <span class="keyword2"><span class="keyword">where</span></span> host<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">host</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> shadow_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> get_shadow_root_ok assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def a_shadow_root_valid_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> finite_set_in returns_result_select_result<span class="main">)</span>


  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">host_candidates</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    host_candidates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">element_ptr</span><span class="main">.</span> Heap_Error_Monad.bind <span class="main">(</span><span class="free">get_shadow_root</span> <span class="bound">element_ptr</span><span class="main">)</span>
      <span class="main">(</span><span class="main">λ</span><span class="bound">shadow_root_opt</span><span class="main">.</span> return <span class="main">(</span><span class="bound">shadow_root_opt</span> <span class="main">=</span> Some <span class="free">shadow_root_ptr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">host_candidates</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> is_OK_returns_result_E<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_ok assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_is_OK_I bind_pure_I bind_is_OK_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">host_candidates</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">host</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_M_ex1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> host<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bind_pure_returns_result_I2 bind_returns_result_E finite_set_in host
        local.get_shadow_root_ok local.get_shadow_root_pure local.shadow_root_same_host
        return_returns_result returns_result_eq shadow_root sorted_list_of_fset.rep_eq
        sorted_list_of_fset_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bind_pure_I bind_pure_returns_result_I2 host local.get_shadow_root_ok
        returns_result_eq shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> host_candidates host assms<span class="main">(</span>1<span class="main">)</span> get_shadow_root_ok
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_host_def known_ptrs_known_ptr
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I filter_M_pure_I filter_M_is_OK_I bind_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.inject returns_result_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_host_wf<span class="main">?</span><span class="main">:</span> l_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">type_wf</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span>
  <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> l_get_host_wf <span class="main">=</span> l_heap_is_wellformed_defs <span class="main">+</span> l_known_ptrs <span class="main">+</span> l_type_wf <span class="main">+</span> l_get_host_defs <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> get_host_ok<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">known_ptrs</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">shadow_root_ptr</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_host</span> <span class="free">shadow_root_ptr</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_host_wf_is_l_get_host_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_get_host_wf heap_is_wellformed known_ptr known_ptrs type_wf get_host"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_host_wf_def l_get_host_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node\_si›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_root_node_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_parent_wf <span class="main">+</span>
  l_get_parent_get_host_wf <span class="main">+</span>
  l_get_host_wf
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_ptr_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_root_node_si</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> get_root_node_si_def
  <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_ptr_in_heap
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_ancestors_si</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_rev_si<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">child</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> get_parent_parent_in_heap
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.get_parent_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> get_host_ok assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_OK_returns_result_I local.get_shadow_root_ptr_in_heap
        local.shadow_root_host_dual<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_remains_not_in_ancestors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">children</span> <span class="bound">children'</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>
        <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children'</span> <span class="main">⟹</span> set <span class="bound">children'</span> <span class="main">⊆</span> set <span class="bound">children</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">shadow_root_option</span> <span class="bound">shadow_root_option'</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_option</span> <span class="main">⟹</span>
        <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_option'</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">shadow_root_option</span> <span class="main">=</span> None
        <span class="keyword1">then</span> <span class="bound">shadow_root_option'</span> <span class="main">=</span> None <span class="keyword1">else</span> <span class="bound">shadow_root_option'</span> <span class="main">=</span> None <span class="main">∨</span>
          <span class="bound">shadow_root_option'</span> <span class="main">=</span> <span class="bound">shadow_root_option</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">node</span> <span class="main">∉</span> set <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> object_ptr_kinds_eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">node</span> <span class="main">∉</span> set <span class="free">ancestors'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ptr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ancestors</span></span> <span class="quoted"><span class="free">ancestors'</span></span>
      <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_rev_si<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">child</span><span class="main">)</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ancestors_remains</span></span> <span class="keyword2"><span class="keyword">where</span></span> ancestors_remains<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ancestors</span> <span class="main">=</span> <span class="skolem">child</span> <span class="main">#</span> <span class="skolem">ancestors_remains</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ancestors</span>›</span></span> get_ancestors_si_never_empty
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span>
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ancestors_remains'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ancestors_remains'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ancestors'</span> <span class="main">=</span> <span class="skolem">child</span> <span class="main">#</span> <span class="skolem">ancestors_remains'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ancestors'</span>›</span></span> get_ancestors_si_never_empty
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span>
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">child</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.get_ancestors_si_ptr_in_heap object_ptr_kinds_eq3 step.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">node</span> <span class="main">≠</span> <span class="skolem">child</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ancestors_remains step.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">parent</span><span class="main">.</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">parent</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="bound">parent</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">parent</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">parent</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">children'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        children'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">parent</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">children'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        p_in_children'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">children'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> get_parent_child_dual <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">children</span></span> <span class="keyword2"><span class="keyword">where</span></span> children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">parent</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">children</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> get_child_nodes_ok assms<span class="main">(</span>1<span class="main">)</span> get_child_nodes_ptr_in_heap object_ptr_kinds_eq children'
          known_ptrs
        <span class="keyword1"><span class="command">using</span></span>  type_wf type_wf'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">parent</span>›</span></span> get_parent_parent_in_heap is_OK_returns_result_E
            local.known_ptrs_known_ptr object_ptr_kinds_eq3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">children</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> children children' p_in_children'
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">parent</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> child_parent_dual assms<span class="main">(</span>1<span class="main">)</span> children known_ptrs  type_wf  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">host</span><span class="main">.</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">host</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">host</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">host</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="skolem">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">host</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.shadow_root_host_dual <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> element_ptr_kinds_commutes is_OK_returns_result_I local.get_shadow_root_ok
            local.get_shadow_root_ptr_in_heap node_ptr_kinds_commutes object_ptr_kinds_eq3
            option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_select_result type_wf<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="skolem">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">host</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_OK_returns_result_E known_ptrs local.get_host_ok
            local.get_shadow_root_shadow_root_ptr_in_heap local.shadow_root_host_dual
            local.shadow_root_same_host type_wf<span class="main">)</span>

    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">child</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span> step<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">node</span> <span class="main">≠</span> <span class="skolem">child</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.shadow_root_same_host list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
            local.l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms local.shadow_root_host_dual step.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
            step.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> type_wf<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">node_child</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span> step<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">node</span> <span class="main">≠</span> <span class="skolem">child</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"1"</span> option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.inject returns_result_eq step.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_ptrs_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ancestors</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ptr</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ancestors</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">x</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ancestors</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ptr'</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.hyps Cons.prems<span class="main">(</span>2<span class="main">)</span> get_ancestors_si_ptr_in_heap x
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ptr''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ptr''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">ptr''</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ancestors</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">x</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ancestors</span>›</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> False
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.hyps Cons.prems<span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_reads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reads <span class="free">get_ancestors_si_locs</span> <span class="main">(</span><span class="free">get_ancestors_si</span> <span class="free">node_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_rev_si<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">child</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Product_Type.unit_eq<span class="main">]</span><span class="main">]</span> get_parent_reads<span class="main">[</span><span class="operator">unfolded</span> reads_def<span class="main">]</span>
      get_host_reads<span class="main">[</span><span class="operator">unfolded</span> reads_def<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_locs_def get_parent_reads_pointers
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reads_bind_pure reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> check_in_heap_reads<span class="main"><span class="main">]</span></span>
        reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> return_reads<span class="main"><span class="main">]</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_parent_reads<span class="main"><span class="main">]</span></span>
        reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_child_nodes_reads<span class="main"><span class="main">]</span></span> reads_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_host_reads<span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ancestor</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ancestor</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestor_ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ancestor_ancestors</span> <span class="main">⊆</span> set <span class="free">ancestors</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ptr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ancestors</span></span>
    <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_rev_si<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">child</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">child</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_ptr_in_heap step<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(*  then have "h ⊢ check_in_heap child →<span class="hidden">⇩</span><sub>r</sub> ()"
    using returns_result_select_result by force *)</span>


  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tl_ancestors</span></span> <span class="keyword2"><span class="keyword">where</span></span> tl_ancestors<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ancestors</span> <span class="main">=</span> <span class="skolem">child</span> <span class="main">#</span> <span class="skolem">tl_ancestors</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">child</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">child</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹None <span class="main">=</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">child</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> empty_iff empty_set select_result_I2 set_ConsD
            step.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">shadow_root_child</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">shadow_root_child</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">child</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> shadow_root_ptr_casts_commute shadow_root_ptr_kinds_commutes<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">host</span></span> <span class="keyword2"><span class="keyword">where</span></span> host<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="skolem">shadow_root_child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">host</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> get_host_ok assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">shadow_root_child</span> <span class="main">|∈|</span> shadow_root_ptr_kinds <span class="free">h</span>›</span></span> is_OK_returns_result_E<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="main">(</span>cast <span class="skolem">host</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">tl_ancestors</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Some step<span class="main">(</span>3<span class="main">)</span> tl_ancestors None
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I
            <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> returns_result_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>2<span class="main">)</span> Some host step<span class="main">(</span>4<span class="main">)</span> tl_ancestors
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> dual_order.trans eq_iff returns_result_eq set_ConsD
            set_subset_Cons shadow_root_ptr_casts_commute step.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">child_node</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> s1 <span class="main">=</span> Some
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">parent_opt</span></span> <span class="keyword2"><span class="keyword">where</span></span> parent_opt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">parent_opt</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">child</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> Some<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        get_parent_ok<span class="main">[</span><span class="operator">OF</span> type_wf known_ptrs<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> is_OK_returns_result_E known_ptrs get_parent_ok
          l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms node_ptr_casts_commute node_ptr_kinds_commutes<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">parent_opt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ancestors</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">child</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span> s1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> returns_result_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span> step<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ancestors</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">child</span><span class="main">]</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> returns_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">parent</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">parent</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">tl_ancestors</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s1 tl_ancestors step<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">child</span></span><span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> returns_result_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Some.prems <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="skolem">parent</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">tl_ancestors</span>›</span></span>
            assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> eq_iff node_ptr_casts_commute order_trans s1 select_result_I2 set_ConsD
            set_subset_Cons step.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tl_ancestors<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_also_parent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">some_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">child</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="free">parent</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">child_ancestors</span></span> <span class="keyword2"><span class="keyword">where</span></span> child_ancestors<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="main">(</span>cast <span class="free">child</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">child_ancestors</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> get_ancestors_si_ok is_OK_returns_result_I known_ptrs
        local.get_parent_ptr_in_heap node_ptr_kinds_commutes returns_result_select_result
        type_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent</span> <span class="main">∈</span> set <span class="skolem">child_ancestors</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> returns_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
        get_ancestors_si_ptr<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms child_ancestors get_ancestors_si_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_also_host<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">some_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">shadow_root</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="free">shadow_root</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">host</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">host</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">child_ancestors</span></span> <span class="keyword2"><span class="keyword">where</span></span> child_ancestors<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="main">(</span>cast <span class="free">shadow_root</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">child_ancestors</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> get_ancestors_si_ok get_ancestors_si_ptrs_in_heap
        is_OK_returns_result_E known_ptrs type_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">host</span> <span class="main">∈</span> set <span class="skolem">child_ancestors</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> returns_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
        get_ancestors_si_ptr<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms child_ancestors get_ancestors_si_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_parent_child_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">ptr</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ptr</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_si<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ptr</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr</span> <span class="main">=</span> <span class="free">child</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> local.get_ancestors_si_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ptr_child</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ptr_child<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ptr</span><span class="main">,</span> <span class="skolem">ptr_child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ptr_child</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> converse_rtranclE<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ptr</span> <span class="main">≠</span> <span class="free">child</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ptr_child_node</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> ptr_child_ptr_child_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child</span> <span class="main">=</span> cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">ptr_child_node</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ptr_child node_ptr_casts_commute3 CD.parent_child_rel_node_ptr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">children</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">children</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ptr_child_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="skolem">children</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">children</span><span class="main">.</span> <span class="main">⟦</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span><span class="main">;</span> <span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="bound">children</span><span class="main">⟧</span>
                   <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_parent_in_heap ptr_child <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> local.get_child_nodes_ok local.known_ptrs_known_ptr
            CD.parent_child_rel_child ptr_child ptr_child_ptr_child_node
            returns_result_select_result <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 get_child_nodes_ok <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.known_ptrs_known_ptr returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">ptr_child_node</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ptr_child ptr_child_ptr_child_node <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">ptr_child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">ptr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> children ptr_child_node child_parent_dual
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_also_parent assms <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_ancestors_si_parent_child_host_shadow_root_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ancestors</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">ptr</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ptr</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_si<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ptr</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr</span> <span class="main">=</span> <span class="free">child</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> local.get_ancestors_si_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ptr_child</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ptr_child<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ptr</span><span class="main">,</span> <span class="skolem">ptr_child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">ptr_child</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> converse_rtranclE<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ptr</span> <span class="main">≠</span> <span class="free">child</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ptr</span><span class="main">,</span> <span class="skolem">ptr_child</span><span class="main">)</span> <span class="main">∈</span> <span class="free">parent_child_rel</span> <span class="free">h</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ptr_child_node</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> ptr_child_ptr_child_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child</span> <span class="main">=</span> cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">ptr_child_node</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ptr_child node_ptr_casts_commute3 CD.parent_child_rel_node_ptr
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">children</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">children</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ptr_child_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="skolem">children</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">children</span><span class="main">.</span> <span class="main">⟦</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span><span class="main">;</span> <span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="bound">children</span><span class="main">⟧</span>
                   <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_parent_in_heap True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> calculation local.CD.parent_child_rel_child
              local.get_child_nodes_ok local.known_ptrs_known_ptr ptr_child_ptr_child_node
              returns_result_select_result<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a1 get_child_nodes_ok <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.known_ptrs_known_ptr returns_result_select_result<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">ptr_child_node</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span>
          <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ptr_child True ptr_child_ptr_child_node <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">ptr_child_node</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">ptr_child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">ptr</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> children ptr_child_node child_parent_dual
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_also_parent assms <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">host</span></span> <span class="keyword2"><span class="keyword">where</span></span> host<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr</span> <span class="main">=</span> cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">host</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ptr_child
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">shadow_root</span></span> <span class="keyword2"><span class="keyword">where</span></span> shadow_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">shadow_root</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ptr_child_shadow_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ptr_child</span> <span class="main">=</span> cast <span class="skolem">shadow_root</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ptr_child False
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.get_shadow_root_ok select_result_I<span class="main">)</span>

      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cast <span class="skolem">shadow_root</span><span class="main">,</span> <span class="free">child</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ptr_child ptr_child_shadow_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">shadow_root</span> <span class="main">∈</span> set <span class="free">ancestors</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span><span class="main">(</span>2<span class="main">)</span> host <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_host</span> <span class="skolem">shadow_root</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">host</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_OK_returns_result_E local.get_host_ok
            local.get_shadow_root_shadow_root_ptr_in_heap local.shadow_root_host_dual
            local.shadow_root_same_host shadow_root<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_also_host assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> host
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_root_node_si</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms get_ancestors_si_ok
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_root_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_root_node_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">root</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">root</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_never_empty get_ancestors_si_ptrs_in_heap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> get_root_node_si_same_no_parent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_root_node_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> cast <span class="free">child</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ptr</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_rev_si<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">c</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span>
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> step<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bind_pure_returns_result_I<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">child_node</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> s <span class="main">=</span> this
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">parent_opt</span></span> <span class="keyword2"><span class="keyword">where</span></span> parent_opt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="skolem">child_node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">parent_opt</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def get_ancestors_si_def
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">parent_opt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Some get_root_node_si_no_parent returns_result_eq step.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">parent</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span> s
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def get_ancestors_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits list.splits if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> get_ancestors_si_never_empty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_root_node_si_def
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> returns_result_eq
            <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> step<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bind_pure_returns_result_I<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_root_node_si_wf<span class="main">?</span><span class="main">:</span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span>
  <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">instances</span></span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_disconnected\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_disconnected_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_disconnected_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_parent_wf <span class="main">+</span>
  l_get_parent
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_disconnected_document_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_disconnected_document</span> <span class="free">node_ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> is_OK_returns_result_I local.get_parent_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">parent</span> <span class="main">∈</span> fset <span class="main">(</span>object_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> child_parent_dual<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> known_ptrs_known_ptr option.simps<span class="main">(</span>3<span class="main">)</span>
      returns_result_eq returns_result_select_result
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CD.get_child_nodes_ok<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">document_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="free">node_ptr</span> <span class="main">∈</span>
    set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_children_disc_nodes
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">some_owner_document</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">some_owner_document</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">some_owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">h</span> <span class="main">⊢</span> Heap_Error_Monad.bind <span class="main">(</span><span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">children</span><span class="main">.</span> return <span class="main">(</span><span class="free">node_ptr</span> <span class="main">∈</span> set <span class="bound">children</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> True"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> CD.get_disconnected_nodes_ok CD.get_disconnected_nodes_pure
        <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">document_ptr</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="free">node_ptr</span> <span class="main">∈</span>
                set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
        bind_pure_returns_result_I2 notin_fset return_returns_result select_result_I2<span class="main">)</span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_one_disc_parent assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?filter_M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter_M
             <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span>
                 Heap_Error_Monad.bind <span class="main">(</span><span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">disconnected_nodes</span><span class="main">.</span> return <span class="main">(</span><span class="free">node_ptr</span> <span class="main">∈</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="var">?filter_M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_ok
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> CD.get_disconnected_nodes_pure DocumentMonad.ptr_kinds_M_ptr_kinds
        DocumentMonad.ptr_kinds_ptr_kinds_M assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bind_is_OK_pure_I bind_pure_I
        document_ptr_kinds_M_def filter_M_is_OK_I l_ptr_kinds_M.ptr_kinds_M_ok return_ok
        return_pure returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">candidates</span></span> <span class="keyword2"><span class="keyword">where</span></span> candidates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> filter_M
             <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span>
                 Heap_Error_Monad.bind <span class="main">(</span><span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">disconnected_nodes</span><span class="main">.</span> return <span class="main">(</span><span class="free">node_ptr</span> <span class="main">∈</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">candidates</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">candidates</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">some_owner_document</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_M_ex1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> candidates <span class="quoted"><span class="quoted">‹<span class="skolem">some_owner_document</span> <span class="main">∈</span>
               set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> h5<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">some_owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">some_owner_document</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.get_disconnected_nodes_ok assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> candidates  <span class="quoted"><span class="quoted">‹<span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_disconnected_document_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I filter_M_pure_I bind_pure_I
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> not_Cons_self2 returns_result_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.inject returns_result_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_get_disconnected_document_wf<span class="main">?</span><span class="main">:</span> l_get_disconnected_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span>
  <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_disconnected_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_disconnected_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_owner\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_owner_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_nodes <span class="main">+</span>
  l_get_child_nodes <span class="main">+</span>
  l_get_owner_document<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_parent_wf <span class="main">+</span>
  l_known_ptrs <span class="main">+</span>
  l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_parent<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptr_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">=</span> ShadowRootClass.known_ptr"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_disconnected_nodes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">∈</span> set <span class="free">disc_nodes</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">document_ptr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.a_all_ptrs_in_heap_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> local.heap_is_wellformed_disc_nodes_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> get_disconnected_nodes_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">parent_ptr</span><span class="main">.</span> <span class="bound">parent_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">∧</span>
    <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.distinct_lists_no_parent assms
    <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="bound">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span> <span class="main">∧</span>
        <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∨</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">parent_ptr</span><span class="main">.</span> <span class="bound">parent_ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">∧</span>
        <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 2 <span class="quoted">"3"</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">document_ptr</span></span><span class="main">∈</span>set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span>
    <span class="free">node_ptr</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_map_distinct assms<span class="main">(</span>1<span class="main">)</span>  known_ptrs_implies
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> CD.heap_is_wellformed_one_disc_parent DocumentMonad.ptr_kinds_ptr_kinds_M
        disjoint_iff_not_equal local.get_disconnected_nodes_ok local.heap_is_wellformed_def
        returns_result_select_result type_wf<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_parent_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I filter_M_pure_I bind_pure_I <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  filter_M_empty_I bind_pure_I bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_child_nodes_ok assms<span class="main">(</span>4<span class="main">)</span>  type_wf
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_child_nodes_ok known_ptrs_known_ptr returns_result_select_result<span class="main">)</span>


  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_root_node_si</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> cast <span class="free">node_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_root_node_si_no_parent
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">document_ptrs</span></span> <span class="keyword2"><span class="keyword">where</span></span> document_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> document_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">document_ptrs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span>filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">disconnected_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">;</span>
          return <span class="main">(</span><span class="main">(</span><span class="main">(</span>cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span>
        <span class="main">}</span><span class="main">)</span> <span class="skolem">document_ptrs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> get_disconnected_nodes_ok type_wf
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_I2 filter_M_is_OK_I bind_pure_I<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">candidates</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    candidates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">disconnected_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">;</span>
          return <span class="main">(</span><span class="main">(</span><span class="main">(</span>cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span>
        <span class="main">}</span><span class="main">)</span> <span class="skolem">document_ptrs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">candidates</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> filter<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">disconnected_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">;</span>
          return <span class="main">(</span>cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span>
        <span class="main">}</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="skolem">document_ptrs</span> <span class="main">=</span> <span class="main">[</span><span class="free">document_ptr</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_ex1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 0 document_ptrs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted">"0"</span> <span class="quoted">"3"</span> assms bind_is_OK_pure_I bind_pure_returns_result_I bind_pure_returns_result_I2
        bind_returns_result_E2 bind_returns_result_E3 document_ptr_kinds_M_def get_disconnected_nodes_ok
        get_disconnected_nodes_pure image_eqI is_OK_returns_result_E l_ptr_kinds_M.ptr_kinds_ptr_kinds_M
        return_ok return_returns_result returns_result_eq select_result_E select_result_I select_result_I2
        select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bind_pure_returns_result_I2 is_OK_returns_result_I
        local.get_disconnected_nodes_pure node_ptr_inclusion return_returns_result select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> document_ptrs  3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> document_ptrs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
          <span class="bound">disconnected_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">;</span>
          return <span class="main">(</span><span class="main">(</span><span class="main">(</span>cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span>
        <span class="main">}</span><span class="main">)</span> <span class="skolem">document_ptrs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[</span><span class="free">document_ptr</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_M_filter2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_ok document_ptrs 3  assms<span class="main">(</span>1<span class="main">)</span>  type_wf filter
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bind_pure_I bind_is_OK_I2<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> 4 document_ptrs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span> <span class="main">()</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">document_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I filter_M_pure_I bind_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_known_ptr<span class="main">[</span><span class="operator">OF</span> known_ptrs<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ptr<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span>"</span></span><span class="main">]</span> 2
      known_ptrs_implies
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document_tups_def get_owner_document_def
        a_get_owner_document_tups_def known_ptr_impl<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> known_ptr_not_shadow_root_ptr<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> known_ptr_not_document_ptr<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  known_ptr_not_character_data_ptr<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  known_ptr_not_element_ptr<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NodeClass.known_ptr_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_returns_result_I<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_disconnected_nodes_no_parent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">owner_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">∈</span> set <span class="free">disc_nodes</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">parent</span><span class="main">.</span> <span class="bound">parent</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> <span class="free">node_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">parent</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> get_child_nodes_ok assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> local.child_parent_dual
        local.known_ptrs_known_ptr option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> finite_set_in is_OK_returns_result_I
        local.get_disconnected_nodes_ok local.get_owner_document_disconnected_nodes
        local.get_parent_ptr_in_heap local.heap_is_wellformed_children_disc_nodes
        returns_result_select_result select_result_I2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_owner_document_in_heap_node<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">node_ptr</span> <span class="main">()</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">root</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_root_node_si</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">root</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_document_ptr <span class="skolem">root</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> root
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  bind_returns_result_E2
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_pure_I bind_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms document_ptr_kinds_commutes get_root_node_si_root_in_heap
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="skolem">root</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms local.get_root_node_si_root_in_heap local.known_ptrs_known_ptr root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">root</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> root
      <span class="keyword1"><span class="command">using</span></span> assms local.get_root_node_si_root_in_heap
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_shadow_root_ptr <span class="skolem">root</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> root
      <span class="keyword1"><span class="command">using</span></span> local.get_root_node_si_root_not_shadow_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_node_ptr_kind <span class="skolem">root</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">known_ptr</span> <span class="skolem">root</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">root</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> known_ptr_impl known_ptr_defs DocumentClass.known_ptr_defs
          CharacterDataClass.known_ptr_defs ElementClass.known_ptr_defs NodeClass.known_ptr_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> is_node_ptr_kind_none <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">document_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
<span class="skolem">root</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.child_parent_dual local.get_child_nodes_ok local.get_root_node_si_same_no_parent
        local.heap_is_wellformed_children_disc_nodes local.known_ptrs_known_ptr node_ptr_casts_commute3
        node_ptr_inclusion node_ptr_kinds_commutes notin_fset option.distinct<span class="main">(</span>1<span class="main">)</span> returns_result_eq
        returns_result_select_result root
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">root</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">some_owner_document</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">some_owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">root</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">some_owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">candidates</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      candidates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> filter_M
             <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span>
                 Heap_Error_Monad.bind <span class="main">(</span><span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">disconnected_nodes</span><span class="main">.</span> return <span class="main">(</span><span class="skolem">root</span> <span class="main">∈</span> cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">`</span> set <span class="bound">disconnected_nodes</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">candidates</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms bind_is_OK_I2 bind_pure_I filter_M_is_OK_I finite_fset
          is_OK_returns_result_E local.get_disconnected_nodes_ok local.get_disconnected_nodes_pure
          notin_fset return_ok return_pure sorted_list_of_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">some_owner_document</span> <span class="main">∈</span> set <span class="skolem">candidates</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_M_in_result_if_ok<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">some_owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">root</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">some_owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">some_owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">root</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">some_owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">some_owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">root</span> <span class="main">∈</span> cast <span class="main">`</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">some_owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms local.get_disconnected_nodes_ok
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_pure_I bind_pure_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">candidates</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">∈</span> set <span class="skolem">candidates</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> root
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  bind_returns_result_E2
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_pure_I bind_pure_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> candidates list.set_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_node_ptr_kind <span class="skolem">root</span>›</span></span> node_ptr_no_document_ptr_cast returns_result_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> candidates
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bind_pure_I bind_returns_result_E2 filter_M_holds_for_result is_OK_returns_result_I
          local.get_disconnected_nodes_ptr_in_heap local.get_disconnected_nodes_pure return_pure<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_owner_document_in_heap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_owner_document_def a_get_owner_document_tups_def
      CD.a_get_owner_document_tups_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> invoke <span class="main">[]</span> <span class="free">ptr</span> <span class="main">()</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> invoke_empty is_OK_returns_result_I<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span>
    <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_element_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"is_character_data_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bind_returns_result_E2 check_in_heap_pure comp_apply
        get_owner_document_owner_document_in_heap_node<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_element_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bind_returns_result_E2 check_in_heap_pure comp_apply
        get_owner_document_owner_document_in_heap_node<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_element_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_character_data_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_document_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>local.a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span>
             <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">owner_document</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_M_pure_I bind_pure_I
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_owner_document_owner_document_in_heap_node <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">get_owner_document</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> local.known_ptrs_known_ptr
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_owner_document_def a_get_owner_document_tups_def CD.a_get_owner_document_tups_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> invoke_splits<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_element_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_character_data_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_document_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> invoke <span class="main">[]</span> <span class="free">ptr</span> <span class="main">()</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NodeClass.a_known_ptr_def known_ptr_not_character_data_ptr known_ptr_not_document_ptr
        known_ptr_not_shadow_root_ptr known_ptr_not_element_ptr known_ptr_impl
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_element_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_character_data_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_document_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_shadow_root_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span> <span class="main">⟶</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>local.a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.get_host_ok get_root_node_def
          CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
          a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I filter_M_pure_I bind_pure_I filter_M_is_OK_I get_root_node_si_ok
          get_disconnected_nodes_ok
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> local.get_shadow_root_ptr_in_heap local.shadow_root_host_dual
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_document_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span> <span class="main">⟶</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>local.CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_character_data_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span> <span class="main">⟶</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>local.CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.get_host_ok get_root_node_def
          CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
          a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I filter_M_pure_I bind_pure_I filter_M_is_OK_I get_root_node_si_ok
          get_disconnected_nodes_ok
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> local.get_shadow_root_ptr_in_heap local.shadow_root_host_dual <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_element_ptr<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">ptr</span> <span class="main">⟶</span> <span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> Heap_Error_Monad.bind <span class="main">(</span>check_in_heap <span class="free">ptr</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>local.CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="main">∘</span> the <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="free">ptr</span> <span class="main">()</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.get_host_ok get_root_node_def
          CD.a_get_owner_document<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def CD.a_get_owner_document<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
          a_get_owner_document<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub>_def
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I filter_M_pure_I bind_pure_I filter_M_is_OK_I get_root_node_si_ok
          get_disconnected_nodes_ok
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> local.get_shadow_root_ptr_in_heap local.shadow_root_host_dual
          <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> i_get_owner_document_wf<span class="main">?</span><span class="main">:</span> l_get_owner_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">known_ptr</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span> <span class="quoted">CD.a_get_owner_document</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span>
  <span class="quoted">get_owner_document</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_owner_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def l_get_owner_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms_def
      <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_owner_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> get_owner_document_wf_is_l_get_owner_document_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_get_owner_document_wf
  heap_is_wellformed type_wf known_ptr known_ptrs get_disconnected_nodes get_owner_document
  get_parent"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_owner_document_wf_def l_get_owner_document_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> get_owner_document_disconnected_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> in_disconnected_nodes_no_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> get_owner_document_owner_document_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> get_owner_document_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹remove\_child›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_remove_child_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_set_disconnected_nodes_get_disconnected_nodes <span class="main">+</span>
  l_get_child_nodes <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_owner_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_remove_child<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_set_child_nodes_get_shadow_root <span class="main">+</span>
  l_set_disconnected_nodes_get_shadow_root <span class="main">+</span>
  l_set_child_nodes_get_tag_name <span class="main">+</span>
  l_set_disconnected_nodes_get_tag_name <span class="main">+</span>
  CD<span class="main">:</span> l_remove_child_wf2<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> remove_child_preserves_type_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove_child</span> <span class="free">ptr</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_child_heap_is_wellformed_preserved<span class="main">(</span>1<span class="main">)</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_child_preserves_known_ptrs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove_child</span> <span class="free">ptr</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_child_heap_is_wellformed_preserved<span class="main">(</span>2<span class="main">)</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> remove_child_heap_is_wellformed_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove_child</span> <span class="free">ptr</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.remove_child_heap_is_wellformed_preserved<span class="main">(</span>3<span class="main">)</span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">shadow_root_ptr_opt</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span> <span class="main">=</span>
    <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads remove_child_writes assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove_child_locs_def set_child_nodes_get_shadow_root
        set_disconnected_nodes_get_shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">tag</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads remove_child_writes assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove_child_locs_def set_child_nodes_get_tag_name
        set_disconnected_nodes_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> remove_child_writes assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> remove_child_locs_def
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="free">h</span> <span class="main">=</span> element_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def node_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">⊆</span> <span class="free">parent_child_rel</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> heap_is_wellformed_def
    <span class="keyword1"><span class="command">using</span></span> CD.remove_child_parent_child_rel_subset
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">⊆</span> <span class="free">parent_child_rel</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def
        a_host_shadow_root_rel_def a_all_ptrs_in_heap_def a_distinct_lists_def a_shadow_root_valid_def
        object_ptr_kinds_eq element_ptr_kinds_eq shadow_root_ptr_kinds_eq  shadow_root_eq shadow_root_eq2
        tag_name_eq tag_name_eq2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> acyclic_subset order_refl sup_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remove_preserves_type_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_heap_is_wellformed_preserved<span class="main">(</span>1<span class="main">)</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_preserves_known_ptrs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_heap_is_wellformed_preserved<span class="main">(</span>2<span class="main">)</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> remove_heap_is_wellformed_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">remove</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E2
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> remove_child_heap_is_wellformed_preserved
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_child_removes_child<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">remove_child</span> <span class="free">ptr'</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>
    <span class="main">⟹</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>
    <span class="main">⟹</span> <span class="free">known_ptrs</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span>
    <span class="main">⟹</span> <span class="free">child</span> <span class="main">∉</span> set <span class="free">children</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_child_removes_child local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> remove_child_removes_first_child<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">known_ptrs</span> <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">node_ptr</span> <span class="main">#</span> <span class="free">children</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">remove_child</span> <span class="free">ptr</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
    <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_child_removes_first_child local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> remove_removes_child<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">known_ptrs</span> <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">node_ptr</span> <span class="main">#</span> <span class="free">children</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">remove</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
    <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_removes_child local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> remove_for_all_empty_children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">type_wf</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">known_ptrs</span> <span class="free">h</span> <span class="main">⟹</span>
    <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> forall_M <span class="free">remove</span> <span class="free">children</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span>
    <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CD.remove_for_all_empty_children local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_remove_child_wf2<span class="main">?</span><span class="main">:</span> l_remove_child_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_disconnected_nodes</span>
  <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span>
  <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_root_node_si</span>
  <span class="quoted">get_root_node_si_locs</span> <span class="quoted">CD.a_get_owner_document</span> <span class="quoted">get_owner_document</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_ancestors_si</span>
  <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">remove</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_child_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_remove_child_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_child_wf2_is_l_remove_child_wf2 <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_remove_child_wf2 type_wf known_ptr known_ptrs remove_child heap_is_wellformed get_child_nodes remove"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_remove_child_wf2_def l_remove_child_wf2_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> remove_child_preserves_type_wf <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_child_preserves_known_ptrs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_child_heap_is_wellformed_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> remove_preserves_type_wf <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_preserves_known_ptrs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_heap_is_wellformed_preserved <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> remove_child_removes_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_child_removes_first_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_removes_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> remove_for_all_empty_children <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹adopt\_node›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_adopt_node_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes <span class="main">+</span>
  l_get_disconnected_nodes <span class="main">+</span>
  l_set_child_nodes_get_shadow_root <span class="main">+</span>
  l_set_disconnected_nodes_get_shadow_root <span class="main">+</span>
  l_set_child_nodes_get_tag_name <span class="main">+</span>
  l_set_disconnected_nodes_get_tag_name <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_root_node <span class="main">+</span>
  l_set_disconnected_nodes_get_child_nodes <span class="main">+</span>
  l_get_owner_document_wf <span class="main">+</span>
  l_remove_child_wf2 <span class="main">+</span>
  l_adopt_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_adopt_node<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_get_parent_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adopt_node_removes_child<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wellformed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> adopt_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">adopt_node</span> <span class="free">owner_document</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">∉</span> set <span class="free">children</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">old_document</span></span> <span class="skolem"><span class="skolem">parent_opt</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    old_document<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">old_document</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    parent_opt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">parent_opt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">parent_opt</span> <span class="keyword1">of</span> Some <span class="bound">parent</span> <span class="main">⇒</span> <span class="free">remove_child</span> <span class="bound">parent</span> <span class="free">node_ptr</span> <span class="main">|</span> None <span class="main">⇒</span> return <span class="main">()</span> <span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> get_owner_document_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_parent_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_def  <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E3<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> old_document<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E3<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> parent_opt<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E4<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> h'<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_child_nodes children
        reads_writes_preserved<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_child_nodes_reads set_disconnected_nodes_writes<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> children <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> parent_opt h'<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">parent_opt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> child_parent_dual wellformed known_ptrs type_wf
        <span class="quoted"><span class="quoted">‹<span class="skolem">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>›</span></span> returns_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">option</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> remove_child_removes_child <span class="quoted"><span class="quoted">‹<span class="skolem">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">children</span>›</span></span> known_ptrs type_wf
        wellformed
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adopt_node_preserves_wellformedness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">adopt_node</span> <span class="free">document_ptr</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">old_document</span></span> <span class="skolem"><span class="skolem">parent_opt</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    old_document<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="main">(</span>cast <span class="free">child</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">old_document</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    parent_opt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">parent_opt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">parent_opt</span> <span class="keyword1">of</span> Some <span class="bound">parent</span> <span class="main">⇒</span> <span class="free">remove_child</span> <span class="bound">parent</span> <span class="free">child</span> <span class="main">|</span> None <span class="main">⇒</span> return <span class="main">()</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">old_document</span> <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">old_disc_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span><span class="main">;</span>
        <span class="free">set_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="main">(</span>remove1 <span class="free">child</span> <span class="bound">old_disc_nodes</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">disc_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span><span class="main">;</span>
        <span class="free">set_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="main">(</span><span class="free">child</span> <span class="main">#</span> <span class="bound">disc_nodes</span><span class="main">)</span>
      <span class="main">}</span> <span class="keyword1">else</span> <span class="keyword1">do</span> <span class="main">{</span>
        return <span class="main">()</span>
      <span class="main">}</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pure_returns_heap_eq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_owner_document_pure<span class="main"><span class="main">]</span></span>
        pure_returns_heap_eq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_parent_pure<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_h_eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> remove_child_writes<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> remove_child_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> object_ptr_kinds_M_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> wellformed_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 remove_child_heap_is_wellformed_preserved known_ptrs type_wf
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.case_eq_if pure_returns_heap_eq return_pure<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 remove_child_preserves_type_wf assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 remove_child_preserves_known_ptrs assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span> <span class="main">∧</span> <span class="free">known_ptrs</span> <span class="free">h'</span> <span class="main">∧</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">old_document</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span> <span class="main">∧</span> <span class="free">known_ptrs</span> <span class="free">h'</span> <span class="main">∧</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h' wellformed_h2 <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h3</span></span> <span class="skolem"><span class="skolem">old_disc_nodes</span></span> <span class="skolem"><span class="skolem">disc_nodes_document_ptr_h3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      docs_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">old_document</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      old_disc_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">old_disc_nodes</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="main">(</span>remove1 <span class="free">child</span> <span class="skolem">old_disc_nodes</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      disc_nodes_document_ptr_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_document_ptr_h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="main">(</span><span class="free">child</span> <span class="main">#</span> <span class="skolem">disc_nodes_document_ptr_h3</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h'
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
          bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_h2_eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
            <span class="operator">OF</span> set_disconnected_nodes_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq_h2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq3_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2 document_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq3_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2 document_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> children_eq_h2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads set_disconnected_nodes_writes h3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_child_nodes<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_h3_eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
            <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq_h3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq3_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> node_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3 document_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq3_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3 document_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> children_eq_h3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads set_disconnected_nodes_writes h'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_child_nodes<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">old_document</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span>
      <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads set_disconnected_nodes_writes h3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_disconnected_nodes_different_pointers<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="skolem">old_document</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span>
      <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">disc_nodes_old_document_h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> disc_nodes_old_document_h2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> old_disc_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disc_nodes_old_document_h3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> remove1 <span class="free">child</span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h3 old_disc_nodes returns_result_eq set_disconnected_nodes_get_disconnected_nodes
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_old_document_h2 local.heap_is_wellformed_disconnected_nodes_distinct
        wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> h2<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span>  <span class="quoted"><span class="skolem">parent_opt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> type_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">option</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> remove_child_writes<span class="main">]</span>
          type_wf remove_child_types_preserved
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h3<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span>  set_disconnected_nodes_types_preserved
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span>  set_disconnected_nodes_types_preserved
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span>
      <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads set_disconnected_nodes_writes h'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_disconnected_nodes_different_pointers<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span>
      <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> disc_nodes_document_ptr_h2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_document_ptr_h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq_h2 docs_neq disc_nodes_document_ptr_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> disc_nodes_document_ptr_h'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">child</span> <span class="main">#</span> <span class="skolem">disc_nodes_document_ptr_h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h' disc_nodes_document_ptr_h3
      <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_disconnected_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> document_ptr_in_heap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_document_ptr_h3 document_ptr_kinds_eq2_h2 get_disconnected_nodes_ok assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_document_ptr_h2 get_disconnected_nodes_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> old_document_in_heap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_old_document_h3 document_ptr_kinds_eq2_h2 get_disconnected_nodes_ok assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> heap_is_wellformed_def
      <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_ptr_in_heap old_disc_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> parent_opt h2<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">parent_opt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="skolem">h2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> old_document disc_nodes_old_document_h2 None<span class="main">(</span>1<span class="main">)</span> child_parent_dual<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          in_disconnected_nodes_no_parent assms<span class="main">(</span>1<span class="main">)</span> known_ptrs type_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">option</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> disc_nodes_old_document_h2 old_document remove_child_in_disconnected_nodes
          known_ptrs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∉</span> set <span class="main">(</span>remove1 <span class="free">child</span> <span class="skolem">disc_nodes_old_document_h2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_old_document_h3 h3 known_ptrs wellformed_h2
        <span class="quoted"><span class="quoted">‹distinct <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_document_ptr_h3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span>
        <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span>
          disc_nodes_old_document_h2 disc_nodes_document_ptr_h2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> docs_neq known_ptrs local.get_owner_document_disconnected_nodes
            local.known_ptrs_preserved object_ptr_kinds_h_eq3 returns_result_eq wellformed_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> child_in_heap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_owner_document_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> is_OK_returns_result_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> old_document<span class="main"><span class="main">]</span></span><span class="main">]</span>
        node_ptr_kinds_commutes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">⊆</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_h2_eq3  object_ptr_kinds_h3_eq3 children_eq2_h2 children_eq2_h3
          mem_Collect_eq object_ptr_kinds_M_eq_h3 select_result_eq split_cong
        <span class="keyword1"><span class="command">unfolding</span></span> CD.parent_child_rel_def
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ CD.a_acyclic_heap <span class="skolem">h2</span>›</span></span>  CD.acyclic_heap_def acyclic_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" CD.a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq3_h2 children_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> children_eq2_h3 children_eq_h2 children_eq_h3 known_ptrs
          l_heap_is_wellformed.heap_is_wellformed_children_in_heap local.get_child_nodes_ok
          local.known_ptrs_known_ptr local.l_heap_is_wellformed_axioms node_ptr_kinds_eq3_h2
          object_ptr_kinds_h2_eq3 object_ptr_kinds_h3_eq3 object_ptr_kinds_h_eq3
          returns_result_select_result wellformed_h2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> disc_nodes_old_document_h2 disc_nodes_old_document_h3
          disconnected_nodes_eq2_h2 document_ptr_kinds_eq3_h2 finite_set_in select_result_I2
          set_remove1_subset subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq3_h3 children_eq_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> children_eq2_h3 finite_set_in object_ptr_kinds_h3_eq3
          subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> disc_nodes_document_ptr_h'
          disc_nodes_document_ptr_h2 disc_nodes_old_document_h2 disconnected_nodes_eq2_h3
          document_ptr_kinds_eq3_h3 finite_set_in local.heap_is_wellformed_disc_nodes_in_heap
          node_ptr_kinds_eq3_h2 node_ptr_kinds_eq3_h3 select_result_I2 set_ConsD subsetD wellformed_h2<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def node_ptr_kinds_eq_h2 node_ptr_kinds_eq3_h3
          object_ptr_kinds_eq_h2 object_ptr_kinds_eq_h3 document_ptr_kinds_eq2_h2 document_ptr_kinds_eq2_h3
          children_eq2_h2 children_eq2_h3 <span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> disc_nodes_document_ptr_h' disc_nodes_document_ptr_h2
          disc_nodes_old_document_h2 disc_nodes_old_document_h3 disconnected_nodes_eq2_h2
          disconnected_nodes_eq2_h3 document_ptr_in_heap document_ptr_kinds_eq3_h2 document_ptr_kinds_eq3_h3
          in_set_remove1 list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> node_ptr_kinds_eq3_h2 node_ptr_kinds_eq3_h3
          object_ptr_kinds_h2_eq3 object_ptr_kinds_h3_eq3 select_result_I2<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> a_distinct_lists_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def object_ptr_kinds_eq_h3 object_ptr_kinds_eq_h2
          children_eq2_h2 children_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
        <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
        <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
        <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
        <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> distinct_concat_map_I<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_M_def <span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a_distinct_lists_h2 <span class="quoted">"2"</span> a1 concat_map_all_distinct document_ptr_kinds_eq2_h2
            document_ptr_kinds_eq2_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq2_h2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main">]</span>
                disconnected_nodes_eq2_h3<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main">]</span> 4
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span>  disc_nodes_document_ptr_h3 disc_nodes_document_ptr_h' 4
                <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_document_ptr_h3</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disconnected_nodes_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">disc_nodes_old_document_h2</span>›</span></span>
                disc_nodes_old_document_h3 disconnected_nodes_eq2_h3 distinct_remove1 docs_neq select_result_I2<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span>
          set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 calculation
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq3_h2 document_ptr_kinds_eq3_h3
              <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span>
          set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> docs_neq <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 True select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h'<span class="main">]</span>
                select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h2<span class="main">]</span>
                select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span>
                select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h3<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∉</span> set <span class="main">(</span>remove1 <span class="free">child</span> <span class="skolem">disc_nodes_old_document_h2</span><span class="main">)</span>›</span></span>
                  <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> disconnected_nodes_eq2_h3 disjoint_iff_not_equal notin_set_remove1 set_ConsD<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> 5 select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h'<span class="main">]</span>
                select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h2<span class="main">]</span>
                select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span>
                select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h3<span class="main">]</span>
                disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3 <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> docs_neq
                <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal notin_set_remove1<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> 5 select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h'<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h2<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h3<span class="main">]</span>
                  <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∉</span> set <span class="main">(</span>remove1 <span class="free">child</span> <span class="skolem">disc_nodes_old_document_h2</span><span class="main">)</span>›</span></span>
                    disconnected_nodes_eq2_h3 disjoint_iff_not_equal notin_set_remove1<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> 5 select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h'<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h2<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h3<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                  <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h2
                    disconnected_nodes_eq2_h3 disjoint_iff_not_equal docs_neq notin_set_remove1<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="skolem">disc_nodes_old_document_h2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DocumentMonad.ptr_kinds_M_ok DocumentMonad.ptr_kinds_M_ptr_kinds False
                  <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> a1 disc_nodes_old_document_h2 document_ptr_kinds_M_def document_ptr_kinds_eq2_h2
                  document_ptr_kinds_eq2_h3 l_ptr_kinds_M.ptr_kinds_ptr_kinds_M local.get_disconnected_nodes_ok
                  local.heap_is_wellformed_one_disc_parent returns_result_select_result wellformed_h2<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="skolem">disc_nodes_old_document_h2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="skolem">disc_nodes_old_document_h2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> 5 select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h'<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h2<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span>
                  select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h3<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                  <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
                  <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> disconnected_nodes_eq2_h2
                  disconnected_nodes_eq2_h3 <span class="quoted"><span class="quoted">‹set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="skolem">disc_nodes_old_document_h2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="skolem">disc_nodes_document_ptr_h3</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> 2 a1 document_ptr_in_heap document_ptr_kinds_eq2_h2
                    document_ptr_kinds_eq2_h3 <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                    select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h3<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
                    disconnected_nodes_eq2_h2<span class="main">[</span><span class="operator">OF</span> docs_neq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"5"</span> True<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span>
set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> 2 a1 old_document_in_heap document_ptr_kinds_eq2_h2
                    document_ptr_kinds_eq2_h3 <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> a0 distinct_concat_map_E<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                      document_ptr_kinds_eq3_h2 document_ptr_kinds_eq3_h3 finite_fset fmember.rep_eq
                      set_sorted_list_of_set<span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> 5 select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_document_ptr_h'<span class="main">]</span>
                    select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> disconnected_nodes_eq2_h2
                    disconnected_nodes_eq2_h3
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> 5
                    select_result_I2<span class="main">[</span><span class="operator">OF</span> disc_nodes_old_document_h2<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">old_document</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> disconnected_nodes_eq2_h2
                    disconnected_nodes_eq2_h3
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span>
                  set <span class="skolem">disc_nodes_old_document_h2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> empty_iff inf.idem<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
      <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
          <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
          <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
          <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> disc_nodes_document_ptr_h'
          disc_nodes_document_ptr_h2 disc_nodes_old_document_h2 disc_nodes_old_document_h3
          disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3 document_ptr_kinds_eq2_h2
          document_ptr_kinds_eq2_h3  old_document_in_heap
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">=</span> <span class="skolem">old_document</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">=</span> <span class="skolem">old_document</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> remove1 <span class="free">child</span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
          <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a1 <span class="quoted"><span class="quoted">‹<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f6 a3 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> disconnected_nodes_eq_h3 docs_neq
              get_disconnected_nodes_ok returns_result_eq returns_result_select_result set_remove1_subset subsetCE<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span>  set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f7 f6 a5 a4 <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> a1 a4 f7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">≠</span> <span class="skolem">old_document</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_document_ptr_h3</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">child</span> <span class="main">#</span> <span class="skolem">disc_nodes_document_ptr_h3</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">old_document</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="skolem">old_document</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span>
          <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span>
          <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
          <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∨</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="free">get_disconnected_nodes</span> <span class="bound">d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a9 <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> get_disconnected_nodes_ok
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a6 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a12 a8 a4 <span class="quoted"><span class="quoted">‹<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UN_I disjoint_iff_not_equal fmember.rep_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">child</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f13 a11 a10 a7 a5 a2 a1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> select_result_I2 set_ConsD<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">child</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_old_document_h2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f14 a12 a8 a6 a4
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> adopt_node_removes_child assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> type_wf
              get_child_nodes_ok known_ptrs local.known_ptrs_known_ptr object_ptr_kinds_h2_eq3
              object_ptr_kinds_h3_eq3 object_ptr_kinds_h_eq3 returns_result_select_result<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">child</span> <span class="main">∈</span> set <span class="skolem">disc_nodes_old_document_h2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹CD.a_owner_document_valid <span class="free">h'</span>›</span></span> CD.heap_is_wellformed_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



    <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">shadow_root_ptr_opt</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span> <span class="main">=</span>
  <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_disconnected_nodes_writes h3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_shadow_root
          set_disconnected_nodes_get_shadow_root<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> shadow_root_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">shadow_root_ptr_opt</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span> <span class="main">=</span>
<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_disconnected_nodes_writes h'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_shadow_root
          set_disconnected_nodes_get_shadow_root<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> shadow_root_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">tag</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_disconnected_nodes_writes h3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_tag_name
          set_disconnected_nodes_get_tag_name<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">tag</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_disconnected_nodes_writes h'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_tag_name
          set_disconnected_nodes_get_tag_name<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
            <span class="operator">OF</span> set_disconnected_nodes_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> adopt_node_locs_def remove_child_locs_def
      <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
            <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> adopt_node_locs_def remove_child_locs_def
      <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def node_ptr_kinds_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> element_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def node_ptr_kinds_def<span class="main">)</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> known_ptrs local.known_ptrs_preserved object_ptr_kinds_h2_eq3 object_ptr_kinds_h_eq3
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.known_ptrs_preserved object_ptr_kinds_h3_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span> <span class="main">∧</span> <span class="free">known_ptrs</span> <span class="free">h'</span> <span class="main">∧</span> <span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">⊆</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def
          a_host_shadow_root_rel_def a_all_ptrs_in_heap_def a_distinct_lists_def a_shadow_root_valid_def
          object_ptr_kinds_eq_h2 object_ptr_kinds_eq_h3 element_ptr_kinds_eq_h2 element_ptr_kinds_eq_h3
          shadow_root_ptr_kinds_eq_h2 shadow_root_ptr_kinds_eq_h3  shadow_root_eq_h2 shadow_root_eq_h3
          shadow_root_eq2_h2 shadow_root_eq2_h3 tag_name_eq_h2 tag_name_eq_h3 tag_name_eq2_h2
          tag_name_eq2_h3 CD.parent_child_rel_def children_eq2_h2 children_eq2_h3 object_ptr_kinds_h2_eq3
          object_ptr_kinds_h3_eq3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> adopt_node_node_in_disconnected_nodes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wellformed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> adopt_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">adopt_node</span> <span class="free">owner_document</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">owner_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> known_ptrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> type_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">∈</span> set <span class="free">disc_nodes</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">old_document</span></span> <span class="skolem"><span class="skolem">parent_opt</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    old_document<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="main">(</span>cast <span class="free">node_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">old_document</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    parent_opt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_parent</span> <span class="free">node_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">parent_opt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">parent_opt</span> <span class="keyword1">of</span> Some <span class="bound">parent</span> <span class="main">⇒</span> <span class="free">remove_child</span> <span class="bound">parent</span> <span class="free">node_ptr</span> <span class="main">|</span> None <span class="main">⇒</span> return <span class="main">()</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">owner_document</span> <span class="main">≠</span> <span class="skolem">old_document</span> <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">old_disc_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">old_document</span><span class="main">;</span>
        <span class="free">set_disconnected_nodes</span> <span class="skolem">old_document</span> <span class="main">(</span>remove1 <span class="free">node_ptr</span> <span class="bound">old_disc_nodes</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">disc_nodes</span> <span class="main">←</span> <span class="free">get_disconnected_nodes</span> <span class="free">owner_document</span><span class="main">;</span>
        <span class="free">set_disconnected_nodes</span> <span class="free">owner_document</span> <span class="main">(</span><span class="free">node_ptr</span> <span class="main">#</span> <span class="bound">disc_nodes</span><span class="main">)</span>
      <span class="main">}</span> <span class="keyword1">else</span> <span class="keyword1">do</span> <span class="main">{</span>
        return <span class="main">()</span>
      <span class="main">}</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pure_returns_heap_eq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_owner_document_pure<span class="main"><span class="main">]</span></span>
        pure_returns_heap_eq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_parent_pure<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">owner_document</span> <span class="main">=</span> <span class="skolem">old_document</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> parent_opt h2<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">parent_opt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="free">h'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h2 h' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> in_disconnected_nodes_no_parent assms None old_document <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">parent</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> remove_child_in_disconnected_nodes known_ptrs True h' assms<span class="main">(</span>3<span class="main">)</span> old_document
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>  h' list.set_intros<span class="main">(</span>1<span class="main">)</span> select_result_I2
        set_disconnected_nodes_get_disconnected_nodes
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
          bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">h'a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xb</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">owner_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">disc_nodes</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">document_ptr</span> <span class="bound">disc_nodes</span> <span class="bound">h'</span><span class="main">.</span>
        <span class="bound">h</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="bound">document_ptr</span> <span class="bound">disc_nodes</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span>
        <span class="bound">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'a</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="free">owner_document</span> <span class="main">(</span><span class="free">node_ptr</span> <span class="main">#</span> <span class="skolem">xb</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">node_ptr</span> <span class="main">#</span> <span class="skolem">xb</span> <span class="main">=</span> <span class="free">disc_nodes</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> returns_result_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> l_adopt_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">Shadow_DOM.get_owner_document</span> <span class="quoted">Shadow_DOM.get_parent</span>
  <span class="quoted">Shadow_DOM.get_parent_locs</span> <span class="quoted">Shadow_DOM.remove_child</span> <span class="quoted">Shadow_DOM.remove_child_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">Shadow_DOM.adopt_node</span> <span class="quoted">Shadow_DOM.adopt_node_locs</span>
  <span class="quoted">ShadowRootClass.known_ptr</span> <span class="quoted">ShadowRootClass.type_wf</span> <span class="quoted">Shadow_DOM.get_child_nodes</span>
  <span class="quoted">Shadow_DOM.get_child_nodes_locs</span>
  <span class="quoted">ShadowRootClass.known_ptrs</span> <span class="quoted">Shadow_DOM.set_child_nodes</span> <span class="quoted">Shadow_DOM.set_child_nodes_locs</span>
  <span class="quoted">Shadow_DOM.remove</span> <span class="quoted">Shadow_DOM.heap_is_wellformed</span> <span class="quoted">Shadow_DOM.parent_child_rel</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_adopt_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_adopt_node_wf2<span class="main">?</span><span class="main">:</span> l_adopt_node_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span>
  <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">known_ptrs</span>
  <span class="quoted">get_owner_document</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span> <span class="quoted">remove</span> <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_adopt_node_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> adopt_node_wf_is_l_adopt_node_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_adopt_node_wf type_wf known_ptr heap_is_wellformed parent_child_rel get_child_nodes
  get_disconnected_nodes known_ptrs adopt_node"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_adopt_node_wf_def l_adopt_node_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_preserves_wellformedness <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_removes_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_node_in_disconnected_nodes <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_removes_first_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_document_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_preserves_wellformedness <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> adopt_node_preserves_wellformedness <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹insert\_before›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_insert_before_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes <span class="main">+</span>
  l_get_disconnected_nodes <span class="main">+</span>
  l_set_child_nodes_get_shadow_root <span class="main">+</span>
  l_set_disconnected_nodes_get_shadow_root <span class="main">+</span>
  l_set_child_nodes_get_tag_name <span class="main">+</span>
  l_set_disconnected_nodes_get_tag_name <span class="main">+</span>
  l_set_disconnected_nodes_get_disconnected_nodes <span class="main">+</span>
  l_set_child_nodes_get_disconnected_nodes <span class="main">+</span>
  l_set_disconnected_nodes_get_disconnected_nodes_wf <span class="main">+</span>
  l_set_disconnected_nodes_get_ancestors_si <span class="main">+</span>
  l_insert_before<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> _ _ _ _ _ _ <span class="quoted"><span class="free">get_ancestors_si</span></span> <span class="quoted"><span class="free">get_ancestors_si_locs</span></span> <span class="main">+</span>
  l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>  <span class="main">+</span>
  l_get_owner_document  <span class="main">+</span>
  l_adopt_node  <span class="main">+</span>
  l_adopt_node_wf  <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_adopt_node_get_shadow_root
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> insert_before_child_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">insert_before</span> <span class="free">ptr</span> <span class="free">node</span> <span class="free">child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ancestors</span></span> <span class="skolem"><span class="skolem">reference_child</span></span> <span class="skolem"><span class="skolem">owner_document</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">h3</span></span> <span class="skolem"><span class="skolem">disconnected_nodes_h2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ancestors<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ancestors</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    node_not_in_ancestors<span class="main">:</span> <span class="quoted"><span class="quoted">"cast <span class="free">node</span> <span class="main">∉</span> set <span class="skolem">ancestors</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    reference_child<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">if</span> Some <span class="free">node</span> <span class="main">=</span> <span class="free">child</span> <span class="keyword1">then</span> a_next_sibling <span class="free">node</span> <span class="keyword1">else</span> return <span class="free">child</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">reference_child</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    owner_document<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_owner_document</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">owner_document</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">adopt_node</span> <span class="skolem">owner_document</span> <span class="free">node</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    disconnected_nodes_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">owner_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disconnected_nodes_h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="skolem">owner_document</span> <span class="main">(</span>remove1 <span class="free">node</span> <span class="skolem">disconnected_nodes_h2</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> a_insert_node <span class="free">ptr</span> <span class="free">node</span> <span class="skolem">reference_child</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="comment1">(* children: "h3 ⊢ get_child_nodes ptr →<span class="hidden">⇩</span><sub>r</sub> children" and *)</span>
    <span class="comment1">(* h': "h3 ⊢ set_child_nodes ptr (insert_before_list node reference_child children) →<span class="hidden">⇩</span><sub>h</sub> h'" *)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_before_def a_ensure_pre_insertion_validity_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_result_E
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_parent_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_child_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_ancestors_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> next_sibling_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_owner_document_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> adopt_node_writes h2<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_disconnected_nodes_writes h3<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> insert_node_writes h'<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> set_child_nodes_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node_writes h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert_node_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_child_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> known_ptrs_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> known_ptrs_preserved <span class="quoted"><span class="quoted">‹object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved <span class="quoted"><span class="quoted">‹object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="free">ptr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> get_owner_document_ptr_in_heap is_OK_returns_result_I <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span>
        l_known_ptrs.known_ptrs_known_ptr l_known_ptrs_axioms owner_document<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq3_h<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> adopt_node_writes h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node_pointers_preserved
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_defs <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> wellformed_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adopt_node_preserves_wellformedness<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> h2<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq3_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> a_remove_child_locs_def
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_M_eq2_h2 document_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq3_h'<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> insert_node_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">unfolding</span></span> a_remove_child_locs_def
    <span class="keyword1"><span class="command">using</span></span> set_child_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptrs</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">ptrs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_M_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_M_eq2_h3 document_ptr_kinds_M_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">shadow_root</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root</span> <span class="main">=</span>
  <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads adopt_node_writes h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> local.adopt_node_get_shadow_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">owner_document</span> <span class="main">≠</span> <span class="bound">doc_ptr</span> <span class="main">⟹</span>
      <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads set_disconnected_nodes_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_disconnected_nodes_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="bound">doc_ptr</span> <span class="main">≠</span> <span class="skolem">owner_document</span> <span class="main">⟹</span>
      <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span>
      <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">owner_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> remove1 <span class="free">node</span> <span class="skolem">disconnected_nodes_h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 set_disconnected_nodes_get_disconnected_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
      <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads insert_node_writes  h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_child_nodes_get_disconnected_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads set_disconnected_nodes_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="free">ptr</span> <span class="main">≠</span> <span class="bound">ptr'</span> <span class="main">⟹</span>
       <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_child_nodes_reads insert_node_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_child_nodes_get_child_nodes_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="free">ptr</span> <span class="main">≠</span> <span class="bound">ptr'</span> <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">children_h3</span></span> <span class="keyword2"><span class="keyword">where</span></span> children_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">children_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' a_insert_node_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> children_h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> insert_before_list <span class="free">node</span> <span class="skolem">reference_child</span> <span class="skolem">children_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptr</span> <span class="free">ptr</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_insert_node_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E2
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_child_nodes_get_child_nodes returns_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> children_h3<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ptr_in_heap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> children_h3 get_child_nodes_ptr_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> node_in_heap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">node</span> <span class="main">|∈|</span> node_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 adopt_node_child_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> child_not_in_any_children<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">⟹</span> <span class="free">node</span> <span class="main">∉</span> set <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> h2 adopt_node_removes_child <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">node</span> <span class="main">∈</span> set <span class="skolem">disconnected_nodes_h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_h2 h2 adopt_node_node_in_disconnected_nodes assms<span class="main">(</span>1<span class="main">)</span>
      <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> node_not_in_disconnected_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span> <span class="main">⟹</span> <span class="free">node</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">d</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">node</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">d</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">owner_document</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_h2 wellformed_h2 h3 remove_from_disconnected_nodes_removes
          wellformed_h2 <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>›</span></span> disconnected_nodes_h3
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">d</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">owner_document</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span> wellformed_h2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span>
            disconnected_nodes_h2 document_ptr_kinds_M_def document_ptr_kinds_eq2_h2
            l_ptr_kinds_M.ptr_kinds_ptr_kinds_M local.get_disconnected_nodes_ok
            local.heap_is_wellformed_one_disc_parent returns_result_select_result select_result_I2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq2_h2<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">node</span> <span class="main">∈</span> set <span class="skolem">disconnected_nodes_h2</span>›</span></span>
          disconnected_nodes_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">node</span> <span class="main">≠</span> <span class="free">ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ancestors node_not_in_ancestors get_ancestors_ptr
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ancestors_h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ancestors_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ancestors_h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_ok
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> is_OK_returns_result_E
        object_ptr_kinds_M_eq3_h2 ptr_in_heap wellformed_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ancestors_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_ancestors_si</span> <span class="free">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ancestors_h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_reads set_disconnected_nodes_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_separate_forwards<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> ancestors_h2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ancestors_si_locs_def get_parent_locs_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.get_ancestors_si_locs_def local.get_parent_reads_pointers
        local.set_disconnected_nodes_get_ancestors_si<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> local.get_ancestors_si_locs_def local.set_disconnected_nodes_get_ancestors_si <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> node_not_in_ancestors_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"cast <span class="free">node</span> <span class="main">∉</span> set <span class="skolem">ancestors_h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>›</span></span> ancestors ancestors_h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> get_ancestors_si_remains_not_in_ancestors<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> h2 local.adopt_node_children_subset <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h2 node_not_in_ancestors object_ptr_kinds_M_eq2_h assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
      <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> returns_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_M_eq3_h2 children_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">ptr</span><span class="main">,</span> cast <span class="free">node</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> children_h3 children_h' ptr_in_heap
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_M_eq3_h' children_eq2_h3
        insert_before_list_node_in_set<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> children_eq2_h3 insert_before_list_in_set select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> children_eq2_h3 imageI insert_before_list_in_set select_result_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wellformed_h2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_M_eq3_h2 children_eq2_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">node</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">ptr</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_parent_child_rel
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> ancestors_h2 node_not_in_ancestors_h2 wellformed_h2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">node</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">ptr</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_M_eq3_h2 children_eq2_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">ptr</span><span class="main">,</span> cast <span class="free">node</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.acyclic_heap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wellformed_h2  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="skolem">h2</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def object_ptr_kinds_M_eq2_h2
          node_ptr_kinds_eq2_h2 children_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq2_h2 disconnected_nodes_h2 disconnected_nodes_h3
      <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq2_h2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> children_eq2_h2 in_mono notin_fset object_ptr_kinds_M_eq3_h2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> NodeMonad.ptr_kinds_ptr_kinds_M disconnected_nodes_eq2_h2
          disconnected_nodes_h2 disconnected_nodes_h3 document_ptr_kinds_commutes finite_set_in
          node_ptr_kinds_eq2_h2 object_ptr_kinds_M_eq3_h2 select_result_I2 set_remove1_subset subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">children_h3</span>  <span class="main">⊆</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> children_h3 <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="skolem">h3</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_child_nodes2 <span class="quoted"><span class="quoted">‹<span class="free">known_ptr</span> <span class="free">ptr</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span>
        local.parent_child_rel_child_in_heap node_ptr_kinds_commutes object_ptr_kinds_M_eq3_h'
        object_ptr_kinds_M_eq3_h2 wellformed_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>insert_before_list <span class="free">node</span> <span class="skolem">reference_child</span> <span class="skolem">children_h3</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> node_in_heap
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_eq2_h node_ptr_kinds_eq2_h2 node_ptr_kinds_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> contra_subsetD finite_set_in insert_before_list_in_set
          node_ptr_kinds_commutes object_ptr_kinds_M_eq3_h object_ptr_kinds_M_eq3_h' object_ptr_kinds_M_eq3_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="skolem">h3</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_M_eq3_h' CD.a_all_ptrs_in_heap_def node_ptr_kinds_def
          node_ptr_kinds_eq2_h3 disconnected_nodes_eq_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> children_eq_h3 children_h'
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> children_eq2_h3 finite_set_in select_result_I2 subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DocumentMonad.ptr_kinds_ptr_kinds_M disconnected_nodes_eq2_h3
          document_ptr_kinds_eq2_h3 finite_set_in subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wellformed_h2  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def object_ptr_kinds_M_eq2_h2 document_ptr_kinds_eq2_h2
      children_eq2_h2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
<span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h3<span class="main">]</span>
        disconnected_nodes_eq2_h2 select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h2<span class="main">]</span> 1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> distinct_remove1 finite_fset fmember.rep_eq set_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xa</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
<span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">owner_document</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">owner_document</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 4 5 6 select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h3<span class="main">]</span>
          select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h2<span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True disconnected_nodes_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">owner_document</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h2 disjoint_iff_not_equal
            notin_set_remove1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">owner_document</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> 2 3 4 5 6 select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h3<span class="main">]</span>
            select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h2<span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True disconnected_nodes_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">owner_document</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h2 disjoint_iff_not_equal
              notin_set_remove1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 2 3 4<span class="main">]</span> 5 6
          <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq2_h2 disconnected_nodes_h2 disconnected_nodes_h3
            disjoint_iff_not_equal finite_fset fmember.rep_eq notin_set_remove1 select_result_I2
            set_sorted_list_of_set
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> children_eq2_h2 document_ptr_kinds_commutes <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span>
          local.get_child_nodes_ok local.get_disconnected_nodes_ok
          local.heap_is_wellformed_children_disc_nodes_different local.known_ptrs_known_ptr
          object_ptr_kinds_M_eq3_h object_ptr_kinds_M_eq3_h2 returns_result_select_result wellformed_h2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">=</span> <span class="skolem">owner_document</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> select_result_I2<span class="main">[</span><span class="operator">OF</span> disconnected_nodes_h3<span class="main">,</span><span class="operator">folded</span> select_result_I2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> disconnected_nodes_h2<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span> <span class="quoted">"5"</span> <span class="quoted">"6"</span> disjoint_iff_not_equal notin_set_remove1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 4 5 6 <span class="keyword1"><span class="command">unfolding</span></span> disconnected_nodes_eq2_h2<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def document_ptr_kinds_eq2_h3 object_ptr_kinds_M_eq2_h3
      disconnected_nodes_eq2_h3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
<span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span> <span class="main">⟹</span> distinct <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> children_h3 children_h'
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True  insert_before_list_distinct
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> child_not_in_any_children<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> children_eq_h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> children_eq2_h3<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> 3<span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xa</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
<span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> 2 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span>  children_h3 children_h' child_not_in_any_children<span class="main">[</span><span class="operator">unfolded</span> children_eq_h2<span class="main">]</span> 5 6
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  True children_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">ptr</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span> <span class="quoted">"7"</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> children_eq2_h3 disjoint_iff_not_equal
            get_child_nodes_ok insert_before_list_in_set <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> local.known_ptrs_known_ptr
            object_ptr_kinds_M_eq3_h object_ptr_kinds_M_eq3_h' object_ptr_kinds_M_eq3_h2
            returns_result_select_result select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span>  children_h3 children_h' child_not_in_any_children<span class="main">[</span><span class="operator">unfolded</span> children_eq_h2<span class="main">]</span> 5 6
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  True children_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"2"</span> <span class="quoted">"4"</span> <span class="quoted">"7"</span> IntI <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span>
              children_eq_h3 empty_iff insert_before_list_in_set local.get_child_nodes_ok
              local.known_ptrs_known_ptr object_ptr_kinds_M_eq3_h' returns_result_select_result select_result_I2<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> children_eq2_h3<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">ptr</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main">]</span> children_eq2_h3<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">ptr</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span><span class="main">]</span> 5 6 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 5
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span> <span class="bound">d</span><span class="main">.</span> <span class="main">¬</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">∨</span> <span class="bound">d</span> <span class="main">|∉|</span> document_ptr_kinds <span class="bound">h</span> <span class="main">∨</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="free">get_disconnected_nodes</span> <span class="bound">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.get_disconnected_nodes_ok <span class="keyword1"><span class="command">by</span></span> <span class="operator">satx</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disconnected_nodes_eq_h3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> object_ptr_kinds_M_eq3_h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="skolem">h3</span>›</span></span> CD.distinct_lists_no_parent <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">=</span> <span class="skolem">xa</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 6 node_not_in_disconnected_nodes  3 4 5  select_result_I2<span class="main">[</span><span class="operator">OF</span> children_h'<span class="main">]</span>
          select_result_I2<span class="main">[</span><span class="operator">OF</span> children_h3<span class="main">]</span> True disconnected_nodes_eq2_h3
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"2"</span> DocumentMonad.ptr_kinds_ptr_kinds_M
            <span class="quoted"><span class="quoted">‹CD.a_distinct_lists <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> disconnected_nodes_eq_h3 CD.distinct_lists_no_parent
            document_ptr_kinds_eq2_h3 get_disconnected_nodes_ok insert_before_list_in_set
            object_ptr_kinds_M_eq3_h' returns_result_select_result<span class="main">)</span>

    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 5 children_eq2_h3<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wellformed_h2  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def object_ptr_kinds_M_eq2_h2
        object_ptr_kinds_M_eq2_h3 node_ptr_kinds_eq2_h2 node_ptr_kinds_eq2_h3 document_ptr_kinds_eq2_h2
        document_ptr_kinds_eq2_h3 children_eq2_h2 <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> <span class="keyword1"><span class="command">thm</span></span> children_eq2_h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span>  document_ptr_kinds_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
        object_ptr_kinds_M_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> object_ptr_kinds_M_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
        node_ptr_kinds_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> node_ptr_kinds_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disconnected_nodes_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Core_DOM_Functions.i_insert_before.insert_before_list_in_set
        children_eq2_h3 children_h' children_h3 disconnected_nodes_eq2_h2 disconnected_nodes_h2
        disconnected_nodes_h3 finite_set_in in_set_remove1 is_OK_returns_result_I object_ptr_kinds_M_eq3_h'
        ptr_in_heap returns_result_eq returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.heap_is_wellformed_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">shadow_root_ptr_opt</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span> <span class="main">=</span>
<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_disconnected_nodes_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_shadow_root
        set_disconnected_nodes_get_shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">shadow_root_ptr_opt</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span> <span class="main">=</span>
<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_ptr_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads insert_node_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_shadow_root
        set_disconnected_nodes_get_shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">tag</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_disconnected_nodes_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_tag_name
        set_disconnected_nodes_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">tag</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">tag</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads insert_node_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adopt_node_locs_def remove_child_locs_def set_child_nodes_get_tag_name
        set_disconnected_nodes_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> select_result_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> adopt_node_locs_def remove_child_locs_def
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> insert_node_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved set_child_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def node_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> element_ptr_kinds <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def node_ptr_kinds_def<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h2 shadow_root_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> a_host_shadow_root_rel <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h3 shadow_root_eq2_h3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="free">node</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">ptr</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_ancestors_si_parent_child_host_shadow_root_rel
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> ancestors_h2 node_not_in_ancestors_h2
      wellformed_h2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span>
        <span class="quoted"><span class="quoted">‹a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> a_host_shadow_root_rel <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">ptr</span><span class="main">,</span> cast <span class="free">node</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast <span class="free">node</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">ptr</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="free">h'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="free">h'</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def
        a_all_ptrs_in_heap_def a_distinct_lists_def a_shadow_root_valid_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h2 object_ptr_kinds_eq_h3 element_ptr_kinds_eq_h2
        element_ptr_kinds_eq_h3 shadow_root_ptr_kinds_eq_h2 shadow_root_ptr_kinds_eq_h3  shadow_root_eq_h2
        shadow_root_eq_h3 shadow_root_eq2_h2 shadow_root_eq2_h3 tag_name_eq_h2 tag_name_eq_h3
        tag_name_eq2_h2 tag_name_eq2_h3<span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_insert_before_wf<span class="main">?</span><span class="main">:</span> l_insert_before_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_ancestors_si</span>
  <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_owner_document</span> <span class="quoted">insert_before</span>
  <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_insert_before_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_insert_before_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> insert_before_wf_is_l_insert_before_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_insert_before_wf Shadow_DOM.heap_is_wellformed ShadowRootClass.type_wf
ShadowRootClass.known_ptr ShadowRootClass.known_ptrs
     Shadow_DOM.insert_before Shadow_DOM.get_child_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_insert_before_wf_def l_insert_before_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> insert_before_removes_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> l_set_disconnected_nodes_get_disconnected_nodes_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"l_set_disconnected_nodes_get_disconnected_nodes_wf ShadowRootClass.type_wf
ShadowRootClass.known_ptr Shadow_DOM.heap_is_wellformed Shadow_DOM.parent_child_rel Shadow_DOM.get_child_nodes
     get_disconnected_nodes get_disconnected_nodes_locs set_disconnected_nodes set_disconnected_nodes_locs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_set_disconnected_nodes_get_disconnected_nodes_wf_def
      l_set_disconnected_nodes_get_disconnected_nodes_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Shadow_DOM.i_heap_is_wellformed.heap_is_wellformed_disconnected_nodes_distinct
      Shadow_DOM.i_remove_child.set_disconnected_nodes_get_disconnected_nodes insert_iff
      returns_result_eq set_remove1_eq<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span>
  <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_get_root_node_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> i_insert_before_wf2<span class="main">?</span><span class="main">:</span> l_insert_before_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">set_child_nodes</span> <span class="quoted">set_child_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">get_owner_document</span> <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_root_node_si</span> <span class="quoted">get_root_node_si_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_insert_before_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_insert_before_wf2<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> insert_before_wf2_is_l_insert_before_wf2 <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_insert_before_wf2 ShadowRootClass.type_wf ShadowRootClass.known_ptr ShadowRootClass.known_ptrs
Shadow_DOM.insert_before
     Shadow_DOM.heap_is_wellformed"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_insert_before_wf2_def l_insert_before_wf2_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> insert_before_child_preserves <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹append\_child›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_append_child_wf<span class="main">?</span><span class="main">:</span> l_append_child_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">get_owner_document</span> <span class="quoted">get_parent</span>
  <span class="quoted">get_parent_locs</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span>
  <span class="quoted">adopt_node</span> <span class="quoted">adopt_node_locs</span> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">set_child_nodes</span>
  <span class="quoted">set_child_nodes_locs</span> <span class="quoted">remove</span> <span class="quoted">get_ancestors_si</span> <span class="quoted">get_ancestors_si_locs</span>
  <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">heap_is_wellformed</span>
  <span class="quoted">parent_child_rel</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_append_child_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_append_child_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> append_child_wf_is_l_append_child_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_append_child_wf type_wf known_ptr known_ptrs append_child heap_is_wellformed"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_append_child_wf_def l_append_child_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> append_child_heap_is_wellformed_preserved <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹to\_tree\_order›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order_wf<span class="main">?</span><span class="main">:</span> l_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">to_tree_order</span> <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">heap_is_wellformed</span>
  <span class="quoted">parent_child_rel</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">declare</span></span> l_to_tree_order_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_wf_is_l_to_tree_order_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_to_tree_order_wf heap_is_wellformed parent_child_rel type_wf known_ptr known_ptrs
to_tree_order get_parent get_child_nodes"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf_def l_to_tree_order_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_ok <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_ptrs_in_heap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_parent_child_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_child2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_node_ptrs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_child <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_ptr_in_result <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_parent <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_subset <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹get\_root\_node›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order_wf_get_root_node_wf<span class="main">?</span><span class="main">:</span> l_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">known_ptrs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">get_ancestors</span> <span class="quoted">get_ancestors_locs</span> <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span>
  <span class="quoted">to_tree_order</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_to_tree_order_wf_get_root_node_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_wf_get_root_node_wf_is_l_to_tree_order_wf_get_root_node_wf <span class="main">[</span><span class="operator">instances</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"l_to_tree_order_wf_get_root_node_wf ShadowRootClass.type_wf ShadowRootClass.known_ptr
ShadowRootClass.known_ptrs to_tree_order Shadow_DOM.get_root_node
     Shadow_DOM.heap_is_wellformed"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_wf_get_root_node_wf_def
      l_to_tree_order_wf_get_root_node_wf_axioms_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_get_root_node <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">using</span></span> to_tree_order_same_root <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹to\_tree\_order\_si›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_to_tree_order_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_child_nodes <span class="main">+</span>
  l_get_parent_get_host_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_to_tree_order_si<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> to_tree_order_si_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ptr</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="main">(</span><span class="free">to_tree_order_si</span> <span class="free">ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> heap_wellformed_induct_si<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">parent</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="skolem">parent</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> local.known_ptrs_known_ptr step.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> step
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> local.heap_is_wellformed_children_in_heap local.get_shadow_root_shadow_root_ptr_in_heap
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_tree_order_si_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">parent</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> get_child_nodes_ok get_shadow_root_ok
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_is_OK_pure_I map_M_pure_I bind_pure_I map_M_ok_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_to_tree_order_si_wf<span class="main">?</span><span class="main">:</span> l_to_tree_order_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">type_wf</span> <span class="quoted">known_ptr</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span>
  <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span>
  <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span>
  <span class="quoted">known_ptrs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">to_tree_order_si</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_to_tree_order_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_to_tree_order_si_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_assigned\_nodes›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> forall_M_small_big<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> forall_M <span class="free">f</span> <span class="free">xs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">h</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">⊢</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">h</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">h'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> l_assigned_nodes_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_assigned_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">+</span>
  l_heap_is_wellformed <span class="main">+</span>
  l_remove_child_wf2 <span class="main">+</span>
  l_append_child_wf <span class="main">+</span>
  l_remove_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> assigned_nodes_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">assigned_nodes</span> <span class="free">slot</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">nodes</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">nodes</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr</span> <span class="bound">children</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">⟹</span> distinct <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> local.heap_is_wellformed_children_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigned_nodes_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_E2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_M_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> flatten_dom_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">flatten_dom</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tups</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">element_ptrs</span></span> <span class="skolem"><span class="skolem">shadow_root_ptrs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> element_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">element_ptrs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    tups<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> map_filter_M2 <span class="main">(</span><span class="main">λ</span><span class="bound">element_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">tag</span> <span class="main">←</span> <span class="free">get_tag_name</span> <span class="bound">element_ptr</span><span class="main">;</span>
      <span class="bound">assigned_nodes</span> <span class="main">←</span> <span class="free">assigned_nodes</span> <span class="bound">element_ptr</span><span class="main">;</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">tag</span> <span class="main">=</span> <span class="inner_quoted">''slot''</span> <span class="main">∧</span> <span class="bound">assigned_nodes</span> <span class="main">≠</span> <span class="main">[]</span> <span class="keyword1">then</span>
return <span class="main">(</span>Some <span class="main">(</span><span class="bound">element_ptr</span><span class="main">,</span> <span class="bound">assigned_nodes</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> return None<span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="skolem">element_ptrs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">tups</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> map_filter_M2 <span class="var">?f</span> <span class="skolem">element_ptrs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">tups</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> forall_M <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">slot</span><span class="main">,</span> <span class="bound">assigned_nodes</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">slot</span><span class="main">)</span> <span class="main">⤜</span> forall_M <span class="free">remove</span><span class="main">;</span>
      forall_M <span class="main">(</span><span class="free">append_child</span> <span class="main">(</span>cast <span class="bound">slot</span><span class="main">)</span><span class="main">)</span> <span class="bound">assigned_nodes</span>
    <span class="main">}</span><span class="main">)</span> <span class="skolem">tups</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> shadow_root_ptr_kinds_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">shadow_root_ptrs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> forall_M <span class="main">(</span><span class="main">λ</span><span class="bound">shadow_root_ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">host</span> <span class="main">←</span> <span class="free">get_host</span> <span class="bound">shadow_root_ptr</span><span class="main">;</span>
      <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span> <span class="main">⤜</span> forall_M <span class="free">remove</span><span class="main">;</span>
      <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="bound">shadow_root_ptr</span><span class="main">)</span> <span class="main">⤜</span> forall_M <span class="main">(</span><span class="free">append_child</span> <span class="main">(</span>cast <span class="bound">host</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="free">remove_shadow_root</span> <span class="bound">host</span>
    <span class="main">}</span><span class="main">)</span> <span class="skolem">shadow_root_ptrs</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">flatten_dom</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flatten_dom_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> ElementMonad.ptr_kinds_M_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> ShadowRootMonad.ptr_kinds_M_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> pure_returns_heap_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_filter_M2_pure bind_pure_I<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="skolem">h2</span> <span class="main">∧</span> <span class="free">known_ptrs</span> <span class="skolem">h2</span> <span class="main">∧</span> <span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> get_child_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> forall_M_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="free">heap_is_wellformed</span> <span class="bound">h</span> <span class="main">∧</span> <span class="free">known_ptrs</span> <span class="bound">h</span> <span class="main">∧</span> <span class="free">type_wf</span> <span class="bound">h</span>"</span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> remove_preserves_known_ptrs remove_heap_is_wellformed_preserved
        remove_preserves_type_wf
        append_child_preserves_known_ptrs append_child_heap_is_wellformed_preserved
        append_child_preserves_type_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h'
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_host_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_child_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> forall_M_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="free">heap_is_wellformed</span> <span class="bound">h</span> <span class="main">∧</span> <span class="free">known_ptrs</span> <span class="bound">h</span> <span class="main">∧</span> <span class="free">type_wf</span> <span class="bound">h</span>"</span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> remove_preserves_known_ptrs remove_heap_is_wellformed_preserved
        remove_preserves_type_wf
        append_child_preserves_known_ptrs append_child_heap_is_wellformed_preserved
        append_child_preserves_type_wf
        remove_shadow_root_preserves
        <span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_assigned_nodes_wf<span class="main">?</span><span class="main">:</span> l_assigned_nodes_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted">known_ptr</span> <span class="quoted">assigned_nodes</span> <span class="quoted">assigned_nodes_flatten</span> <span class="quoted">flatten_dom</span> <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span>
  <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span> <span class="quoted">get_root_node</span> <span class="quoted">get_root_node_locs</span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">find_slot</span>
  <span class="quoted">assigned_slot</span> <span class="quoted">remove</span> <span class="quoted">insert_before</span> <span class="quoted">insert_before_locs</span> <span class="quoted">append_child</span> <span class="quoted">remove_shadow_root</span>
  <span class="quoted">remove_shadow_root_locs</span> <span class="quoted">type_wf</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">set_shadow_root</span>
  <span class="quoted">set_shadow_root_locs</span> <span class="quoted">get_parent</span> <span class="quoted">get_parent_locs</span> <span class="quoted">to_tree_order</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span>
  <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">known_ptrs</span> <span class="quoted">remove_child</span> <span class="quoted">remove_child_locs</span>
  <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_disconnected_document</span> <span class="quoted">get_disconnected_document_locs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_assigned_nodes_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_assigned_nodes_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹get\_shadow\_root\_safe›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_get_shadow_root_safe_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span> <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_host</span></span>
  <span class="quoted"><span class="free">get_host_locs</span></span> <span class="main">+</span>
  l_type_wf <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_get_shadow_root_safe<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root_safe</span></span> <span class="quoted"><span class="free">get_shadow_root_safe_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_mode</span></span> <span class="quoted"><span class="free">get_mode_locs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_safe</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_safe_locs</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> shadow_root_mode<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹create\_element›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_create_element_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_set_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="main">+</span>
  l_create_element_defs <span class="quoted"><span class="free">create_element</span></span> <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">get_disconnected_document</span></span>
  <span class="quoted"><span class="free">get_disconnected_document_locs</span></span> <span class="main">+</span>
  l_new_element_get_disconnected_nodes <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_set_tag_name_get_disconnected_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_create_element<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">create_element</span></span> <span class="quoted"><span class="free">known_ptr</span></span>
  <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="main">+</span>
  l_new_element_get_child_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  l_set_tag_name_get_child_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span>
  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  l_set_tag_name_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="main">+</span>
  l_new_element_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_set_disconnected_nodes_get_child_nodes <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="main">+</span>
  l_set_disconnected_nodes_get_shadow_root <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_set_disconnected_nodes_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="main">+</span>
  l_set_disconnected_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_set_disconnected_nodes_get_disconnected_nodes  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_new_element_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_set_tag_name_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_tag_name</span></span> <span class="quoted"><span class="free">set_tag_name_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span>
  <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="main">+</span>
  l_new_element <span class="quoted"><span class="free">type_wf</span></span> <span class="main">+</span>
  l_known_ptrs <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">known_ptrs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_element</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> create_element_preserves_wellformedness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_element</span> <span class="free">document_ptr</span> <span class="free">tag</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_element_ptr</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">h3</span></span> <span class="skolem"><span class="skolem">disc_nodes_h3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    new_element_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_element_ptr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_element <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">set_tag_name</span> <span class="skolem">new_element_ptr</span> <span class="free">tag</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    disc_nodes_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="main">(</span>cast <span class="skolem">new_element_ptr</span> <span class="main">#</span> <span class="skolem">disc_nodes_h3</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> create_element_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> CD.get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_element</span> <span class="free">document_ptr</span> <span class="free">tag</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_element_ptr</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> create_element_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_I is_OK_returns_result_E old.unit.exhaust<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_E is_OK_returns_result_I CD.get_disconnected_nodes_pure
        pure_returns_heap_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_I is_OK_returns_result_E old.unit.exhaust<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> element_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_ptr ElementMonad.ptr_kinds_ptr_kinds_M h2
    <span class="keyword1"><span class="command">using</span></span> new_element_ptr_not_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_element_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_new_ptr h2 new_element_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> node_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_element_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="skolem">new_element_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> character_data_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def character_data_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_tag_name_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_tag_name_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h'</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h'</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="free">h'</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="skolem">new_element_ptr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_element</span> <span class="free">document_ptr</span> <span class="free">tag</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_element_ptr</span>›</span></span> local.create_element_known_ptr
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_new_ptr object_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> h2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved object_ptr_kinds_eq_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved object_ptr_kinds_eq_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disc_nodes_h3 document_ptr_kinds_eq_h object_ptr_kinds_eq_h2
      CD.get_disconnected_nodes_ptr_in_heap <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> document_ptr_kinds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_result_I<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">ptr'</span><span class="main">::</span><span class="main">(_)</span> object_ptr<span class="main">)</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_element_ptr</span>
              <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads h2 get_child_nodes_new_element<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_element_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_element_ptr</span>
                                    <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_ptr h2 new_element_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> h2 new_element_ptr<span class="main">]</span>
      new_element_is_element_ptr<span class="main">[</span><span class="operator">OF</span> new_element_ptr<span class="main">]</span> new_element_no_child_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span>  <span class="skolem">new_element_ptr</span>
              <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads h2 get_tag_name_new_element<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_element_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>
                                    <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">new_element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="inner_quoted">''''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_ptr h2 new_element_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> h2 new_element_ptr<span class="main">]</span>
      new_element_is_element_ptr<span class="main">[</span><span class="operator">OF</span> new_element_ptr<span class="main">]</span> new_element_empty_tag_name
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads h2 get_disconnected_nodes_new_element<span class="main">[</span><span class="operator">OF</span> new_element_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads set_tag_name_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_tag_name_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                               <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads set_tag_name_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_tag_name_get_disconnected_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span>  <span class="skolem">new_element_ptr</span>
              <span class="main">⟹</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_tag_name_reads set_tag_name_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.set_tag_name_get_tag_name_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>
                                    <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">new_element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="inner_quoted">''''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_ptr h2 new_element_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> h2 new_element_ptr<span class="main">]</span>
      new_element_is_element_ptr<span class="main">[</span><span class="operator">OF</span> new_element_ptr<span class="main">]</span> new_element_empty_tag_name
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> new_element_types_preserved h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_tag_name_writes h3<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  set_tag_name_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  set_disconnected_nodes_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span>
       <span class="main">⟹</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                               <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_disconnected_nodes_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span>
                <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span>  <span class="skolem">new_element_ptr</span>
              <span class="main">⟹</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_tag_name_reads set_tag_name_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.set_tag_name_get_tag_name_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>
                                    <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> disc_nodes_document_ptr_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq_h2 disc_nodes_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disc_nodes_document_ptr_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      a_all_ptrs_in_heap_def heap_is_wellformed_def
    <span class="keyword1"><span class="command">using</span></span> NodeMonad.ptr_kinds_ptr_kinds_M local.heap_is_wellformed_disc_nodes_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_tag_name_reads set_disconnected_nodes_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_tag_name
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectMonad.ptr_kinds_ptr_kinds_M
          <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> children_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
          children_eq2_h empty_iff empty_set image_eqI select_result_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h2 children_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h3 children_eq2_h3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.acyclic_heap_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> funion_iff CD.get_child_nodes_ok local.known_ptrs_known_ptr
        local.parent_child_rel_child_in_heap CD.parent_child_rel_child_nodes2 node_ptr_kinds_commutes
        node_ptr_kinds_eq_h returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CD.get_child_nodes_ok CD.get_child_nodes_ptr_in_heap
        <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span>
        children_eq_h disconnected_nodes_eq2_h document_ptr_kinds_eq_h finite_set_in is_OK_returns_result_I
        local.known_ptrs_known_ptr node_ptr_kinds_commutes returns_result_select_result subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h2 disconnected_nodes_eq2_h2 document_ptr_kinds_eq_h2
        CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq_h2 object_ptr_kinds_eq_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> children_eq2_h3 disc_nodes_h3 disconnected_nodes_eq2_h3 document_ptr_kinds_eq_h3
        element_ptr_kinds_commutes h' h2 local.CD.a_all_ptrs_in_heap_def
        local.set_disconnected_nodes_get_disconnected_nodes new_element_ptr new_element_ptr_in_heap
        node_ptr_kinds_eq_h2 node_ptr_kinds_eq_h3 notin_fset object_ptr_kinds_eq_h3 select_result_I2
        set_ConsD subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      heap_is_wellformed_children_in_heap
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NodeMonad.ptr_kinds_ptr_kinds_M CD.a_all_ptrs_in_heap_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> fset_mp
        fset_of_list_elem CD.get_child_nodes_ok known_ptrs_known_ptr returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span> <span class="main">⟹</span> cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> children_eq2_h
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectMonad.ptr_kinds_ptr_kinds_M
        <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span> <span class="main">⟹</span> cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2 children_eq2_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> new_element_ptr_not_in_any_children<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span> <span class="main">⟹</span> cast <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3 children_eq2_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.heap_is_wellformed_def heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def object_ptr_kinds_eq_h document_ptr_kinds_eq_h
        disconnected_nodes_eq2_h <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> distinct_sorted_list_of_set finite_fset sorted_list_of_set_insert<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">=</span>cast <span class="skolem">new_element_ptr</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IntI assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> empty_iff  CD.get_child_nodes_ok
        local.heap_is_wellformed_one_parent local.known_ptrs_known_ptr returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ CD.a_distinct_lists <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> disconnected_nodes_eq_h document_ptr_kinds_eq_h
        CD.distinct_lists_no_parent  get_disconnected_nodes_ok returns_result_select_result<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" CD.a_distinct_lists <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  CD.a_distinct_lists_def disconnected_nodes_eq2_h2 document_ptr_kinds_eq_h2
        children_eq2_h2 object_ptr_kinds_eq_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" CD.a_distinct_lists <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  CD.a_distinct_lists_def disconnected_nodes_eq2_h3 children_eq2_h3
      object_ptr_kinds_eq_h3 document_ptr_kinds_eq_h3
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                                              <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> document_ptr_kinds_eq_h3 disconnected_nodes_eq_h3 h'
        set_disconnected_nodes_get_disconnected_nodes
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_h3</span>›</span></span>
          <span class="quoted"><span class="quoted">‹ CD.a_distinct_lists <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> disc_nodes_h3 distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          CD.distinct_lists_disconnected_nodes  get_disconnected_nodes_ok returns_result_eq
          returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xa</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                                            <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">-</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">document_ptr</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">smt</span> NodeMonad.ptr_kinds_ptr_kinds_M
          <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="free">h</span>›</span></span>
          disc_nodes_h3 disconnected_nodes_eq2_h disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3
          disjoint_iff_not_equal document_ptr_kinds_eq_h document_ptr_kinds_eq_h2 finite_set_in h'
          set_disconnected_nodes_get_disconnected_nodes
          CD.a_all_ptrs_in_heap_def
          select_result_I2 set_ConsD subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> NodeMonad.ptr_kinds_ptr_kinds_M
          <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="free">h</span>›</span></span>
          disc_nodes_document_ptr_h2 disconnected_nodes_eq2_h disconnected_nodes_eq2_h2
          disconnected_nodes_eq2_h3
          disjoint_iff_not_equal document_ptr_kinds_eq_h document_ptr_kinds_eq_h2 finite_set_in h'
          l_set_disconnected_nodes_get_disconnected_nodes.set_disconnected_nodes_get_disconnected_nodes
          CD.a_all_ptrs_in_heap_def local.l_set_disconnected_nodes_get_disconnected_nodes_axioms
          select_result_I2 set_ConsD subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                   <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_document_ptr_h disconnected_nodes_eq2_h3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">=</span> <span class="free">document_ptr</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span> <span class="quoted">"4"</span> <span class="quoted">"6"</span>
          <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span>
                      <span class="main">⟹</span> cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
          <span class="quoted"><span class="quoted">‹ CD.a_distinct_lists <span class="skolem">h3</span>›</span></span> children_eq2_h3 disc_nodes_h3 CD.distinct_lists_no_parent h'
          select_result_I2 set_ConsD  set_disconnected_nodes_get_disconnected_nodes<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"4"</span> <span class="quoted">"5"</span> <span class="quoted">"6"</span> <span class="quoted"><span class="quoted">‹ CD.a_distinct_lists <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> children_eq2_h3
          CD.distinct_lists_no_parent  get_disconnected_nodes_ok returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disc_nodes_h3 <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  object_ptr_kinds_eq_h object_ptr_kinds_eq_h3 <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  document_ptr_kinds_eq_h document_ptr_kinds_eq_h3 <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  node_ptr_kinds_eq_h node_ptr_kinds_eq_h3 <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_eq_h2 node_ptr_kinds_eq_h <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> children_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        disconnected_nodes_eq2_h disconnected_nodes_eq2_h2
        disconnected_nodes_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> document_ptr_kinds_eq_h h' list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        local.set_disconnected_nodes_get_disconnected_nodes select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> NodeMonad.ptr_kinds_ptr_kinds_M
        <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_element_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> children_eq2_h children_eq2_h2
        children_eq2_h3 disconnected_nodes_eq2_h disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3
        document_ptr_kinds_eq_h finite_set_in h'
        l_set_disconnected_nodes_get_disconnected_nodes.set_disconnected_nodes_get_disconnected_nodes
        list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.l_set_disconnected_nodes_get_disconnected_nodes_axioms
        node_ptr_kinds_commutes select_result_I2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_heap_is_wellformed <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹CD.a_acyclic_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹CD.a_distinct_lists <span class="free">h'</span>›</span></span>
      <span class="quoted"><span class="quoted">‹CD.a_owner_document_valid <span class="free">h'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_heap_is_wellformed_def<span class="main">)</span>





  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h'</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>



  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">element_ptr</span> <span class="bound">shadow_root_opt</span><span class="main">.</span> <span class="bound">element_ptr</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>
              <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span> <span class="main">=</span>
<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">element_ptr</span> <span class="skolem">shadow_root_opt</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">element_ptr</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="main">∈</span> <span class="free">get_shadow_root_locs</span> <span class="skolem">element_ptr</span><span class="main">.</span> <span class="bound">P</span> <span class="free">h</span> <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_shadow_root_new_element new_element_ptr h2
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">element_ptr</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preserved <span class="main">(</span><span class="free">get_shadow_root</span> <span class="skolem">element_ptr</span><span class="main">)</span> <span class="free">h</span> <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_shadow_root_new_element<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_element_ptr h2<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">shadow_root_opt</span> <span class="main">=</span>
<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">shadow_root_opt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preserved_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="main">(</span><span class="skolem">new_element_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_element_ptr h2 new_element_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> h2 new_element_ptr<span class="main">]</span>
      new_element_is_element_ptr<span class="main">[</span><span class="operator">OF</span> new_element_ptr<span class="main">]</span> new_element_no_shadow_root
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_tag_name_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_tag_name_get_shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_shadow_root
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_shadow_root<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.a_all_ptrs_in_heap_def local.get_shadow_root_shadow_root_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> returns_result_eq shadow_root_eq_h shadow_root_none <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_eq_h3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_insort <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="skolem">new_element_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_none <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Diff_empty Diff_insert0 ElementMonad.ptr_kinds_M_ptr_kinds
        ElementMonad.ptr_kinds_ptr_kinds_M assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> finite_set_in h2 insort_split
        local.get_shadow_root_ok local.shadow_root_same_host new_element_ptr new_element_ptr_not_in_heap
        option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_select_result select_result_I2 shadow_root_none<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h2 select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h3 select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h3<span class="main"><span class="main">]</span></span><span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="skolem">h2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> a_shadow_root_valid_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">shadow_root_ptr</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">shadow_root_ptr</span><span class="main">∈</span>fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="bound">shadow_root_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="skolem">h2</span><span class="main">)</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">previous_host</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">previous_host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹local.a_shadow_root_valid <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="skolem">h2</span><span class="main">)</span>›</span></span>
          local.a_shadow_root_valid_def shadow_root_ptr_kinds_eq_h<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">previous_host</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">)</span> h2 new_element_ptr new_element_ptr_not_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tag_name_eq2_h<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">previous_host</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>›</span></span>
          select_result_eq shadow_root_eq_h<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span>
<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">previous_host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">previous_host</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>›</span></span>
          assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.get_shadow_root_ok local.get_shadow_root_ptr_in_heap notin_fset
          returns_result_select_result shadow_root_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="skolem">h3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> a_shadow_root_valid_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">shadow_root_ptr</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">shadow_root_ptr</span><span class="main">∈</span>fset <span class="main">(</span>shadow_root_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="skolem">h2</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span>
<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="bound">shadow_root_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="skolem">h3</span><span class="main">)</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">previous_host</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">previous_host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="skolem">h2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹local.a_shadow_root_valid <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="skolem">h3</span><span class="main">)</span>›</span></span>
          local.a_shadow_root_valid_def shadow_root_ptr_kinds_eq_h2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">previous_host</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">)</span> h3 new_element_ptr new_element_ptr_not_in_heap
      <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>3<span class="main">)</span> shadow_root_none <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tag_name_eq2_h2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">previous_host</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">previous_host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>›</span></span> select_result_eq
          shadow_root_eq_h<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span>
<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="skolem">previous_host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="skolem">h2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">previous_host</span> <span class="main">≠</span> <span class="skolem">new_element_ptr</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> element_ptr_kinds_eq_h2 finite_set_in local.get_shadow_root_ok
          returns_result_eq returns_result_select_result shadow_root_eq_h2 tag_name_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_shadow_root_valid_def element_ptr_kinds_eq_h3 shadow_root_eq_h3
        shadow_root_ptr_kinds_eq_h3 tag_name_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> finite_set_in local.get_shadow_root_ok returns_result_select_result
        select_result_I2 shadow_root_eq_h3<span class="main">)</span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h shadow_root_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> case_prod_conv h2 image_iff local.get_shadow_root_ok mem_Collect_eq
        new_element_ptr new_element_ptr_not_in_heap returns_result_select_result select_result_I2
        shadow_root_eq_h<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_none <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> case_prodE case_prodI h2
        host_shadow_root_rel_def host_shadow_root_rel_shadow_root local.a_host_shadow_root_rel_def
        local.get_shadow_root_impl local.get_shadow_root_ok local.new_element_no_shadow_root
        new_element_ptr option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> returns_result_select_result select_result_I2 shadow_root_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h2 shadow_root_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Collect_cong Shadow_DOM.a_host_shadow_root_rel_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> h2
        host_shadow_root_rel_shadow_root is_OK_returns_result_E local.get_shadow_root_impl
        local.get_shadow_root_ok local.new_element_types_preserved select_result_I2 shadow_root_eq_h2
        split_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> element_ptr_kinds_eq_h2
        host_shadow_root_rel_def host_shadow_root_rel_shadow_root local.a_host_shadow_root_rel_def
        local.get_shadow_root_impl local.get_shadow_root_ok returns_result_select_result shadow_root_eq_h2
        split_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> a_host_shadow_root_rel <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h2 shadow_root_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> case_prodE case_prodI
        element_ptr_kinds_eq_h2 host_shadow_root_rel_def host_shadow_root_rel_shadow_root
        local.a_host_shadow_root_rel_def local.get_shadow_root_impl local.get_shadow_root_ok
        returns_result_select_result shadow_root_eq_h3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Collect_cong <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> case_prodD case_prodI2 host_shadow_root_rel_def
        host_shadow_root_rel_shadow_root is_OK_returns_result_E local.a_host_shadow_root_rel_def
        local.get_shadow_root_impl local.get_shadow_root_ok select_result_I2 shadow_root_eq_h2 shadow_root_eq_h3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span><span class="main">)</span>


  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">heap_is_wellformed</span> <span class="free">h'</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_impl
        <span class="quoted"><span class="quoted">‹local.CD.a_heap_is_wellformed <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_distinct_lists <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.a_shadow_root_valid <span class="free">h'</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> i_create_element_wf<span class="main">?</span><span class="main">:</span> l_create_element_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">type_wf</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">set_tag_name</span> <span class="quoted">set_tag_name_locs</span> <span class="quoted">set_disconnected_nodes</span>
  <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">create_element</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">DocumentClass.known_ptr</span> <span class="quoted">DocumentClass.type_wf</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_create_element_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_create_element_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹create\_character\_data›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_create_character_data_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_nodes <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="main">+</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">get_disconnected_document</span></span>
  <span class="quoted"><span class="free">get_disconnected_document_locs</span></span> <span class="main">+</span>
  l_create_character_data<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_val</span></span> <span class="quoted"><span class="free">set_val_locs</span></span> <span class="quoted"><span class="free">create_character_data</span></span>
  <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span>
  <span class="main">+</span> l_new_character_data_get_disconnected_nodes
  <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>

<span class="main">+</span> l_set_val_get_disconnected_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_val</span></span> <span class="quoted"><span class="free">set_val_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
<span class="main">+</span> l_new_character_data_get_child_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
<span class="main">+</span> l_set_val_get_child_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_val</span></span> <span class="quoted"><span class="free">set_val_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
<span class="main">+</span> l_set_disconnected_nodes_get_child_nodes
<span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
<span class="main">+</span> l_set_disconnected_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
<span class="main">+</span> l_set_disconnected_nodes_get_disconnected_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span>
<span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
<span class="main">+</span> l_set_val_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_val</span></span> <span class="quoted"><span class="free">set_val_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
<span class="main">+</span> l_set_disconnected_nodes_get_shadow_root <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
<span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
<span class="main">+</span> l_new_character_data_get_tag_name
<span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_set_val_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_val</span></span> <span class="quoted"><span class="free">set_val_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_set_disconnected_nodes_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_disconnected_nodes</span></span> <span class="quoted"><span class="free">set_disconnected_nodes_locs</span></span>
<span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_new_character_data
<span class="quoted"><span class="free">type_wf</span></span>
<span class="main">+</span> l_known_ptrs
<span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">known_ptrs</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_character_data</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> character_data_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> create_character_data_preserves_wellformedness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_character_data</span> <span class="free">document_ptr</span> <span class="free">text</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_character_data_ptr</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">h3</span></span> <span class="skolem"><span class="skolem">disc_nodes_h3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    new_character_data_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_character_data_ptr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_character_data <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">set_val</span> <span class="skolem">new_character_data_ptr</span> <span class="free">text</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    disc_nodes_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">set_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span> <span class="main">#</span> <span class="skolem">disc_nodes_h3</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.create_character_data_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> CD.get_disconnected_nodes_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_character_data</span> <span class="free">document_ptr</span> <span class="free">text</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_character_data_ptr</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.create_character_data_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_I is_OK_returns_result_E old.unit.exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_E is_OK_returns_result_I local.CD.get_disconnected_nodes_pure
        pure_returns_heap_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_heap_I is_OK_returns_result_E old.unit.exhaust<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> character_data_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_character_data_ptr CharacterDataMonad.ptr_kinds_ptr_kinds_M h2
    <span class="keyword1"><span class="command">using</span></span> new_character_data_ptr_not_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_character_data_new_ptr h2 new_character_data_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> node_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> character_data_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def element_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> CD.set_val_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CD.set_val_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h'</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h'</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_character_data</span> <span class="free">document_ptr</span> <span class="free">text</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_character_data_ptr</span>›</span></span>
      local.create_character_data_known_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_new_ptr object_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> h2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved object_ptr_kinds_eq_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved object_ptr_kinds_eq_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disc_nodes_h3 document_ptr_kinds_eq_h object_ptr_kinds_eq_h2
      CD.get_disconnected_nodes_ptr_in_heap <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> document_ptr_kinds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_result_I<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">ptr'</span><span class="main">::</span><span class="main">(_)</span> object_ptr<span class="main">)</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_character_data_ptr</span>
                  <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads h2
      get_child_nodes_new_character_data<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_character_data_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_character_data_ptr</span>
      <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_character_data_new_ptr h2 new_character_data_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> node_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> character_data_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="skolem">new_character_data_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def element_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> CD.set_val_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CD.set_val_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> character_data_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h'</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h'</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="free">h'</span> <span class="main">=</span> character_data_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="free">h'</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disc_nodes_h3 document_ptr_kinds_eq_h object_ptr_kinds_eq_h2
      CD.get_disconnected_nodes_ptr_in_heap <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> document_ptr_kinds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_OK_returns_result_I<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">ptr'</span><span class="main">::</span><span class="main">(_)</span> object_ptr<span class="main">)</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_character_data_ptr</span>
                <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads h2
      get_child_nodes_new_character_data<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_character_data_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_character_data_ptr</span>
                                 <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_character_data_ptr h2 new_character_data_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> h2 new_character_data_ptr<span class="main">]</span>
      new_character_data_is_character_data_ptr<span class="main">[</span><span class="operator">OF</span> new_character_data_ptr<span class="main">]</span>
      new_character_data_no_child_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads h2
      get_disconnected_nodes_new_character_data<span class="main">[</span><span class="operator">OF</span> new_character_data_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads h2
      get_tag_name_new_character_data<span class="main">[</span><span class="operator">OF</span> new_character_data_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads CD.set_val_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_val_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                              <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads CD.set_val_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_val_get_disconnected_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads CD.set_val_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_val_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> new_character_data_types_preserved h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> CD.set_val_writes h3<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  set_val_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_disconnected_nodes_writes h'<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  set_disconnected_nodes_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span>
    <span class="main">⟹</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                            <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_disconnected_nodes_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="free">document_ptr</span> <span class="main">≠</span> <span class="bound">doc_ptr</span>
             <span class="main">⟹</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> disc_nodes_document_ptr_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq_h2 disc_nodes_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disc_nodes_document_ptr_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="free">document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">disc_nodes_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disconnected_nodes_eq_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      a_all_ptrs_in_heap_def heap_is_wellformed_def
    <span class="keyword1"><span class="command">using</span></span> NodeMonad.ptr_kinds_ptr_kinds_M local.heap_is_wellformed_disc_nodes_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectMonad.ptr_kinds_ptr_kinds_M
          <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> children_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
          children_eq2_h empty_iff empty_set image_eqI select_result_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h2 children_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h3 children_eq2_h3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.acyclic_heap_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> NodeMonad.ptr_kinds_ptr_kinds_M
        <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span>
        children_eq2_h finite_set_in finsert_iff funion_finsert_right CD.parent_child_rel_child
        CD.parent_child_rel_parent_in_heap node_ptr_kinds_commutes object_ptr_kinds_eq_h
        select_result_I2 subsetD sup_bot.right_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CD.get_child_nodes_ok CD.get_child_nodes_ptr_in_heap
        <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span>
        children_eq_h disconnected_nodes_eq2_h document_ptr_kinds_eq_h finite_set_in
        is_OK_returns_result_I local.known_ptrs_known_ptr node_ptr_kinds_commutes
        returns_result_select_result subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h2 disconnected_nodes_eq2_h2 document_ptr_kinds_eq_h2
        CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq_h2 object_ptr_kinds_eq_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> character_data_ptr_kinds_commutes character_data_ptr_kinds_eq_h2 children_eq2_h3
        disc_nodes_h3 disconnected_nodes_eq2_h3 document_ptr_kinds_eq_h3 h' h2
        local.CD.a_all_ptrs_in_heap_def local.set_disconnected_nodes_get_disconnected_nodes
        new_character_data_ptr new_character_data_ptr_in_heap node_ptr_kinds_eq_h3 notin_fset
        object_ptr_kinds_eq_h3 select_result_I2 set_ConsD subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span> <span class="main">⟹</span> cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      heap_is_wellformed_children_in_heap
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NodeMonad.ptr_kinds_ptr_kinds_M CD.a_all_ptrs_in_heap_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> fset_mp
        fset_of_list_elem CD.get_child_nodes_ok known_ptrs_known_ptr returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span> <span class="main">⟹</span>
cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> children_eq2_h
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectMonad.ptr_kinds_ptr_kinds_M
        <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span> <span class="main">⟹</span>
cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2 children_eq2_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> new_character_data_ptr_not_in_any_children<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span> <span class="main">⟹</span> cast <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">p</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3 children_eq2_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_character_data_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def object_ptr_kinds_eq_h document_ptr_kinds_eq_h
        disconnected_nodes_eq2_h <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> distinct_sorted_list_of_set finite_fset sorted_list_of_set_insert<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">=</span>cast <span class="skolem">new_character_data_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IntI assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> empty_iff CD.get_child_nodes_ok
        local.heap_is_wellformed_one_parent local.known_ptrs_known_ptr
        returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> insort_split <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">thm</span></span> children_eq2_h

    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹CD.a_distinct_lists <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> disconnected_nodes_eq_h document_ptr_kinds_eq_h
      CD.distinct_lists_no_parent get_disconnected_nodes_ok returns_result_select_result
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def disconnected_nodes_eq2_h2 document_ptr_kinds_eq_h2
        children_eq2_h2 object_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def disconnected_nodes_eq2_h3 children_eq2_h3
      object_ptr_kinds_eq_h3 document_ptr_kinds_eq_h3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                      <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> document_ptr_kinds_eq_h3 disconnected_nodes_eq_h3 h'
        set_disconnected_nodes_get_disconnected_nodes
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>
          <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="skolem">disc_nodes_h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
          disc_nodes_document_ptr_h disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3
          disconnected_nodes_eq_h distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> document_ptr_kinds_eq_h2 local.get_disconnected_nodes_ok
          local.heap_is_wellformed_disconnected_nodes_distinct returns_result_select_result select_result_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xa</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                                            <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  NodeMonad.ptr_kinds_ptr_kinds_M
        <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> node_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>

      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> local.CD.a_all_ptrs_in_heap_def <span class="quoted"><span class="quoted">‹CD.a_all_ptrs_in_heap <span class="free">h</span>›</span></span> disc_nodes_document_ptr_h2
          disconnected_nodes_eq2_h
          disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3 disjoint_iff_not_equal
          document_ptr_kinds_eq_h document_ptr_kinds_eq_h2 finite_set_in h'
          l_set_disconnected_nodes_get_disconnected_nodes.set_disconnected_nodes_get_disconnected_nodes
          local.a_all_ptrs_in_heap_def local.l_set_disconnected_nodes_get_disconnected_nodes_axioms
          select_result_I2 set_ConsD subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                  <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="skolem">h3</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc_nodes_document_ptr_h disconnected_nodes_eq2_h3
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">document_ptr</span> <span class="main">=</span> <span class="skolem">xb</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span> <span class="quoted">"4"</span> <span class="quoted">"5"</span> <span class="quoted">"6"</span> CD.distinct_lists_no_parent
          <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> children_eq2_h2 children_eq2_h3
          disc_nodes_document_ptr_h2 document_ptr_kinds_eq_h3 h' local.get_disconnected_nodes_ok
          local.set_disconnected_nodes_get_disconnected_nodes new_character_data_ptr_not_in_any_children
          object_ptr_kinds_eq_h2 object_ptr_kinds_eq_h3 returns_result_eq returns_result_select_result
          set_ConsD<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"4"</span> <span class="quoted">"5"</span> <span class="quoted">"6"</span> CD.distinct_lists_no_parent <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="skolem">h3</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> children_eq2_h3 local.get_disconnected_nodes_ok returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disc_nodes_h3 <span class="quoted"><span class="quoted">‹<span class="free">document_ptr</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h object_ptr_kinds_eq_h3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq_h document_ptr_kinds_eq_h3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq_h2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_eq_h node_ptr_kinds_eq_h3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_eq_h2 node_ptr_kinds_eq_h <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> children_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        disconnected_nodes_eq2_h
        disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> document_ptr_kinds_eq_h h' list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        local.set_disconnected_nodes_get_disconnected_nodes select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
        <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_character_data_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
        children_eq2_h disconnected_nodes_eq2_h3 document_ptr_kinds_eq_h finite_set_in h'
        l_ptr_kinds_M.ptr_kinds_ptr_kinds_M
        l_set_disconnected_nodes_get_disconnected_nodes.set_disconnected_nodes_get_disconnected_nodes
        list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.l_set_disconnected_nodes_get_disconnected_nodes_axioms
        object_ptr_kinds_M_def
        select_result_I2<span class="main">)</span>






  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h'</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>



  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">character_data_ptr</span> <span class="bound">shadow_root_opt</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">character_data_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span> <span class="main">=</span>
<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">character_data_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads h2 get_shadow_root_new_character_data<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.get_shadow_root_locs_impl new_character_data_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> local.get_shadow_root_locs_impl new_character_data_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_val_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_val_get_shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_disconnected_nodes_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_disconnected_nodes_get_shadow_root
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_disconnected_nodes_get_shadow_root<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.a_all_ptrs_in_heap_def local.get_shadow_root_shadow_root_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> returns_result_eq shadow_root_eq_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_eq_h3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def character_data_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_insort <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.get_shadow_root_ok local.shadow_root_same_host
        returns_result_select_result shadow_root_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h2
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h3
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h3<span class="main"><span class="main">]</span></span><span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_shadow_root_valid_def shadow_root_ptr_kinds_eq_h element_ptr_kinds_eq_h
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h<span class="main"><span class="main">]</span></span> tag_name_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_shadow_root_valid_def shadow_root_ptr_kinds_eq_h2 element_ptr_kinds_eq_h2
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h2<span class="main"><span class="main">]</span></span> tag_name_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_shadow_root_valid_def shadow_root_ptr_kinds_eq_h3 element_ptr_kinds_eq_h3
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h3<span class="main"><span class="main">]</span></span> tag_name_eq2_h3<span class="main">)</span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h2
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> a_host_shadow_root_rel <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h3
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h3<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span>
local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span><span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_heap_is_wellformed <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_acyclic_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_owner_document_valid <span class="free">h'</span>›</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_impl
        <span class="quoted"><span class="quoted">‹local.CD.a_heap_is_wellformed <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_distinct_lists <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.a_shadow_root_valid <span class="free">h'</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹create\_document›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_create_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">get_disconnected_document</span></span>
  <span class="quoted"><span class="free">get_disconnected_document_locs</span></span>
  <span class="main">+</span> l_new_document_get_disconnected_nodes
  <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="main">+</span> l_create_document<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">create_document</span></span>
  <span class="main">+</span> l_new_document_get_child_nodes
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
  <span class="main">+</span> l_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="main">+</span> l_new_document_get_tag_name <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
  <span class="main">+</span> l_get_disconnected_nodes<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span>
  <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="main">+</span> l_new_document
  <span class="quoted"><span class="free">type_wf</span></span>
  <span class="main">+</span> l_known_ptrs
  <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">known_ptrs</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> create_document_preserves_wellformedness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">create_document</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_document_ptr</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    new_document_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_document_ptr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> create_document_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> new_document_ok <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">new_document_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> document_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_document_ptr DocumentMonad.ptr_kinds_ptr_kinds_M
    <span class="keyword1"><span class="command">using</span></span> new_document_ptr_not_in_heap h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_document_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">new_document_ptr</span> <span class="main">|∉|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_document_ptr DocumentMonad.ptr_kinds_ptr_kinds_M
    <span class="keyword1"><span class="command">using</span></span> new_document_ptr_not_in_heap h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_document_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_document_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_document_new_ptr h' new_document_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h'</span> <span class="main">=</span> node_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="free">h'</span> <span class="main">=</span> character_data_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="free">h'</span> <span class="main">=</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def element_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h'</span> <span class="main">=</span> document_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="skolem">new_document_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> document_ptr_kinds_commutes document_ptr_kinds_def finsertI1
        fset.map_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h'</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="keyword1"><span class="command">have</span></span> children_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">ptr'</span><span class="main">::</span><span class="main">(_)</span> object_ptr<span class="main">)</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_document_ptr</span>
             <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads h' get_child_nodes_new_document<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_document_ptr h'<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_document_ptr</span>
                                    <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_document_ptr h' new_document_ptr_in_heap<span class="main">[</span><span class="operator">OF</span> h' new_document_ptr<span class="main">]</span>
      new_document_is_document_ptr<span class="main">[</span><span class="operator">OF</span> new_document_ptr<span class="main">]</span> new_document_no_child_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="bound">doc_ptr</span> <span class="main">≠</span> <span class="skolem">new_document_ptr</span>
    <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span> <span class="main">=</span>
<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_disconnected_nodes_reads h' get_disconnected_nodes_new_document_different_pointers
      new_document_ptr
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">new_document_ptr</span><span class="main">.</span>
             <span class="main">⟦</span><span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">new_document_ptr</span><span class="main">;</span> <span class="free">h</span> <span class="main">⊢</span> new_document <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
        local.get_disconnected_nodes_new_document_different_pointers new_document_ptr<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="bound">doc_ptr</span> <span class="main">≠</span> <span class="skolem">new_document_ptr</span>
                 <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">new_document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h' local.new_document_no_disconnected_nodes new_document_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> new_document_types_preserved h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectMonad.ptr_kinds_ptr_kinds_M
          <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_document_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> children_eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
          children_eq2 empty_iff empty_set image_eqI select_result_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.acyclic_heap_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span>  ObjectMonad.ptr_kinds_ptr_kinds_M
      <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_document_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> children_eq fset_of_list_elem
      local.heap_is_wellformed_children_in_heap CD.parent_child_rel_child
      CD.parent_child_rel_parent_in_heap node_ptr_kinds_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
        children_eq2 finite_set_in finsert_iff funion_finsert_right object_ptr_kinds_eq
        select_result_I2 subsetD sup_bot.right_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">new_document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span>
        assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> disconnected_nodes_eq_h empty_iff empty_set local.get_disconnected_nodes_ok
        local.heap_is_wellformed_disc_nodes_in_heap node_ptr_kinds_eq returns_result_select_result
        select_result_I2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">new_document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> CD.a_distinct_lists_def insort_split
        object_ptr_kinds_eq
        document_ptr_kinds_eq_h  disconnected_nodes_eq2_h <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> distinct_sorted_list_of_set finite_fset sorted_list_of_set_insert<span class="main">)</span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">new_document_ptr</span> <span class="main">|∉|</span> document_ptr_kinds <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_insort <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h get_disconnected_nodes_ok
        local.heap_is_wellformed_disconnected_nodes_distinct
        returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">new_document_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">new_document_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                                              <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a7 a3 disconnected_nodes_eq2_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a8 a5 disconnected_nodes_eq2_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> f11 f10 f9 a6 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjoint_iff_not_equal distinct_concat_map_E<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">new_document_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_document_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                                                  <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">document_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">document_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                                              <span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
                      <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_document_ptr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">≠</span> <span class="skolem">new_document_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>

      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹CD.a_distinct_lists <span class="free">h</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h
          CD.distinct_lists_no_parent get_disconnected_nodes_ok
          returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_document_ptr</span> <span class="main">|∉|</span> object_ptr_kinds <span class="free">h</span>›</span></span>
        children_eq2 disconnected_nodes_eq2_h document_ptr_kinds_commutes finite_set_in funion_iff
        node_ptr_kinds_eq object_ptr_kinds_eq<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">character_data_ptr</span> <span class="bound">shadow_root_opt</span><span class="main">.</span>
<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">character_data_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span> <span class="main">=</span>
<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">character_data_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads assms<span class="main">(</span>2<span class="main">)</span> get_shadow_root_new_document<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> h'<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.get_shadow_root_locs_impl new_document_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> local.get_shadow_root_locs_impl new_document_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.a_all_ptrs_in_heap_def local.get_shadow_root_shadow_root_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq document_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def character_data_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_insort <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.get_shadow_root_ok local.shadow_root_same_host
        returns_result_select_result shadow_root_eq_h<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads h'
      get_tag_name_new_document<span class="main">[</span><span class="operator">OF</span> new_document_ptr h'<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_document_is_document_ptr<span class="main">[</span><span class="operator">OF</span> new_document_ptr<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_shadow_root_valid_def element_ptr_kinds_eq_h document_ptr_kinds_eq_h
        shadow_root_ptr_kinds_eq select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h<span class="main"><span class="main">]</span></span> select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tag_name_eq_h<span class="main"><span class="main">]</span></span><span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> a_host_shadow_root_rel <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_heap_is_wellformed <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_acyclic_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_owner_document_valid <span class="free">h'</span>›</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.heap_is_wellformed_impl <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹local.CD.a_heap_is_wellformed <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_distinct_lists <span class="free">h'</span>›</span></span>
      <span class="quoted"><span class="quoted">‹local.a_shadow_root_valid <span class="free">h'</span>›</span></span> local.heap_is_wellformed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> l_create_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">type_wf</span> <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">get_child_nodes</span>
  <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span> <span class="quoted">get_shadow_root</span>
  <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span> <span class="quoted">get_tag_name_locs</span>
  <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">set_val</span> <span class="quoted">set_val_locs</span>
  <span class="quoted">set_disconnected_nodes</span> <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">create_document</span> <span class="quoted">known_ptrs</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_create_document_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹attach\_shadow\_root›</span></span>

<span class="keyword1"><span class="command">locale</span></span> l_attach_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="main">=</span>
  l_get_disconnected_nodes
  <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="main">+</span> l_heap_is_wellformed<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>
  <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
  <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">type_wf</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed</span></span> <span class="quoted"><span class="free">parent_child_rel</span></span>
  <span class="quoted"><span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span></span> <span class="quoted"><span class="free">get_host</span></span> <span class="quoted"><span class="free">get_host_locs</span></span> <span class="quoted"><span class="free">get_disconnected_document</span></span>
  <span class="quoted"><span class="free">get_disconnected_document_locs</span></span>
  <span class="main">+</span> l_attach_shadow_root<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="quoted"><span class="free">set_mode</span></span>
  <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="quoted"><span class="free">attach_shadow_root</span></span> <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span>
  <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
  <span class="main">+</span> l_new_shadow_root_get_disconnected_nodes
  <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>

<span class="main">+</span> l_set_mode_get_disconnected_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
<span class="main">+</span> l_new_shadow_root_get_child_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
<span class="main">+</span> l_new_shadow_root_get_tag_name
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_set_mode_get_child_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
<span class="main">+</span> l_set_shadow_root_get_child_nodes
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">get_child_nodes</span></span> <span class="quoted"><span class="free">get_child_nodes_locs</span></span>
<span class="main">+</span> l_set_shadow_root
<span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span>
<span class="main">+</span> l_set_shadow_root_get_disconnected_nodes
<span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_disconnected_nodes</span></span> <span class="quoted"><span class="free">get_disconnected_nodes_locs</span></span>
<span class="main">+</span> l_set_mode_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
<span class="main">+</span> l_set_shadow_root_get_shadow_root <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span>
<span class="quoted"><span class="free">get_shadow_root</span></span> <span class="quoted"><span class="free">get_shadow_root_locs</span></span>
<span class="main">+</span> l_new_character_data_get_tag_name
<span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_set_mode_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">set_mode</span></span> <span class="quoted"><span class="free">set_mode_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_get_tag_name <span class="quoted"><span class="free">type_wf</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_set_shadow_root_get_tag_name <span class="quoted"><span class="free">set_shadow_root</span></span> <span class="quoted"><span class="free">set_shadow_root_locs</span></span> <span class="quoted"><span class="free">get_tag_name</span></span> <span class="quoted"><span class="free">get_tag_name_locs</span></span>
<span class="main">+</span> l_new_shadow_root
<span class="quoted"><span class="free">type_wf</span></span>
<span class="main">+</span> l_known_ptrs
<span class="quoted"><span class="free">known_ptr</span></span> <span class="quoted"><span class="free">known_ptrs</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">known_ptr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptrs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_child_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> node_ptr list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">parent_child_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr <span class="main">×</span> <span class="main">(_)</span> object_ptr<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(_)</span> node_ptr list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_disconnected_nodes_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> shadow_root_ptr option<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> char list<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_tag_name_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> element_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_host_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> document_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">get_disconnected_document_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> heap <span class="main">⇒</span> <span class="main">(_)</span> heap <span class="main">⇒</span> bool<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_val_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> character_data_ptr <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> unit<span class="main">)</span> prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">create_character_data</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr <span class="main">⇒</span> char list <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> heap<span class="main">,</span> exception<span class="main">,</span> <span class="main">(_)</span> character_data_ptr<span class="main">)</span> prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">known_ptr<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">type_wf<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> heap <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_)</span> shadow_root_ptr option <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_shadow_root_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_mode_locs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> shadow_root_ptr <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">attach_shadow_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> element_ptr <span class="main">⇒</span> shadow_root_mode <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> shadow_root_ptr<span class="main">)</span> dom_prog"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> attach_shadow_root_child_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">new_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">h3</span></span> <span class="skolem"><span class="skolem">new_shadow_root_ptr</span></span> <span class="skolem"><span class="skolem">element_tag_name</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    element_tag_name<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">element_tag_name</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">element_tag_name</span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    prev_shadow_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    new_shadow_root_ptr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_shadow_root_ptr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">set_mode</span> <span class="skolem">new_shadow_root_ptr</span> <span class="free">new_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">h3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="main">(</span>Some <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> attach_shadow_root_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_heap_E
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_tag_name_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
        bind_returns_heap_E2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> get_shadow_root_pure<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊢</span> <span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">new_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">thm</span></span>  bind_pure_returns_result_I<span class="main">[</span><span class="operator">OF</span> get_tag_name_pure<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> attach_shadow_root_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> element_tag_name
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bind_pure_returns_result_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_tag_name_pure<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bind_pure_returns_result_I<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">element_tag_name</span> <span class="main">∈</span> safe_shadow_root_element_types›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">element_tag_name</span> <span class="main">∈</span> safe_shadow_root_element_types›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> prev_shadow_root
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bind_pure_returns_result_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> get_shadow_root_pure<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bind_pure_returns_result_I<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> h2 new_shadow_root_ptr h3 h'
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bind_returns_result_I
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_OK_returns_result_E<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_OK_returns_heap_I<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> h3<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
        is_OK_returns_result_E<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_OK_returns_heap_I<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> h'<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">new_shadow_root_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> shadow_root_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_shadow_root_ptr ShadowRootMonad.ptr_kinds_ptr_kinds_M h2
    <span class="keyword1"><span class="command">using</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_not_in_heap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_shadow_root_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_new_ptr h2 new_shadow_root_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span><span class="skolem">new_shadow_root_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def element_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_mode_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_mode_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_shadow_root_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_shadow_root_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h'</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"shadow_root_ptr_kinds <span class="free">h'</span> <span class="main">=</span> shadow_root_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h'</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptr</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">new_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_shadow_root_ptr</span>›</span></span>
      create_shadow_root_known_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_new_ptr object_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="free">h</span>›</span></span> h2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved object_ptr_kinds_eq_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">known_ptrs</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> known_ptrs_preserved object_ptr_kinds_eq_h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">⊢</span> <span class="free">attach_shadow_root</span> <span class="free">element_ptr</span> <span class="free">new_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">new_shadow_root_ptr</span>›</span></span>
        is_OK_returns_result_I local.attach_shadow_root_element_ptr_in_heap<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> children_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">ptr'</span><span class="main">::</span><span class="main">(_)</span> object_ptr<span class="main">)</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_shadow_root_ptr</span>
                  <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads h2 get_child_nodes_new_shadow_root<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_shadow_root_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_shadow_root_ptr</span>
      <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> object_ptr_kinds <span class="free">h</span> <span class="main">|∪|</span> <span class="main">{|</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">|}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_new_ptr h2 new_shadow_root_ptr object_ptr_kinds_eq_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> node_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> character_data_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h2</span> <span class="main">=</span> element_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def element_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_mode_writes h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_mode_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> character_data_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="skolem">h3</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> object_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"object_ptr_kinds <span class="free">h'</span> <span class="main">=</span> object_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> writes_small_big<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">h</span></span> <span class="bound"><span class="bound">h'</span></span><span class="main"><span class="main">.</span></span> object_ptr_kinds <span class="bound"><span class="bound">h'</span></span> <span class="main"><span class="main">=</span></span> object_ptr_kinds <span class="bound"><span class="bound">h</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> set_shadow_root_writes h'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> set_shadow_root_pointers_preserved
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> document_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"document_ptr_kinds <span class="free">h'</span> <span class="main">=</span> document_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> node_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"node_ptr_kinds <span class="free">h'</span> <span class="main">=</span> node_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> character_data_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"character_data_ptr_kinds <span class="free">h'</span> <span class="main">=</span> character_data_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> character_data_ptr_kinds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> element_ptr_kinds_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"element_ptr_kinds <span class="free">h'</span> <span class="main">=</span> element_ptr_kinds <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h3
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_ptr_kinds_def<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> children_eq_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">ptr'</span><span class="main">::</span><span class="main">(_)</span> object_ptr<span class="main">)</span> <span class="bound">children</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_shadow_root_ptr</span>
                <span class="main">⟹</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads h2 get_child_nodes_new_shadow_root<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> new_shadow_root_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="bound">ptr'</span> <span class="main">≠</span> cast <span class="skolem">new_shadow_root_ptr</span>
                                 <span class="main">⟹</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 local.new_shadow_root_no_child_nodes new_shadow_root_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads h2
      get_disconnected_nodes_new_shadow_root<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> h2<span class="main">,</span><span class="operator">rotated</span><span class="main">,</span><span class="operator">OF</span> new_shadow_root_ptr<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads h2
      get_tag_name_new_shadow_root<span class="main">[</span><span class="operator">OF</span> new_shadow_root_ptr h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads set_mode_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                              <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads set_mode_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_get_disconnected_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_mode_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h</span>›</span></span> new_shadow_root_types_preserved h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_mode_writes h3<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  set_mode_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">type_wf</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> writes_small_big<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span> <span class="bound">h'</span><span class="main">.</span> <span class="free">type_wf</span> <span class="bound">h</span> <span class="main">⟶</span> <span class="free">type_wf</span> <span class="bound">h'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> set_shadow_root_writes h'<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span>  set_shadow_root_types_preserved
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def transp_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> children_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.get_child_nodes_reads set_shadow_root_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_get_child_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> children_eq2_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                            <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_disconnected_nodes_reads set_shadow_root_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_get_disconnected_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disconnected_nodes_eq2_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">doc_ptr</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">doc_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> tag_name_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">disc_nodes</span><span class="main">.</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>
                                             <span class="main">=</span> <span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">disc_nodes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_tag_name_reads set_shadow_root_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_get_tag_name<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tag_name_eq2_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def CD.acyclic_heap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ObjectMonad.ptr_kinds_ptr_kinds_M
          <span class="quoted"><span class="quoted">‹cast <span class="skolem">new_shadow_root_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> children_eq2_h<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> object_ptr_kinds_eq_h <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">|∈|</span> object_ptr_kinds <span class="skolem">h2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
          children_eq2_h empty_iff empty_set image_eqI select_result_I2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h2 children_eq2_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.parent_child_rel_def object_ptr_kinds_eq_h3 children_eq2_h3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_acyclic_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.acyclic_heap_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_all_ptrs_in_heap_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> node_ptr_kinds_eq_h
      <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CD.get_child_nodes_ok CD.l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms
        <span class="quoted"><span class="quoted">‹<span class="free">known_ptrs</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
        l_heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>.parent_child_rel_child local.known_ptrs_known_ptr
        local.parent_child_rel_child_in_heap node_ptr_kinds_commutes returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h document_ptr_kinds_eq_h
        local.get_disconnected_nodes_ok local.heap_is_wellformed_disc_nodes_in_heap node_ptr_kinds_eq_h
        returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h2 disconnected_nodes_eq2_h2 document_ptr_kinds_eq_h2
        CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq_h2 object_ptr_kinds_eq_h2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h3 disconnected_nodes_eq2_h3 document_ptr_kinds_eq_h3
        CD.a_all_ptrs_in_heap_def node_ptr_kinds_eq_h3 object_ptr_kinds_eq_h3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> children_eq2_h
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> disconnected_nodes_eq_h<span class="main"><span class="main">]</span></span> CD.a_distinct_lists_def
        insort_split object_ptr_kinds_eq_h
        document_ptr_kinds_eq_h  disconnected_nodes_eq2_h <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> distinct_sorted_list_of_set finite_fset sorted_list_of_set_insert<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_concat_map_E<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> cast <span class="skolem">new_shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> children_eq2_h <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">y</span> <span class="main">=</span> cast <span class="skolem">new_shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="main">(</span>cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[]</span>›</span></span> children_eq2_h <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>
<span class="main">(</span>sorted_list_of_set <span class="main">(</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> distinct_concat_map_E<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">y</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span>›</span></span><span class="main"><span class="main">]</span></span>
          children_eq2_h<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> node_ptr"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> object_ptr"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(_)</span> document_ptr"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>object_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">∩</span>
<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>fset <span class="main">(</span>document_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="bound">x</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∩</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CD.get_child_nodes_ok <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">|∈|</span> object_ptr_kinds <span class="free">h</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">xb</span> <span class="main">|∈|</span> document_ptr_kinds <span class="free">h</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> disconnected_nodes_eq2_h
          is_OK_returns_result_E local.get_disconnected_nodes_ok
          local.heap_is_wellformed_children_disc_nodes_different local.known_ptrs_known_ptr select_result_I2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_child_nodes</span> <span class="skolem">xa</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">|</span><span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_disconnected_nodes</span> <span class="skolem">xb</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">≠</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span>›</span></span> children_eq2_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def disconnected_nodes_eq2_h2 document_ptr_kinds_eq_h2
        children_eq2_h2 object_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_distinct_lists_def disconnected_nodes_eq2_h3 children_eq2_h3
        object_ptr_kinds_eq_h3 document_ptr_kinds_eq_h3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_owner_document_valid <span class="free">h'</span>"</span></span>
    <span class="comment1">(* using disc_nodes_h3 ‹document_ptr |∈| document_ptr_kinds h› *)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_owner_document_valid_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h object_ptr_kinds_eq_h3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> object_ptr_kinds_eq_h2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq_h document_ptr_kinds_eq_h3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> document_ptr_kinds_eq_h2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_eq_h node_ptr_kinds_eq_h3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> node_ptr_kinds_eq_h2 node_ptr_kinds_eq_h <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> children_eq2_h2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> children_eq2_h3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        disconnected_nodes_eq2_h
        disconnected_nodes_eq2_h2 disconnected_nodes_eq2_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CD.get_child_nodes_ok CD.get_child_nodes_ptr_in_heap
        <span class="quoted"><span class="quoted">‹cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span> <span class="main">∉</span> set <span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> object_ptr_kinds_M<span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
        children_eq2_h children_eq_h document_ptr_kinds_eq_h finite_set_in is_OK_returns_result_I
        l_ptr_kinds_M.ptr_kinds_ptr_kinds_M local.known_ptrs_known_ptr object_ptr_kinds_M_def
        returns_result_select_result<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">character_data_ptr</span> <span class="bound">shadow_root_opt</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">character_data_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span> <span class="main">=</span>
<span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">character_data_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">shadow_root_opt</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads h2 get_shadow_root_new_shadow_root<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> h2<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reads_def reflp_def transp_def preserved_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.get_shadow_root_locs_impl new_shadow_root_ptr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> local.get_shadow_root_locs_impl new_shadow_root_ptr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="skolem">h2</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_mode_writes h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_mode_get_shadow_root<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_eq_h3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ptr'</span> <span class="bound">children</span><span class="main">.</span> <span class="free">element_ptr</span> <span class="main">≠</span> <span class="bound">ptr'</span> <span class="main">⟹</span> <span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span> <span class="main">=</span>
<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">children</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_shadow_root_reads set_shadow_root_writes h'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reads_writes_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_shadow_root_get_shadow_root_different_pointers<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> shadow_root_h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> Some <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> h' local.set_shadow_root_get_shadow_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.a_all_ptrs_in_heap_def local.get_shadow_root_shadow_root_ptr_in_heap<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> returns_result_eq shadow_root_eq_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h2<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_all_ptrs_in_heap <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_all_ptrs_in_heap_def shadow_root_ptr_kinds_eq_h3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">shadow_root_ptr</span> <span class="main">=</span> <span class="skolem">new_shadow_root_ptr</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> h2 new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_in_heap new_shadow_root_ptr shadow_root_ptr_kinds_eq_h2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> h' local.set_shadow_root_get_shadow_root returns_result_eq shadow_root_eq_h3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def character_data_ptr_kinds_eq_h<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_insort <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.get_shadow_root_ok local.shadow_root_same_host
        returns_result_select_result shadow_root_eq_h<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h2
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_distinct_lists <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_distinct_lists_def element_ptr_kinds_eq_h3
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h3<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_insort <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_concat_map_I <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h' h2 local.get_shadow_root_ok
        local.get_shadow_root_shadow_root_ptr_in_heap local.set_shadow_root_get_shadow_root
        local.shadow_root_same_host new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_not_in_heap new_shadow_root_ptr
        returns_result_select_result select_result_I2 shadow_root_eq_h shadow_root_eq_h2 shadow_root_eq_h3<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> a_shadow_root_valid_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">shadow_root_ptr</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">shadow_root_ptr</span><span class="main">∈</span>fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span>
<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="bound">shadow_root_ptr</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"a_shadow_root_valid <span class="free">h</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="free">h'</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span>
Some <span class="skolem">shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">shadow_root_ptr</span> <span class="main">=</span> <span class="skolem">new_shadow_root_ptr</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">element_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">element_ptr</span> <span class="main">|∈|</span> element_ptr_kinds <span class="free">h</span>›</span></span> element_ptr_kinds_eq_h
            element_ptr_kinds_eq_h2 element_ptr_kinds_eq_h3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">element_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">h2</span> <span class="bound">h3</span> <span class="bound">new_shadow_root_ptr</span> <span class="bound">element_tag_name</span><span class="main">.</span>
<span class="main">⟦</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">element_tag_name</span><span class="main">;</span>
<span class="bound">element_tag_name</span> <span class="main">∈</span> safe_shadow_root_element_types<span class="main">;</span>
<span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">element_ptr</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> None<span class="main">;</span> <span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h2</span><span class="main">;</span>
<span class="free">h</span> <span class="main">⊢</span> new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M <span class="keyword1">→<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">new_shadow_root_ptr</span><span class="main">;</span> <span class="bound">h2</span> <span class="main">⊢</span> <span class="free">set_mode</span> <span class="bound">new_shadow_root_ptr</span> <span class="free">new_mode</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">h3</span><span class="main">;</span>
<span class="bound">h3</span> <span class="main">⊢</span> <span class="free">set_shadow_root</span> <span class="free">element_ptr</span> <span class="main">(</span>Some <span class="bound">new_shadow_root_ptr</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">h'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
            select_result_I2 tag_name_eq2_h tag_name_eq2_h2 tag_name_eq2_h3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="free">element_ptr</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> shadow_root_h3
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">host</span></span> <span class="keyword2"><span class="keyword">where</span></span> host<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">host</span> <span class="main">∈</span> fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="skolem">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="skolem">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="skolem">shadow_root_ptr</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">shadow_root_ptr</span> <span class="main">∈</span> fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free">h'</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">shadow_root_ptr</span><span class="main">∈</span>fset <span class="main">(</span>shadow_root_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">host</span><span class="main">∈</span>fset <span class="main">(</span>element_ptr_kinds <span class="free">h</span><span class="main">)</span><span class="main">.</span>
<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_tag_name</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∈</span> safe_shadow_root_element_types <span class="main">∧</span>
<span class="main">|</span><span class="free">h</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">host</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> Some <span class="bound">shadow_root_ptr</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shadow_root_ptr_kinds_eq_h3 shadow_root_ptr_kinds_eq_h2
            shadow_root_ptr_kinds_eq_h<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_set_in<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">host</span> <span class="main">≠</span> <span class="free">element_ptr</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>3<span class="main">)</span> prev_shadow_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> element_ptr_kinds_eq_h3 element_ptr_kinds_eq_h2 element_ptr_kinds_eq_h
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="free">h'</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite_set_in local.get_shadow_root_ok returns_result_eq
            returns_result_select_result shadow_root_eq_h shadow_root_eq_h2 shadow_root_eq_h3 tag_name_eq2_h
            tag_name_eq2_h2 tag_name_eq2_h3<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h2
        select_result_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> shadow_root_eq_h2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>cast <span class="free">element_ptr</span><span class="main">,</span> cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>
a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def element_ptr_kinds_eq_h3 <span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">element_ptr</span> <span class="main">≠</span> <span class="improper">aa</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq<span class="main">[</span><span class="operator">OF</span> shadow_root_eq_h3<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> select_result_eq<span class="main">[</span><span class="operator">OF</span> shadow_root_eq_h3<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
        <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span>
        host_shadow_root_rel_def local.get_shadow_root_impl local.get_shadow_root_ok
        option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prev_shadow_root returns_result_select_result<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">element_ptr</span> <span class="main">≠</span> <span class="bound">ptr'</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> case_prod_conv image_iff
        is_OK_returns_result_I mem_Collect_eq option.inject returns_result_eq
        returns_result_select_result shadow_root_h3<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> element_ptr_kinds_eq_h3 local.get_shadow_root_ptr_in_heap shadow_root_h3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">using</span></span> Shadow_DOM.a_host_shadow_root_rel_def <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">ptr'</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">element_ptr</span> <span class="main">≠</span> <span class="bound">ptr'</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">|</span><span class="skolem">h3</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> <span class="main">|</span><span class="free">h'</span> <span class="main">⊢</span> <span class="free">get_shadow_root</span> <span class="bound">ptr'</span><span class="keyword1">|<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">type_wf</span> <span class="skolem">h3</span>›</span></span> case_prodE case_prodI
        host_shadow_root_rel_shadow_root image_iff local.get_shadow_root_impl local.get_shadow_root_ok
        mem_Collect_eq option.discI prev_shadow_root returns_result_select_result select_result_I2
        shadow_root_eq_h shadow_root_eq_h2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prodI mem_Collect_eq option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pair_imageI returns_result_eq returns_result_select_result<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">heap_is_wellformed</span> <span class="free">h</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="main">{</span><span class="main">(</span>cast <span class="free">element_ptr</span><span class="main">,</span> cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="main">{</span><span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free">element_ptr</span><span class="main">,</span> cast<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>
local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="free">h'</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> cast <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CD.parent_child_rel_parent_in_heap <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h2</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span>›</span></span> document_ptr_kinds_commutes
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h2 new<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>R</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>t</sub>_M_ptr_not_in_heap new_shadow_root_ptr shadow_root_ptr_kinds_commutes<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> a_host_shadow_root_rel <span class="skolem">h3</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> cast <span class="skolem">new_shadow_root_ptr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shadow_root_eq_h2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_host_shadow_root_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cast <span class="skolem">new_shadow_root_ptr</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> cast <span class="free">element_ptr</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span>
a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UnE calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
        cast_shadow_root_ptr_not_node_ptr<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> converse_rtranclE mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="skolem">h3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span><span class="main">)</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h</span> <span class="main">=</span>
<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="skolem">h2</span> <span class="main">∪</span>
local.a_host_shadow_root_rel <span class="skolem">h2</span> <span class="main">=</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> a_host_shadow_root_rel <span class="free">h'</span> <span class="main">=</span>
<span class="main">{</span><span class="main">(</span>cast <span class="free">element_ptr</span><span class="main">,</span> cast <span class="skolem">new_shadow_root_ptr</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">parent_child_rel</span> <span class="skolem">h3</span> <span class="main">∪</span>
a_host_shadow_root_rel <span class="skolem">h3</span>›</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CD.a_heap_is_wellformed <span class="free">h'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CD.a_heap_is_wellformed_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_acyclic_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.CD.a_distinct_lists <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.CD.a_owner_document_valid <span class="free">h'</span>›</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">heap_is_wellformed</span> <span class="free">h'</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹acyclic <span class="main">(</span><span class="free">parent_child_rel</span> <span class="free">h'</span> <span class="main">∪</span> local.a_host_shadow_root_rel <span class="free">h'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heap_is_wellformed_def CD.heap_is_wellformed_impl <span class="quoted"><span class="quoted">‹local.CD.a_heap_is_wellformed <span class="free">h'</span>›</span></span>
        <span class="quoted"><span class="quoted">‹local.a_all_ptrs_in_heap <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_distinct_lists <span class="free">h'</span>›</span></span> <span class="quoted"><span class="quoted">‹local.a_shadow_root_valid <span class="free">h'</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> l_attach_shadow_root_wf<span class="main">?</span><span class="main">:</span> l_attach_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub> <span class="quoted">known_ptr</span> <span class="quoted">known_ptrs</span> <span class="quoted">type_wf</span>
  <span class="quoted">get_child_nodes</span> <span class="quoted">get_child_nodes_locs</span> <span class="quoted">get_disconnected_nodes</span> <span class="quoted">get_disconnected_nodes_locs</span>
  <span class="quoted">heap_is_wellformed</span> <span class="quoted">parent_child_rel</span> <span class="quoted">set_tag_name</span> <span class="quoted">set_tag_name_locs</span> <span class="quoted">set_disconnected_nodes</span>
  <span class="quoted">set_disconnected_nodes_locs</span> <span class="quoted">create_element</span> <span class="quoted">get_shadow_root</span> <span class="quoted">get_shadow_root_locs</span> <span class="quoted">get_tag_name</span>
  <span class="quoted">get_tag_name_locs</span> <span class="quoted">heap_is_wellformed<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub></span> <span class="quoted">get_host</span> <span class="quoted">get_host_locs</span> <span class="quoted">get_disconnected_document</span>
  <span class="quoted">get_disconnected_document_locs</span> <span class="quoted">set_val</span> <span class="quoted">set_val_locs</span> <span class="quoted">create_character_data</span> <span class="quoted">DocumentClass.known_ptr</span>
  <span class="quoted">DocumentClass.type_wf</span> <span class="quoted">set_shadow_root</span> <span class="quoted">set_shadow_root_locs</span> <span class="quoted">set_mode</span> <span class="quoted">set_mode_locs</span> <span class="quoted">attach_shadow_root</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_attach_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_def <span class="dynamic"><span class="dynamic">instances</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> l_attach_shadow_root_wf<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>h</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_axioms <span class="main">[</span><span class="operator">instances</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM_BaseTest">
<div class="head">
<h1>Theory Shadow_DOM_BaseTest</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Shadow DOM Base Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM_BaseTest
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Shadow_DOM.html">../Shadow_DOM</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">assert_throws</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">h</span> <span class="main">←</span> get_heap<span class="main">;</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">h</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>e</sub></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">then</span> return <span class="main">()</span> <span class="keyword1">else</span> error AssertException<span class="main">)</span>
<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> assert_throws <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_throws'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⊢</span> <span class="keyword1">ok</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">field_access</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span>
<span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">.</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">field_access</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">field</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">field</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assert_equals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">assert_equals</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> return <span class="main">()</span> <span class="keyword1">else</span> error AssertException<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assert_equals_with_message</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">assert_equals_with_message</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> return <span class="main">()</span> <span class="keyword1">else</span> error AssertException<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> assert_equals <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> assert_equals_with_message <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> assert_equals <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_array'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> assert_equals_with_message <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_array'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assert_not_equals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">assert_not_equals</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> return <span class="main">()</span> <span class="keyword1">else</span> error AssertException<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assert_not_equals_with_message</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">assert_not_equals_with_message</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> return <span class="main">()</span> <span class="keyword1">else</span> error AssertException<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> assert_not_equals <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_not'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> assert_not_equals_with_message <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_not'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> assert_not_equals <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_array'_not'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> assert_not_equals_with_message <span class="main">(</span><span class="quoted">"<span class="keyword1">assert'_array'_not'_equals'(</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="comment1">(* TODO: why don't the code equations of noop work here?  *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">removeWhiteSpaceOnlyTextNodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">removeWhiteSpaceOnlyTextNodes</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> return <span class="main">()</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Making the functions under test compatible with untyped languages such as JavaScript›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">set_attribute_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> attr_key <span class="main">⇒</span> attr_value <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">set_attribute_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> set_attribute <span class="bound">element_ptr</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">set_attribute_with_null2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> attr_key <span class="main">⇒</span> attr_value option <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">set_attribute_with_null2</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> set_attribute <span class="bound">element_ptr</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> set_attribute_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">setAttribute'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> set_attribute_with_null2 <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">setAttribute'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">children</span> <span class="main">←</span> get_child_nodes <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
      return <span class="main">(</span>map <span class="main">(</span>Some <span class="main">∘</span> cast<span class="main">)</span> <span class="bound">children</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_child_nodes<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>D</sub><span class="hidden">⇩</span><sub>O</sub><span class="hidden">⇩</span><sub>M</sub>_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">childNodes</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">create_element_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">create_element_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">owner_document_obj</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tag</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">owner_document_obj</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">owner_document</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">element_ptr</span> <span class="main">←</span> create_element <span class="bound">owner_document</span> <span class="free"><span class="bound"><span class="entity">tag</span></span></span><span class="main">;</span>
        return <span class="main">(</span>Some <span class="main">(</span>cast <span class="bound">element_ptr</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> create_element_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">createElement'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">create_character_data_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">create_character_data_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">owner_document_obj</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tag</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">owner_document_obj</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">owner_document</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">character_data_ptr</span> <span class="main">←</span> create_character_data <span class="bound">owner_document</span> <span class="free"><span class="bound"><span class="entity">tag</span></span></span><span class="main">;</span>
        return <span class="main">(</span>Some <span class="main">(</span>cast <span class="bound">character_data_ptr</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> create_character_data_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">createTextNode'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">create_document_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">create_document_with_null</span> <span class="free"><span class="bound"><span class="entity">title</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">new_document_ptr</span> <span class="main">←</span> create_document<span class="main">;</span>
      <span class="bound">html</span> <span class="main">←</span> create_element <span class="bound">new_document_ptr</span> <span class="inner_quoted">''html''</span><span class="main">;</span>
      append_child <span class="main">(</span>cast <span class="bound">new_document_ptr</span><span class="main">)</span> <span class="main">(</span>cast <span class="bound">html</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">heap</span> <span class="main">←</span> create_element <span class="bound">new_document_ptr</span> <span class="inner_quoted">''heap''</span><span class="main">;</span>
      append_child <span class="main">(</span>cast <span class="bound">html</span><span class="main">)</span> <span class="main">(</span>cast <span class="bound">heap</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">body</span> <span class="main">←</span> create_element <span class="bound">new_document_ptr</span> <span class="inner_quoted">''body''</span><span class="main">;</span>
      append_child <span class="main">(</span>cast <span class="bound">html</span><span class="main">)</span> <span class="main">(</span>cast <span class="bound">body</span><span class="main">)</span><span class="main">;</span>
      return <span class="main">(</span>Some <span class="main">(</span>cast <span class="bound">new_document_ptr</span><span class="main">)</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">create_document_with_null2</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">≡</span> create_document_with_null <span class="inner_quoted">''''</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> create_document_with_null <span class="main">(</span><span class="quoted">"<span class="keyword1">createDocument'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> create_document_with_null2 <span class="main">(</span><span class="quoted">"<span class="keyword1">createDocument'(</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_element_by_id_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_element_by_id_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">id'</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">element_ptr_opt</span> <span class="main">←</span> get_element_by_id <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">id'</span></span></span><span class="main">;</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="bound">element_ptr_opt</span> <span class="keyword1">of</span>
          Some <span class="bound">element_ptr</span> <span class="main">⇒</span> return <span class="main">(</span>Some <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">element_ptr</span><span class="main">)</span><span class="main">)</span>
        <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">get_element_by_id_with_null</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> error SegmentationFault"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_element_by_id_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">getElementById'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_elements_by_class_name_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_elements_by_class_name_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">class_name</span></span></span> <span class="main">=</span>
      get_elements_by_class_name <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">class_name</span></span></span> <span class="main">⤜</span> map_M <span class="main">(</span>return <span class="main">∘</span> Some <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_elements_by_class_name_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">getElementsByClassName'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_elements_by_tag_name_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_elements_by_tag_name_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tag</span></span></span> <span class="main">=</span>
      get_elements_by_tag_name <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">tag</span></span></span> <span class="main">⤜</span> map_M <span class="main">(</span>return <span class="main">∘</span> Some <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_elements_by_tag_name_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">getElementsByTagName'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insert_before_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span>
<span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">insert_before_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child_obj</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ref_child_obj_opt</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">child_obj</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">child</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ref_child_obj_opt</span></span></span> <span class="keyword1">of</span>
          Some <span class="bound">ref_child_obj</span> <span class="main">⇒</span> insert_before <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="bound">child</span> <span class="main">(</span>cast <span class="bound">ref_child_obj</span><span class="main">)</span>
        <span class="main">|</span> None <span class="main">⇒</span> insert_before <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="bound">child</span> None<span class="main">)</span><span class="main">;</span>
        return <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child_obj</span></span></span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error HierarchyRequestError<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> insert_before_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">insertBefore'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">append_child_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> unit<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">append_child_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child_obj</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">child_obj</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">child</span> <span class="main">⇒</span> append_child <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="bound">child</span>
    <span class="main">|</span> None <span class="main">⇒</span> error SegmentationFault<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> append_child_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">appendChild'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">code_thms</span></span> <span class="quoted"><span class="quoted">append_child_with_null</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_body</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_body</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
       <span class="bound">ptrs</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="main">.</span> <span class="keyword1">getElementsByTagName(</span><span class="inner_quoted">''body''</span><span class="main">)</span><span class="main">;</span>
       return <span class="main">(</span>hd <span class="bound">ptrs</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_body <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">body</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_document_element_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_document_element_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
    Some <span class="bound">document_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">element_ptr_opt</span> <span class="main">←</span> get_M <span class="bound">document_ptr</span> document_element<span class="main">;</span>
      return <span class="main">(</span><span class="keyword1">case</span> <span class="bound">element_ptr_opt</span> <span class="keyword1">of</span>
        Some <span class="bound">element_ptr</span> <span class="main">⇒</span> Some <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">element_ptr</span><span class="main">)</span>
      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_document_element_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">documentElement</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_owner_document_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_owner_document_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">document_ptr</span> <span class="main">←</span> get_owner_document <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
        return <span class="main">(</span>Some <span class="main">(</span>cast<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">document_ptr</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_owner_document_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">ownerDocument</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">remove_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">child</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">child_node</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        remove <span class="bound">child_node</span><span class="main">;</span>
        return <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child</span></span></span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error NotFoundError<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_with_null</span> None <span class="main">=</span> error TypeError"</span></span>
<span class="keyword1"><span class="command">notation</span></span> remove_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">remove'(')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">remove_child_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">remove_child_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">child</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">child_node</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        remove_child <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="bound">child_node</span><span class="main">;</span>
        return <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child</span></span></span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error NotFoundError<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_child_with_null</span> None <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> error TypeError"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remove_child_with_null</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> None <span class="main">=</span> error TypeError"</span></span>
<span class="keyword1"><span class="command">notation</span></span> remove_child_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">removeChild</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_tag_name_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> attr_value<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_tag_name_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> get_M <span class="bound">element_ptr</span> tag_name<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_tag_name_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">tagName</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">remove_attribute_with_null</span> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> set_attribute_with_null2 <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> None"</span></span>
<span class="keyword1"><span class="command">notation</span></span> remove_attribute_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">removeAttribute'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_attribute_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> attr_key <span class="main">⇒</span> <span class="main">(_,</span> attr_value option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_attribute_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> get_attribute <span class="bound">element_ptr</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_attribute_with_null2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> attr_key <span class="main">⇒</span> <span class="main">(_,</span> attr_value<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_attribute_with_null2</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">a</span> <span class="main">←</span> get_attribute <span class="bound">element_ptr</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">;</span>
        return <span class="main">(</span>the <span class="bound">a</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_attribute_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">getAttribute'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> get_attribute_with_null2 <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">getAttribute'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_parent_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_parent_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">node_ptr</span> <span class="main">⇒</span> get_parent <span class="bound">node_ptr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_parent_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">parentNode</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">first_child_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">first_child_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">child_opt</span> <span class="main">←</span> first_child <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">;</span>
      return <span class="main">(</span><span class="keyword1">case</span> <span class="bound">child_opt</span> <span class="keyword1">of</span>
        Some <span class="bound">child</span> <span class="main">⇒</span> Some <span class="main">(</span>cast <span class="bound">child</span><span class="main">)</span>
      <span class="main">|</span> None <span class="main">⇒</span> None<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> first_child_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">firstChild</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">adopt_node_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span><span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">adopt_node_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">document_ptr</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">child</span></span></span> <span class="keyword1">of</span>
        Some <span class="bound">child_node</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
          adopt_node <span class="bound">document_ptr</span> <span class="bound">child_node</span><span class="main">;</span>
          return <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">child</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> adopt_node_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">adoptNode'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_shadow_root_with_null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(_)</span> object_ptr option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_shadow_root_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">shadow_root</span> <span class="main">←</span> get_shadow_root <span class="bound">element_ptr</span><span class="main">;</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="bound">shadow_root</span> <span class="keyword1">of</span> Some <span class="bound">sr</span> <span class="main">⇒</span> return <span class="main">(</span>Some <span class="main">(</span>cast <span class="bound">sr</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_shadow_root_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">shadowRoot</span>"</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Making the functions under test compatible with untyped languages such as JavaScript›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_element_by_id_si_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_element_by_id_si_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">id'</span></span></span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">element_ptr_opt</span> <span class="main">←</span> get_element_by_id_si <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="free"><span class="bound"><span class="entity">id'</span></span></span><span class="main">;</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="bound">element_ptr_opt</span> <span class="keyword1">of</span>
          Some <span class="bound">element_ptr</span> <span class="main">⇒</span> return <span class="main">(</span>Some <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">element_ptr</span><span class="main">)</span><span class="main">)</span>
        <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">get_element_by_id_si_with_null</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> error SegmentationFault"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">find_slot_closed_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">find_slot_closed_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">node_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">element_ptr_opt</span> <span class="main">←</span> find_slot True <span class="bound">node_ptr</span><span class="main">;</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="bound">element_ptr_opt</span> <span class="keyword1">of</span>
          Some <span class="bound">element_ptr</span> <span class="main">⇒</span> return <span class="main">(</span>Some <span class="main">(</span>cast<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">element_ptr</span><span class="main">)</span><span class="main">)</span>
        <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error SegmentationFault<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">find_slot_closed_with_null</span> None <span class="main">=</span> error SegmentationFault"</span></span>
<span class="keyword1"><span class="command">notation</span></span> find_slot_closed_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">assignedSlot</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">assigned_nodes_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">assigned_nodes_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">l</span> <span class="main">←</span> assigned_nodes <span class="bound">element_ptr</span><span class="main">;</span>
        return <span class="main">(</span>map Some <span class="main">(</span>map cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error SegmentationFault<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">assigned_nodes_with_null</span> None <span class="main">=</span> error SegmentationFault"</span></span>
<span class="keyword1"><span class="command">notation</span></span> assigned_nodes_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">assignedNodes'(')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">assigned_nodes_flatten_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">assigned_nodes_flatten_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">l</span> <span class="main">←</span> assigned_nodes_flatten <span class="bound">element_ptr</span><span class="main">;</span>
        return <span class="main">(</span>map Some <span class="main">(</span>map cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error SegmentationFault<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">assigned_nodes_flatten_with_null</span> None <span class="main">=</span> error SegmentationFault"</span></span>
<span class="keyword1"><span class="command">notation</span></span> assigned_nodes_flatten_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">assignedNodes'(True')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_assigned_elements_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_assigned_elements_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">l</span> <span class="main">←</span> assigned_nodes <span class="bound">element_ptr</span><span class="main">;</span>
        <span class="bound">l</span> <span class="main">←</span> map_filter_M <span class="main">(</span>return <span class="main">∘</span> cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="main">)</span> <span class="bound">l</span><span class="main">;</span>
        return <span class="main">(</span>map Some <span class="main">(</span>map cast <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error SegmentationFault<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">get_assigned_elements_with_null</span> None <span class="main">=</span> error SegmentationFault"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_assigned_elements_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">assignedElements'(')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_assigned_elements_flatten_with_null</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option list<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_assigned_elements_flatten_with_null</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ptr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> cast<span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>m</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="free"><span class="bound"><span class="entity">ptr</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">l</span> <span class="main">←</span> assigned_nodes_flatten <span class="bound">element_ptr</span><span class="main">;</span>
        return <span class="main">(</span>map Some <span class="main">(</span>map cast<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>b</sub><span class="hidden">⇩</span><sub>j</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> error SegmentationFault<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">get_assigned_elements_flatten_with_null</span> None <span class="main">=</span> error SegmentationFault"</span></span>
<span class="keyword1"><span class="command">notation</span></span> get_assigned_elements_flatten_with_null <span class="main">(</span><span class="quoted">"_ <span class="keyword1">.</span> <span class="keyword1">assignedElements'(True')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">createTestTree</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(_::</span>linorder<span class="main">)</span> object_ptr option <span class="main">⇒</span> <span class="main">(_,</span> string <span class="main">⇒</span> <span class="main">(_,</span> <span class="main">(_)</span> object_ptr option<span class="main">)</span> dom_prog<span class="main">)</span> dom_prog"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">createTestTree</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ref</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">tups</span> <span class="main">←</span> to_tree_order_si <span class="free"><span class="bound"><span class="entity">ref</span></span></span> <span class="main">⤜</span> map_filter_M <span class="main">(</span><span class="main">λ</span><span class="bound">ptr</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="main">(</span><span class="keyword1">case</span> cast <span class="bound">ptr</span> <span class="keyword1">of</span>
          Some <span class="bound">element_ptr</span> <span class="main">⇒</span> <span class="keyword1">do</span> <span class="main">{</span>
            <span class="bound">iden_opt</span> <span class="main">←</span> get_attribute <span class="bound">element_ptr</span> <span class="inner_quoted">''id''</span><span class="main">;</span>
            <span class="main">(</span><span class="keyword1">case</span> <span class="bound">iden_opt</span> <span class="keyword1">of</span>
              Some <span class="bound">iden</span> <span class="main">⇒</span> return <span class="main">(</span>Some <span class="main">(</span><span class="bound">iden</span><span class="main">,</span> <span class="bound">ptr</span><span class="main">)</span><span class="main">)</span>
            <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span>
          <span class="main">}</span>
        <span class="main">|</span> None <span class="main">⇒</span> return None<span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">;</span>
      return <span class="main">(</span>return <span class="main">∘</span> map_of <span class="bound">tups</span><span class="main">)</span>
    <span class="main">}</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">createTestTree</span> None <span class="main">=</span> error SegmentationFault"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="slots">
<div class="head">
<h1>Theory slots</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="comment1">(* This file is automatically generated, please do not modify! *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Testing slots›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the test cases for slots.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> slots
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Shadow_DOM_BaseTest.html">Shadow_DOM_BaseTest</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slots_heap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slots_heap</span> <span class="main">=</span> create_heap <span class="main">[</span><span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_document_obj html <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''html''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''head''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''title''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''Shadow%20DOM%3A%20Slots%20and%20assignments''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''meta''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''author''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''title''</span><span class="main">,</span> <span class="inner_quoted">''Hayato Ito''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''href''</span><span class="main">,</span> <span class="inner_quoted">''mailto:hayato@google.com''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharness.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharnessreport.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''resources/shadow-dom.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''body''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">30</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">31</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">39</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">40</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">48</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">49</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">57</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">58</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">64</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">65</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">71</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">72</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">78</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">79</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">85</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">86</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">92</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">93</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">112</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_basic''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_basic_closed''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Closed <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">17</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">20</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_slot_not_in_shadow''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">25</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_slot_not_in_shadow_2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">24</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">24</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">25</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">26</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">27</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">26</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">27</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">28</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">29</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">28</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c3_1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">29</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c3_2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">30</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">31</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">32</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_slot_name_matching''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">32</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">33</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">34</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">35</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">33</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">34</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">35</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c3''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''yyy''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">36</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">37</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">38</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">36</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">37</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">38</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s3''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''xxx''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">39</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">40</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">41</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_no_direct_host_child''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">41</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">42</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">43</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">44</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">42</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">43</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">44</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">45</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">45</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c3''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">46</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">47</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">46</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">47</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">48</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">49</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">50</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_default_slot''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">50</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">51</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">52</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">53</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">51</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">52</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">53</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c3''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''foo''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">54</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">55</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">56</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">54</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">55</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">56</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">57</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">58</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">59</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_slot_in_slot''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">59</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">60</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">61</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">60</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">61</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">62</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">62</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">63</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">63</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">64</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">65</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">66</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_slot_is_assigned_to_slot''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">66</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">67</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">67</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">68</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">68</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">69</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">69</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">70</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">70</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">71</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">72</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">73</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_open_closed''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">73</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">74</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">74</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">75</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">75</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">76</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">76</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Closed <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">77</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">77</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">78</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">79</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">80</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_closed_closed''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">80</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">81</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">81</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Closed <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">82</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">82</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">83</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">83</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Closed <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">84</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">84</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">85</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">86</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">87</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_closed_open''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">87</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">88</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">88</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Closed <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">89</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">89</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">90</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">90</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">91</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">91</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">92</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">93</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">94</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">94</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">95</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">96</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">97</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">98</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">95</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">96</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">97</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">98</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c4''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot-none''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">99</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">99</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">100</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">101</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">102</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">103</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">104</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">105</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">106</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">107</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">100</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot5''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">101</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot6''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">102</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">103</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s4''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot4''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot-none''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">104</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c5''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot5''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">105</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c6''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot6''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">106</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c7''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">107</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c8''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot-none''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">108</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">109</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">110</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">111</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">108</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s5''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot5''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">109</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s6''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot6''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">110</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s7''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">111</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s8''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot8''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">112</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slots_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> object_ptr option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">slots_document</span> <span class="main">=</span> Some <span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Basic.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_basic''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_basic''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp7</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Basic, elements only.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_basic''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp3</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Slots in closed.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_basic_closed''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_basic_closed''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp5</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp6</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Slots in closed, elements only.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_basic_closed''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp3</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Slots not in a shadow tree.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_slot_not_in_shadow''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_slot_not_in_shadow''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Slots not in a shadow tree, elements only.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_slot_not_in_shadow''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Distributed nodes for Slots not in a shadow tree.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_slot_not_in_shadow_2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_slot_not_in_shadow_2''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp5</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3_1''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp7</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3_2''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">tmp14</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp15</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">tmp16</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp17</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">tmp18</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp19</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp20</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp21</span> <span class="main">←</span> <span class="bound">tmp20</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp21</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Name matching'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_slot_name_matching''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_slot_name_matching''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> None<span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: No direct host child.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_no_direct_host_child''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_no_direct_host_child''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">,</span> <span class="bound">tmp13</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Default Slot.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_default_slot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_default_slot''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> None<span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Slot in Slot does not matter in assignment.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_slot_in_slot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_slot_in_slot''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Slot is assigned to another slot'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_slot_is_assigned_to_slot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_slot_is_assigned_to_slot''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp10</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">tmp11</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp12</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp13</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">tmp14</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp15</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp16</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">tmp17</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp18</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp19</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Open &gt; Closed.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_open_closed''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_open_closed''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''A slot in a closed shadow tree should not be accessed via assignedSlot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">tmp13</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp14</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp15</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">tmp16</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp17</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp18</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Closed &gt; Closed.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_closed_closed''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_closed_closed''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''A slot in a closed shadow tree should not be accessed via assignedSlot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp5</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''A slot in a closed shadow tree should not be accessed via assignedSlot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp8</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">tmp15</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp16</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp17</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Closed &gt; Open.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_closed_open''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_closed_open''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''A slot in a closed shadow tree should not be accessed via assignedSlot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp5</span><span class="main">,</span> <span class="bound">tmp6</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">tmp13</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp14</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp15</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">tmp16</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp17</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp18</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Complex case: Basi line.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="bound">tmp10</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c4''</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">tmp11</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp12</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">tmp13</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp14</span><span class="main">,</span> <span class="bound">tmp15</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">tmp16</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp17</span><span class="main">,</span> <span class="bound">tmp18</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp20</span> <span class="main">←</span> <span class="bound">tmp19</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp21</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s7''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp20</span><span class="main">,</span> <span class="bound">tmp21</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp22</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp23</span> <span class="main">←</span> <span class="bound">tmp22</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp23</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp24</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="bound">tmp25</span> <span class="main">←</span> <span class="bound">tmp24</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp26</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp25</span><span class="main">,</span> <span class="bound">tmp26</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp27</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c6''</span><span class="main">;</span>
  <span class="bound">tmp28</span> <span class="main">←</span> <span class="bound">tmp27</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp29</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp28</span><span class="main">,</span> <span class="bound">tmp29</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp30</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c7''</span><span class="main">;</span>
  <span class="bound">tmp31</span> <span class="main">←</span> <span class="bound">tmp30</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp32</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s7''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp31</span><span class="main">,</span> <span class="bound">tmp32</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp33</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c8''</span><span class="main">;</span>
  <span class="bound">tmp34</span> <span class="main">←</span> <span class="bound">tmp33</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp34</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp35</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp36</span> <span class="main">←</span> <span class="bound">tmp35</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp37</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp36</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp37</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp38</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp39</span> <span class="main">←</span> <span class="bound">tmp38</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp40</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp39</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp40</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp41</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp42</span> <span class="main">←</span> <span class="bound">tmp41</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp43</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp42</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp43</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp44</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp45</span> <span class="main">←</span> <span class="bound">tmp44</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp45</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp46</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp47</span> <span class="main">←</span> <span class="bound">tmp46</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp48</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp49</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp47</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp48</span><span class="main">,</span> <span class="bound">tmp49</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp50</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="bound">tmp51</span> <span class="main">←</span> <span class="bound">tmp50</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp52</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp53</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c6''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp51</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp52</span><span class="main">,</span> <span class="bound">tmp53</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp54</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s7''</span><span class="main">;</span>
  <span class="bound">tmp55</span> <span class="main">←</span> <span class="bound">tmp54</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp56</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp57</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c7''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp55</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp56</span><span class="main">,</span> <span class="bound">tmp57</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp58</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s8''</span><span class="main">;</span>
  <span class="bound">tmp59</span> <span class="main">←</span> <span class="bound">tmp58</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp59</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp60</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp61</span> <span class="main">←</span> <span class="bound">tmp60</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp62</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp61</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp62</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp63</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp64</span> <span class="main">←</span> <span class="bound">tmp63</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp65</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp64</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp65</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp66</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp67</span> <span class="main">←</span> <span class="bound">tmp66</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp68</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp67</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp68</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp69</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp70</span> <span class="main">←</span> <span class="bound">tmp69</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp70</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp71</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp72</span> <span class="main">←</span> <span class="bound">tmp71</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp73</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp74</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp72</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp73</span><span class="main">,</span> <span class="bound">tmp74</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp75</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="bound">tmp76</span> <span class="main">←</span> <span class="bound">tmp75</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp77</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp78</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c6''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp76</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp77</span><span class="main">,</span> <span class="bound">tmp78</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp79</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s7''</span><span class="main">;</span>
  <span class="bound">tmp80</span> <span class="main">←</span> <span class="bound">tmp79</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp81</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="bound">tmp82</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c7''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp80</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp81</span><span class="main">,</span> <span class="bound">tmp82</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp83</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s8''</span><span class="main">;</span>
  <span class="bound">tmp84</span> <span class="main">←</span> <span class="bound">tmp83</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp84</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: appendChild.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">d1</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">d1</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''host1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">d1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">,</span> <span class="bound">d1</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">d1</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">tmp7</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp10</span><span class="main">,</span> <span class="bound">d1</span><span class="main">,</span> <span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Change slot= attribute 1.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot-none''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Change slot= attribute 2.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp7</span><span class="main">,</span> <span class="bound">tmp8</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="bound">tmp11</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">tmp15</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c6''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp16</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp17</span><span class="main">,</span> <span class="bound">tmp18</span><span class="main">,</span> <span class="bound">tmp19</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Change slot= attribute 3.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c4''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">,</span> <span class="bound">tmp6</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c4''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="bound">tmp9</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c4''</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">,</span> <span class="bound">tmp13</span><span class="main">,</span> <span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Remove a child.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">remove()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Add a slot: after.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">slot</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''slot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">slot</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''host2''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">slot</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">slot</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Add a slot: before.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">slot</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''slot''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">slot</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''host2''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">slot</span><span class="main">,</span> <span class="bound">tmp3</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">slot</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="bound">slot</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s7''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c7''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="main">[</span><span class="bound">slot</span><span class="main">,</span> <span class="bound">tmp10</span><span class="main">,</span> <span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s7''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c3''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c7''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">,</span> <span class="bound">tmp15</span><span class="main">,</span> <span class="bound">tmp16</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Remove a slot.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">remove()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Change slot name= attribute.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp7</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="bound">tmp10</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">tmp11</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp12</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp13</span><span class="main">,</span> <span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">tmp15</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp16</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp17</span><span class="main">,</span> <span class="bound">tmp18</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots: Mutation: Change slot slot= attribute.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test_complex''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test_complex''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot6''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s5''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c5''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp8</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c6''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp11</span><span class="main">,</span> <span class="bound">tmp12</span><span class="main">,</span> <span class="bound">tmp13</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s6''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">tmp14</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c2''</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c6''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp15</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp16</span><span class="main">,</span> <span class="bound">tmp17</span><span class="main">,</span> <span class="bound">tmp18</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="slots_fallback">
<div class="head">
<h1>Theory slots_fallback</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="comment1">(* This file is automatically generated, please do not modify! *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Testing slots\_fallback›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the test cases for slots\_fallback.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> slots_fallback
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Shadow_DOM_BaseTest.html">Shadow_DOM_BaseTest</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slots_fallback_heap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slots_fallback_heap</span> <span class="main">=</span> create_heap <span class="main">[</span><span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_document_obj html <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''html''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''head''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''title''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''Shadow%20DOM%3A%20Slots%20and%20fallback%20contents''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''meta''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''author''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''title''</span><span class="main">,</span> <span class="inner_quoted">''Hayato Ito''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''href''</span><span class="main">,</span> <span class="inner_quoted">''mailto:hayato@google.com''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharness.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharnessreport.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''resources/shadow-dom.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''body''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">26</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">27</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">33</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">34</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">46</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">17</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">18</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">21</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">22</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">23</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">24</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">24</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">25</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">25</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">26</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">27</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">28</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test4''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">28</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">29</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">29</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">30</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">30</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">31</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">31</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">32</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">32</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">33</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">34</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">35</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">35</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">36</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">36</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''c1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">37</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">37</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">38</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''host2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">38</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">39</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">41</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">39</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">40</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">40</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">41</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f2''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>shadow_root_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_shadow_root_obj Open <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">42</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">42</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">43</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">45</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s4''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot4''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">43</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''slot''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">44</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''s3''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''name''</span><span class="main">,</span> <span class="inner_quoted">''slot3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">44</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f3''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">45</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''f4''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">46</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slots_fallback_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> object_ptr option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">slots_fallback_document</span> <span class="main">=</span> Some <span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Basic.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test1''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp5</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp8</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Basic, elements only.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Slots in Slots.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test2''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp5</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp10</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">tmp11</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp12</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp13</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Slots in Slots, elements only.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp7</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp10</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Fallback contents should not be used if a node is assigned.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test3''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test3''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">tmp15</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp16</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp17</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Slots in Slots: Assigned nodes should be used as fallback contents of another slot'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test4''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test4''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">tmp4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedSlot</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">tmp15</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp16</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp17</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Complex case.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test5''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp4</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">tmp15</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp16</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp17</span><span class="main">,</span> <span class="bound">tmp18</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp20</span> <span class="main">←</span> <span class="bound">tmp19</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp21</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp22</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp20</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp21</span><span class="main">,</span> <span class="bound">tmp22</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp23</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp24</span> <span class="main">←</span> <span class="bound">tmp23</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp25</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp26</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="bound">tmp27</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp24</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp25</span><span class="main">,</span> <span class="bound">tmp26</span><span class="main">,</span> <span class="bound">tmp27</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Complex case, elements only.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp3</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">tmp4</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp5</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp8</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedElements()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">tmp11</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp12</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp13</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">tmp14</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp15</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp16</span><span class="main">,</span> <span class="bound">tmp17</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">tmp18</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp20</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp21</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp19</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp20</span><span class="main">,</span> <span class="bound">tmp21</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp22</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp23</span> <span class="main">←</span> <span class="bound">tmp22</span> <span class="main">.</span> <span class="keyword1">assignedElements(True)</span><span class="main">;</span>
  <span class="bound">tmp24</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp25</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="bound">tmp26</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp23</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp24</span><span class="main">,</span> <span class="bound">tmp25</span><span class="main">,</span> <span class="bound">tmp26</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Mutation. Append fallback contents.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test5''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">d1</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">d1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp8</span><span class="main">,</span> <span class="bound">tmp9</span><span class="main">,</span> <span class="bound">d1</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">,</span> <span class="bound">tmp13</span><span class="main">,</span> <span class="bound">d1</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">tmp14</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp15</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp16</span><span class="main">,</span> <span class="bound">tmp17</span><span class="main">,</span> <span class="bound">d1</span><span class="main">,</span> <span class="bound">tmp18</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Mutation. Remove fallback contents.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test5''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">remove()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp5</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">tmp6</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp7</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp8</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">,</span> <span class="bound">tmp15</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Mutation. Assign a node to a slot so that fallback contens are no longer used.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test5''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">d2</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">d2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''slot''</span><span class="main">,</span> <span class="inner_quoted">''slot2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''host1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">d2</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">d2</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[</span><span class="bound">d2</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">d2</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">tmp9</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp10</span><span class="main">,</span> <span class="main">[</span><span class="bound">d2</span><span class="main">,</span> <span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Mutation. Remove an assigned node from a slot so that fallback contens will be used.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test5''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''c1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">remove()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp7</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">tmp8</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp10</span><span class="main">,</span> <span class="bound">tmp11</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">tmp12</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp14</span><span class="main">,</span> <span class="bound">tmp15</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp17</span> <span class="main">←</span> <span class="bound">tmp16</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp18</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f1''</span><span class="main">;</span>
  <span class="bound">tmp19</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="bound">tmp20</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp17</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp18</span><span class="main">,</span> <span class="bound">tmp19</span><span class="main">,</span> <span class="bound">tmp20</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'Slots fallback: Mutation.  Remove a slot which is a fallback content of another slot.'›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> slots_fallback_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">n</span> <span class="main">←</span> createTestTree<span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''test5''</span><span class="main">;</span>
  removeWhiteSpaceOnlyTextNodes<span class="main">(</span><span class="bound">tmp1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">remove()</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">assignedNodes()</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s1''</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">tmp5</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="inner_quoted">''fall back contents should be empty because s1 is not in a shadow tree.''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s2''</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">tmp7</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp8</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp9</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s3''</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">tmp10</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp12</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''s4''</span><span class="main">;</span>
  <span class="bound">tmp14</span> <span class="main">←</span> <span class="bound">tmp13</span> <span class="main">.</span> <span class="keyword1">assignedNodes(True)</span><span class="main">;</span>
  <span class="bound">tmp15</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f2''</span><span class="main">;</span>
  <span class="bound">tmp16</span> <span class="main">←</span> <span class="bound">n</span> <span class="main">.</span> <span class="inner_quoted">''f4''</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp14</span><span class="main">,</span> <span class="main">[</span><span class="bound">tmp15</span><span class="main">,</span> <span class="bound">tmp16</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> slots_fallback_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM_Document_adoptNode">
<div class="head">
<h1>Theory Shadow_DOM_Document_adoptNode</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="comment1">(* This file is automatically generated, please do not modify! *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Testing Document\_adoptNode›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the test cases for Document\_adoptNode.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM_Document_adoptNode
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Shadow_DOM_BaseTest.html">Shadow_DOM_BaseTest</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Document_adoptNode_heap</span> <span class="main">::</span> <span class="quoted">heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Document_adoptNode_heap</span> <span class="main">=</span> create_heap <span class="main">[</span><span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_document_obj html <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''html''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''head''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''meta''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''charset''</span><span class="main">,</span> <span class="inner_quoted">''utf-8''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''title''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''Document.adoptNode''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''link''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''rel''</span><span class="main">,</span> <span class="inner_quoted">''help''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''href''</span><span class="main">,</span> <span class="inner_quoted">''https://dom.spec.whatwg.org/#dom-document-adoptnode''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharness.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharnessreport.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''body''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''log''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''x&lt;''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Document_adoptNode_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> object_ptr option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Document_adoptNode_document</span> <span class="main">=</span> Some <span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Adopting an Element called 'x&lt;' should work."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Document_adoptNode_document <span class="main">.</span> <span class="keyword1">getElementsByTagName(</span><span class="inner_quoted">''x&lt;''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">y</span> <span class="main">←</span> return <span class="main">(</span><span class="bound">tmp0</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">child</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">firstChild</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">parentNode</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> Document_adoptNode_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">tmp2</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> Document_adoptNode_document<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> Document_adoptNode_document <span class="main">.</span> <span class="keyword1">adoptNode(</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">parentNode</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp5</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp6</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">firstChild</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp6</span><span class="main">,</span> <span class="bound">child</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp7</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp7</span><span class="main">,</span> Document_adoptNode_document<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp8</span> <span class="main">←</span> <span class="bound">child</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp8</span><span class="main">,</span> Document_adoptNode_document<span class="main">)</span><span class="main">;</span>
  <span class="bound">doc</span> <span class="main">←</span> <span class="keyword1">createDocument(</span>None<span class="main">,</span> None<span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp9</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">adoptNode(</span><span class="bound">y</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp9</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp10</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">parentNode</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp10</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp11</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">firstChild</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp11</span><span class="main">,</span> <span class="bound">child</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp12</span> <span class="main">←</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp12</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp13</span> <span class="main">←</span> <span class="bound">child</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp13</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_adoptNode_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Adopting an Element called ':good:times:' should work."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">x</span> <span class="main">←</span> Document_adoptNode_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">'':good:times:''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Document_adoptNode_document <span class="main">.</span> <span class="keyword1">adoptNode(</span><span class="bound">x</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">doc</span> <span class="main">←</span> <span class="keyword1">createDocument(</span>None<span class="main">,</span> None<span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">adoptNode(</span><span class="bound">x</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">x</span> <span class="main">.</span> <span class="keyword1">parentNode</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp2</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_adoptNode_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM_Document_getElementById">
<div class="head">
<h1>Theory Shadow_DOM_Document_getElementById</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="comment1">(* This file is automatically generated, please do not modify! *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Testing Document\_getElementById›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the test cases for Document\_getElementById.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM_Document_getElementById
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Shadow_DOM_BaseTest.html">Shadow_DOM_BaseTest</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Document_getElementById_heap</span> <span class="main">::</span> <span class="quoted">heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Document_getElementById_heap</span> <span class="main">=</span> create_heap <span class="main">[</span><span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_document_obj html <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''html''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''head''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''meta''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''charset''</span><span class="main">,</span> <span class="inner_quoted">''utf-8''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''title''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''Document.getElementById''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''link''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''rel''</span><span class="main">,</span> <span class="inner_quoted">''author''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''title''</span><span class="main">,</span> <span class="inner_quoted">''Tetsuharu OHZEKI''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''href''</span><span class="main">,</span> <span class="inner_quoted">''mailto:saneyuki.snyk@gmail.com''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''link''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''rel''</span><span class="main">,</span> <span class="inner_quoted">''help''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''href''</span><span class="main">,</span> <span class="inner_quoted">''https://dom.spec.whatwg.org/#dom-document-getelementbyid''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharness.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharnessreport.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''body''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">19</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''log''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test1''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''data-name''</span><span class="main">,</span> <span class="inner_quoted">''1st''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''p''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''data-name''</span><span class="main">,</span> <span class="inner_quoted">''2nd''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''P''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''input''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''test5''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''type''</span><span class="main">,</span> <span class="inner_quoted">''submit''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''value''</span><span class="main">,</span> <span class="inner_quoted">''Submit''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''data-name''</span><span class="main">,</span> <span class="inner_quoted">''3rd''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">17</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''outer''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">18</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''middle''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''inner''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Document_getElementById_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> object_ptr option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Document_getElementById_document</span> <span class="main">=</span> Some <span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Document.getElementById with a script-inserted element"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test2''</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">test</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">result</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_not_equals(</span><span class="bound">result</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should not be null.''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">result</span> <span class="main">.</span> <span class="keyword1">tagName</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> <span class="inner_quoted">''div''</span><span class="main">,</span> <span class="inner_quoted">''should have appended element's tag name''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">test</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">removed</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">removed</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should not get removed element.''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"update `id` attribute via setAttribute/removeAttribute"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test3''</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">test</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">UPDATED_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test3-updated''</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">UPDATED_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">e</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">UPDATED_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">test</span><span class="main">,</span> <span class="inner_quoted">''should get the element with id.''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">old</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">old</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''shouldn't get the element by the old id.''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">removeAttribute(</span><span class="inner_quoted">''id''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">e2</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">UPDATED_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">e2</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should return null when the passed id is none in document.''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Ensure that the id attribute only affects elements present in a document"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test4-should-not-exist''</span><span class="main">;</span>
  <span class="bound">e</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">e</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should be null''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">e</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="inner_quoted">''should be the appended element''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"in tree order, within the context object's tree"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test5''</span><span class="main">;</span>
  <span class="bound">target</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_not_equals(</span><span class="bound">target</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should not be null''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">target</span> <span class="main">.</span> <span class="keyword1">getAttribute(</span><span class="inner_quoted">''data-name''</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> <span class="inner_quoted">''1st''</span><span class="main">,</span> <span class="inner_quoted">''should return the 1st''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element4</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element4</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element4</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''data-name''</span><span class="main">,</span> <span class="inner_quoted">''4th''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">element4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">target2</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_not_equals(</span><span class="bound">target2</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should not be null''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">target2</span> <span class="main">.</span> <span class="keyword1">getAttribute(</span><span class="inner_quoted">''data-name''</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="inner_quoted">''1st''</span><span class="main">,</span> <span class="inner_quoted">''should be the 1st''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">target2</span> <span class="main">.</span> <span class="keyword1">parentNode</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">target2</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">target3</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_not_equals(</span><span class="bound">target3</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should not be null''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">target3</span> <span class="main">.</span> <span class="keyword1">getAttribute(</span><span class="inner_quoted">''data-name''</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="inner_quoted">''4th''</span><span class="main">,</span> <span class="inner_quoted">''should be the 4th''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Modern browsers optimize this method with using internal id cache. This test checks that their optimization should effect only append to `Document`, not append to `Node`."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test6''</span><span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">s</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should be null''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"changing attribute's value via `Attr` gotten from `Element.attribute`."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test7''</span><span class="main">;</span>
  <span class="bound">element</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">element</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">target</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">target</span><span class="main">,</span> <span class="bound">element</span><span class="main">,</span> <span class="inner_quoted">''should return the element before changing the value''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="main">(</span><span class="bound">TEST_ID</span> <span class="main">@</span> <span class="inner_quoted">''-updated''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">target2</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">target2</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should return null after updated id via Attr.value''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">target3</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="main">(</span><span class="bound">TEST_ID</span> <span class="main">@</span> <span class="inner_quoted">''-updated''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">target3</span><span class="main">,</span> <span class="bound">element</span><span class="main">,</span> <span class="inner_quoted">''should be equal to the updated element.''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"update `id` attribute via element.id"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test12''</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">test</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">UPDATED_ID</span> <span class="main">←</span> return <span class="main">(</span><span class="bound">TEST_ID</span> <span class="main">@</span> <span class="inner_quoted">''-updated''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">UPDATED_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">e</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">UPDATED_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">test</span><span class="main">,</span> <span class="inner_quoted">''should get the element with id.''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">old</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">old</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''shouldn't get the element by the old id.''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">e2</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">UPDATED_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">e2</span><span class="main">,</span> None<span class="main">,</span> <span class="inner_quoted">''should return null when the passed id is none in document.''</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"where insertion order and tree order don't match"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test13''</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="main">(</span><span class="bound">TEST_ID</span> <span class="main">@</span> <span class="inner_quoted">''-fixture''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">container</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element1</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element1</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element2</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element2</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element3</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element3</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element4</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">element4</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">element2</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">element4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">element3</span><span class="main">,</span> <span class="bound">element4</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">element1</span><span class="main">,</span> <span class="bound">element2</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">test</span><span class="main">,</span> <span class="bound">element1</span><span class="main">,</span> <span class="inner_quoted">''should return 1st element''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">element1</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">test</span><span class="main">,</span> <span class="bound">element2</span><span class="main">,</span> <span class="inner_quoted">''should return 2nd element''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">element2</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">test</span><span class="main">,</span> <span class="bound">element3</span><span class="main">,</span> <span class="inner_quoted">''should return 3rd element''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">element3</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">test</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">test</span><span class="main">,</span> <span class="bound">element4</span><span class="main">,</span> <span class="inner_quoted">''should return 4th element''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">container</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">element4</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Inserting an id by inserting its parent node"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">gBody</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test14''</span><span class="main">;</span>
  <span class="bound">a</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">b</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">b</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">b</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> None<span class="main">)</span><span class="main">;</span>
  <span class="bound">gBody</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">a</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="bound">TEST_ID</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Document.getElementById must not return nodes not present in document"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">TEST_ID</span> <span class="main">←</span> return <span class="inner_quoted">''test15''</span><span class="main">;</span>
  <span class="bound">outer</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''outer''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">middle</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''middle''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">inner</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''inner''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''middle''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">outer</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">tmp0</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">new_el</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''h1''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">new_el</span> <span class="main">.</span> <span class="keyword1">setAttribute(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''heading''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">inner</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">new_el</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Document_getElementById_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''heading''</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> None<span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Document_getElementById_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM_Node_insertBefore">
<div class="head">
<h1>Theory Shadow_DOM_Node_insertBefore</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="comment1">(* This file is automatically generated, please do not modify! *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Testing Node\_insertBefore›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the test cases for Node\_insertBefore.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM_Node_insertBefore
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Shadow_DOM_BaseTest.html">Shadow_DOM_BaseTest</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Node_insertBefore_heap</span> <span class="main">::</span> <span class="quoted">heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Node_insertBefore_heap</span> <span class="main">=</span> create_heap <span class="main">[</span><span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_document_obj html <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''html''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''head''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''title''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''Node.insertBefore''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharness.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharnessreport.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''body''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''log''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Node_insertBefore_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> object_ptr option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Node_insertBefore_document</span> <span class="main">=</span> Some <span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Calling insertBefore an a leaf node Text must throw HIERARCHY\_REQUEST\_ERR."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">node</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createTextNode(</span><span class="inner_quoted">''Foo''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createTextNode(</span><span class="inner_quoted">''fail''</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>HierarchyRequestError<span class="main">,</span> <span class="bound">node</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">tmp0</span><span class="main">,</span> None<span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_insertBefore_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Calling insertBefore with an inclusive ancestor of the context object must throw HIERARCHY\_REQUEST\_ERR."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''log''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>HierarchyRequestError<span class="main">,</span> <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">tmp2</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">documentElement</span><span class="main">;</span>
  <span class="bound">tmp5</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">getElementById(</span><span class="inner_quoted">''log''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>HierarchyRequestError<span class="main">,</span> <span class="bound">tmp3</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="bound">tmp5</span><span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_insertBefore_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Calling insertBefore with a reference child whose parent is not the context node must throw a NotFoundError."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">a</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">b</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">c</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_insertBefore_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"If the context node is a document, inserting a document or text node should throw a HierarchyRequestError."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> <span class="keyword1">createDocument(</span><span class="inner_quoted">''title''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">doc2</span> <span class="main">←</span> <span class="keyword1">createDocument(</span><span class="inner_quoted">''title2''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">documentElement</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>HierarchyRequestError<span class="main">,</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">doc2</span><span class="main">,</span> <span class="bound">tmp0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createTextNode(</span><span class="inner_quoted">''text''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">documentElement</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>HierarchyRequestError<span class="main">,</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">tmp2</span><span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_insertBefore_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Inserting a node before itself should not move the node"›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">a</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">b</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">c</span> <span class="main">←</span> Node_insertBefore_document <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">b</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">c</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">childNodes</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp0</span><span class="main">,</span> <span class="main">[</span><span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">childNodes</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="main">[</span><span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">insertBefore(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp4</span> <span class="main">←</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">childNodes</span><span class="main">;</span>
  <span class="keyword1">assert_array_equals(</span><span class="bound">tmp4</span><span class="main">,</span> <span class="main">[</span><span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_insertBefore_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM_Node_removeChild">
<div class="head">
<h1>Theory Shadow_DOM_Node_removeChild</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="comment1">(* This file is automatically generated, please do not modify! *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Testing Node\_removeChild›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory contains the test cases for Node\_removeChild.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM_Node_removeChild
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="Shadow_DOM_BaseTest.html">Shadow_DOM_BaseTest</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Node_removeChild_heap</span> <span class="main">::</span> <span class="quoted">heap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>l</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Node_removeChild_heap</span> <span class="main">=</span> create_heap <span class="main">[</span><span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_document_obj html <span class="main">(</span>Some <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''html''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''head''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''title''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''Node.removeChild''</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharness.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''/resources/testharnessreport.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''creators.js''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''body''</span> <span class="main">[</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''div''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''id''</span><span class="main">,</span> <span class="inner_quoted">''log''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''iframe''</span> <span class="main">[]</span> <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''src''</span><span class="main">,</span> <span class="inner_quoted">''about:blank''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>element_ptr.Ref <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_element_obj <span class="inner_quoted">''script''</span> <span class="main">[</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> fmempty None<span class="main">)</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span>cast <span class="main">(</span>character_data_ptr.Ref <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cast <span class="main">(</span>create_character_data_obj <span class="inner_quoted">''%3C%3Cscript%3E%3E''</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Node_removeChild_document</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">,</span> unit<span class="main">)</span> object_ptr option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Node_removeChild_document</span> <span class="main">=</span> Some <span class="main">(</span>cast <span class="main">(</span>document_ptr.Ref <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Passing a detached Element to removeChild should not affect it."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> return Node_removeChild_document<span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Node_removeChild_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Passing a non-detached Element to removeChild should not affect it."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> return Node_removeChild_document<span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">documentElement</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">s</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> Node_removeChild_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Calling removeChild on an Element with no children should throw NOT\_FOUND\_ERR."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> return Node_removeChild_document<span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">s</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">doc</span><span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Passing a detached Element to removeChild should not affect it."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> <span class="keyword1">createDocument(</span><span class="inner_quoted">''''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp0</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> Node_removeChild_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">tmp1</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp2</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Passing a non-detached Element to removeChild should not affect it."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> <span class="keyword1">createDocument(</span><span class="inner_quoted">''''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">documentElement</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">s</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp2</span> <span class="main">←</span> Node_removeChild_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">tmp2</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp3</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp3</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Calling removeChild on an Element with no children should throw NOT\_FOUND\_ERR."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">doc</span> <span class="main">←</span> <span class="keyword1">createDocument(</span><span class="inner_quoted">''''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">s</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">createElement(</span><span class="inner_quoted">''div''</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">←</span> <span class="bound">doc</span> <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">appendChild(</span><span class="bound">s</span><span class="main">)</span><span class="main">;</span>
  <span class="bound">tmp1</span> <span class="main">←</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">ownerDocument</span><span class="main">;</span>
  <span class="keyword1">assert_equals(</span><span class="bound">tmp1</span><span class="main">,</span> <span class="bound">doc</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>NotFoundError<span class="main">,</span> <span class="bound">s</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span><span class="bound">doc</span><span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"Passing a value that is not a Node reference to removeChild should throw TypeError."›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
  <span class="bound">tmp0</span> <span class="main">←</span> Node_removeChild_document <span class="main">.</span> <span class="keyword1">body</span><span class="main">;</span>
  <span class="keyword1">assert_throws(</span>TypeError<span class="main">,</span> <span class="bound">tmp0</span> <span class="main">.</span> <span class="keyword1">removeChild</span><span class="main">(</span>None<span class="main">)</span><span class="main">)</span>
<span class="main">}</span><span class="main">)</span> Node_removeChild_heap"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shadow_DOM_Tests">
<div class="head">
<h1>Theory Shadow_DOM_Tests</h1>
</div>
<pre class="source"><span class="comment1">(***********************************************************************************
 * Copyright (c) 2016-2020 The University of Sheffield, UK
 *               2019-2020 University of Exeter, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 ***********************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Shadow DOM Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Shadow_DOM_Tests
  <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="slots.html">tests/slots</a>"</span>
  <span class="quoted">"<a href="slots_fallback.html">tests/slots_fallback</a>"</span>
  <span class="quoted">"<a href="Shadow_DOM_Document_adoptNode.html">tests/Shadow_DOM_Document_adoptNode</a>"</span>
  <span class="quoted">"<a href="Shadow_DOM_Document_getElementById.html">tests/Shadow_DOM_Document_getElementById</a>"</span>
  <span class="quoted">"<a href="Shadow_DOM_Node_insertBefore.html">tests/Shadow_DOM_Node_insertBefore</a>"</span>
  <span class="quoted">"<a href="Shadow_DOM_Node_removeChild.html">tests/Shadow_DOM_Node_removeChild</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>