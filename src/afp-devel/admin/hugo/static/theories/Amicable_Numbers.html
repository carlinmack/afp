<div id="Amicable_Numbers">
<div class="head">
<h1>Theory Amicable_Numbers</h1>
</div>
<pre class="source"><span class="comment1">(*Author: Angeliki Koutsoukou-Argyraki, University of Cambridge.
Date: 3 August 2020.

text‹This is a formalisation of Amicable Numbers, involving some relevant material including
Euler's sigma function, some relevant definitions, results and examples as well as rules such as
Th\={a}bit ibn Qurra's Rule, Euler's Rule, te Riele's Rule and Borho's Rule with breeders.›*)</span>

<span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Amicable_Numbers"</span>
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
   <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
   <a href="../Pratt_Certificate/Pratt_Certificate_Code.html">Pratt_Certificate.Pratt_Certificate_Code</a>
   <a href="../Polynomial_Factorization/Prime_Factorization.html">Polynomial_Factorization.Prime_Factorization</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_minus_eq_nat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span>  <span class="free">x</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">-</span><span class="free">x</span><span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="free">z</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_eq_nat_subst<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">C</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">D</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">E</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">-</span><span class="free">C</span><span class="main">-</span><span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="main">-</span><span class="free">E</span> <span class="main">=</span> <span class="main">-</span><span class="free">C</span><span class="main">-</span><span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">-</span><span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_eq_nat_subst_order<span class="main">:</span>  <span class="keyword2"><span class="keyword">fixes</span></span>  <span class="free">A</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">B</span><span class="main">::</span><span class="quoted">nat</span>  <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">C</span><span class="main">::</span><span class="quoted">nat</span>  <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">D</span><span class="main">::</span><span class="quoted">nat</span>  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">E</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">-</span><span class="free">C</span><span class="main">-</span><span class="free">D</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">-</span><span class="free">C</span><span class="main">-</span><span class="free">D</span><span class="main">+</span><span class="free">B</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">B</span><span class="main">-</span><span class="free">C</span><span class="main">-</span><span class="free">D</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> auxiliary_ineq<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="comment1">(* TODO The following three auxiliary lemmas are by Lawrence Paulson. To be added to the library. *)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_strict_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊂</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="free">A</span> <span class="main">&lt;</span> <span class="main">∑</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">-</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms DiffE <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="main">(</span><span class="free">B</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="free">B</span> <span class="main">=</span> <span class="main">∑</span> <span class="free">A</span> <span class="main">+</span> <span class="main">∑</span> <span class="main">(</span><span class="free">B</span><span class="main">-</span><span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> psubsetE sum.subset_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_image_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sum.reindex_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> coprime_dvd_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">na</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ma</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">mb</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">nb</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ma</span> <span class="main">*</span> <span class="free">na</span> <span class="main">=</span> <span class="free">mb</span> <span class="main">*</span> <span class="free">nb</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ma</span> <span class="main">=</span> <span class="free">mb</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">na</span> <span class="free">mb</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def gcd.commute gcd_nat.mono is_unit_gcd_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">nb</span> <span class="free">ma</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def gcd.commute gcd_nat.mono is_unit_gcd_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ma</span> <span class="main">=</span> <span class="free">mb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq gcd_mult_distrib_nat mult.commute nat_mult_1_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Amicable Numbers›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divisor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span>nat <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">divisor</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1"><span class="free">divisor</span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> divisor_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">divisor_set</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">divisor</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> def_equiv_divisor_set<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> set<span class="main">(</span>divisors_nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  divisors_nat_def divisors_nat divisor_set divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proper_divisor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span>nat <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">properdiv</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1"><span class="free">properdiv</span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> properdiv_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">properdiv_set</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">properdiv</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> example1_divisor<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> divisor_set <span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span>  divisor_set divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> example2_properdiv_set<span class="main">:</span> <span class="quoted"><span class="quoted">"properdiv_set <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> properdiv_set proper_divisor_def less_Suc_eq dvd_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">presburger</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_set_not_empty<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> divisor_set <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms divisor_set divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_divisor_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>divisor_set <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divisor_def divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_properdiv_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>properdiv_set <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  properdiv_set proper_divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_set_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"divisor_set  <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">*</span><span class="bound">j</span><span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">∈</span> divisor_set <span class="free">m</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">∈</span> divisor_set <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divisor_set divisor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_set divisor_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> division_decomp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_set_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_set divisor_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divisor_set_one<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">1</span> <span class="main">=</span><span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divisor_set  divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> union_properdiv_set<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"divisor_set <span class="free">n</span> <span class="main">=</span><span class="main">(</span>properdiv_set <span class="free">n</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> divisor_set properdiv_set  proper_divisor_def assms  divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prime_div_set<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"divisor_set <span class="free">n</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divisor_def assms divisor_set  prime_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> div_set_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"properdiv_set <span class="free">n</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms properdiv_set prime_nat_iff proper_divisor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong One_nat_def divisor_def divisor_set divisor_set_one
 dvd_1_left empty_iff insert_iff mem_Collect_eq order_less_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prime_gcd<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">m</span> <span class="free">n</span> <span class="main">=</span><span class="main">1</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> prime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms primes_coprime<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We refer to definitions from \cite{aliquotwiki}:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">aliquot_sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">aliquot_sum</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="main">(</span>properdiv_set <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deficient_number</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deficient_number</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">abundant_number</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">abundant_number</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perfect_number</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">perfect_number</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> example_perfect_6<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perfect_number <span class="numeral">6</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">6</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">6</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="numeral">6</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">6</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a  def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span>  c<span class="main">:</span> <span class="quoted"><span class="quoted">"properdiv_set <span class="main">(</span><span class="numeral">6</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b union_properdiv_set properdiv_set proper_divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aliquot_sum_def c
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_3_eq_3 perfect_number_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Euler's sigma function and properties›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The sources of the following useful material on Euler's sigma function are \cite{garciaetal1},
\cite{garciaetal2}, \cite{sandifer} and \cite{escott}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Esigma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Esigma</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="main">(</span>divisor_set <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Esigma_properdiv_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>aliquot_sum <span class="free">m</span><span class="main">)</span> <span class="main">+</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms divisor_set properdiv_set proper_divisor_def union_properdiv_set  Esigma_def
        aliquot_sum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> Esigmanotzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Esigma_def assms Esigma_properdiv_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prime_sum_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" Esigma <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms prime_ge_1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Esigma_properdiv_set assms div_set_prime
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Esigma_properdiv_set aliquot_sum_def assms div_set_prime<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_div_is_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span>prime <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">n</span> <span class="keyword1">divisor</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">divisor</span> <span class="free">n</span>"</span></span><span class="keyword1"><span class="command">using</span></span> assms divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Esigma_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="main">(</span> <span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> divisor_set <span class="free">n</span> <span class="main">∧</span> <span class="bound">m</span><span class="main">≠</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms F
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Esigma_def divisor_set divisor_def prime_nat_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc_le_eq dvd_imp_le dvd_pos_nat<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">=</span> <span class="main">∑</span><span class="main">{</span><span class="free">n</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">≠</span> Suc <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"divisor_set <span class="free">n</span> <span class="main">⊃</span> <span class="main">{</span><span class="free">n</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms divisor_set r <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="keyword1">divisor</span> <span class="free">n</span>›</span></span> divisor_set_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="main">(</span>divisor_set <span class="free">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">∑</span><span class="main">{</span><span class="free">n</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_strict_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_divisor_set<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_def divisor_set<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> Esigma_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Esigma_prime_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span> <span class="free">m</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="main">(</span><span class="free">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">m</span>›</span></span> prime_gt_1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma <span class="main">(</span><span class="free">m</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span> <span class="main">∑</span> <span class="bound">j</span><span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span><span class="main">(</span> <span class="free">m</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> AA<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="free">m</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">m</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms prime_ge_1_nat
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_increasing prime_ge_Suc_0_nat divisor_set divisor_def image_iff
 divides_primepow_nat<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">m</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">m</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atMost_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add.commute add_le_same_cancel1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atMost_iff finite_atMost finite_imageI
image_iff le_zero_eq power_add power_one_right prime_power_inj sum.insert zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"§"</span> AA Esigma_def atMost_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span><span class="main">(</span> <span class="free">m</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="free">m</span><span class="main">^</span>Suc <span class="free">k</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="main">(</span><span class="free">m</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> Set_Interval.geometric_sum  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def lessThan_Suc_atMost nat_one_le_power of_nat_1 of_nat_diff of_nat_mult
of_nat_power one_le_mult_iff prime_ge_Suc_0_nat sum.lessThan_Suc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 atMost_atLeast0 of_nat_1 of_nat_diff prime_ge_1_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_Esigma_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">m</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">divisor</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> divisor_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_imp_le prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k</span> <span class="keyword1">divisor</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">k</span><span class="main">≠</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">∧</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">m</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">k</span><span class="main">≠</span> <span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> divisor_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def division_decomp nat_mult_1 nat_mult_1_right prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> divisor_set assms  divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≠</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms not_prime_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span><span class="free">m</span> <span class="main">*</span><span class="free">n</span> <span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Esigma_def c<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_sum_div assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gcd_Esigma_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">∑</span> <span class="main">{</span><span class="bound">i</span><span class="main">*</span><span class="bound">j</span><span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> divisor_set <span class="free">m</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> divisor_set <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_set_mult Esigma_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> divisor_set <span class="free">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span> <span class="main">∈</span> divisor_set <span class="free">n</span><span class="main">.</span> <span class="bound">i</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span>divisor_set <span class="free">m</span> <span class="main">×</span> divisor_set <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def divisor_set divisor_def<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms coprime_dvd_aux mult_left_cancel not_one_le_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
<span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">*</span><span class="bound">j</span><span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> divisor_set <span class="free">m</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> divisor_set <span class="free">n</span><span class="main">}</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>divisor_set <span class="free">m</span> <span class="main">×</span> divisor_set <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.cartesian_product sum_image_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">∑</span><span class="main">(</span> divisor_set <span class="free">m</span><span class="main">)</span><span class="main">*</span> <span class="main">∑</span><span class="main">(</span> divisor_set <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_product<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Esigma <span class="free">m</span> <span class="main">*</span> Esigma <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Esigma_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deficient_Esigma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deficient_number <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Esigma_properdiv_set assms deficient_number_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> abundant_Esigma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">&gt;</span> <span class="numeral">2</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span><span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abundant_number <span class="free">m</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Esigma_properdiv_set assms abundant_number_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> perfect_Esigma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span><span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perfect_number <span class="free">m</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> Esigma_properdiv_set assms perfect_number_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Amicable Numbers; definitions, some lemmas and examples›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Amicable_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span>nat <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">Amic</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1"><span class="free">Amic</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span> "</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_pair_sym<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span> "</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">Amic</span> <span class="free">m</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span>  Amicable_pair_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_pair_equiv_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="free">m</span> <span class="main">=</span> Esigma <span class="free">n</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>Esigma <span class="free">m</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Amicable_pair_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Esigma_properdiv_set add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_pair_equiv_def_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="free">m</span> <span class="main">=</span> Esigma <span class="free">n</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>Esigma <span class="free">m</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Amicable_pair_def Esigma_properdiv_set
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_imp_eq add.commute <span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">typeAmic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">typeAmic</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span>
    <span class="main">[</span><span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">N</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="bound">N</span><span class="main">*</span><span class="main">(</span>gcd <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">∧</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="bound">N</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="main">(</span>gcd <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
     <span class="main">(</span>card <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">M</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="bound">M</span><span class="main">*</span><span class="main">(</span>gcd <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">∧</span> prime <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="keyword1">dvd</span> <span class="bound">M</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">j</span> <span class="keyword1">dvd</span> <span class="main">(</span>gcd <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_pair_deficient<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deficient_number <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms deficient_number_def Amicable_pair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_pair_abundant<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abundant_number <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms abundant_number_def Amicable_pair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> even_even_amicable<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">≠</span> <span class="free">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span> <span class="operator">rule</span> ccontr <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span>  <span class="main">=</span> Esigma <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>›</span></span> Amicable_pair_equiv_def Amicable_pair_def
     assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">≠</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">≠</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">≠</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">∈</span> divisor_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> divisor_set assms divisor_set_not_empty
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">m</span> <span class="main">∉</span> divisor_set <span class="main">(</span><span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> divisor_set assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span> <span class="keyword1">divisor</span> <span class="free">m</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="keyword1">divisor</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> w3<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">⊃</span> divisor_set <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> divisor_set divisor_def assms w w1 w2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">(</span> divisor_set <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">i</span><span class="main">)</span><span class="main">&gt;</span> <span class="main">(</span> <span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">(</span> divisor_set <span class="free">m</span><span class="main">)</span><span class="main">.</span><span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> w3  sum_strict_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_def divisor_set<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v d Esigma_def a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Regular Amicable Pairs›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">regularAmicPair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">regularAmicPair</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">Amic</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">M</span> <span class="bound">N</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">=</span> gcd <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="bound">M</span><span class="main">*</span><span class="bound">g</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="bound">N</span><span class="main">*</span><span class="bound">g</span> <span class="main">∧</span> squarefree <span class="bound">M</span> <span class="main">∧</span>
              squarefree <span class="bound">N</span> <span class="main">∧</span> gcd <span class="bound">g</span> <span class="bound">M</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> gcd <span class="bound">g</span> <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> regularAmicPair_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"regularAmicPair <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"regularAmicPair <span class="free">m</span> <span class="free">n</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> gcd <span class="free">n</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> gcd.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Amicable_pair_sym assms regularAmicPair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">irregularAmicPair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">irregularAmicPair</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">Amic</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> regularAmicPair <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irregularAmicPair_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irregularAmicPair <span class="free">n</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irregularAmicPair <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  irregularAmicPair_def regularAmicPair_sym Amicable_pair_sym assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Twin Amicable Pairs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We refer to the definition in \cite{amicwiki}:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">twinAmicPair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">twinAmicPair</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟷</span>
     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">Amic</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">k</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> Min <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> Max <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span><span class="main">∧</span> <span class="bound">k</span> <span class="keyword1">Amic</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> twinAmicPair_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"twinAmicPair <span class="free">n</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"twinAmicPair <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms twinAmicPair_def Amicable_pair_sym assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Isotopic Amicable Pairs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A way of generating an amicable pair from a given amicable pair under certain conditions is 
given below. Such amicable pairs are called Isotopic \cite{garciaetal1}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> isotopic_amicable_pair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span> <span class="free">g</span> <span class="free">h</span> <span class="free">M</span> <span class="free">N</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">=</span> <span class="free">g</span><span class="main">*</span><span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">g</span><span class="main">*</span><span class="free">N</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">h</span><span class="main">/</span><span class="free">g</span><span class="main">)</span> <span class="main">*</span> Esigma <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">g</span> <span class="free">M</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">g</span> <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">h</span> <span class="free">M</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">h</span> <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">=</span> Esigma <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ <span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>›</span></span>  Amicable_pair_equiv_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ <span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>›</span></span> Amicable_pair_equiv_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">h</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">M</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Esigmanotzero gcd_Esigma_mult gcd_nat.idem b mult_eq_self_implies_10
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="free">M</span>›</span></span>  gcd_Esigma_mult assms
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">g</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">g</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">M</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">≠</span><span class="free">M</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms gcd_nat.idem <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">g</span><span class="main">≠</span><span class="free">M</span>›</span></span>  gcd_Esigma_mult assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">g</span><span class="main">*</span><span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">g</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">N</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">≠</span><span class="free">N</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">g</span><span class="main">≠</span><span class="free">N</span>›</span></span>  gcd_Esigma_mult assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">g</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">g</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">h</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">N</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">≠</span><span class="free">N</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹ gcd <span class="free">h</span> <span class="free">N</span> <span class="main">=</span><span class="main">1</span>›</span></span>  a b p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="free">N</span>›</span></span>  gcd_Esigma_mult  assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c p3 d e p1 p2 a assms Esigmanotzero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span>  <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">h</span><span class="main">/</span><span class="free">g</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b c p1 Esigmanotzero assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span><span class="main">*</span><span class="main">(</span><span class="free">m</span><span class="main">/</span><span class="free">g</span><span class="main">+</span><span class="free">n</span><span class="main">/</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  s assms
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_divide_distrib b of_nat_add semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span>
 times_divide_eq_left times_divide_eq_right<span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma <span class="main">(</span><span class="free">h</span><span class="main">*</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span><span class="main">*</span><span class="main">(</span><span class="free">M</span><span class="main">+</span><span class="free">N</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">/</span><span class="free">g</span> <span class="main">=</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">/</span><span class="free">g</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s1 v v1 assms
         <span class="keyword1"><span class="command">using</span></span> of_nat_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s2 assms
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Amicable_pair_equiv_def_conv A B assms one_le_mult_iff  One_nat_def Suc_leI
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>  nat_less_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> isotopic_pair_example1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">11</span><span class="main">*</span><span class="numeral">17</span><span class="main">*</span><span class="numeral">227</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">23</span><span class="main">*</span><span class="numeral">37</span><span class="main">*</span><span class="numeral">53</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">11</span><span class="main">*</span><span class="numeral">17</span><span class="main">*</span><span class="numeral">227</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">23</span><span class="main">*</span><span class="numeral">37</span><span class="main">*</span><span class="numeral">53</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">11</span><span class="main">*</span><span class="numeral">17</span><span class="main">*</span><span class="numeral">227</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">23</span><span class="main">*</span><span class="numeral">37</span><span class="main">*</span><span class="numeral">53</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> o3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">5</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> o4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> o5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">11</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="numeral">17</span><span class="main">*</span><span class="numeral">227</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> o6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">23</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="numeral">37</span><span class="main">*</span><span class="numeral">53</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">Amic</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o1 o2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o1 o3 o5  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="skolem">N</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> o2 o3 o6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> v3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o4 o3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="numeral">819</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="numeral">135</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">/</span><span class="skolem">g</span><span class="main">)</span><span class="main">*</span>Esigma <span class="skolem">g</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="skolem">h</span> <span class="main">=</span> <span class="numeral">1456</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">819</span><span class="main">)</span> <span class="main">=</span><span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="numeral">13</span><span class="main">,</span> <span class="numeral">21</span><span class="main">,</span> <span class="numeral">39</span><span class="main">,</span> <span class="numeral">63</span><span class="main">,</span> <span class="numeral">91</span><span class="main">,</span> <span class="numeral">117</span><span class="main">,</span> <span class="numeral">273</span><span class="main">,</span> <span class="numeral">819</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
      <span class="keyword1"><span class="command">have</span></span> RR<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span> divisors_nat<span class="main">(</span><span class="numeral">819</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> divisor_set <span class="main">(</span><span class="numeral">819</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">show</span></span><span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Esigma_def RR R <span class="quoted"><span class="quoted">‹ <span class="skolem">h</span> <span class="main">=</span> <span class="numeral">819</span>›</span></span> divisor_def divisors_nat divisors_nat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="skolem">g</span> <span class="main">=</span> <span class="numeral">240</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">135</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">27</span><span class="main">,</span> <span class="numeral">45</span><span class="main">,</span> <span class="numeral">135</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
      <span class="keyword1"><span class="command">have</span></span> GG<span class="main">:</span>  <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">135</span><span class="main">)</span> <span class="main">=</span> divisor_set <span class="numeral">135</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G GG Esigma_def  <span class="quoted"><span class="quoted">‹ <span class="skolem">g</span> <span class="main">=</span> <span class="numeral">135</span>›</span></span>
      properdiv_set proper_divisor_def
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="skolem">h</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="skolem">h</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">=</span> <span class="numeral">196560</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B o3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> AA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">=</span> <span class="numeral">196560</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C o4  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A AA <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> D
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute nat_neq_iff nonzero_mult_div_cancel_right
of_nat_eq_0_iff of_nat_mult times_divide_eq_left w<span class="main">)</span>

 <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> w4<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">g</span> <span class="skolem">M</span> <span class="main">=</span><span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">g</span> <span class="skolem">M</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> o3 o5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">5</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> o5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> o5 o3
     gcd_nat.absorb_iff2 prime_nat_iff <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coprime_commute
coprime_mult_left_iff prime_imp_coprime_nat prime_imp_power_coprime_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">g</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">" gcd <span class="skolem">g</span> <span class="skolem">N</span> <span class="main">=</span><span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">g</span> <span class="skolem">N</span>"</span></span>

 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> o3 o6  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">5</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> o3 gcd_nat.absorb_iff2 prime_nat_iff <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
 <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coprime_commute
coprime_mult_left_iff prime_imp_coprime_nat prime_imp_power_coprime_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">g</span> <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">h</span> <span class="skolem">M</span> <span class="main">=</span><span class="main">1</span>"</span></span>

 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">h</span> <span class="skolem">M</span>"</span></span>

 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> o4 o5  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o5  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">7</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o5  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">13</span> <span class="keyword1">dvd</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> o4  gcd_nat.absorb_iff2 prime_nat_iff <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
<span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coprime_commute
coprime_mult_left_iff prime_imp_coprime_nat prime_imp_power_coprime_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">h</span> <span class="skolem">M</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">h</span> <span class="skolem">N</span> <span class="main">=</span><span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">h</span> <span class="skolem">N</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o4 o6  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o6  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">7</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o6  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">13</span> <span class="keyword1">dvd</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> o4
     gcd_nat.absorb_iff2 prime_nat_iff <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>›</span></span><span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹ prime<span class="main">(</span><span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coprime_commute
coprime_mult_left_iff prime_imp_coprime_nat prime_imp_power_coprime_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">h</span> <span class="skolem">N</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> s4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">*</span><span class="skolem">M</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="skolem">h</span><span class="main">*</span><span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> isotopic_amicable_pair v v1 v2 v3 w4 s s1 s2 w w1 w2
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI le_eq_less_or_eq nat_1_eq_mult_iff
num.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> numeral_eq_one_iff one_le_mult_iff one_le_numeral o3 o4 o5 o6<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s4 o4 o5 o6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Betrothed (Quasi-Amicable) Pairs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We refer to the definition in \cite{betrothedwiki}:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">QuasiAmicable_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">QAmic</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1"><span class="free">QAmic</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> aliquot_sum <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> QuasiAmicable_pair_sym <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">QAmic</span> <span class="free">n</span> "</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">QAmic</span> <span class="free">m</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span>  QuasiAmicable_pair_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> QuasiAmicable_example<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">48</span> <span class="keyword1">QAmic</span> <span class="numeral">75</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">48</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">12</span><span class="main">,</span> <span class="numeral">16</span><span class="main">,</span> <span class="numeral">24</span><span class="main">,</span> <span class="numeral">48</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="numeral">48</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">12</span><span class="main">,</span> <span class="numeral">16</span><span class="main">,</span> <span class="numeral">24</span><span class="main">,</span> <span class="numeral">48</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a  def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"properdiv_set <span class="main">(</span><span class="numeral">48</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">12</span><span class="main">,</span> <span class="numeral">16</span><span class="main">,</span> <span class="numeral">24</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b union_properdiv_set properdiv_set proper_divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"aliquot_sum <span class="main">(</span><span class="numeral">48</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">75</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aliquot_sum_def c
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">75</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">25</span><span class="main">,</span> <span class="numeral">75</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"divisor_set <span class="main">(</span><span class="numeral">75</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">25</span><span class="main">,</span> <span class="numeral">75</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i  def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"properdiv_set <span class="main">(</span><span class="numeral">75</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">25</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ii union_properdiv_set properdiv_set proper_divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"aliquot_sum <span class="main">(</span><span class="numeral">75</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">48</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aliquot_sum_def iii
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e iv QuasiAmicable_pair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Breeders›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">breeder_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span>nat <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">breeder</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1"><span class="free">breeder</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">ℕ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> Esigma <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">*</span><span class="bound">x</span> <span class="main">∧</span> Esigma <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> breederAmic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">*</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> Esigma <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">n</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">m</span> <span class="free">x</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms  gcd_nat.absorb_iff2 prime_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gcd <span class="free">m</span> <span class="free">x</span> <span class="main">=</span><span class="main">1</span>›</span></span> gcd_Esigma_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">x</span>›</span></span>  prime_Esigma_mult A1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_sum_div<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">n</span> <span class="main">=</span> <span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">*</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B Amicable_pair_equiv_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Amicable_pair_equiv_def_conv Esigma_properdiv_set
One_nat_def Suc_leI add_cancel_left_left add_le_same_cancel1 add_mult_distrib2 assms
 dvd_triv_right le_add2 nat_0_less_mult_iff not_gr_zero not_le semiring_normalization_rules<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹More examples›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The first odd-odd amicable pair was discovered by Euler \cite{garciaetal1}. In the following 
proof, amicability is shown using the properties of Euler's sigma function.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> odd_odd_amicable_Euler<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">69615</span> <span class="keyword1">Amic</span> <span class="numeral">87633</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">17</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span><span class="keyword1">dvd</span><span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">5</span> <span class="keyword1">dvd</span><span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">17</span> <span class="keyword1">dvd</span><span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">69615</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span> <span class="main">=</span>  Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span><span class="main">*</span>Esigma<span class="main">(</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> A111<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime  <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">17</span> <span class="keyword1">dvd</span><span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">5</span> <span class="keyword1">dvd</span><span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">17</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> coprime_commute coprime_mult_left_iff prime_imp_coprime_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span><span class="main">(</span><span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A111  coprime_imp_gcd_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gcd <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span><span class="main">(</span><span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span> <span class="main">=</span><span class="main">1</span> ›</span></span>
        gcd_Esigma_mult
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">7</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="numeral">13</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">)</span> <span class="numeral">13</span> <span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">13</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">)</span>›</span></span> gcd_nat.absorb_iff2 prime_nat_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">)</span><span class="main">*</span>Esigma<span class="main">(</span><span class="numeral">13</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹gcd  <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span><span class="numeral">7</span><span class="main">)</span> <span class="numeral">13</span> <span class="main">=</span><span class="main">1</span>›</span></span>  gcd_Esigma_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="numeral">7</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹ <span class="main">¬</span> <span class="numeral">7</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">)</span>›</span></span> gcd_nat.absorb_iff2 prime_nat_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span> Esigma <span class="main">(</span><span class="numeral">7</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹gcd <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="numeral">7</span> <span class="main">=</span><span class="main">1</span>›</span></span>  gcd_Esigma_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">13</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span><span class="numeral">9</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> A55<span class="main">:</span><span class="quoted"><span class="quoted">"divisor_set <span class="numeral">9</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">9</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> A555<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="main">(</span><span class="numeral">9</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">9</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> def_equiv_divisor_set A555 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A55 <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span><span class="numeral">9</span>›</span></span> Esigma_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span> <span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A6<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">13</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">14</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_sum_div <span class="quoted"><span class="quoted">‹prime<span class="main">(</span> <span class="numeral">13</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span> <span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A7<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">7</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">8</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_sum_div <span class="quoted"><span class="quoted">‹prime<span class="main">(</span> <span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">17</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A8<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">17</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">5</span><span class="main">)</span> <span class="main">*</span> Esigma <span class="main">(</span><span class="numeral">17</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> prime_Esigma_mult <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">17</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arith_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.commute num.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> numeral_eq_iff semiring_norm<span class="main"><span class="main">(</span></span>83<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A9<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">69615</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span>Esigma <span class="main">(</span><span class="numeral">7</span><span class="main">)</span> <span class="main">*</span>Esigma <span class="main">(</span><span class="numeral">13</span><span class="main">)</span> <span class="main">*</span> Esigma<span class="main">(</span><span class="numeral">5</span><span class="main">)</span> <span class="main">*</span> Esigma <span class="main">(</span><span class="numeral">17</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A1 A2 A3 A4 A5 A6 A7 A8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A10<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">5</span><span class="main">)</span><span class="main">=</span><span class="numeral">6</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_sum_div <span class="quoted"><span class="quoted">‹prime<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> A11<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">17</span><span class="main">)</span><span class="main">=</span><span class="numeral">18</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_sum_div <span class="quoted"><span class="quoted">‹prime<span class="main">(</span><span class="numeral">17</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> AA<span class="main">:</span>  <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">69615</span><span class="main">)</span><span class="main">=</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">8</span><span class="main">*</span><span class="numeral">14</span><span class="main">*</span><span class="numeral">6</span><span class="main">*</span><span class="numeral">18</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A1 A2 A3 A4 A5 A6 A7 A8 A9 A10 A11
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> AAA<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">69615</span><span class="main">)</span> <span class="main">=</span><span class="numeral">157248</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AA <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> AA1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">87633</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">107</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">107</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> AA2<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">107</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span><span class="main">*</span>Esigma<span class="main">(</span><span class="numeral">107</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="numeral">107</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span>  <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd  <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span> <span class="numeral">107</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">107</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹ <span class="main">¬</span> <span class="main">(</span><span class="numeral">107</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span>  <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span>›</span></span>

      <span class="keyword1"><span class="command">using</span></span> gcd_nat.absorb_iff2 prime_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gcd  <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span> <span class="numeral">107</span> <span class="main">=</span><span class="main">1</span>›</span></span> gcd_Esigma_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> AA3<span class="main">:</span>  <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">107</span><span class="main">)</span> <span class="main">=</span><span class="numeral">108</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_sum_div <span class="quoted"><span class="quoted">‹prime<span class="main">(</span><span class="numeral">107</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> AA4<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">13</span><span class="main">*</span><span class="numeral">8</span><span class="main">*</span><span class="numeral">14</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A3 A4 A5 A6 A7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> AA5 <span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">107</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">13</span><span class="main">*</span><span class="numeral">8</span><span class="main">*</span><span class="numeral">14</span><span class="main">*</span><span class="numeral">108</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AA2 AA3 AA4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> AA6<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">*</span><span class="numeral">13</span><span class="main">*</span><span class="numeral">107</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">157248</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AA5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="numeral">69615</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">87633</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  AAA AA6 AA5 AA1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma<span class="main">(</span><span class="numeral">87633</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">69615</span> <span class="main">+</span> <span class="numeral">87633</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AAA <span class="quoted"><span class="quoted">‹Esigma <span class="numeral">69615</span> <span class="main">=</span> Esigma <span class="numeral">87633</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B Amicable_pair_def Amicable_pair_equiv_def_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following is the smallest odd-odd amicable pair \cite{garciaetal1}. In the following proof, 
amicability is shown directly by evaluating the sets of divisors.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_pair_example_smallest_odd_odd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">12285</span> <span class="keyword1">Amic</span> <span class="numeral">14595</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="main">(</span><span class="numeral">12285</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="numeral">13</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">21</span><span class="main">,</span> <span class="numeral">27</span><span class="main">,</span> <span class="numeral">35</span><span class="main">,</span> <span class="numeral">39</span><span class="main">,</span> <span class="numeral">45</span><span class="main">,</span> <span class="numeral">63</span><span class="main">,</span> <span class="numeral">65</span><span class="main">,</span> <span class="numeral">91</span><span class="main">,</span>
<span class="numeral">105</span><span class="main">,</span> <span class="numeral">117</span><span class="main">,</span> <span class="numeral">135</span><span class="main">,</span> <span class="numeral">189</span><span class="main">,</span> <span class="numeral">195</span><span class="main">,</span> <span class="numeral">273</span><span class="main">,</span> <span class="numeral">315</span><span class="main">,</span> <span class="numeral">351</span><span class="main">,</span> <span class="numeral">455</span><span class="main">,</span> <span class="numeral">585</span><span class="main">,</span> <span class="numeral">819</span><span class="main">,</span> <span class="numeral">945</span><span class="main">,</span> <span class="numeral">1365</span><span class="main">,</span> <span class="numeral">1755</span><span class="main">,</span> <span class="numeral">2457</span><span class="main">,</span> <span class="numeral">4095</span><span class="main">,</span> <span class="numeral">12285</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="main">(</span><span class="numeral">12285</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> divisor_set <span class="numeral">12285</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="numeral">13</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">21</span><span class="main">,</span> <span class="numeral">27</span><span class="main">,</span> <span class="numeral">35</span><span class="main">,</span> <span class="numeral">39</span><span class="main">,</span> <span class="numeral">45</span><span class="main">,</span> <span class="numeral">63</span><span class="main">,</span> <span class="numeral">65</span><span class="main">,</span> <span class="numeral">91</span><span class="main">,</span> <span class="numeral">105</span><span class="main">,</span> <span class="numeral">117</span><span class="main">,</span> <span class="numeral">135</span><span class="main">,</span> <span class="numeral">189</span><span class="main">,</span> <span class="numeral">195</span><span class="main">,</span> <span class="numeral">273</span><span class="main">,</span> 
<span class="numeral">315</span><span class="main">,</span> <span class="numeral">351</span><span class="main">,</span> <span class="numeral">455</span><span class="main">,</span> <span class="numeral">585</span><span class="main">,</span> <span class="numeral">819</span><span class="main">,</span> <span class="numeral">945</span><span class="main">,</span> <span class="numeral">1365</span><span class="main">,</span> <span class="numeral">1755</span><span class="main">,</span> <span class="numeral">2457</span><span class="main">,</span> <span class="numeral">4095</span><span class="main">,</span> <span class="numeral">12285</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">26880</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span>  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="numeral">12285</span> <span class="main">=</span> <span class="numeral">26880</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A A1 A2 Esigma_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma <span class="numeral">12285</span> <span class="main">=</span> Esigma <span class="numeral">14595</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="main">(</span><span class="numeral">14595</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">{</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">21</span><span class="main">,</span> <span class="numeral">35</span><span class="main">,</span> <span class="numeral">105</span><span class="main">,</span> <span class="numeral">139</span><span class="main">,</span> <span class="numeral">417</span><span class="main">,</span> <span class="numeral">695</span><span class="main">,</span> <span class="numeral">973</span><span class="main">,</span> <span class="numeral">2085</span><span class="main">,</span> <span class="numeral">2919</span><span class="main">,</span> <span class="numeral">4865</span><span class="main">,</span> <span class="numeral">14595</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">have</span></span> N1<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="main">(</span><span class="numeral">14595</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> divisor_set <span class="numeral">14595</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> def_equiv_divisor_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> N2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="main">{</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">21</span><span class="main">,</span> <span class="numeral">35</span><span class="main">,</span> <span class="numeral">105</span><span class="main">,</span> <span class="numeral">139</span><span class="main">,</span> <span class="numeral">417</span><span class="main">,</span> <span class="numeral">695</span><span class="main">,</span> <span class="numeral">973</span><span class="main">,</span> <span class="numeral">2085</span><span class="main">,</span> <span class="numeral">2919</span><span class="main">,</span> <span class="numeral">4865</span><span class="main">,</span> <span class="numeral">14595</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">26880</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A3 N N1 N2 Esigma_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">12285</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">12285</span> <span class="main">+</span> <span class="numeral">14595</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> B Q Amicable_pair_def
    <span class="keyword1"><span class="command">using</span></span> Amicable_pair_equiv_def_conv one_le_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Euler's Rule›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We present Euler's Rule as in \cite{garciaetal1}. The proof has been reconstructed.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Euler_Rule_Amicable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">l</span> <span class="free">f</span> <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">m</span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">l</span><span class="main">+</span><span class="main">1</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="free">f</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">Amic</span> <span class="free">n</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">linarith_split_limit</span> <span class="main"><span class="main">=</span></span> 50<span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d c
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_imp_le_nat mult_2 power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">p</span> <span class="main">=</span> <span class="free">p</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> prime_sum_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">q</span> <span class="main">=</span> <span class="free">q</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">q</span>›</span></span> prime_sum_div assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="free">r</span> <span class="main">=</span> <span class="free">r</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">r</span>›</span></span> prime_sum_div assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aa bb cc A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Z0<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="free">r</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹prime <span class="free">r</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> Ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd_nat.idem numeral_le_one_iff prime_ge_2_nat semiring_norm<span class="main"><span class="main">(</span></span>69<span class="main"><span class="main">)</span></span> Z0<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Z0 gcd_Esigma_mult assms A Ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>Esigma<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span>  <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span>  <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹prime <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> BB<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms One_nat_def one_le_mult_iff prime_ge_1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> A6<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span> Esigma<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma<span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BB Nat.add_0_right gcd_idem_nat less_add_eq_less
            not_add_less1 power_inject_exp prime_gt_1_nat semiring_normalization_rules<span class="main"><span class="main">(</span></span>32<span class="main"><span class="main">)</span></span>
            two_is_prime_nat <span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">≥</span><span class="main">1</span>›</span></span>  gcd_Esigma_mult assms C BB
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> A7<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms One_nat_def Suc_pred add_gr_0 add_is_0 diff_commute diff_diff_cancel
          diff_is_0_eq nat_0_less_mult_iff nat_mult_eq_cancel_disj
          numeral_One prime_gt_1_nat power_inject_exp
          semiring_normalization_rules<span class="main">(</span>7<span class="main">)</span> two_is_prime_nat zero_less_numeral zero_less_power
zero_neq_numeral  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> less_imp_le_nat<span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>›</span></span>
          <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span>  <span class="quoted"><span class="quoted">‹prime <span class="free">q</span>›</span></span> C  prime_Esigma_mult assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> A8<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span>Esigma<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A6 A7<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A1 A2 A3 A4 A5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> Z1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">r</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹prime <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>›</span></span> assms Esigma_prime_sum  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="free">k</span> <span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> JJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_imp_le_nat mult_2_right power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>Esigma<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms ss aa bb <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> left_diff_distrib' mult.commute mult_numeral_1_right numeral_One<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_imp_le_nat power_add<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> JJ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> YY<span class="main">:</span><span class="quoted"><span class="quoted">" Esigma<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> auxicalc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">l</span><span class="main">+</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="free">l</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ii  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">*</span><span class="free">f</span> <span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> iii assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">*</span><span class="free">f</span> <span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> iv assms comm_monoid_mult_axioms  power2_eq_square semiring_normalization_rules<span class="main">(</span>18<span class="main">)</span>
          semiring_normalization_rules <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib assms<span class="main">)</span> <span class="comment1">(*slow*)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> W1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">r</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span><span class="free">r</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> W2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> W3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">=</span>
<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib'<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> W4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span>
<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> W5<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span>
<span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms  less_imp_le_nat less_imp_le_nat  prime_ge_1_nat
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Nat.add_diff_assoc2 Nat.diff_diff_right One_nat_def Suc_leI Suc_pred W3 W4
          add_diff_cancel_right' add_gr_0 le_Suc_ex less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_cancel1
          nat_0_less_mult_iff zero_less_diff zero_less_numeral zero_less_power<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> W6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">=</span>
 <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> W7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>
   <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Semiring_Normalization.comm_semiring_1_class.semiring_normalization_rules<span class="main">(</span>16<span class="main">)</span>
          Semiring_Normalization.comm_semiring_1_class.semiring_normalization_rules<span class="main">(</span>29<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  power_add<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="free">k</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> JJ power_add<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span>  <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

       <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a b c d e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>
       <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">&gt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add_gr_0 b lessI mult_less_mono1<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> c auxicalc <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> aaa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span>

        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span>

          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> A_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>  <span class="main">&gt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>

            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> A_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> JJ semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>

              <span class="keyword1"><span class="command">have</span></span> df1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

              <span class="keyword1"><span class="command">have</span></span> df2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> xxx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span><span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms xx
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI one_le_numeral power_increasing
                        semiring_normalization_rules<span class="main"><span class="main">(</span></span>33<span class="main"><span class="main">)</span></span> zero_less_diff<span class="main">)</span>

                  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="free">f</span> <span class="main">≥</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> auxiliary_ineq  xxx <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                  <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> c1 xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c xx
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_is_0_eq' le_trans nat_less_le zero_less_diff<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>

                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> df aa assms
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> JJ add.commute mult_less_cancel2 semiring_normalization_rules
                      zero_less_numeral zero_less_power<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A_2 df1 df2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms A_1
              <span class="keyword1"><span class="command">using</span></span> diff_diff_left zero_less_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">qed</span></span>

           <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A aa assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>  a nat_0_less_mult_iff right_diff_distrib'
                semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>29<span class="main"><span class="main">)</span></span>
               semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a aa assms  minus_eq_nat_subst_order  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> aaa diff_commute<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b3 e mult_2<span class="main">)</span>

      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> W8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span>
<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span>
<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_add<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Groups.mult_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Groups.mult_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Nat.diff_add_assoc assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
mult_2_right plus_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> power.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>

        <span class="keyword1"><span class="command">using</span></span> power_add   Nat.add_diff_assoc assms<span class="main">(</span>1<span class="main">)</span> less_imp_le_nat mult_2
          semiring_normalization_rules<span class="main">(</span>18<span class="main">)</span> semiring_normalization_rules<span class="main">(</span>23<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> J<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">using</span></span> a b c d  One_nat_def  one_le_mult_iff
          Nat.add_diff_assoc assms<span class="main">(</span>1<span class="main">)</span> less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">have</span></span> ee<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>
<span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">using</span></span> e  power_add  Nat.add_diff_assoc assms<span class="main">(</span>1<span class="main">)</span> less_imp_le_nat mult_2
          semiring_normalization_rules
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> J<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> eee <span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">-</span><span class="main">(</span><span class="main">(</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> auxicalc mult_minus_eq_nat mult_minus_left of_nat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>

      <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> wq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">B</span><span class="main">-</span><span class="skolem">C</span><span class="main">-</span><span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ee A B C D  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> wq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">E</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">C</span><span class="main">-</span><span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eee C D E
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>36<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> wq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">B</span><span class="main">-</span><span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wq wq1  minus_eq_nat_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> wq2 A B E
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">*</span><span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> W1 W2 W3 W4 W5 W6 W7 W8  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Y YY  auxicalc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Z Z1 Amicable_pair_equiv_def_conv assms One_nat_def  one_le_mult_iff
         one_le_numeral less_imp_le_nat one_le_power
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prime_ge_1_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Another approach by Euler \cite{garciaetal1}:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Euler_Rule_Amicable_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">m</span> <span class="main">=</span> Esigma <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="free">a</span> <span class="main">*</span> Esigma <span class="free">m</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="free">m</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="free">n</span> <span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  gcd_Esigma_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gcd_Esigma_mult <span class="quoted"><span class="quoted">‹gcd <span class="free">a</span> <span class="free">n</span> <span class="main">=</span><span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> a <span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c a assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">qed</span></span>

     <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">m</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">n</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> a assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a b d Amicable_pair_equiv_def_conv assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_leI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Th\={a}bit ibn Qurra's Rule and more examples›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Euler's Rule (theorem Euler\_Rule\_Amicable) is actually a generalisation of the following 
rule by Th\={a}bit ibn Qurra from the 9th century \cite{garciaetal1}. Th\={a}bit ibn Qurra's Rule is 
the special case for $l=1$ thus $f=3$.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Thabit_ibn_Qurra_Rule_Amicable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">l</span> <span class="free">f</span> <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">9</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">r</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span><span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">r</span> <span class="main">=</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> assms Euler_Rule_Amicable  <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">=</span><span class="numeral">2</span><span class="main">^</span><span class="main">1</span> <span class="main">+</span><span class="main">1</span>›</span></span>
     <span class="quoted"><span class="quoted">‹ <span class="free">r</span> <span class="main">=</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span><span class="main">1</span>›</span></span> l f
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the following three example of amicable pairs, instead of evaluating the sum of the divisors 
or using the properties of Euler's sigma function as it was done in the previous examples, we 
prove amicability more directly as we can apply Th\={a}bit ibn Qurra's Rule.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following is the first example of an amicable pair known to the Pythagoreans and can be
derived from Th\={a}bit ibn Qurra's Rule with $k=2$ \cite{garciaetal1}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_Example_Pythagoras<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">220</span> <span class="keyword1">Amic</span> <span class="numeral">284</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">9</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="keyword1">Amic</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Thabit_ibn_Qurra_Rule_Amicable a b c d
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="numeral">5</span><span class="main">*</span><span class="numeral">11</span> <span class="main">=</span> <span class="numeral">220</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="numeral">71</span> <span class="main">=</span> <span class="numeral">284</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  e f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following example of an amicable pair was (re)discovered by Fermat and can be derived from
Th\={a}bit ibn Qurra's Rule with $k=4$ \cite{garciaetal1}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_Example_Fermat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="numeral">17296</span> <span class="keyword1">Amic</span> <span class="numeral">18416</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">4</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">1151</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pratt</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">code</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">1151</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">4</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">9</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">4</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d e <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">4</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">Amic</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">4</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span>  Thabit_ibn_Qurra_Rule_Amicable a b c f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span><span class="numeral">23</span><span class="main">*</span><span class="numeral">47</span> <span class="main">=</span> <span class="numeral">17296</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span><span class="numeral">1151</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">18416</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g h i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following example of an amicable pair was (re)discovered by Descartes and can be derived 
from Th\={a}bit ibn Qurra's Rule with $k=7$ \cite{garciaetal1}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Amicable_Example_Descartes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">9363584</span> <span class="keyword1">Amic</span> <span class="numeral">9437056</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">7</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">191</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pratt</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">code</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">7</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span><span class="numeral">191</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">7</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">383</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pratt</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">code</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">383</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e f <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">73727</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pratt</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">code</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">9</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">73727</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="main">(</span><span class="numeral">9</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i h <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">7</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="keyword1">Amic</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">7</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span>  Thabit_ibn_Qurra_Rule_Amicable a d g j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">*</span> <span class="numeral">191</span><span class="main">*</span> <span class="numeral">383</span> <span class="main">=</span> <span class="numeral">9363584</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">7</span><span class="main">)</span><span class="main">*</span> <span class="numeral">73727</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">9437056</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a k l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In fact, the Amicable Pair (220, 284) is Regular and of type (2,1):›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> regularAmicPairExample<span class="main">:</span> <span class="quoted"><span class="quoted">"regularAmicPair <span class="numeral">220</span> <span class="numeral">284</span> <span class="main">∧</span> typeAmic <span class="numeral">220</span> <span class="numeral">284</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">220</span> <span class="keyword1">Amic</span> <span class="numeral">284</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Amicable_Example_Pythagoras <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">220</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="numeral">284</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">220</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="numeral">55</span><span class="main">*</span><span class="numeral">4</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">284</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="numeral">71</span><span class="main">*</span><span class="numeral">4</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> squarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span><span class="numeral">71</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> squarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="numeral">71</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"regularAmicPair <span class="numeral">220</span> <span class="numeral">284</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b e g f h gcd.commute regularAmicPair_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span><span class="main">∃</span> <span class="bound">N</span><span class="main">.</span> <span class="main">(</span> <span class="numeral">220</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="bound">N</span><span class="main">*</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="bound">N</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">220</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span><span class="main">*</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  c<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> NN<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">=</span><span class="numeral">55</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K1<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K2<span class="main">:</span> <span class="quoted"><span class="quoted">"prime<span class="main">(</span><span class="numeral">11</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> KK2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> prime <span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> KK3<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> prime <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">55</span> <span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span> <span class="numeral">55</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">have</span></span> KK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span> <span class="numeral">55</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> K divisors_nat  divisors_nat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> K3 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K4 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="numeral">11</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K55<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">55</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> KK3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K56<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">55</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> KK2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K57<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">55</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K58<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">11</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">55</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K5<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">11</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> K66<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span>prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="numeral">55</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">)</span><span class="main">}</span><span class="main">=</span>
<span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">55</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span> <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> K66  K K1 K2 KK2 KK3  K3 K4 KK K55 K56 K57 K58 divisors_nat_def
          divisors_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(*slow*)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> K6<span class="main">:</span>  <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> K5 K6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="numeral">284</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="bound">N</span><span class="main">*</span><span class="numeral">4</span> <span class="main">∧</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="bound">N</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">}</span> <span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">284</span> <span class="main">=</span> <span class="skolem">N</span><span class="main">*</span><span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> NN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">=</span> <span class="numeral">71</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>divisors_nat <span class="numeral">71</span> <span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">71</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">have</span></span> KK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="numeral">71</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">71</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> K divisors_nat  divisors_nat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> K55<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">71</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K58<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">71</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">71</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> K5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">71</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="numeral">71</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> K66<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">71</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">}</span><span class="main">=</span> 
<span class="main">{</span><span class="bound">i</span><span class="main">.</span> prime <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">71</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span> <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">i</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  K KK K55 K58 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisors_nat_def K66 divisors_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> K6<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="numeral">71</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> K5 K6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B C
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeAmic_def b<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abundant220ex<span class="main">:</span> <span class="quoted"><span class="quoted">"abundant_number <span class="numeral">220</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">220</span> <span class="keyword1">Amic</span> <span class="numeral">284</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Amicable_Example_Pythagoras <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">220</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">284</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Amicable_pair_abundant Amicable_pair_sym
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>   

<span class="keyword1"><span class="command">lemma</span></span> deficient284ex<span class="main">:</span> <span class="quoted"><span class="quoted">"deficient_number <span class="numeral">284</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">220</span> <span class="keyword1">Amic</span> <span class="numeral">284</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Amicable_Example_Pythagoras <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">220</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">284</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Amicable_pair_deficient Amicable_pair_sym
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Te Riele's Rule and Borho's Rule with breeders›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹With the following rule \cite{garciaetal1} we can get an amicable pair from a known amicable 
pair under certain conditions.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> teRiele_Rule_Amicable<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">u</span> <span class="free">p</span> <span class="free">r</span> <span class="free">c</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="main">(</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">r</span><span class="main">+</span><span class="free">c</span><span class="main">+</span><span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">r</span> <span class="main">+</span><span class="free">c</span><span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">+</span> <span class="free">p</span><span class="main">+</span><span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">+</span><span class="main">1</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Z1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">r</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">+</span><span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Z2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">+</span> <span class="free">p</span><span class="main">+</span><span class="main">1</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="free">r</span><span class="main">+</span> <span class="free">c</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms y Z1 yy  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms gcd_Esigma_mult <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd_unique_nat prime_nat_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> dd <span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d assms  prime_sum_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> ddd<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms Amicable_pair_def
        Amicable_pair_equiv_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def add_mult_distrib2 one_le_mult_iff prime_ge_1_nat<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d dd ddd Esigmanotzero assms<span class="main">(</span>3<span class="main">)</span> dvd_triv_right
        nonzero_mult_div_cancel_right prime_nat_iff prime_sum_div real_of_nat_div
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span>›</span></span> neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms prime_sum_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms prime_sum_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="main">(</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms gcd_Esigma_mult
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma <span class="main">(</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms prime_Esigma_mult
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h hh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> wk<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms gcd_Esigma_mult  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_sum_div<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> wk1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms Amicable_pair_equiv_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def add_mult_distrib2 one_le_mult_iff prime_ge_1_nat<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> w3<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wk wk1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> w4<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> Esigma <span class="free">a</span> <span class="main">*</span> Esigma <span class="free">r</span> <span class="main">*</span> Esigma <span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹Esigma <span class="free">c</span> <span class="main">=</span> <span class="free">c</span> <span class="main">+</span> <span class="main">1</span>›</span></span> 
           <span class="quoted"><span class="quoted">‹Esigma <span class="free">r</span> <span class="main">=</span> <span class="free">r</span><span class="main">+</span><span class="main">1</span>›</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> we<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> we1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹real <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">/</span>real<span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>›</span></span> of_nat_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> we12<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> we1 Z2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_mult semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> we12 assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span>  nonzero_mult_div_cancel_right of_nat_1  of_nat_add of_nat_eq_iff of_nat_le_iff
            of_nat_mult prime_ge_1_nat times_divide_eq_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> we w3 w4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">+</span><span class="free">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms add_mult_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">+</span><span class="free">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">+</span><span class="free">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a2 Z2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">p</span><span class="main">+</span><span class="free">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a3
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a4 Z1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>21<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span> <span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a5
        semiring_normalization_rules<span class="main">(</span>21<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">+</span><span class="main">1</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span> <span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a6 <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">+</span><span class="main">1</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv nonzero_mult_div_cancel_right of_nat_eq_0_iff of_nat_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">+</span><span class="free">p</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a7  <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">+</span><span class="main">1</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_mult times_divide_eq_left<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span> Esigma<span class="main">(</span><span class="free">r</span><span class="main">)</span><span class="main">*</span> Esigma<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span> <span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a8 assms
        <span class="quoted"><span class="quoted">‹ Esigma<span class="main">(</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹ Esigma<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹real <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">/</span>real<span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>›</span></span> of_nat_eq_iff of_nat_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">" Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">+</span> <span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a9 assms
        <span class="quoted"><span class="quoted">‹Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Esigma <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a10 assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2 mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B  Amicable_pair_equiv_def_conv assms One_nat_def  one_le_mult_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> prime_ge_1_nat<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>

 <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹By replacing the assumption that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(a*u) Amic (a*p)›</span></span></span></span> in the above rule by te Riele with the 
 assumption that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(a*u) breeder u›</span></span></span></span>, we obtain Borho's Rule with breeders \cite{garciaetal1}.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Borho_Rule_breeders_Amicable<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">u</span> <span class="free">r</span> <span class="free">c</span> <span class="free">q</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">u</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">c</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">u</span> <span class="main">+</span> <span class="free">x</span><span class="main">*</span><span class="free">u</span> <span class="main">+</span><span class="free">r</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span><span class="free">x</span><span class="main">*</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">r</span><span class="main">+</span><span class="free">c</span><span class="main">+</span><span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="keyword1">Amic</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span><span class="main">*</span>Esigma<span class="main">(</span><span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gcd_Esigma_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span>Esigma<span class="main">(</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gcd_Esigma_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Esigma <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult.left_commute prime_Esigma_mult prime_sum_div<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> ce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="free">c</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> ce1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">u</span><span class="main">+</span><span class="free">x</span><span class="main">*</span><span class="free">u</span><span class="main">+</span><span class="free">r</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">x</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="free">c</span><span class="main">+</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ce assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> de<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="free">x</span><span class="main">+</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> de1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="free">c</span><span class="main">+</span><span class="free">u</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="free">x</span><span class="main">+</span> <span class="free">r</span><span class="main">+</span><span class="free">c</span><span class="main">+</span><span class="free">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms de <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> de1 ce1 add_mult_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d1 assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d a2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prime_sum_div<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">r</span><span class="main">*</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> Esigma<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_sum_div<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

     <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"Esigma <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">u</span><span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">x</span><span class="main">*</span><span class="free">q</span><span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms ii add_mult_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> iii assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> distrib_left semiring_normalization_rules<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B assms Amicable_pair_equiv_def_conv assms  One_nat_def one_le_mult_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> prime_ge_1_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> divisor <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">divisor</span>"</span> 80<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Acknowledgements›</span></span>

<span class="keyword1"><span class="command">text</span></span>
<span class="quoted"><span class="plain_text">‹The author was supported by the ERC Advanced Grant ALEXANDRIA (Project 742178) funded by the
European Research Council and led by Professor Lawrence Paulson at the University of Cambridge, UK.
Many thanks to Lawrence Paulson for his help and suggestions. Number divisors were initially looked
up on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://onlinemathtools.com/find-all-divisors›</span></span>.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>