<div id="Trivia">
<div class="head">
<h1>Theory Trivia</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Trivia›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Trivia
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Trivia-measure_induct2"><span class="command">lemma</span></span> measure_induct2<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">meas</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y1</span> <span class="bound">y2</span><span class="main">.</span> <span class="free">meas</span> <span class="bound">y1</span> <span class="bound">y2</span> <span class="main">&lt;</span> <span class="free">meas</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">⟹</span> <span class="free">S</span> <span class="bound">y1</span> <span class="bound">y2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">S</span> <span class="bound">x1</span> <span class="bound">x2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x1x2</span><span class="main">.</span> <span class="free">meas</span> <span class="main">(</span>fst <span class="bound">x1x2</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x1x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x1x2</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span>fst <span class="bound">x1x2</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x1x2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">(</span><span class="free">x1</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> measure_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?m</span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?S</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Right cons:›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Rcons</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">##</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">##</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Trivia-two_singl_Rcons"><span class="command">lemma</span></span> two_singl_Rcons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">##</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="IO_Automaton">
<div class="head">
<h1>Theory IO_Automaton</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹IO Automaton›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> IO_Automaton
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Trivia.html">Trivia</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Transitions›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">=</span>
Trans <span class="main">(</span><span class="free"><span class="entity">srcOf</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">actOf</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'act</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">outOf</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'out</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">tgtOf</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span><span class="main">)</span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans list"</span></span>


<span class="keyword1"><span class="command">locale</span></span> IO_Automaton <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">istate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span>"</span></span> <span class="comment1">(* initial step *)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'act</span> <span class="main">⇒</span> <span class="tfree">'out</span> <span class="main">*</span> <span class="tfree">'state</span>"</span></span>  <span class="comment1">(* transition function *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Reachability and invariance›</span></span>

<span class="comment1">(* Reachable states: *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reach</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Istate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">reach</span> <span class="free">istate</span>"</span></span>
<span class="main">|</span>
Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">reach</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free">reach</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">step</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="IO_Automaton-reach_PairI"><span class="command">lemma</span></span> reach_PairI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">s</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">ou</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Step assms assms snd_eqD<span class="main">)</span>

<span class="comment1">(* holds at the initial state: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">holdsIstate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">holdsIstate</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free">istate</span>"</span></span>

<span class="comment1">(* is invariant: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">.</span> reach <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span>snd <span class="main">(</span><span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="IO_Automaton-holdsIstate_invar"><span class="command">lemma</span></span> holdsIstate_invar<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"holdsIstate <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"reach <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach.induct<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> h i <span class="keyword1"><span class="command">unfolding</span></span> holdsIstate_def invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹System traces›</span></span>

<span class="comment1">(* The output and effect of an action on a state: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">out</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'act</span> <span class="main">⇒</span> <span class="tfree">'out</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">out</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> fst <span class="main">(</span><span class="free">step</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'act</span> <span class="main">⇒</span> <span class="tfree">'state</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">eff</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> snd <span class="main">(</span><span class="free">step</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">validTrans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">validTrans</span> <span class="main">(</span>Trans <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ou</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">step</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ou</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="IO_Automaton-validTrans"><span class="command">lemma</span></span> validTrans<span class="main">:</span>
<span class="quoted"><span class="quoted">"validTrans <span class="free">trn</span> <span class="main">=</span>
 <span class="main">(</span><span class="free">step</span> <span class="main">(</span>srcOf <span class="free">trn</span><span class="main">)</span> <span class="main">(</span>actOf <span class="free">trn</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>outOf <span class="free">trn</span><span class="main">,</span> tgtOf <span class="free">trn</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">trn</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(* Traces allowed by the system (starting in any given state) *)</span>
<span class="comment1">(* Two alternative definitions: growing from the left and growing from the right: *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Singl<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"validTrans <span class="free"><span class="bound"><span class="entity">trn</span></span></span>
 <span class="main">⟹</span>
 <span class="free">valid</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span>
Cons<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>validTrans <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">;</span> tgtOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">=</span> srcOf <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free">valid</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">⟧</span>
 <span class="main">⟹</span>
 <span class="free">valid</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> valid_SinglE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">[</span><span class="free">trn</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> valid_ConsE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">valid2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Singl<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"validTrans <span class="free"><span class="bound"><span class="entity">trn</span></span></span>
 <span class="main">⟹</span>
 <span class="free">valid2</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span>
Rcons<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">valid2</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">;</span> tgtOf <span class="main">(</span>last <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span> <span class="main">=</span> srcOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">;</span> validTrans <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">⟧</span>
 <span class="main">⟹</span>
 <span class="free">valid2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">##</span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> valid2_SinglE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid2 <span class="main">[</span><span class="free">trn</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> valid2_RconsE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid2 <span class="main">(</span><span class="free">tr</span> <span class="main">##</span> <span class="free">trn</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="IO_Automaton-Nil_not_valid"><span class="command">lemma</span></span> Nil_not_valid<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> valid <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid.simps neq_Nil_conv<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-Nil_not_valid2"><span class="command">lemma</span></span> Nil_not_valid2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> valid2 <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid2.cases append_Nil butlast.simps butlast_snoc not_Cons_self2<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-valid_Rcons"><span class="command">lemma</span></span> valid_Rcons<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tgtOf <span class="main">(</span>last <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> srcOf <span class="free">trn</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validTrans <span class="free">trn</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid <span class="main">(</span><span class="free">tr</span> <span class="main">##</span> <span class="free">trn</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">trn</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">trn</span> <span class="skolem">tr</span> <span class="skolem">trna</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tr</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid.Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid.intros<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-valid_hd_Rcons"><span class="command">lemma</span></span> valid_hd_Rcons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">tr</span> <span class="main">##</span> <span class="free">tran</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_not_valid assms hd_append<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-valid2_hd_Rcons"><span class="command">lemma</span></span> valid2_hd_Rcons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid2 <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">tr</span> <span class="main">##</span> <span class="free">tran</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_not_valid2 assms hd_append<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-valid2_last_Cons"><span class="command">lemma</span></span> valid2_last_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid2 <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">tran</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> last <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_not_valid2 assms last.simps<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-valid2_Cons"><span class="command">lemma</span></span> valid2_Cons<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid2 <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tgtOf <span class="free">trn</span> <span class="main">=</span> srcOf <span class="main">(</span>hd <span class="free">tr</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validTrans <span class="free">trn</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid2 <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">trn</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Singl  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> two_singl_Rcons <span class="keyword1"><span class="command">using</span></span> Singl
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> valid2.Rcons<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid2.Singl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Rcons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append.append_Cons<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Rcons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> valid2.Rcons<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IO_Automaton-valid_valid2"><span class="command">lemma</span></span> valid_valid2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="main">=</span> valid2"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tr</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"valid <span class="skolem">tr</span>"</span></span>  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"valid2 <span class="skolem">tr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid2.Singl valid2_Cons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tr</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"valid2 <span class="skolem">tr</span>"</span></span>  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"valid <span class="skolem">tr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid.Singl valid_Rcons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> valid2_valid <span class="main">=</span> valid_valid2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">validFrom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">validFrom</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>valid <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">∧</span> srcOf <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="IO_Automaton-validFrom_Nil"><span class="command">lemma</span></span> validFrom_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="free">s</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IO_Automaton-validFrom_valid"><span class="command">lemma</span></span> validFrom_valid<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="free">tr</span> <span class="main">∧</span> srcOf <span class="main">(</span>hd <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⟹</span> validFrom <span class="free">s</span> <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IO_Automaton-validFrom_validTrans"><span class="command">lemma</span></span> validFrom_validTrans<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validTrans <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validFrom <span class="free">s'</span> <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"validFrom <span class="free">s</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Traces versus reachability›</span></span>

<span class="keyword1" id="IO_Automaton-valid_reach_src_tgt"><span class="command">lemma</span></span> valid_reach_src_tgt<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reach <span class="main">(</span>srcOf <span class="main">(</span>hd <span class="free">tr</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reach <span class="main">(</span>tgtOf <span class="main">(</span>last <span class="free">tr</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_PairI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> validTrans<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-valid_init_reach"><span class="command">lemma</span></span> valid_init_reach<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"srcOf <span class="main">(</span>hd <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">istate</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reach <span class="main">(</span>tgtOf <span class="main">(</span>last <span class="free">tr</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> valid_reach_src_tgt assms reach.Istate <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="IO_Automaton-Trans_fst_sndI"><span class="command">lemma</span></span> Trans_fst_sndI<span class="main">:</span>
<span class="quoted"><span class="quoted">"valid <span class="main">[</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">step</span> <span class="free">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">step</span> <span class="free">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid.Singl surjective_pairing validTrans.simps<span class="main">)</span>

<span class="keyword1" id="IO_Automaton-reach_init_valid"><span class="command">lemma</span></span> reach_init_valid<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">istate</span>
 <span class="main">∨</span>
 <span class="main">(</span><span class="main">∃</span> <span class="bound">tr</span><span class="main">.</span> valid <span class="bound">tr</span> <span class="main">∧</span> srcOf <span class="main">(</span>hd <span class="bound">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">istate</span> <span class="main">∧</span> tgtOf <span class="main">(</span>last <span class="bound">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Step <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">istate</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ou</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">step</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">step</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2 exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[</span></span></span>Trans <span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span> <span class="var"><span class="var"><span class="var">?ou</span></span></span> <span class="var"><span class="var"><span class="var">?s'</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tr</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="skolem">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"srcOf <span class="main">(</span>hd <span class="skolem">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">istate</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"tgtOf <span class="main">(</span>last <span class="skolem">tr</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ou</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">step</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">step</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v t s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2 exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">tr</span></span></span> <span class="main"><span class="main"><span class="main">##</span></span></span> Trans <span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span> <span class="var"><span class="var"><span class="var">?ou</span></span></span> <span class="var"><span class="var"><span class="var">?s'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> valid_Rcons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IO_Automaton-reach_validFrom"><span class="command">lemma</span></span> reach_validFrom<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span> <span class="bound">tr</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">istate</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∨</span> <span class="main">(</span>validFrom <span class="bound">s</span> <span class="bound">tr</span> <span class="main">∧</span> tgtOf <span class="main">(</span>last <span class="bound">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> reach_init_valid<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="comment1">(*&lt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* locale IO_Automaton *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="BD_Security">
<div class="head">
<h1>Theory BD_Security</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹BD Security›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> BD_Security
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IO_Automaton.html">IO_Automaton</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">declare</span></span> Let_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">no_notation</span></span> relcomp <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">O</span>"</span> 75<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">never</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">never</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> list_all <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">filtermap</span> <span class="main">::</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">filtermap</span> <span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">func</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">⟹</span> <span class="free">filtermap</span> <span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">func</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">filtermap</span> <span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">func</span></span></span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span>"</span></span>
<span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">⟹</span> <span class="free">filtermap</span> <span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">func</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">func</span></span></span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">#</span> <span class="free">filtermap</span> <span class="free"><span class="bound"><span class="entity">pred</span></span></span> <span class="free"><span class="bound"><span class="entity">func</span></span></span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> list.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">lexicographic_order</span>

<span class="keyword1"><span class="command">locale</span></span> BD_Security <span class="main">=</span> IO_Automaton <span class="quoted"><span class="free">istate</span></span> <span class="quoted"><span class="free">step</span></span>
 <span class="keyword2"><span class="keyword">for</span></span> <span class="free">istate</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'act</span> <span class="main">⇒</span> <span class="tfree">'out</span> <span class="main">×</span> <span class="tfree">'state</span>"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="comment1">(* value filtering and production:  *)</span>
   <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> <span class="tfree">'value</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* observation filtering and production: *)</span>
   <span class="free">γ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> <span class="tfree">'obs</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* declassification trigger:  *)</span>
   <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* declassification bound: *)</span>
   <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'value</span> list <span class="main">⇒</span> <span class="tfree">'value</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* The value function: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="tfree">'value</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≡</span> filtermap <span class="free">φ</span> <span class="free">f</span>"</span></span>
<span class="comment1">(* The observation function: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">O</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="tfree">'obs</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">O</span> <span class="main">≡</span> filtermap <span class="free">γ</span> <span class="free">g</span>"</span></span>

<span class="keyword1" id="BD_Security-V_simps"><span class="command">lemma</span></span> V_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"V <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">φ</span> <span class="free">trn</span> <span class="main">⟹</span> V <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> V <span class="free">tr</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">trn</span> <span class="main">⟹</span> V <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">trn</span> <span class="main">#</span> V <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BD_Security-O_simps"><span class="command">lemma</span></span> O_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"O <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">γ</span> <span class="free">trn</span> <span class="main">⟹</span> O <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> O <span class="free">tr</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="free">trn</span> <span class="main">⟹</span> O <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">trn</span> <span class="main">#</span> O <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> O_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Reachable states by transitions satisfying T: *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reachNT</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Istate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">reachNT</span> <span class="free">istate</span>"</span></span>
<span class="main">|</span>
Step<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">reachNT</span> <span class="main">(</span>srcOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free">step</span> <span class="main">(</span>srcOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">)</span> <span class="main">(</span>actOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>outOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">,</span> tgtOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">¬</span> <span class="free">T</span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">⟧</span>
 <span class="main">⟹</span> <span class="free">reachNT</span> <span class="main">(</span>tgtOf <span class="free"><span class="bound"><span class="entity">trn</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BD_Security-reachNT_PairI"><span class="command">lemma</span></span> reachNT_PairI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">s</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">ou</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">T</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BD_Security.reachNT.simps assms trans.sel<span class="main">)</span>

<span class="keyword1" id="BD_Security-reachNT_reach"><span class="command">lemma</span></span> reachNT_reach<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> reach.Step snd_conv validTrans<span class="main">)</span>

<span class="keyword1" id="BD_Security-reachNT_stateO_aux"><span class="command">lemma</span></span> reachNT_stateO_aux<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">istate</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">sh</span> <span class="bound">a</span> <span class="bound">ou</span><span class="main">.</span> reach <span class="bound">sh</span> <span class="main">∧</span> <span class="free">step</span> <span class="bound">sh</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">T</span> <span class="main">(</span>Trans <span class="bound">sh</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> BD_Security.reachNT_reach trans.exhaust_sel<span class="main">)</span>

<span class="keyword1" id="BD_Security-reachNT_state_cases"><span class="command">lemma</span></span> reachNT_state_cases<span class="main">[</span><span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword">set</span></span><span class="main">,</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> init step<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">istate</span>"</span></span>
<span class="main">|</span> <span class="free">sh</span> <span class="free">a</span> <span class="free">ou</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">sh</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">sh</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">ou</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">T</span> <span class="main">(</span>Trans <span class="free">sh</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachNT_stateO_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* This is assumed to be an invariant only modulo non T  *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invarNT</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">invarNT</span> <span class="free"><span class="bound"><span class="entity">Inv</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Inv</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">T</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Inv</span></span></span> <span class="bound">s'</span>"</span></span>

<span class="keyword1" id="BD_Security-invarNT_disj"><span class="command">lemma</span></span> invarNT_disj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="free">Inv1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="free">Inv2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Inv1</span> <span class="bound">s</span> <span class="main">∨</span> <span class="free">Inv2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> invarNT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="BD_Security-invarNT_conj"><span class="command">lemma</span></span> invarNT_conj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="free">Inv1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="free">Inv2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Inv1</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Inv2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> invarNT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="BD_Security-holdsIstate_invarNT"><span class="command">lemma</span></span> holdsIstate_invarNT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"holdsIstate <span class="free">Inv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"invarNT <span class="free">Inv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inv</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">using</span></span> h i <span class="keyword1"><span class="command">unfolding</span></span> holdsIstate_def invarNT_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachNT.induct<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> i invarNT_def trans.exhaust_sel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(* BD security: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">secure</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">secure</span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">tr</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span>
   validFrom <span class="free">istate</span> <span class="bound">tr</span> <span class="main">∧</span> never <span class="free">T</span> <span class="bound">tr</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">∧</span> V <span class="bound">tr</span> <span class="main">=</span> <span class="bound">vl</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span><span class="main">.</span> validFrom <span class="free">istate</span> <span class="bound">tr1</span> <span class="main">∧</span> O <span class="bound">tr1</span> <span class="main">=</span> O <span class="bound">tr</span> <span class="main">∧</span> V <span class="bound">tr1</span> <span class="main">=</span> <span class="bound">vl1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BD_Security-V_iff_non_φ"><span class="command">lemma</span></span> V_iff_non_φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> V <span class="free">tr</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">φ</span> <span class="free">trn</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">trn</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BD_Security-V_imp_φ"><span class="command">lemma</span></span> V_imp_φ<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">#</span> V <span class="free">tr</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="free">trn</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">trn</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BD_Security-V_imp_Nil"><span class="command">lemma</span></span> V_imp_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> V <span class="free">tr</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V_simps list.distinct trans.exhaust<span class="main">)</span>

<span class="keyword1" id="BD_Security-V_iff_Nil"><span class="command">lemma</span></span> V_iff_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="main">(</span><span class="free">trn</span> <span class="main">#</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">φ</span> <span class="free">trn</span> <span class="main">∧</span> V <span class="free">tr</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V_iff_non_φ V_imp_Nil<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context BD_Security *)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Unwinding proof method›</span></span>

<span class="keyword1"><span class="command">context</span></span> BD_Security
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consume</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span><span class="main">,</span><span class="tfree">'act</span><span class="main">,</span><span class="tfree">'out</span><span class="main">)</span> trans <span class="main">⇒</span> <span class="tfree">'value</span> list <span class="main">⇒</span> <span class="tfree">'value</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">consume</span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="main">≡</span>
 <span class="keyword1">if</span> <span class="free">φ</span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">trn</span></span></span> <span class="main">=</span> hd <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="main">=</span> tl <span class="free"><span class="bound"><span class="entity">vl</span></span></span>
 <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span>"</span></span>

<span class="keyword1" id="BD_Security-length_consume"><span class="command">lemma</span></span> length_consume<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"consume <span class="free">trn</span> <span class="free">vl</span> <span class="free">vl'</span> <span class="main">⟹</span> length <span class="free">vl'</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">vl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> consume_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="BD_Security-ex_consume_φ"><span class="command">lemma</span></span> ex_consume_φ<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">φ</span> <span class="free">trn</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">vl'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"consume <span class="free">trn</span> <span class="free">vl</span> <span class="free">vl'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> consume_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BD_Security-ex_consume_NO"><span class="command">lemma</span></span> ex_consume_NO<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vl</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">trn</span> <span class="main">=</span> hd <span class="free">vl</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">vl'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"consume <span class="free">trn</span> <span class="free">vl</span> <span class="free">vl'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> consume_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">trn</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(* independent action: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iaction</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">iaction</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="main">≡</span>
 <span class="main">∃</span> <span class="bound">a1</span> <span class="bound">ou1</span> <span class="bound">s1'</span> <span class="bound">vl1'</span><span class="main">.</span>
   <span class="keyword1">let</span> <span class="bound">trn1</span> <span class="main">=</span> Trans <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="bound">a1</span> <span class="bound">ou1</span> <span class="bound">s1'</span> <span class="keyword1">in</span>
   validTrans <span class="bound">trn1</span> <span class="main">∧</span>
   <span class="free">φ</span> <span class="bound">trn1</span> <span class="main">∧</span> consume <span class="bound">trn1</span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="bound">vl1'</span> <span class="main">∧</span>
   <span class="main">¬</span> <span class="free">γ</span> <span class="bound">trn1</span>
   <span class="main">∧</span>
   <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="bound">s1'</span> <span class="bound">vl1'</span>"</span></span>

<span class="keyword1" id="BD_Security-iactionI"><span class="command">lemma</span></span> iactionI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">s1</span> <span class="free">a1</span> <span class="main">=</span> <span class="main">(</span><span class="free">ou1</span><span class="main">,</span> <span class="free">s1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span> <span class="free">vl1</span> <span class="free">vl1'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1'</span> <span class="free">vl1'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iaction <span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iaction_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">match</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ou</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="main">≡</span>
 <span class="main">∃</span> <span class="bound">a1</span> <span class="bound">ou1</span> <span class="bound">s1'</span> <span class="bound">vl1'</span><span class="main">.</span>
    <span class="keyword1">let</span> <span class="bound">trn</span> <span class="main">=</span> Trans <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ou</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">;</span> <span class="bound">trn1</span> <span class="main">=</span> Trans <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="bound">a1</span> <span class="bound">ou1</span> <span class="bound">s1'</span> <span class="keyword1">in</span>
    validTrans <span class="bound">trn1</span> <span class="main">∧</span>
    consume <span class="bound">trn1</span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="bound">vl1'</span> <span class="main">∧</span>
    <span class="free">γ</span> <span class="bound">trn</span> <span class="main">=</span> <span class="free">γ</span> <span class="bound">trn1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">trn</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">trn</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">trn1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="bound">s1'</span> <span class="bound">vl1'</span>"</span></span>

<span class="keyword1" id="BD_Security-matchI"><span class="command">lemma</span></span> matchI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"validTrans <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span> <span class="free">vl1</span> <span class="free">vl1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="free">a1</span> <span class="free">ou1</span> <span class="free">s1'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="free">s'</span> <span class="free">vl'</span> <span class="free">s1'</span> <span class="free">vl1'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"match <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="free">vl'</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> match_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ignore</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ignore</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ou</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="main">≡</span>
 <span class="main">¬</span> <span class="free">γ</span> <span class="main">(</span>Trans <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ou</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">∧</span>
 <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">vl'</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span>"</span></span>

<span class="keyword1" id="BD_Security-ignoreI"><span class="command">lemma</span></span> ignoreI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="free">s'</span> <span class="free">vl'</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ignore <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="free">vl'</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ignore_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* reaction: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reaction</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">reaction</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="bound">vl'</span><span class="main">.</span>
   <span class="keyword1">let</span> <span class="bound">trn</span> <span class="main">=</span> Trans <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="keyword1">in</span>
   validTrans <span class="bound">trn</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">T</span> <span class="bound">trn</span> <span class="main">∧</span>
   consume <span class="bound">trn</span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="bound">vl'</span>
   <span class="main">⟶</span>
   match <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="bound">vl'</span>
   <span class="main">∨</span>
   ignore <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="bound">vl'</span>"</span></span>

<span class="keyword1" id="BD_Security-reactionI"><span class="command">lemma</span></span> reactionI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="bound">vl'</span><span class="main">.</span>
   <span class="main">⟦</span><span class="free">step</span> <span class="free">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="main">¬</span> <span class="free">T</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span><span class="main">;</span>
    consume <span class="main">(</span>Trans <span class="free">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="free">vl</span> <span class="bound">vl'</span><span class="main">⟧</span>
   <span class="main">⟹</span>
   match <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="bound">vl'</span> <span class="main">∨</span> ignore <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span> <span class="bound">vl'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reaction <span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reaction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">exit</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'value</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">exit</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">tr</span> <span class="bound">trn</span><span class="main">.</span> validFrom <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="bound">tr</span> <span class="main">##</span> <span class="bound">trn</span><span class="main">)</span> <span class="main">∧</span> never <span class="free">T</span> <span class="main">(</span><span class="bound">tr</span> <span class="main">##</span> <span class="bound">trn</span><span class="main">)</span> <span class="main">∧</span> <span class="free">φ</span> <span class="bound">trn</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">trn</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1" id="BD_Security-exit_coind"><span class="command">lemma</span></span> exit_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">trn</span><span class="main">.</span> <span class="main">⟦</span><span class="free">K</span> <span class="main">(</span>srcOf <span class="bound">trn</span><span class="main">)</span><span class="main">;</span> validTrans <span class="bound">trn</span><span class="main">;</span> <span class="main">¬</span> <span class="free">T</span> <span class="bound">trn</span><span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="free">φ</span> <span class="bound">trn</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">trn</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="free">K</span> <span class="main">(</span>tgtOf <span class="bound">trn</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exit <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">unfolding</span></span> exit_def <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI conjI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tr</span> <span class="skolem">trn</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validFrom <span class="free">s</span> <span class="main">(</span><span class="skolem">tr</span> <span class="main">##</span> <span class="skolem">trn</span><span class="main">)</span> <span class="main">∧</span> never <span class="free">T</span> <span class="main">(</span><span class="skolem">tr</span> <span class="main">##</span> <span class="skolem">trn</span><span class="main">)</span> <span class="main">∧</span> <span class="free">φ</span> <span class="skolem">trn</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">trn</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">unfolding</span></span> validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">tr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">trn</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> neq_Nil_conv rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rotate1_is_Nil_conv valid_ConsE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">noVal</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">noVal</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">φ</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1" id="BD_Security-noVal_disj"><span class="command">lemma</span></span> noVal_disj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noVal <span class="free">Inv1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noVal <span class="free">Inv2</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"noVal <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Inv1</span> <span class="bound">s</span> <span class="main">∨</span> <span class="free">Inv2</span> <span class="bound">s</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> noVal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="BD_Security-noVal_conj"><span class="command">lemma</span></span> noVal_conj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noVal <span class="free">Inv1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noVal <span class="free">Inv2</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"noVal <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Inv1</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Inv2</span> <span class="bound">s</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> noVal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* Often encountered sufficient criterion for noVal: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">noφ</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">noφ</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">φ</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BD_Security-noφ_noVal"><span class="command">lemma</span></span> noφ_noVal<span class="main">:</span> <span class="quoted"><span class="quoted">"noφ <span class="free">K</span> <span class="main">⟹</span> noVal <span class="free">K</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> noφ_def noVal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* intro rule for quick inline checks: *)</span>
<span class="keyword1" id="BD_Security-exitI"><span class="command">lemma</span></span> exitI<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> <span class="quoted">"exit"</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">.</span>
   <span class="main">⟦</span>reach <span class="bound">s</span><span class="main">;</span> reachNT <span class="bound">s</span><span class="main">;</span> <span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">K</span> <span class="bound">s</span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="free">K</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exit <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free">K</span> <span class="bound">s</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exit_coind<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?K</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">metis</span> BD_Security.reachNT_reach IO_Automaton.validTrans reachNT.Step trans.exhaust_sel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* intro rule for more elaborate checks: *)</span>
<span class="keyword1" id="BD_Security-exitI2"><span class="command">lemma</span></span> exitI2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noVal <span class="free">K</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exit <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free">K</span> <span class="bound">s</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> invarNT_def noVal_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exit_coind<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?K</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> <span class="main">(</span><span class="operator">metis</span> IO_Automaton.validTrans reachNT.Step trans.exhaust_sel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Binary version of the invariant: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">noVal2</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">noVal2</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">φ</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1" id="BD_Security-noVal2_disj"><span class="command">lemma</span></span> noVal2_disj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="free">Inv1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="free">Inv2</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="bound">v</span><span class="main">.</span> <span class="free">Inv1</span> <span class="bound">s</span> <span class="bound">v</span> <span class="main">∨</span> <span class="free">Inv2</span> <span class="bound">s</span> <span class="bound">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> noVal2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="BD_Security-noVal2_conj"><span class="command">lemma</span></span> noVal2_conj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="free">Inv1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="free">Inv2</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="bound">v</span><span class="main">.</span> <span class="free">Inv1</span> <span class="bound">s</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">Inv2</span> <span class="bound">s</span> <span class="bound">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> noVal2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="BD_Security-noVal_noVal2"><span class="command">lemma</span></span> noVal_noVal2<span class="main">:</span> <span class="quoted"><span class="quoted">"noVal <span class="free">K</span> <span class="free">v</span> <span class="main">⟹</span> noVal2 <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="bound">v</span><span class="main">.</span> <span class="free">K</span> <span class="bound">s</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> noVal_def noVal2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BD_Security-exitI_noVal2"><span class="command">lemma</span></span> exitI_noVal2<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> <span class="quoted">"exit"</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">.</span>
   <span class="main">⟦</span>reach <span class="bound">s</span><span class="main">;</span> reachNT <span class="bound">s</span><span class="main">;</span> <span class="free">step</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ou</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">K</span> <span class="bound">s</span> <span class="free">v</span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span>Trans <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ou</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="free">K</span> <span class="bound">s'</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exit <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free">K</span> <span class="bound">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exit_coind<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?K</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">metis</span> BD_Security.reachNT_reach IO_Automaton.validTrans reachNT.Step trans.exhaust_sel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BD_Security-exitI2_noVal2"><span class="command">lemma</span></span> exitI2_noVal2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invarNT <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">K</span> <span class="bound">s</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noVal2 <span class="free">K</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exit <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> <span class="free">K</span> <span class="bound">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> invarNT_def noVal2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exit_coind<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?K</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> IO_Automaton.validTrans reachNT.Step trans.exhaust_sel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* end binary version *)</span>

<span class="keyword1" id="BD_Security-exit_validFrom"><span class="command">lemma</span></span> exit_validFrom<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> vl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vl</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"exit <span class="free">s</span> <span class="main">(</span>hd <span class="free">vl</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="free">s</span> <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="free">tr</span> <span class="main">=</span> <span class="free">vl</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"never <span class="free">T</span> <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">using</span></span> i v V T <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">tr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">trn</span> <span class="skolem">tr</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">trn</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">trn</span> <span class="main">=</span> hd <span class="free">vl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> hd_Cons_tl list.inject vl<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validFrom <span class="skolem">s</span> <span class="main">[</span><span class="skolem">trn</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹validFrom <span class="skolem">s</span> <span class="main">(</span><span class="skolem">trn</span> <span class="main">#</span> <span class="skolem">tr</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons True <span class="keyword1"><span class="command">unfolding</span></span> exit_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> allE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"V <span class="skolem">tr</span> <span class="main">=</span> <span class="free">vl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"never <span class="free">T</span> <span class="skolem">tr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems list_all_simps<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹validFrom <span class="skolem">s</span> <span class="main">(</span><span class="skolem">trn</span> <span class="main">#</span> <span class="skolem">tr</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"validFrom <span class="main">(</span>tgtOf <span class="skolem">trn</span><span class="main">)</span> <span class="skolem">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> srcOf <span class="skolem">trn</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> validFrom_def valid_ConsE Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
              IO_Automaton.validFrom_def list.discI list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>    
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exit <span class="main">(</span>tgtOf <span class="skolem">trn</span><span class="main">)</span> <span class="main">(</span>hd <span class="free">vl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹exit <span class="skolem">s</span> <span class="main">(</span>hd <span class="free">vl</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> exit_def s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> append_Cons list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
           list.distinct list_all_simps valid.Cons validFrom_def valid_ConsE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unwind</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unwind</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   reachNT <span class="bound">s</span> <span class="main">∧</span> reach <span class="bound">s1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">⟶</span>
   <span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="bound">s</span> <span class="main">(</span>hd <span class="bound">vl</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∨</span>
   iaction <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">∨</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BD_Security-unwindI"><span class="command">lemma</span></span> unwindI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   <span class="main">⟦</span>reachNT <span class="bound">s</span><span class="main">;</span> reach <span class="bound">s1</span><span class="main">;</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">⟧</span>
   <span class="main">⟹</span>
   <span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="bound">s</span> <span class="main">(</span>hd <span class="bound">vl</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∨</span>
   iaction <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">∨</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unwind <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unwind_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BD_Security-unwind_trace"><span class="command">lemma</span></span> unwind_trace<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> unwind<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind <span class="free">Δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reachNT <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reach <span class="free">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"validFrom <span class="free">s</span> <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"never <span class="free">T</span> <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V <span class="free">tr</span> <span class="main">=</span> <span class="free">vl</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr1</span><span class="main">.</span> validFrom <span class="free">s1</span> <span class="bound">tr1</span> <span class="main">∧</span> O <span class="bound">tr1</span> <span class="main">=</span> O <span class="free">tr</span> <span class="main">∧</span> V <span class="bound">tr1</span> <span class="main">=</span> <span class="free">vl1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">tr</span> <span class="bound">vl1</span><span class="main">.</span>
  <span class="main">∀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span><span class="main">.</span> reachNT <span class="bound">s</span> <span class="main">∧</span> reach <span class="bound">s1</span> <span class="main">∧</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">∧</span> validFrom <span class="bound">s</span> <span class="bound">tr</span> <span class="main">∧</span> never <span class="free">T</span> <span class="bound">tr</span> <span class="main">∧</span> V <span class="bound">tr</span> <span class="main">=</span> <span class="bound">vl</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">tr1</span><span class="main">.</span> validFrom <span class="bound">s1</span> <span class="bound">tr1</span> <span class="main">∧</span> O <span class="bound">tr1</span> <span class="main">=</span> O <span class="bound">tr</span> <span class="main">∧</span> V <span class="bound">tr1</span> <span class="main">=</span> <span class="bound">vl1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">tr</span> <span class="bound">vl1</span><span class="main">.</span> length <span class="bound">tr</span> <span class="main">+</span> length <span class="bound">vl1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="free">tr</span> <span class="free">vl1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> measure_induct2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?S</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">tr</span> <span class="skolem">vl1</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="keyword3"><span class="command">assume</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rs1<span class="main">:</span> <span class="quoted"><span class="quoted">"reach <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="skolem">s</span> <span class="skolem">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> NT<span class="main">:</span> <span class="quoted"><span class="quoted">"never <span class="free">T</span> <span class="skolem">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="skolem">tr</span> <span class="main">=</span> <span class="skolem">vl</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="skolem">s</span> <span class="main">(</span>hd <span class="skolem">vl</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
             iaction <span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span> <span class="main">∨</span>
             <span class="main">(</span>reaction <span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span> <span class="main">∧</span> <span class="main">¬</span> iaction <span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?exit</span> <span class="main">∨</span> <span class="var">?iact</span> <span class="main">∨</span> <span class="var">?react</span> <span class="main">∧</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> unwind <span class="keyword1"><span class="command">unfolding</span></span> unwind_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr1</span><span class="main">.</span> validFrom <span class="skolem">s1</span> <span class="bound">tr1</span> <span class="main">∧</span> O <span class="bound">tr1</span> <span class="main">=</span> O <span class="skolem">tr</span> <span class="main">∧</span> V <span class="bound">tr1</span> <span class="main">=</span> <span class="skolem">vl1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exit <span class="skolem">s</span> <span class="main">(</span>hd <span class="skolem">vl</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v V exit_validFrom NT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?iact</span></span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> iaction_def Let_def <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a1</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'act</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ou1</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'out</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s1'</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">vl1'</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?trn1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Trans <span class="skolem">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> vtrans1<span class="main">:</span> <span class="quoted"><span class="quoted">"validTrans <span class="var">?trn1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="var">?trn1</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"consume <span class="var">?trn1</span> <span class="skolem">vl1</span> <span class="skolem">vl1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">γ</span> <span class="var">?trn1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1'</span> <span class="skolem">vl1'</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> φ1 c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vl1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vl1</span> <span class="main">=</span> <span class="skolem">v1</span> <span class="main">#</span> <span class="skolem">vl1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?trn1</span> <span class="main">=</span> <span class="skolem">v1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> consume_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vl1</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> rs1'<span class="main">:</span> <span class="quoted"><span class="quoted">"reach <span class="skolem">s1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs1 vtrans1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_PairI<span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="skolem">s1'</span> <span class="skolem">tr1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"O <span class="skolem">tr1</span> <span class="main">=</span> O <span class="skolem">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="skolem">tr1</span> <span class="main">=</span> <span class="skolem">vl1'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tr</span></span> <span class="quoted"><span class="skolem">vl1'</span></span><span class="main">]</span> rs rs1' Δ v NT V <span class="keyword1"><span class="command">unfolding</span></span> vl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> vtrans1 v1 O γ V φ1 f1 <span class="keyword1"><span class="command">unfolding</span></span> vl1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?trn1</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">tr1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> react<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?react</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> iact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?iact</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tr</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">note</span></span> tr <span class="main">=</span> Nil
          <span class="keyword1"><span class="command">hence</span></span> vl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vl</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vl1</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">note</span></span> vl1 <span class="main">=</span> Nil
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tr</span></span> <span class="quoted"><span class="skolem">vl1</span></span><span class="main">]</span> Δ V NT V <span class="keyword1"><span class="command">unfolding</span></span> tr vl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> Cons
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> vl unwind rs rs1 Δ iact <span class="keyword1"><span class="command">unfolding</span></span> unwind_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">trn</span> <span class="skolem">tr'</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> tr <span class="main">=</span> Cons
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">trn</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Trans <span class="skolem">ss</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> trn <span class="main">=</span> Trans <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?trn</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Trans <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trn v <span class="keyword1"><span class="command">unfolding</span></span> tr validFrom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> Ta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">T</span> <span class="var">?trn</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> srcOf <span class="skolem">trn</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vtrans<span class="main">:</span> <span class="quoted"><span class="quoted">"validTrans <span class="var">?trn</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="skolem">s'</span> <span class="skolem">tr'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> NT'<span class="main">:</span> <span class="quoted"><span class="quoted">"never <span class="free">T</span> <span class="skolem">tr'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> v NT V <span class="keyword1"><span class="command">unfolding</span></span> tr validFrom_def trn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> rs'<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs vtrans Ta <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachNT_PairI<span class="main">)</span>
            <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="var">?trn</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">f</span> <span class="var">?trn</span> <span class="main">=</span> hd <span class="skolem">vl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">unfolding</span></span> tr trn ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vl'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"consume <span class="var">?trn</span> <span class="skolem">vl</span> <span class="skolem">vl'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ex_consume_φ ex_consume_NO <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
            <span class="keyword1"><span class="command">have</span></span> V'<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="skolem">tr'</span> <span class="main">=</span> <span class="skolem">vl'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V c <span class="keyword1"><span class="command">unfolding</span></span> tr trn ss consume_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="var">?trn</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"match <span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">s1</span> <span class="skolem">vl1</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span> <span class="main">∨</span> ignore <span class="free">Δ</span> <span class="skolem">s</span> <span class="skolem">s1</span> <span class="skolem">vl1</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?match</span> <span class="main">∨</span> <span class="var">?ignore</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> react <span class="keyword1"><span class="command">unfolding</span></span> reaction_def <span class="keyword1"><span class="command">using</span></span> vtrans Ta c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?match</span></span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> match_def Let_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a1</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'act</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ou1</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'out</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s1'</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">vl1'</span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?trn1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Trans <span class="skolem">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="skolem">s'</span> <span class="skolem">vl'</span> <span class="skolem">s1'</span> <span class="skolem">vl1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vtrans1<span class="main">:</span> <span class="quoted"><span class="quoted">"validTrans <span class="var">?trn1</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"consume <span class="var">?trn1</span> <span class="skolem">vl1</span> <span class="skolem">vl1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="var">?trn</span> <span class="main">=</span> <span class="free">γ</span> <span class="var">?trn1</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="var">?trn</span> <span class="main">⟶</span> <span class="free">g</span> <span class="var">?trn</span> <span class="main">=</span> <span class="free">g</span> <span class="var">?trn1</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> rs1'<span class="main">:</span> <span class="quoted"><span class="quoted">"reach <span class="skolem">s1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs rs1 vtrans vtrans1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_PairI<span class="main">)</span>
                <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="skolem">s1'</span> <span class="skolem">tr1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"O <span class="skolem">tr1</span> <span class="main">=</span> O <span class="skolem">tr'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="skolem">tr1</span> <span class="main">=</span> <span class="skolem">vl1'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tr'</span></span> <span class="quoted"><span class="skolem">vl1'</span></span><span class="main">]</span> rs' rs1' Δ v' NT' V' c1 <span class="keyword1"><span class="command">unfolding</span></span> tr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"V <span class="main">(</span><span class="var">?trn1</span> <span class="main">#</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">vl1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> c1 V <span class="keyword1"><span class="command">unfolding</span></span> consume_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="var">?trn1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Trans <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ou1</span></span> <span class="skolem"><span class="skolem">s1'</span></span> <span class="main"><span class="main">#</span></span> <span class="skolem"><span class="skolem">tr1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> vtrans1 v1 O γ g V <span class="keyword1"><span class="command">unfolding</span></span> tr trn ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?ignore</span></span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ignore_def Let_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">γ</span> <span class="var">?trn</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="skolem">s'</span> <span class="skolem">vl'</span> <span class="skolem">s1</span> <span class="skolem">vl1</span>"</span></span>
                <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"validFrom <span class="skolem">s1</span> <span class="skolem">tr1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"O <span class="skolem">tr1</span> <span class="main">=</span> O <span class="skolem">tr'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"V <span class="skolem">tr1</span> <span class="main">=</span> <span class="skolem">vl1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tr'</span></span> <span class="quoted"><span class="skolem">vl1</span></span><span class="main">]</span> rs' rs1 Δ v' NT' V' c <span class="keyword1"><span class="command">unfolding</span></span> tr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">tr1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> v1 O V γ <span class="keyword1"><span class="command">unfolding</span></span> tr trn ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> unwind_secure<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> unwind<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind <span class="free">Δ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">secure</span>
<span class="keyword1"><span class="command">using</span></span> assms unwind_trace <span class="keyword1"><span class="command">unfolding</span></span> secure_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach.Istate reachNT.Istate<span class="main">)</span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* locale BD_Security *)</span>


<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Compositional_Reasoning">
<div class="head">
<h1>Theory Compositional_Reasoning</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Compositional Reasoning›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Compositional_Reasoning
<span class="keyword2"><span class="keyword">imports</span></span> <a href="BD_Security.html">BD_Security</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">context</span></span> BD_Security <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">disjAll</span> <span class="free"><span class="bound"><span class="entity">Δs</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Δ</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Δs</span></span></span><span class="main">.</span> <span class="bound">Δ</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">vl1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Compositional_Reasoning-disjAll_simps"><span class="command">lemma</span></span> disjAll_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"disjAll <span class="main">{}</span> <span class="main">≡</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False"</span></span>
  <span class="quoted"><span class="quoted">"disjAll <span class="main">(</span>insert <span class="free">Δ</span> <span class="free">Δs</span><span class="main">)</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">∨</span> disjAll <span class="free">Δs</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> disjAll_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Compositional_Reasoning-iaction_mono"><span class="command">lemma</span></span> iaction_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"iaction <span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ'</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iaction <span class="free">Δ'</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ou1</span></span> <span class="skolem"><span class="skolem">s1'</span></span> <span class="skolem"><span class="skolem">vl1'</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">s1</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ou1</span><span class="main">,</span> <span class="skolem">s1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Trans <span class="free">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span><span class="main">)</span> <span class="free">vl1</span> <span class="skolem">vl1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="skolem">s1'</span> <span class="skolem">vl1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> iaction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> iaction_def <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ou1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s1'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">vl1'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositional_Reasoning-match_mono"><span class="command">lemma</span></span> match_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="free">vl'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ'</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"match <span class="free">Δ'</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="free">vl'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">ou1</span></span> <span class="skolem"><span class="skolem">s1'</span></span> <span class="skolem"><span class="skolem">vl1'</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="free">s'</span> <span class="free">vl'</span> <span class="skolem">s1'</span> <span class="skolem">vl1'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">s1</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ou1</span><span class="main">,</span> <span class="skolem">s1'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Trans <span class="free">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span><span class="main">)</span> <span class="free">vl1</span> <span class="skolem">vl1'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">g</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>Trans <span class="free">s1</span> <span class="skolem">a1</span> <span class="skolem">ou1</span> <span class="skolem">s1'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> match_def <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ou1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s1'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">vl1'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositional_Reasoning-ignore_mono"><span class="command">lemma</span></span> ignore_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ignore <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="free">vl'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ'</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ignore <span class="free">Δ'</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="free">a</span> <span class="free">ou</span> <span class="free">s'</span> <span class="free">vl'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ignore_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Compositional_Reasoning-reaction_mono"><span class="command">lemma</span></span> reaction_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"reaction <span class="free">Δ</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ'</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reaction <span class="free">Δ'</span> <span class="free">s</span> <span class="free">vl</span> <span class="free">s1</span> <span class="free">vl1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">s</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ou</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">T</span> <span class="main">(</span>Trans <span class="free">s</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"consume <span class="main">(</span>Trans <span class="free">s</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span><span class="main">)</span> <span class="free">vl</span> <span class="skolem">vl'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"match <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span> <span class="main">∨</span> ignore <span class="free">Δ</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∨</span> <span class="var">?i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> reaction_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"match <span class="free">Δ'</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span> <span class="main">∨</span> ignore <span class="free">Δ'</span> <span class="free">s</span> <span class="free">s1</span> <span class="free">vl1</span> <span class="skolem">a</span> <span class="skolem">ou</span> <span class="skolem">s'</span> <span class="skolem">vl'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">∨</span> <span class="var">?i'</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="keyword1"><span class="command">from</span></span> match_mono<span class="main">[</span><span class="operator">OF</span> this 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="keyword1"><span class="command">from</span></span> ignore_mono<span class="main">[</span><span class="operator">OF</span> this 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Decomposition into an arbitrary network of components›</span></span>

<span class="comment1">(* Unwind not to itself, but to a disjunction of other relations: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unwind_to</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unwind_to</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">Δs</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   reachNT <span class="bound">s</span> <span class="main">∧</span> reach <span class="bound">s1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">⟶</span>
   <span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="bound">s</span> <span class="main">(</span>hd <span class="bound">vl</span><span class="main">)</span>
   <span class="main">∨</span>
   iaction <span class="main">(</span>disjAll <span class="free"><span class="bound"><span class="entity">Δs</span></span></span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">∨</span>
   <span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="main">(</span>disjAll <span class="free"><span class="bound"><span class="entity">Δs</span></span></span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>

<span class="keyword1" id="Compositional_Reasoning-unwind_toI"><span class="command">lemma</span></span> unwind_toI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   <span class="main">⟦</span>reachNT <span class="bound">s</span><span class="main">;</span> reach <span class="bound">s1</span><span class="main">;</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">⟧</span>
   <span class="main">⟹</span>
   <span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="bound">s</span> <span class="main">(</span>hd <span class="bound">vl</span><span class="main">)</span>
   <span class="main">∨</span>
   iaction <span class="main">(</span>disjAll <span class="free">Δs</span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">∨</span>
   <span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="main">(</span>disjAll <span class="free">Δs</span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unwind_to <span class="free">Δ</span> <span class="free">Δs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unwind_to_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Decomposition: *)</span>
<span class="keyword1" id="Compositional_Reasoning-unwind_dec"><span class="command">lemma</span></span> unwind_dec<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">Δ</span><span class="main">.</span> <span class="bound">Δ</span> <span class="main">∈</span> <span class="free">Δs</span> <span class="main">⟹</span> <span class="free">next</span> <span class="bound">Δ</span> <span class="main">⊆</span> <span class="free">Δs</span> <span class="main">∧</span> unwind_to <span class="bound">Δ</span> <span class="main">(</span><span class="free">next</span> <span class="bound">Δ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unwind <span class="main">(</span>disjAll <span class="free">Δs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"unwind <span class="var">?Δ</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s1</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">vl</span> <span class="skolem">vl1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'value</span> list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"reachNT <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"reach <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">∈</span> <span class="free">Δs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> disjAll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Δs'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="skolem">Δ</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Δ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"disjAll <span class="var">?Δs'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="skolem">s</span> <span class="main">(</span>hd <span class="skolem">vl</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        iaction <span class="var">?Δ'</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="var">?Δ'</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 2 Δ ne r <span class="keyword1"><span class="command">unfolding</span></span> unwind_to_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span> <span class="var">?Δ'</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="var">?Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ne<span class="main">[</span><span class="operator">OF</span> Δ<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> disjAll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="skolem">s</span> <span class="main">(</span>hd <span class="skolem">vl</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        iaction <span class="var">?Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="var">?Δ</span> <span class="skolem">s</span> <span class="skolem">vl</span> <span class="skolem">s1</span> <span class="skolem">vl1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iaction_mono<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Δ'</span></span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?Δ</span></span></span><span class="main">]</span> reaction_mono<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Δ'</span></span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?Δ</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositional_Reasoning-init_dec"><span class="command">lemma</span></span> init_dec<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> Δ0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ0</span> <span class="main">∈</span> <span class="free">Δs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ0</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟶</span> disjAll <span class="free">Δs</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> disjAll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> unwind_dec_secure<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> Δ0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ0</span> <span class="main">∈</span> <span class="free">Δs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ0</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">Δ</span><span class="main">.</span> <span class="bound">Δ</span> <span class="main">∈</span> <span class="free">Δs</span> <span class="main">⟹</span> <span class="free">next</span> <span class="bound">Δ</span> <span class="main">⊆</span> <span class="free">Δs</span> <span class="main">∧</span> unwind_to <span class="bound">Δ</span> <span class="main">(</span><span class="free">next</span> <span class="bound">Δ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">secure</span>
<span class="keyword1"><span class="command">using</span></span> init_dec<span class="main">[</span><span class="operator">OF</span> Δ0 i<span class="main">]</span> unwind_dec<span class="main">[</span><span class="operator">OF</span> ne<span class="main">]</span> unwind_secure <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A customization for linear modular reasoning›</span></span>

<span class="comment1">(* The customization assumes that each component unwinds only into itself,
its successor or an exit component.  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unwind_cont</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unwind_cont</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">Δs</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   reachNT <span class="bound">s</span> <span class="main">∧</span> reach <span class="bound">s1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">⟶</span>
   iaction <span class="main">(</span>disjAll <span class="free"><span class="bound"><span class="entity">Δs</span></span></span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">∨</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="main">(</span>disjAll <span class="free"><span class="bound"><span class="entity">Δs</span></span></span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Compositional_Reasoning-unwind_contI"><span class="command">lemma</span></span> unwind_contI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   <span class="main">⟦</span>reachNT <span class="bound">s</span><span class="main">;</span> reach <span class="bound">s1</span><span class="main">;</span> <span class="free">Δ</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">⟧</span>
   <span class="main">⟹</span>
   iaction <span class="main">(</span>disjAll <span class="free">Δs</span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">∨</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">vl1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> reaction <span class="main">(</span>disjAll <span class="free">Δs</span><span class="main">)</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ</span> <span class="free">Δs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unwind_cont_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unwind_exit</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unwind_exit</span> <span class="free"><span class="bound"><span class="entity">Δe</span></span></span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   reachNT <span class="bound">s</span> <span class="main">∧</span> reach <span class="bound">s1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Δe</span></span></span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span>
   <span class="main">⟶</span>
   <span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="bound">s</span> <span class="main">(</span>hd <span class="bound">vl</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Compositional_Reasoning-unwind_exitI"><span class="command">lemma</span></span> unwind_exitI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">.</span>
   <span class="main">⟦</span>reachNT <span class="bound">s</span><span class="main">;</span> reach <span class="bound">s1</span><span class="main">;</span> <span class="free">Δe</span> <span class="bound">s</span> <span class="bound">vl</span> <span class="bound">s1</span> <span class="bound">vl1</span><span class="main">⟧</span>
   <span class="main">⟹</span>
   <span class="bound">vl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> exit <span class="bound">s</span> <span class="main">(</span>hd <span class="bound">vl</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unwind_exit <span class="free">Δe</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unwind_exit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allConsec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allConsec</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">allConsec</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">allConsec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">allConsec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Compositional_Reasoning-set_allConsec"><span class="command">lemma</span></span> set_allConsec<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">∈</span> set <span class="free">Δs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δs</span> <span class="main">=</span> <span class="free">Δs'</span> <span class="main">##</span> <span class="free">Δ1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Δ2</span><span class="main">.</span> <span class="main">(</span><span class="free">Δ</span><span class="main">,</span><span class="bound">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δs'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">Δ3</span> <span class="skolem">Δs'</span> <span class="skolem">Δs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">=</span> <span class="skolem">Δ3</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">Δs'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Δs</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Δ3</span> <span class="main">#</span> <span class="skolem">Δs'</span><span class="main">)</span> <span class="main">##</span> <span class="free">Δ1</span>›</span></span> Nil True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Δ1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">Δ4</span> <span class="skolem">Δs''</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Δs</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Δ3</span> <span class="main">#</span> <span class="skolem">Δs'</span><span class="main">)</span> <span class="main">##</span> <span class="free">Δ1</span>›</span></span> Cons True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Δ4</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">∈</span> set <span class="skolem">Δs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Δ</span><span class="main">,</span> <span class="skolem">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="main">(</span><span class="skolem">Δs'</span> <span class="main">##</span> <span class="free">Δ1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Δs</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Δ3</span> <span class="main">#</span> <span class="skolem">Δs'</span><span class="main">)</span> <span class="main">##</span> <span class="free">Δ1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Δ2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">Δs'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositional_Reasoning-allConsec_set"><span class="command">lemma</span></span> allConsec_set<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Δ1</span><span class="main">,</span><span class="free">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ1</span> <span class="main">∈</span> set <span class="free">Δs</span> <span class="main">∧</span> <span class="free">Δ2</span> <span class="main">∈</span> set <span class="free">Δs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Δs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> allConsec.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(* Liniar decomposition: *)</span>
<span class="keyword1"><span class="command">theorem</span></span> unwind_decomp_secure<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> hd <span class="free">Δs</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">Δ1</span> <span class="bound">Δ2</span><span class="main">.</span> <span class="main">(</span><span class="bound">Δ1</span><span class="main">,</span><span class="bound">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span> <span class="main">⟹</span> unwind_cont <span class="bound">Δ1</span> <span class="main">{</span><span class="bound">Δ1</span><span class="main">,</span> <span class="bound">Δ2</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="main">(</span>last <span class="free">Δs</span><span class="main">)</span> <span class="main">{</span>last <span class="free">Δs</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_exit <span class="free">Δe</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">secure</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Δ0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd <span class="free">Δs</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Δs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="free">Δe</span> <span class="main">(</span>set <span class="free">Δs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="quoted">"<span class="skolem"><span class="skolem">next</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">next</span> <span class="skolem">Δ1</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">Δ1</span> <span class="main">=</span> <span class="free">Δe</span> <span class="keyword1">then</span> <span class="main">{}</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">Δ1</span> <span class="main">=</span> last <span class="free">Δs</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">Δ1</span><span class="main">,</span><span class="free">Δe</span><span class="main">}</span>
     <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">Δ1</span><span class="main">,</span><span class="keyword1">SOME</span> <span class="bound">Δ2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Δ1</span><span class="main">,</span><span class="bound">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span><span class="main">,</span><span class="free">Δe</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Δ1</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> unwind_dec_secure<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Δ0</span> <span class="main">∈</span> <span class="var">?Δs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vl</span> <span class="skolem">vl1</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="skolem">vl</span> <span class="skolem">vl1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Δ0</span> <span class="free">istate</span> <span class="skolem">vl</span> <span class="free">istate</span> <span class="skolem">vl1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Δ</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">∈</span> <span class="var">?Δs</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">next</span> <span class="skolem">Δ</span> <span class="main">⊆</span> <span class="var">?Δs</span> <span class="main">∧</span> unwind_to <span class="skolem">Δ</span> <span class="main">(</span><span class="skolem">next</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="free">Δe</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">unfolding</span></span> next_def unwind_exit_def unwind_to_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> last <span class="free">Δs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">≠</span> <span class="free">Δe</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n l <span class="keyword1"><span class="command">unfolding</span></span> next_def unwind_cont_def unwind_to_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">∈</span> set <span class="free">Δs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">≠</span> last <span class="free">Δs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">≠</span> <span class="free">Δe</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="skolem"><span class="skolem">Δs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Δs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δs</span> <span class="main">=</span> <span class="skolem">Δs'</span> <span class="main">##</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">∈</span> set <span class="skolem">Δs'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> append_Cons append_assoc in_set_conv_decomp last_snoc rev_exhaust<span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Δ2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Δ</span><span class="main">,</span> <span class="bound">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_allConsec<span class="main">[</span><span class="operator">OF</span> Δ Δs<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Δ</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">Δ2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Δ</span><span class="main">,</span> <span class="bound">Δ2</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span><span class="main">)</span> <span class="main">∈</span> allConsec <span class="free">Δs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 c <span class="keyword1"><span class="command">unfolding</span></span> next_def unwind_cont_def unwind_to_def
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> allConsec_set<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Instances›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> unwind_decomp3_secure<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ1</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ1</span> <span class="main">{</span><span class="free">Δ1</span><span class="main">,</span> <span class="free">Δ2</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ2</span> <span class="main">{</span><span class="free">Δ2</span><span class="main">,</span> <span class="free">Δ3</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ3</span> <span class="main">{</span><span class="free">Δ3</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_exit <span class="free">Δe</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">secure</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> unwind_decomp_secure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">Δ1</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ2</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ3</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Δe</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> unwind_decomp4_secure<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ1</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ1</span> <span class="main">{</span><span class="free">Δ1</span><span class="main">,</span> <span class="free">Δ2</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ2</span> <span class="main">{</span><span class="free">Δ2</span><span class="main">,</span> <span class="free">Δ3</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ3</span> <span class="main">{</span><span class="free">Δ3</span><span class="main">,</span> <span class="free">Δ4</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ4</span> <span class="main">{</span><span class="free">Δ4</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_exit <span class="free">Δe</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">secure</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> unwind_decomp_secure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">Δ1</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ2</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ3</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ4</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Δe</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> unwind_decomp5_secure<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">vl</span> <span class="bound">vl1</span><span class="main">.</span> <span class="free">B</span> <span class="bound">vl</span> <span class="bound">vl1</span> <span class="main">⟹</span> <span class="free">Δ1</span> <span class="free">istate</span> <span class="bound">vl</span> <span class="free">istate</span> <span class="bound">vl1</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ1</span> <span class="main">{</span><span class="free">Δ1</span><span class="main">,</span> <span class="free">Δ2</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ2</span> <span class="main">{</span><span class="free">Δ2</span><span class="main">,</span> <span class="free">Δ3</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ3</span> <span class="main">{</span><span class="free">Δ3</span><span class="main">,</span> <span class="free">Δ4</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ4</span> <span class="main">{</span><span class="free">Δ4</span><span class="main">,</span> <span class="free">Δ5</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_cont <span class="free">Δ5</span> <span class="main">{</span><span class="free">Δ5</span><span class="main">,</span> <span class="free">Δe</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"unwind_exit <span class="free">Δe</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">secure</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> unwind_decomp_secure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">Δ1</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ2</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ3</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ4</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Δ5</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Δe</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>




<span class="comment1">(*&lt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context BD_Security *)</span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Bounded_Deducibility_Security">
<div class="head">
<h1>Theory Bounded_Deducibility_Security</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Bounded_Deducibility_Security
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Compositional_Reasoning.html">Compositional_Reasoning</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div>