<div id="GenClock">
<div class="head">
<h1>Theory GenClock</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Formalization of Schneider's generalized clock synchronization protocol.
    Author:      Alwen Tiu, LORIA, June 11, 2005
    Maintainer:  Alwen Tiu &lt;Alwen.Tiu at loria.fr&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> GenClock <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Types and constants definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Process is represented by natural numbers. The type 'event' corresponds
to synchronization rounds.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> process <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> event <span class="main">=</span> <span class="quoted">nat</span>      <span class="comment1">(* synchronization rounds *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> time <span class="main">=</span> <span class="quoted">real</span>
<span class="keyword1"><span class="command">type_synonym</span></span> Clocktime <span class="main">=</span> <span class="quoted">real</span>

<span class="keyword1"><span class="command">axiomatization</span></span>
  <span class="free">δ</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">μ</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">ρ</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">rmin</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">rmax</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">β</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Λ</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Number of processes *)</span>
  <span class="free">np</span> <span class="main">::</span> <span class="quoted">process</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">maxfaults</span> <span class="main">::</span> <span class="quoted">process</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Physical clocks *)</span>
  <span class="free">PC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> time<span class="main">]</span> <span class="main">⇒</span> Clocktime"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Virtual / Logical clocks *)</span>
  <span class="free">VC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> time<span class="main">]</span> <span class="main">⇒</span> Clocktime"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Starting (real) time of synchronization rounds *)</span>
  <span class="free">te</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> event<span class="main">]</span> <span class="main">⇒</span> time"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Clock readings at each round *)</span>
  <span class="free">θ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> event<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span>process <span class="main">⇒</span> Clocktime<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Logical clock in-effect at a time interval *)</span>
  <span class="free">IC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> event<span class="main">,</span> time<span class="main">]</span> <span class="main">⇒</span> Clocktime"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Correct clocks *)</span>
  <span class="free">correct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> time<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* The averaging function to calculate clock adjustment *)</span>
  <span class="free">cfn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> <span class="main">(</span>process <span class="main">⇒</span> Clocktime<span class="main">)</span><span class="main">]</span> <span class="main">⇒</span> Clocktime"</span></span> <span class="keyword2"><span class="keyword">and</span></span>

  <span class="free">π</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Clocktime<span class="main">,</span> Clocktime<span class="main">]</span> <span class="main">⇒</span> Clocktime"</span></span> <span class="keyword2"><span class="keyword">and</span></span>

  <span class="free">α</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Clocktime <span class="main">⇒</span> Clocktime"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">count</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process <span class="main">⇒</span> bool<span class="main">,</span> process<span class="main">]</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">count</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="comment1">(* Adjustment to a clock *)</span>
  <span class="entity">Adj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> event<span class="main">]</span> <span class="main">⇒</span> Clocktime"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Adj</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="keyword1">then</span> cfn <span class="bound">p</span> <span class="main">(</span>θ <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> PC <span class="bound">p</span> <span class="main">(</span>te <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span>
                 <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="comment1">(* Auxilary predicates used in the definition of precision enhancement *)</span>
  <span class="entity">okRead1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process <span class="main">⇒</span> Clocktime<span class="main">,</span> Clocktime<span class="main">,</span> process <span class="main">⇒</span> bool<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">okRead1</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ppred</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ppred</span></span></span> <span class="bound">l</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ppred</span></span></span> <span class="bound">m</span> <span class="main">⟶</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">l</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">okRead2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process <span class="main">⇒</span> Clocktime<span class="main">,</span> process <span class="main">⇒</span> Clocktime<span class="main">,</span> Clocktime<span class="main">,</span>
               process <span class="main">⇒</span> bool<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">okRead2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ppred</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ppred</span></span></span> <span class="bound">p</span> <span class="main">⟶</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">p</span><span class="main">¦</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">rho_bound1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>process<span class="main">,</span> time<span class="main">]</span> <span class="main">⇒</span> Clocktime<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rho_bound1</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">p</span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">p</span> <span class="bound">s</span> <span class="main">≤</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> ρ<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">rho_bound2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>process<span class="main">,</span> time<span class="main">]</span> <span class="main">⇒</span> Clocktime<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rho_bound2</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">p</span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">p</span> <span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Clock conditions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some general assumptions›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  constants_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> β <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> μ <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> rmin
  <span class="main">∧</span> rmin <span class="main">≤</span> rmax <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> ρ <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> np <span class="main">∧</span> maxfaults <span class="main">≤</span> np"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  PC_monotone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> PC <span class="bound">p</span> <span class="bound">s</span> <span class="main">≤</span> PC <span class="bound">p</span> <span class="bound">t</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  VClock<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">t</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> te <span class="bound">p</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> te <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> VC <span class="bound">p</span> <span class="bound">t</span> <span class="main">=</span> IC <span class="bound">p</span> <span class="bound">i</span> <span class="bound">t</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  IClock<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">t</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">⟶</span> IC <span class="bound">p</span> <span class="bound">i</span> <span class="bound">t</span> <span class="main">=</span> PC <span class="bound">p</span> <span class="bound">t</span> <span class="main">+</span> Adj <span class="bound">p</span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 1: initial skew›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> correct <span class="bound">p</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">≤</span> PC <span class="bound">p</span> <span class="main">0</span> <span class="main">∧</span> PC <span class="bound">p</span> <span class="main">0</span> <span class="main">≤</span> μ"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 2: bounded drift›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rate_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> PC <span class="bound">p</span> <span class="bound">t</span> <span class="main">-</span> PC <span class="bound">p</span> <span class="bound">s</span> <span class="main">≤</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> ρ<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rate_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span> <span class="main">≤</span> PC <span class="bound">p</span> <span class="bound">t</span> <span class="main">-</span> PC <span class="bound">p</span> <span class="bound">s</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 3: bounded interval›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rts0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">t</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> te <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">-</span> te <span class="bound">p</span> <span class="bound">i</span> <span class="main">≤</span> rmax"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rts1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">t</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> te <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> rmin <span class="main">≤</span> <span class="bound">t</span> <span class="main">-</span> te <span class="bound">p</span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 4 : bounded delay›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rts2a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">t</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">∧</span> correct <span class="bound">q</span> <span class="bound">t</span> <span class="main">∧</span> te <span class="bound">q</span> <span class="bound">i</span> <span class="main">+</span> β <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> te <span class="bound">p</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">t</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
  rts2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="main">(</span>te <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> correct <span class="bound">q</span> <span class="main">(</span>te <span class="bound">q</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> abs<span class="main">(</span>te <span class="bound">p</span> <span class="bound">i</span> <span class="main">-</span> te <span class="bound">q</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> β"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 5: initial synchronization›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  synch0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> te <span class="bound">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 6: nonoverlap›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  nonoverlap<span class="main">:</span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> rmin"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 7: reading errors›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  readerror<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">i</span><span class="main">.</span> correct <span class="bound">p</span> <span class="main">(</span>te <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> correct <span class="bound">q</span> <span class="main">(</span>te <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
              abs<span class="main">(</span>θ <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">q</span> <span class="main">-</span> IC <span class="bound">q</span> <span class="bound">i</span> <span class="main">(</span>te <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Λ"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 8: bounded faults›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  correct_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> correct <span class="bound">p</span> <span class="bound">t</span> <span class="main">⟶</span> correct <span class="bound">p</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  correct_count<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> np <span class="main">-</span> maxfaults <span class="main">≤</span> count <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> correct <span class="bound">p</span> <span class="bound">t</span><span class="main">)</span> np"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 9: Translation invariance›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  trans_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟶</span> cfn <span class="bound">p</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> cfn <span class="bound">p</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 10: precision enhancement›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  prec_enh<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">ppred</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
          np <span class="main">-</span> maxfaults <span class="main">≤</span> count <span class="bound">ppred</span> np <span class="main">∧</span>
          okRead1 <span class="bound">f</span> <span class="bound">y</span> <span class="bound">ppred</span> <span class="main">∧</span> okRead1 <span class="bound">g</span> <span class="bound">y</span> <span class="bound">ppred</span> <span class="main">∧</span>
          okRead2 <span class="bound">f</span> <span class="bound">g</span> <span class="bound">x</span> <span class="bound">ppred</span> <span class="main">∧</span> <span class="bound">ppred</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">ppred</span> <span class="bound">q</span>
      <span class="main">⟶</span> abs<span class="main">(</span>cfn <span class="bound">p</span> <span class="bound">f</span> <span class="main">-</span> cfn <span class="bound">q</span> <span class="bound">g</span><span class="main">)</span> <span class="main">≤</span> π <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Condition 11: accuracy preservation›</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  acc_prsv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">ppred</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> okRead1 <span class="bound">f</span> <span class="bound">x</span> <span class="bound">ppred</span> <span class="main">∧</span> np <span class="main">-</span> maxfaults <span class="main">≤</span> count <span class="bound">ppred</span> np
          <span class="main">∧</span> <span class="bound">ppred</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">ppred</span> <span class="bound">q</span> <span class="main">⟶</span> abs<span class="main">(</span>cfn <span class="bound">p</span> <span class="bound">f</span> <span class="main">-</span> <span class="bound">f</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≤</span> α <span class="bound">x</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Some derived properties of clocks›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rts0d<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> rmax"</span></span>
<span class="keyword1"><span class="command">using</span></span> cp rts0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> rts1d<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> cp rts1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> rte<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> cp rts1d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this constants_ax <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> beta_bound1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> corr_p rte <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this corr_p correct_closed <span class="keyword1"><span class="command">have</span></span> corr_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> corr_p rts1d nonoverlap <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this nonoverlap <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">+</span> β <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this corr_p corr_q rts2a
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> beta_bound2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> rmax <span class="main">+</span> β"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> corr_p rte <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this corr_p correct_closed <span class="keyword1"><span class="command">have</span></span> corr_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="free">i</span> <span class="main">=</span>
    <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span> <span class="main">-</span> te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> corr_q corr_pi rts2b <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span>te <span class="free">p</span> <span class="free">i</span> <span class="main">-</span> te <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> β"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">-</span> te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> β"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this Eq1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this Eq1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> corr_p rts0d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> rmax"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this split Eq2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Bounded-drift for logical clocks (IC)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rb1<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound1 <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rb2<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound2 <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> PC_ie<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">q</span> <span class="free">t</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="free">C</span> <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span> <span class="free">C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">t</span> <span class="main">¦</span>  <span class="main">≤</span> <span class="main">¦</span> <span class="free">C</span> <span class="free">p</span> <span class="free">s</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">s</span> <span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">p</span> <span class="free">s</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="free">C</span> <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">q</span> <span class="free">t</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> <span class="free">s</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span> <span class="var">?Bp</span> <span class="main">-</span> <span class="var">?Bq</span> <span class="main">¦</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> PC_ie <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span> <span class="var">?Bp</span> <span class="main">-</span> <span class="var">?Bq</span> <span class="main">¦</span> <span class="main">=</span> <span class="var">?Bp</span> <span class="main">-</span> <span class="var">?Bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> corr_p ie rb1 <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Bp</span> <span class="main">-</span> <span class="var">?Bq</span> <span class="main">≤</span> <span class="var">?I</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>ρ<span class="main">)</span> <span class="main">-</span> <span class="var">?Bq</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">≤</span> <span class="var">?E2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rho_bound1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> corr_q ie rb2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span> <span class="main">≤</span> <span class="var">?Bq</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rho_bound2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> Eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E2</span> <span class="main">≤</span> <span class="var">?I</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>ρ<span class="main">)</span> <span class="main">-</span> <span class="var">?I</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?I</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>ρ<span class="main">)</span> <span class="main">-</span> <span class="var">?I</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="var">?I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2 Eq3 Eq4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?Dt</span><span class="main">¦</span>  <span class="main">≤</span> <span class="main">¦</span><span class="var">?Bp</span> <span class="main">-</span> <span class="var">?Bq</span><span class="main">¦</span>  <span class="main">+</span> <span class="main">¦</span><span class="var">?Ds</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bounded_drift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rb1<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound1 <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rb2<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound2 <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rb3<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound1 <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rb4<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound2 <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">C</span> <span class="free">p</span> <span class="free">s</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">s</span><span class="main">¦</span>  <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="free">C</span> <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">q</span> <span class="free">t</span> <span class="main">-</span> <span class="free">D</span> <span class="free">q</span> <span class="free">s</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Bq</span> <span class="main">≤</span> <span class="var">?Bp</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this ie rb1 rb4 corr_p corr_q bd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?Bq</span> <span class="main">≤</span> <span class="var">?Bp</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Bp</span> <span class="main">≤</span> <span class="var">?Bq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this ie rb2 rb3 corr_p corr_q bd
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">D</span> <span class="free">q</span> <span class="free">t</span> <span class="main">-</span> <span class="free">C</span> <span class="free">p</span> <span class="free">t</span><span class="main">¦</span>  <span class="main">≤</span> <span class="main">¦</span><span class="free">D</span> <span class="free">q</span> <span class="free">s</span> <span class="main">-</span> <span class="free">C</span> <span class="free">p</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Drift rate of logical clocks›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> IC_rate1<span class="main">:</span>
<span class="quoted"><span class="quoted">"rho_bound1 <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">t</span><span class="main">.</span> IC <span class="bound">p</span> <span class="free">i</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted">process</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted">time</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">time</span>
    <span class="keyword3"><span class="command">assume</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> cp ie correct_closed <span class="keyword1"><span class="command">have</span></span> cps<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">t</span> <span class="main">-</span> IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>ρ<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> cp IClock <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">t</span> <span class="main">=</span> PC <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">+</span> Adj <span class="skolem">p</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> cps IClock <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">s</span> <span class="main">=</span> PC <span class="skolem">p</span> <span class="skolem">s</span> <span class="main">+</span> Adj <span class="skolem">p</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> cp ie rate_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PC <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">-</span> PC <span class="skolem">p</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>ρ<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rho_bound1_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> IC_rate2<span class="main">:</span>
<span class="quoted"><span class="quoted">"rho_bound2 <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">t</span><span class="main">.</span> IC <span class="bound">p</span> <span class="free">i</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted">process</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted">time</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">time</span>
    <span class="keyword3"><span class="command">assume</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> cp ie correct_closed <span class="keyword1"><span class="command">have</span></span> cps<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span> <span class="main">≤</span> IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">t</span> <span class="main">-</span> IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> cp IClock <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">t</span> <span class="main">=</span> PC <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">+</span> Adj <span class="skolem">p</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> cps IClock <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IC <span class="skolem">p</span> <span class="free">i</span> <span class="skolem">s</span> <span class="main">=</span> PC <span class="skolem">p</span> <span class="skolem">s</span> <span class="main">+</span> Adj <span class="skolem">p</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> cp ie rate_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span>ρ<span class="main">)</span> <span class="main">≤</span> PC <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">-</span> PC <span class="skolem">p</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rho_bound2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Auxilary function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ICf›</span></span></span></span>: we introduce this to avoid some
unification problem in some tactic of isabelle.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ICf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>process <span class="main">⇒</span> time <span class="main">⇒</span> Clocktime<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ICf</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">t</span><span class="main">.</span> IC <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> IC_bd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span> <span class="main">-</span> IC <span class="free">q</span> <span class="free">j</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="free">s</span> <span class="main">-</span> IC <span class="free">q</span> <span class="free">j</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ICf <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ICf <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?C</span> <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> <span class="var">?D</span> <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?C</span> <span class="free">p</span> <span class="free">s</span> <span class="main">-</span> <span class="var">?D</span> <span class="free">q</span> <span class="free">s</span><span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> IC_rate1 <span class="keyword1"><span class="command">have</span></span> rb1<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound1 <span class="main">(</span>ICf <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> rho_bound1 <span class="main">(</span>ICf <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ICf_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> IC_rate2 <span class="keyword1"><span class="command">have</span></span> rb2<span class="main">:</span> <span class="quoted"><span class="quoted">"rho_bound2 <span class="main">(</span>ICf <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> rho_bound2 <span class="main">(</span>ICf <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ICf_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> ie rb1 rb2 corr_p corr_q bounded_drift
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ICf_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> event_bound<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">t</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> te <span class="free">p</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="skolem">i</span> <span class="main">≤</span> max <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> F2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">.</span> correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">from</span></span> F1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this corr_p correct_closed
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> F3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">.</span> real <span class="bound">i</span> <span class="main">*</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> synch0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="skolem">i</span>"</span></span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>

          <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">+</span> rmin <span class="main">=</span> <span class="main">(</span>real <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">*</span>rmin"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> real <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2
          <span class="keyword1"><span class="command">have</span></span> Eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">+</span> rmin <span class="main">=</span> real <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> rmin"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

          <span class="keyword1"><span class="command">from</span></span> F2 <span class="keyword1"><span class="command">have</span></span> cp1<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> F2 <span class="keyword1"><span class="command">have</span></span> cp2<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> cp1 rts1d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">p</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> Eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="skolem">i</span> <span class="main">+</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> ind_hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">+</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="skolem">i</span> <span class="main">+</span> rmin"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this Eq4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">+</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this Eq3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> F4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> real <span class="bound">i</span> <span class="main">*</span> rmin <span class="main">≤</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">from</span></span> F1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> F3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">≤</span> te <span class="free">p</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">i</span> <span class="main">*</span> rmin <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> constants_ax <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> rmin"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> this reals_Archimedean3
    <span class="keyword1"><span class="command">have</span></span> Archi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">t</span> <span class="main">&lt;</span> real <span class="bound">k</span> <span class="main">*</span> rmin"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> Archi <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> real <span class="skolem">k</span> <span class="main">*</span> rmin"</span></span> <span class="keyword1"><span class="command">..</span></span>

    <span class="keyword1"><span class="command">from</span></span> F4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">k</span> <span class="main">*</span> rmin <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> notC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">&lt;</span> real <span class="skolem">k</span> <span class="main">*</span> rmin<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> C notC <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Agreement property›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> π <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>β <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ<span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>rmax"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ3</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> α <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span><span class="main">)</span> <span class="main">+</span> Λ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>β"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">okmaxsync</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span> Clocktime<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">okmaxsync</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> correct <span class="bound">p</span> <span class="main">(</span>max <span class="main">(</span>te <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>te <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="main">∧</span> correct <span class="bound">q</span> <span class="main">(</span>max <span class="main">(</span>te <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>te <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="main">¦</span>IC <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>max <span class="main">(</span>te <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>te <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>max <span class="main">(</span>te <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>te <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">okClocks</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>process<span class="main">,</span> process<span class="main">,</span> nat<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">okClocks</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>te <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
        <span class="main">∧</span> correct <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">t</span> <span class="main">∧</span> correct <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">t</span>
     <span class="main">⟶</span> <span class="main">¦</span>VC <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">t</span> <span class="main">-</span> VC <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">t</span><span class="main">¦</span> <span class="main">≤</span> δ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> okClocks_sym<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ok_pq<span class="main">:</span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"okClocks <span class="free">q</span> <span class="free">p</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">time</span>
    <span class="keyword3"><span class="command">assume</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="skolem">t</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this ok_pq ie1 ie2 corr_p corr_q
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">q</span> <span class="skolem">t</span> <span class="main">-</span> VC <span class="free">p</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> δ"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_minus_commute okClocks_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okClocks_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ICp_Suc<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IC <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cfn <span class="free">p</span> <span class="main">(</span>θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">using</span></span> corr_p IClock <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Adj_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> IC_trans_inv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  cfn <span class="free">q</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>PC <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T1</span> <span class="main">=</span> <span class="var">?T2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"PC <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">from</span></span> corr_q ie1 PC_monotone <span class="keyword1"><span class="command">have</span></span> posX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> IClock corr_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T1</span> <span class="main">=</span> cfn <span class="free">q</span> <span class="main">(</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Adj_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> this posX trans_inv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> beta_rho<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>PC <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> β<span class="main">*</span>ρ"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>PC <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> ie <span class="keyword1"><span class="command">have</span></span> posD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> ie PC_monotone corr_l <span class="keyword1"><span class="command">have</span></span> posX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ie corr_l rate_1 <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">≤</span> <span class="var">?D</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ρ<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ie corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ie corr_q correct_closed <span class="keyword1"><span class="command">have</span></span> corr_q_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> corr_q_tq corr_p rts2b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?D</span><span class="main">¦</span> <span class="main">≤</span> β"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this constants_ax posD <span class="keyword1"><span class="command">have</span></span> D_beta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span><span class="main">*</span>ρ <span class="main">≤</span> β<span class="main">*</span>ρ"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> posX posD A <span class="keyword1"><span class="command">have</span></span> absEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?X</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">=</span> <span class="var">?X</span> <span class="main">-</span> <span class="var">?D</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bound1 <span class="keyword1"><span class="command">have</span></span> bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">-</span> <span class="var">?D</span> <span class="main">≤</span> <span class="var">?D</span><span class="main">*</span>ρ"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute distrib_right<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> D_beta absEq bound2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> notA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?D</span> <span class="main">≤</span> <span class="var">?X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> absEq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?X</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">=</span> <span class="var">?D</span> <span class="main">-</span> <span class="var">?X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ie corr_l rate_2 <span class="keyword1"><span class="command">have</span></span> bound3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> ρ<span class="main">)</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">-</span> <span class="var">?X</span> <span class="main">≤</span> <span class="var">?D</span><span class="main">*</span>ρ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this absEq2 D_beta <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This lemma (and the next one pe-cond2) proves an assumption used
in the precision enhancement.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pe_cond1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">+</span> <span class="main">(</span>PC <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
           θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span> ρ <span class="main">*</span> β <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">≤</span> <span class="var">?N</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Xl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>PC <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Xq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>PC <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RE1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RE2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ICT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="var">?Xq</span> <span class="main">-</span> <span class="var">?D</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?D</span><span class="main">)</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> Split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?Xq</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> ie corr_q correct_closed <span class="keyword1"><span class="command">have</span></span> corr_q_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ie corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> corr_p corr_q corr_l ie beta_rho
  <span class="keyword1"><span class="command">have</span></span> XlD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?Xl</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">≤</span> β<span class="main">*</span>ρ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> corr_p corr_q ie beta_rho
  <span class="keyword1"><span class="command">have</span></span> XqD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?Xq</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">≤</span> β<span class="main">*</span>ρ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> TD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> β<span class="main">*</span>ρ"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?ICT</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?ICT</span> <span class="main">-</span> <span class="var">?D</span><span class="main">)</span><span class="main">¦</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="var">?E2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E2</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?ICT</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?ICT</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> Eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?ICT</span><span class="main">¦</span> <span class="main">≤</span>  <span class="main">¦</span><span class="var">?RE1</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?RE2</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> readerror corr_p corr_l
    <span class="keyword1"><span class="command">have</span></span> Eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?RE1</span><span class="main">¦</span> <span class="main">≤</span> Λ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


    <span class="keyword1"><span class="command">from</span></span> corr_l_tq corr_q_tq this readerror
    <span class="keyword1"><span class="command">have</span></span> Eq5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?RE2</span><span class="main">¦</span> <span class="main">≤</span> Λ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> Eq3 Eq4 Eq5 <span class="keyword1"><span class="command">have</span></span> Eq6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?T</span> <span class="main">-</span> <span class="var">?ICT</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>Λ"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> Eq7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ICT</span> <span class="main">-</span> <span class="var">?D</span> <span class="main">=</span> <span class="var">?Xl</span> <span class="main">-</span> <span class="var">?D</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> corr_p rte <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tpi<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> corr_q_tq rte <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this corr_l_tq correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tqi<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> IClock corr_l
      <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span> <span class="quoted"><span class="quoted">"IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> PC <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> Adj <span class="free">l</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> IClock corr_l_tq
      <span class="keyword1"><span class="command">have</span></span> F2<span class="main">:</span> <span class="quoted"><span class="quoted">"IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> PC <span class="free">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> Adj <span class="free">l</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> F1 F2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> this XlD <span class="keyword1"><span class="command">have</span></span> Eq8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?ICT</span> <span class="main">-</span> <span class="var">?D</span><span class="main">¦</span> <span class="main">≤</span> β<span class="main">*</span>ρ"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2 Eq6 Eq8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> Split XqD TD <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span> β <span class="main">*</span> ρ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> F2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> ρ <span class="main">*</span> β <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span> β <span class="main">*</span> ρ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> F1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> F2<span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pe_cond2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">m</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">l</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_k<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">k</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_l_tk<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_m_tk<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">m</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> θ <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> θ <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ICS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tlm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"te <span class="free">l</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"IC <span class="free">l</span> <span class="free">i</span> <span class="var">?tlm</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="var">?tlm</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?X</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="var">?D1</span> <span class="main">-</span> <span class="var">?D2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?ICS</span><span class="main">¦</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="var">?E2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E2</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?D1</span> <span class="main">-</span> <span class="var">?D2</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?ICS</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> corr_l_tk corr_k beta_bound1 <span class="keyword1"><span class="command">have</span></span> ie_lk<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">l</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> this corr_l_tk correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> ie_lk corr_l_tk corr_m_tk IC_bd
  <span class="keyword1"><span class="command">have</span></span> Eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?ICS</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?IC</span><span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?tlm</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this ind_hyp <span class="keyword1"><span class="command">have</span></span> Eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?ICS</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?tlm</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> corr_l corr_k beta_bound2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?tlm</span> <span class="main">≤</span> rmax <span class="main">+</span> β"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this constants_ax <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>te <span class="free">k</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?tlm</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this Eq4 <span class="keyword1"><span class="command">have</span></span> Eq4a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?ICS</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> corr_k corr_l_tk readerror
  <span class="keyword1"><span class="command">have</span></span> Eq5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?D1</span><span class="main">¦</span> <span class="main">≤</span> Λ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> corr_k corr_m_tk readerror
  <span class="keyword1"><span class="command">have</span></span> Eq6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?D2</span><span class="main">¦</span> <span class="main">≤</span> Λ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?D1</span> <span class="main">-</span> <span class="var">?D2</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?D1</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?D2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this Eq5 Eq6 <span class="keyword1"><span class="command">have</span></span> Eq7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?D1</span> <span class="main">-</span> <span class="var">?D2</span><span class="main">¦</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>Λ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2 Eq4a Eq7 split <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> theta_bound<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_m<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">m</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> IC_bound<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>max <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>max <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>
      <span class="main">≤</span> <span class="free">δS</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span><span class="main">¦</span>
       <span class="main">≤</span>  <span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> corr_p corr_l beta_bound1 <span class="keyword1"><span class="command">have</span></span> tli_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">l</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> corr_p corr_m beta_bound1 <span class="keyword1"><span class="command">have</span></span> tmi_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">m</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tml</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> tli_le_tp tmi_le_tp <span class="keyword1"><span class="command">have</span></span> tml_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tml</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> tml_le_tp corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tml<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">l</span> <span class="var">?tml</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> tml_le_tp corr_m correct_closed <span class="keyword1"><span class="command">have</span></span> corr_m_tml<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">m</span> <span class="var">?tml</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span> <span class="main">-</span> θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">m</span> <span class="free">i</span> <span class="main">&lt;</span> te <span class="free">l</span> <span class="free">i</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> this IC_bound
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">l</span> <span class="free">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this A corr_p corr_l corr_m pe_cond2
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span> <span class="main">&lt;</span> te <span class="free">l</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">l</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">m</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this IC_bound
    <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">m</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">l</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this Eq1 corr_p corr_l corr_m pe_cond2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span> <span class="main">-</span> θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">l</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> four_one_ind_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> rmin"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie3<span class="main">:</span> <span class="quoted"><span class="quoted">"γ1 <span class="free">δS</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"okmaxsync <span class="free">i</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie4<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tpq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>PC <span class="free">q</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> PC <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> ie4 corr_q correct_closed <span class="keyword1"><span class="command">have</span></span> corr_q_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> Eq_IC_cfn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="var">?tpq</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="var">?tpq</span><span class="main">¦</span> <span class="main">=</span>
    <span class="main">¦</span>cfn <span class="free">q</span> <span class="var">?f</span> <span class="main">-</span> cfn <span class="free">p</span> <span class="var">?g</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> corr_p ICp_Suc <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"IC <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="var">?tpq</span> <span class="main">=</span> cfn <span class="free">p</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> ie4 corr_p corr_q IC_trans_inv
    <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="var">?tpq</span> <span class="main">=</span> cfn <span class="free">q</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ppred</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> correct <span class="bound">l</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>β <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> <span class="var">?ppred</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">¦</span><span class="var">?f</span> <span class="bound">l</span> <span class="main">-</span> <span class="var">?g</span> <span class="bound">l</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ie4 corr_p corr_q this pe_cond1
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?f</span> <span class="skolem">l</span> <span class="main">-</span> <span class="var">?g</span> <span class="skolem">l</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>β <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Λ<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cond1<span class="main">:</span> <span class="quoted"><span class="quoted">"okRead2 <span class="var">?f</span> <span class="var">?g</span> <span class="var">?X</span> <span class="var">?ppred</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okRead2_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="var">?ppred</span> <span class="bound">l</span> <span class="main">∧</span> <span class="var">?ppred</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="main">¦</span><span class="var">?f</span> <span class="bound">l</span> <span class="main">-</span> <span class="var">?f</span> <span class="bound">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">m</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> corr_p corr_l beta_bound1 <span class="keyword1"><span class="command">have</span></span> tli_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="skolem">l</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> corr_p corr_m beta_bound1 <span class="keyword1"><span class="command">have</span></span> tmi_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="skolem">m</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tlm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="skolem">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> tli_le_tp tmi_le_tp <span class="keyword1"><span class="command">have</span></span> tlm_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tlm</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> ie4 corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> ie4 corr_m correct_closed <span class="keyword1"><span class="command">have</span></span> corr_m_tq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">m</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> tlm_le_tp corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tlm<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">l</span> <span class="var">?tlm</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> tlm_le_tp corr_m correct_closed <span class="keyword1"><span class="command">have</span></span> corr_m_tlm<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">m</span> <span class="var">?tlm</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> ind_hyp corr_l_tlm corr_m_tlm
      <span class="keyword1"><span class="command">have</span></span> EqAbs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="skolem">l</span> <span class="free">i</span> <span class="var">?tlm</span> <span class="main">-</span> IC <span class="skolem">m</span> <span class="free">i</span> <span class="var">?tlm</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okmaxsync_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> EqAbs3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?f</span> <span class="skolem">l</span> <span class="main">-</span> <span class="var">?f</span> <span class="skolem">m</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">-</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">m</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> EqAbs1 corr_q_tq corr_l_tq corr_m_tq theta_bound
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">-</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this EqAbs3  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?f</span> <span class="skolem">l</span> <span class="main">-</span> <span class="var">?f</span> <span class="skolem">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cond2a<span class="main">:</span> <span class="quoted"><span class="quoted">"okRead1 <span class="var">?f</span> <span class="var">?Y</span> <span class="var">?ppred</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okRead1_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="var">?ppred</span> <span class="bound">l</span> <span class="main">∧</span> <span class="var">?ppred</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="main">¦</span><span class="var">?g</span> <span class="bound">l</span> <span class="main">-</span> <span class="var">?g</span> <span class="bound">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">m</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> corr_p corr_l beta_bound1 <span class="keyword1"><span class="command">have</span></span> tli_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="skolem">l</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> corr_p corr_m beta_bound1 <span class="keyword1"><span class="command">have</span></span> tmi_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="skolem">m</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tlm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="skolem">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tli_le_tp tmi_le_tp <span class="keyword1"><span class="command">have</span></span> tlm_le_tp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tlm</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> tlm_le_tp corr_l correct_closed <span class="keyword1"><span class="command">have</span></span> corr_l_tlm<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">l</span> <span class="var">?tlm</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> tlm_le_tp corr_m correct_closed <span class="keyword1"><span class="command">have</span></span> corr_m_tlm<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">m</span> <span class="var">?tlm</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> ind_hyp corr_l_tlm corr_m_tlm
      <span class="keyword1"><span class="command">have</span></span> EqAbs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="skolem">l</span> <span class="free">i</span> <span class="var">?tlm</span> <span class="main">-</span> IC <span class="skolem">m</span> <span class="free">i</span> <span class="var">?tlm</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okmaxsync_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> EqAbs1 corr_p corr_l corr_m theta_bound
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?g</span> <span class="skolem">l</span> <span class="main">-</span> <span class="var">?g</span> <span class="skolem">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cond2b<span class="main">:</span> <span class="quoted"><span class="quoted">"okRead1 <span class="var">?g</span> <span class="var">?Y</span> <span class="var">?ppred</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okRead1_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> correct_count <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"np <span class="main">-</span> maxfaults <span class="main">≤</span> count <span class="var">?ppred</span> np"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this corr_p corr_q cond1 cond2a cond2b prec_enh
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>cfn <span class="free">q</span> <span class="var">?f</span> <span class="main">-</span> cfn <span class="free">p</span> <span class="var">?g</span><span class="main">¦</span> <span class="main">≤</span> π <span class="var">?X</span> <span class="var">?Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> ie3 this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>cfn <span class="free">q</span> <span class="var">?f</span> <span class="main">-</span> cfn <span class="free">p</span> <span class="var">?g</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> γ1_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> this Eq_IC_cfn <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Theorem 4.1 in Shankar's paper.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> four_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> rmin"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie3<span class="main">:</span> <span class="quoted"><span class="quoted">"γ1 <span class="free">δS</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"okmaxsync <span class="free">i</span> <span class="free">δS</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"okmaxsync <span class="main">0</span> <span class="free">δS</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="main">(</span>max <span class="main">(</span>te <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">q</span> <span class="main">(</span>max <span class="main">(</span>te <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> corr_p synch0 <span class="keyword1"><span class="command">have</span></span> cp0<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> corr_q synch0 <span class="keyword1"><span class="command">have</span></span> cq0<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">q</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> synch0 cp0 cq0 IClock
      <span class="keyword1"><span class="command">have</span></span> IC_eq_PC<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="skolem">p</span> <span class="main">0</span> <span class="main">(</span>max <span class="main">(</span>te <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="skolem">q</span> <span class="main">0</span> <span class="main">(</span>max <span class="main">(</span>te <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>
         <span class="main">=</span> <span class="main">¦</span>PC <span class="skolem">p</span> <span class="main">0</span> <span class="main">-</span> PC <span class="skolem">q</span> <span class="main">0</span><span class="main">¦</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T1</span> <span class="main">=</span> <span class="var">?T2</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Adj_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> ie2 init synch0 cp0 <span class="keyword1"><span class="command">have</span></span> range1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> PC <span class="skolem">p</span> <span class="main">0</span> <span class="main">∧</span> PC <span class="skolem">p</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ie2 init synch0 cq0 <span class="keyword1"><span class="command">have</span></span> range2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> PC <span class="skolem">q</span> <span class="main">0</span> <span class="main">∧</span> PC <span class="skolem">q</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T2</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"PC <span class="skolem">p</span> <span class="main">0</span> <span class="main">&lt;</span> PC <span class="skolem">q</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> A range1 range2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> notA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>PC <span class="skolem">p</span> <span class="main">0</span> <span class="main">&lt;</span> PC <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> notA range1 range2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this IC_eq_PC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T1</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okmaxsync_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"okmaxsync <span class="skolem">i</span> <span class="free">δS</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"okmaxsync <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">δS</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="main">(</span>max <span class="main">(</span>te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">q</span> <span class="main">(</span>max <span class="main">(</span>te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tpq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="var">?tp</span> <span class="var">?tq</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="var">?tpq</span> <span class="main">-</span> IC <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="var">?tpq</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tq</span> <span class="main">&lt;</span> <span class="var">?tp</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> A corr_p <span class="keyword1"><span class="command">have</span></span> cp1<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="main">(</span>te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> A corr_q <span class="keyword1"><span class="command">have</span></span> cq1<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">q</span> <span class="main">(</span>te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> A
        <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="main">¦</span>IC <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
                  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="var">?E2</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> A cp1 cq1 corr_p corr_q ind_hyp ie1 ie2 ie3
          four_one_ind_half
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E2</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this Eq1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> notA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?tq</span> <span class="main">&lt;</span> <span class="var">?tp</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this corr_p <span class="keyword1"><span class="command">have</span></span> cp2<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">p</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> notA corr_q <span class="keyword1"><span class="command">have</span></span> cq2<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">q</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> notA
        <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="main">¦</span>IC <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="skolem">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
                  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span>  <span class="main">=</span> <span class="var">?E3</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def abs_minus_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> notA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?tp</span> <span class="main">≤</span> <span class="var">?tq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this cp2 cq2 ind_hyp ie1 ie2 ie3 four_one_ind_half
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E3</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this Eq2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okmaxsync_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> VC_cfn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"VC <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cfn <span class="free">p</span> <span class="main">(</span>θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ie corr_p VClock <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VC <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> IC <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> corr_p IClock
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IC <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> PC <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> Adj <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PC <span class="free">p</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> Adj <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> cfn <span class="free">p</span> <span class="main">(</span>θ <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Adj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lemma for the inductive case in Theorem 4.2›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> four_two_ind<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> rmin"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie3<span class="main">:</span> <span class="quoted"><span class="quoted">"γ1 <span class="free">δS</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie4<span class="main">:</span> <span class="quoted"><span class="quoted">"γ2 <span class="free">δS</span> <span class="main">≤</span> δ"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie5<span class="main">:</span> <span class="quoted"><span class="quoted">"γ3 <span class="free">δS</span> <span class="main">≤</span> δ"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie6<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> t_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> t_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> t_bound3<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tpq_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> δ"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tpq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">∧</span> te <span class="free">q</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">q</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this  t_bound3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this t_bound3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> ie6 <span class="keyword1"><span class="command">have</span></span> tp_max<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this t_bound2 <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> VClock Eq1 Eq2 corr_p <span class="keyword1"><span class="command">have</span></span> Eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"VC <span class="free">p</span> <span class="free">t</span> <span class="main">=</span> IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> VClock Eq1 A corr_q <span class="keyword1"><span class="command">have</span></span> Eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"VC <span class="free">q</span> <span class="free">t</span> <span class="main">=</span> IC <span class="free">q</span> <span class="free">i</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Eq3 Eq4 <span class="keyword1"><span class="command">have</span></span> Eq5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span> <span class="main">-</span> IC <span class="free">q</span> <span class="free">i</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> t_bound3 corr_p corr_q correct_closed
  <span class="keyword1"><span class="command">have</span></span> corr_tpq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="var">?tpq</span> <span class="main">∧</span> correct <span class="free">q</span> <span class="var">?tpq</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> t_bound3 IC_bd corr_p corr_q
  <span class="keyword1"><span class="command">have</span></span> Eq6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span> <span class="main">-</span> IC <span class="free">q</span> <span class="free">i</span> <span class="free">t</span><span class="main">¦</span>  <span class="main">≤</span> <span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="var">?tpq</span> <span class="main">-</span> IC <span class="free">q</span> <span class="free">i</span> <span class="var">?tpq</span><span class="main">¦</span>
    <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="var">?tpq</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">≤</span> <span class="var">?E2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> ie1 ie2 ie3 four_one <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"okmaxsync <span class="free">i</span> <span class="free">δS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this corr_tpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="var">?tpq</span> <span class="main">-</span> IC <span class="free">q</span> <span class="free">i</span> <span class="var">?tpq</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okmaxsync_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> Eq6 this  <span class="keyword1"><span class="command">have</span></span> Eq7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">≤</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="var">?tpq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> corr_p Eq2 rts0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> rmax"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> <span class="var">?tpq</span> <span class="main">≤</span> rmax"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this constants_ax <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="var">?tpq</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>rmax"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="var">?tpq</span><span class="main">)</span> <span class="main">≤</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>rmax"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this Eq7 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">≤</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>rmax"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this Eq5 ie4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> γ2_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">&lt;</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span>  B<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> ie6 t_bound2
  <span class="keyword1"><span class="command">have</span></span> tp_max<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> max <span class="main">(</span>te <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> this t_bound3 <span class="keyword1"><span class="command">have</span></span> tp_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> tp_max t_bound2 <span class="keyword1"><span class="command">have</span></span> tp_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> tq_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">&lt;</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> C corr_q correct_closed
    <span class="keyword1"><span class="command">have</span></span> corr_q_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> β <span class="main">≤</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> corr_q_t2 rts1d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rmin <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this ie1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> β <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this corr_p corr_q rts2a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">&lt;</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this tp_bound2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> tq_bound1 B <span class="keyword1"><span class="command">have</span></span> tq_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> B tp_bound2 <span class="keyword1"><span class="command">have</span></span> tq_bound3<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> B corr_p correct_closed
  <span class="keyword1"><span class="command">have</span></span> corr_p_tq1<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> B correct_closed corr_q
  <span class="keyword1"><span class="command">have</span></span> corr_q_tq1<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> corr_p_tq1 corr_q_tq1 beta_bound1
  <span class="keyword1"><span class="command">have</span></span> tq_bound4<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> tq_bound1 VClock B corr_q
  <span class="keyword1"><span class="command">have</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"VC <span class="free">q</span> <span class="free">t</span> <span class="main">=</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> VClock tp_bound1 tp_bound2 corr_p
  <span class="keyword1"><span class="command">have</span></span> Eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"VC <span class="free">p</span> <span class="free">t</span> <span class="main">=</span> IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> Eq1 Eq2 <span class="keyword1"><span class="command">have</span></span> Eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">t</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> B corr_p corr_q IC_bd
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="free">t</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span>
     <span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this Eq3
  <span class="keyword1"><span class="command">have</span></span> VC_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span>
    <span class="main">¦</span>IC <span class="free">p</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> tq_bound2 VClock corr_q_tq1
  <span class="keyword1"><span class="command">have</span></span> Eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"VC <span class="free">q</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this tq_bound2 VC_cfn corr_q_tq1
  <span class="keyword1"><span class="command">have</span></span> Eq5<span class="main">:</span> <span class="quoted"><span class="quoted">"IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cfn <span class="free">q</span> <span class="main">(</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">hence</span></span> IC_eq_cfn<span class="main">:</span> <span class="quoted"><span class="quoted">"IC <span class="free">p</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> IC <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    IC <span class="free">p</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cfn <span class="free">q</span> <span class="main">(</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E1</span> <span class="main">=</span> <span class="var">?E2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ppred</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> correct <span class="bound">l</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Λ <span class="main">+</span> <span class="free">δS</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span>rmax <span class="main">+</span> β<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="var">?ppred</span> <span class="bound">l</span> <span class="main">∧</span> <span class="var">?ppred</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="main">¦</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">l</span> <span class="main">-</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="main">::</span> <span class="quoted">process</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">process</span>
      <span class="keyword3"><span class="command">assume</span></span> corr_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppred</span> <span class="skolem">m</span>"</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tlm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="skolem">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>te <span class="skolem">m</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> tlm_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tlm</span> <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> corr_l corr_q_tq1 beta_bound1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="skolem">l</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> corr_m corr_q_tq1 beta_bound1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="skolem">m</span> <span class="free">i</span> <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> tlm_bound corr_l corr_m correct_closed
      <span class="keyword1"><span class="command">have</span></span> corr_tlm<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="skolem">l</span> <span class="var">?tlm</span> <span class="main">∧</span> correct <span class="skolem">m</span> <span class="var">?tlm</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>IC <span class="skolem">l</span> <span class="free">i</span> <span class="var">?tlm</span> <span class="main">-</span> IC <span class="skolem">m</span> <span class="free">i</span> <span class="var">?tlm</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> ie1 ie2 ie3 four_one  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"okmaxsync <span class="free">i</span> <span class="free">δS</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this corr_tlm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okmaxsync_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> this corr_l corr_m corr_q_tq1 theta_bound
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">-</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> readOK<span class="main">:</span> <span class="quoted"><span class="quoted">"okRead1 <span class="main">(</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?X</span> <span class="var">?ppred</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okRead1_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cfn <span class="free">q</span> <span class="main">(</span>θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"θ <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">p</span> <span class="main">-</span> IC <span class="free">p</span> <span class="free">i</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?E2</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="var">?E3</span> <span class="main">+</span> <span class="var">?E4</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Eq8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?E2</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="var">?E3</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?E4</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> correct_count <span class="keyword1"><span class="command">have</span></span> ppredOK<span class="main">:</span> <span class="quoted"><span class="quoted">"np <span class="main">-</span> maxfaults <span class="main">≤</span> count <span class="var">?ppred</span> np"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> readOK ppredOK corr_p_tq1 corr_q_tq1 acc_prsv
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?E3</span><span class="main">¦</span> <span class="main">≤</span> α <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this Eq8 <span class="keyword1"><span class="command">have</span></span> Eq9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?E2</span><span class="main">¦</span> <span class="main">≤</span> α <span class="var">?X</span> <span class="main">+</span> <span class="main">¦</span><span class="var">?E4</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> corr_p_tq1 corr_q_tq1 readerror
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?E4</span><span class="main">¦</span> <span class="main">≤</span> Λ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this Eq9 <span class="keyword1"><span class="command">have</span></span> Eq10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?E2</span><span class="main">¦</span> <span class="main">≤</span> α <span class="var">?X</span> <span class="main">+</span> Λ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> this VC_split IC_eq_cfn
  <span class="keyword1"><span class="command">have</span></span> almost_right<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span>
     α <span class="var">?X</span> <span class="main">+</span> Λ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> β"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> β<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> β <span class="main">≤</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this corr_p corr_q rts2a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">&lt;</span> te <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this tp_bound2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> this constants_ax
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"α <span class="var">?X</span> <span class="main">+</span> Λ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> te <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
        <span class="main">≤</span> α <span class="var">?X</span> <span class="main">+</span> Λ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>β"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> this almost_right
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> α <span class="var">?X</span> <span class="main">+</span> Λ <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>ρ<span class="main">*</span>β"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

  <span class="keyword1"><span class="command">from</span></span> this ie5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> γ3_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Theorem 4.2 in Shankar's paper.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> four_two<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> rmin"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie3<span class="main">:</span> <span class="quoted"><span class="quoted">"γ1 <span class="free">δS</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie4<span class="main">:</span> <span class="quoted"><span class="quoted">"γ2 <span class="free">δS</span> <span class="main">≤</span> δ"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie5<span class="main">:</span> <span class="quoted"><span class="quoted">"γ3 <span class="free">δS</span> <span class="main">≤</span> δ"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">time</span>
      <span class="keyword3"><span class="command">assume</span></span> t_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> t_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> t_bound2 synch0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this t_bound1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="skolem">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> δ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okClocks_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">time</span>
      <span class="keyword3"><span class="command">assume</span></span> t_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> t_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_p<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> corr_q<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">q</span> <span class="skolem">t</span>"</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tpq1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tpq2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="skolem">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> δ"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> tpq_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tpq1</span> <span class="main">&lt;</span> <span class="var">?tpq2</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?tpq1</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> t_bound1 this  corr_p corr_q ind_hyp
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okClocks_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?tpq1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> tpq_le_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tpq1</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>

            <span class="keyword1"><span class="command">from</span></span> this tpq_le_t tpq_bound ie1 ie2 ie3 ie4 ie5
              ind_hyp t_bound1 t_bound2
              corr_p corr_q tpq_bound four_two_ind
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">from</span></span> ind_hyp okClocks_sym <span class="keyword1"><span class="command">have</span></span> ind_hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"okClocks <span class="free">q</span> <span class="free">p</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">have</span></span> maxsym1<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> maxsym2<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> maxsym1 t_bound2
            <span class="keyword1"><span class="command">have</span></span> t_bound21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">from</span></span> maxsym1 maxsym2 tpq_bound
            <span class="keyword1"><span class="command">have</span></span> tpq_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> maxsym2 tpq_le_t
            <span class="keyword1"><span class="command">have</span></span> tpq_le_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">from</span></span> B tpq_le_t1 tpq_bound1 ie1 ie2 ie3 ie4 ie5
              ind_hyp1 t_bound1 t_bound21
              corr_p corr_q tpq_bound four_two_ind
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">q</span> <span class="skolem">t</span> <span class="main">-</span> VC <span class="free">p</span> <span class="skolem">t</span><span class="main">¦</span> <span class="main">≤</span> δ"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?tpq1</span> <span class="main">&lt;</span> <span class="var">?tpq2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?tpq2</span> <span class="main">≤</span> <span class="var">?tpq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">from</span></span> t_bound2 this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="var">?tpq1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">from</span></span> t_bound1 this corr_p corr_q ind_hyp
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okClocks_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okClocks_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The main theorem: all correct clocks are synchronized within the
bound delta.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> agreement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"β <span class="main">≤</span> rmin"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie3<span class="main">:</span> <span class="quoted"><span class="quoted">"γ1 <span class="free">δS</span> <span class="main">≤</span> <span class="free">δS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie4<span class="main">:</span> <span class="quoted"><span class="quoted">"γ2 <span class="free">δS</span> <span class="main">≤</span> δ"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie5<span class="main">:</span> <span class="quoted"><span class="quoted">"γ3 <span class="free">δS</span> <span class="main">≤</span> δ"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ie6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cpq<span class="main">:</span> <span class="quoted"><span class="quoted">"correct <span class="free">p</span> <span class="free">t</span> <span class="main">∧</span> correct <span class="free">q</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>VC <span class="free">p</span> <span class="free">t</span> <span class="main">-</span> VC <span class="free">q</span> <span class="free">t</span><span class="main">¦</span> <span class="main">≤</span> δ"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ie6 cpq event_bound <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span> <span class="main">::</span> nat<span class="main">.</span> <span class="free">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span>  <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> t_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> max <span class="main">(</span>te <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>te <span class="free">q</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">from</span></span> t_bound ie1 ie2 ie3 ie4 ie5 four_two <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"okClocks <span class="free">p</span> <span class="free">q</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> ie6 this t_bound cpq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> okClocks_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>