<div id="GenClock">
<div class="head"><h1>Theory GenClock</h1>
<span class="command">theory</span> <span class="name">GenClock</span><br/>
<span class="keyword">imports</span> <a href="../../HOL/HOL/Complex_Main.html"><span class="name">Complex_Main</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*  Title:       Formalization of Schneider's generalized clock synchronization protocol.
    Author:      Alwen Tiu, LORIA, June 11, 2005
    Maintainer:  Alwen Tiu &lt;Alwen.Tiu at loria.fr&gt;
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>GenClock</span><span> </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Complex_Main</span><span> </span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Types and constants definitions›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Process is represented by natural numbers. The type 'event' corresponds
to synchronization rounds.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span>process</span><span> </span><span class="delimiter">=</span><span> </span><span>nat</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span>event</span><span> </span><span class="delimiter">=</span><span> </span><span>nat</span><span>      </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* synchronization rounds *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span>time</span><span> </span><span class="delimiter">=</span><span> </span><span>real</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span>Clocktime</span><span> </span><span class="delimiter">=</span><span> </span><span>real</span><span>
</span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span>
</span><span>  </span><span>δ</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>μ</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>ρ</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>rmin</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>rmax</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>β</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>Λ</span><span> </span><span class="delimiter">::</span><span> </span><span>real</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Number of processes *)</span></span></span></span></span><span>
</span><span>  </span><span>np</span><span> </span><span class="delimiter">::</span><span> </span><span>process</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>maxfaults</span><span> </span><span class="delimiter">::</span><span> </span><span>process</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Physical clocks *)</span></span></span></span></span><span>
</span><span>  </span><span>PC</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, time] ⇒ Clocktime"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Virtual / Logical clocks *)</span></span></span></span></span><span>
</span><span>  </span><span>VC</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, time] ⇒ Clocktime"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Starting (real) time of synchronization rounds *)</span></span></span></span></span><span>
</span><span>  </span><span>te</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, event] ⇒ time"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Clock readings at each round *)</span></span></span></span></span><span>
</span><span>  </span><span>θ</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, event] ⇒ (process ⇒ Clocktime)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Logical clock in-effect at a time interval *)</span></span></span></span></span><span>
</span><span>  </span><span>IC</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, event, time] ⇒ Clocktime"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Correct clocks *)</span></span></span></span></span><span>
</span><span>  </span><span>correct</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, time] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* The averaging function to calculate clock adjustment *)</span></span></span></span></span><span>
</span><span>  </span><span>cfn</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, (process ⇒ Clocktime)] ⇒ Clocktime"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>
</span><span>  </span><span>π</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[Clocktime, Clocktime] ⇒ Clocktime"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>
</span><span>  </span><span>α</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"Clocktime ⇒ Clocktime"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>count</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process ⇒ bool, process] ⇒ nat"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"count f n = card {p. p &lt; n ∧ f p}"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Adjustment to a clock *)</span></span></span></span></span><span>
</span><span>  </span><span>Adj</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, event] ⇒ Clocktime"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"Adj = (λ p i. if 0 &lt; i then cfn p (θ p i) - PC p (te p i)
                 else 0)"</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* Auxilary predicates used in the definition of precision enhancement *)</span></span></span></span></span><span>
</span><span>  </span><span>okRead1</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process ⇒ Clocktime, Clocktime, process ⇒ bool] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"okRead1 f x ppred ⟷ (∀ l m. ppred l ∧ ppred m ⟶ ¦f l - f m¦ ≤ x)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>okRead2</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process ⇒ Clocktime, process ⇒ Clocktime, Clocktime, 
               process ⇒ bool] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"okRead2 f g x ppred ⟷ (∀ p. ppred p ⟶ ¦f p - g p¦ ≤ x)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>rho_bound1</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[[process, time] ⇒ Clocktime] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"rho_bound1 C ⟷ (∀ p s t. correct p t ∧ s ≤ t ⟶ C p t - C p s ≤ (t - s)*(1 + ρ))"</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>rho_bound2</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[[process, time] ⇒ Clocktime] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"rho_bound2 C ⟷ (∀ p s t. correct p t ∧ s ≤ t ⟶ (t - s)*(1 - ρ) ≤ C p t - C p s)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Clock conditions›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Some general assumptions›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>constants_ax</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 &lt; β ∧ 0 &lt; μ ∧ 0 &lt; rmin 
  ∧ rmin ≤ rmax ∧ 0 &lt; ρ ∧ 0 &lt; np ∧ maxfaults ≤ np"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>PC_monotone</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p s t. correct p t ∧ s ≤ t ⟶ PC p s ≤ PC p t"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>VClock</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p t i. correct p t ∧ te p i ≤ t ∧ t &lt; te p (i + 1) ⟶ VC p t = IC p i t"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>IClock</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p t i. correct p t ⟶ IC p i t = PC p t + Adj p i"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 1: initial skew›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>init</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p. correct p 0 ⟶ 0 ≤ PC p 0 ∧ PC p 0 ≤ μ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 2: bounded drift›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>rate_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p s t. correct p t ∧ s ≤ t ⟶ PC p t - PC p s ≤ (t - s)*(1 + ρ)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>rate_2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p s t. correct p t ∧ s ≤ t ⟶ (t - s)*(1 - ρ) ≤ PC p t - PC p s"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 3: bounded interval›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>rts0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p t i. correct p t ∧ t ≤ te p (i+1) ⟶ t - te p i ≤ rmax"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>rts1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p t i. correct p t ∧ te p (i+1) ≤ t ⟶ rmin ≤ t - te p i"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 4 : bounded delay›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>rts2a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p q t i. correct p t ∧ correct q t ∧ te q i + β ≤ t ⟶ te p i ≤ t"</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>rts2b</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p q i. correct p (te p i) ∧ correct q (te q i) ⟶ abs(te p i - te q i) ≤ β"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 5: initial synchronization›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>synch0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p. te p 0 = 0"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 6: nonoverlap›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>nonoverlap</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ rmin"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 7: reading errors›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>readerror</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p q i. correct p (te p (i+1)) ∧ correct q (te p (i+1)) ⟶ 
              abs(θ p (i+1) q - IC q i (te p (i+1))) ≤ Λ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 8: bounded faults›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>correct_closed</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p s t. s ≤ t ∧ correct p t ⟶ correct p s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>correct_count</span><span class="delimiter">:</span><span>  </span><span class="string"><span class="delete"><span class="delete">"∀ t. np - maxfaults ≤ count (λ p. correct p t) np"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 9: Translation invariance›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>trans_inv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ p f x. 0 ≤ x ⟶ cfn p (λ y. f y + x) = cfn p f + x"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 10: precision enhancement›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>prec_enh</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"∀ ppred p q f g x y. 
          np - maxfaults ≤ count ppred np ∧ 
          okRead1 f y ppred ∧ okRead1 g y ppred ∧ 
          okRead2 f g x ppred ∧ ppred p ∧ ppred q 
      ⟶ abs(cfn p f - cfn q g) ≤ π x y"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Condition 11: accuracy preservation›</span></span></span><span>
</span><span class="keyword1"><span class="command">axiomatization</span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>acc_prsv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"∀ ppred p q f x. okRead1 f x ppred ∧ np - maxfaults ≤ count ppred np
          ∧ ppred p ∧ ppred q ⟶ abs(cfn p f - f q) ≤ α x"</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Some derived properties of clocks›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rts0d</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) - te p i ≤ rmax"</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>rts0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rts1d</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"rmin ≤ te p (i+1) - te p i"</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>rts1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rte</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ te p (i+1)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>rts1d</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"rmin ≤ te p (i+1) - te p i"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>constants_ax</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>beta_bound1</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ te p (i+1) - te q i"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>rte</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_pi</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>rts1d</span><span> </span><span>nonoverlap</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"rmin ≤ te p (i+1) - te p i"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>nonoverlap</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ te p (i+1) - te p i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i + β ≤ te p (i+1)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>rts2a</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te q i ≤ te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>beta_bound2</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q i)"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) - te q i ≤ rmax + β"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>rte</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_pi</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) - te q i =
    (te p (i+1) - te p i) + (te p i - te q i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q</span><span> </span><span>corr_pi</span><span> </span><span>rts2b</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"abs(te p i - te q i) ≤ β"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i - te q i ≤ β"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te q i ≤ te p i"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (te q i ≤ te p i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>rts0d</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) - te p i ≤ rmax"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>split</span><span> </span><span>Eq2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Bounded-drift for logical clocks (IC)›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bd</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≤ t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rb1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound1 C"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rb2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound2 D"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>PC_ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"D q t - D q s ≤ C p t - C p s"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦ C p t - D q t ¦  ≤ ¦ C p s - D q s ¦ + 2*ρ*(t - s)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Dt</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"C p t - D q t"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Ds</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"C p s - D q s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Bp</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"C p t - C p s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Bq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"D q t - D q s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?I</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"t - s"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦ ?Bp - ?Bq ¦ ≤ 2*ρ*(t - s)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>PC_ie</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦ ?Bp - ?Bq ¦ = ?Bp - ?Bq"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>ie</span><span> </span><span>rb1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?Bp - ?Bq ≤ ?I*(1+ρ) - ?Bq"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 ≤ ?E2"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rho_bound1_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q</span><span> </span><span>ie</span><span> </span><span>rb2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?I*(1 - ρ) ≤ ?Bq"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rho_bound2_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?E2 ≤ ?I*(1+ρ) - ?I*(1 - ρ)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?I*(1+ρ) - ?I*(1 - ρ) = 2*ρ*?I"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>algebra_simps</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span>Eq3</span><span> </span><span>Eq4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?Dt¦  ≤ ¦?Bp - ?Bq¦  + ¦?Ds¦"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bounded_drift</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≤ t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rb1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound1 C"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rb2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound2 C"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rb3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound1 D"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rb4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound2 D"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦C p t - D q t¦ ≤ ¦C p s - D q s¦  + 2*ρ*(t - s)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Bp</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"C p t - C p s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Bq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"D q t - D q s"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?Bq ≤ ?Bp"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>ie</span><span> </span><span>rb1</span><span> </span><span>rb4</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>bd</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (?Bq ≤ ?Bp)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?Bp ≤ ?Bq"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>ie</span><span> </span><span>rb2</span><span> </span><span>rb3</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>bd</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦D q t - C p t¦  ≤ ¦D q s - C p s¦ + 2*ρ*(t - s)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_minus_commute</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Drift rate of logical clocks›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>IC_rate1</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">"rho_bound1 (λ p t. IC p i t)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p</span><span class="delimiter">::</span><span>process</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span class="delimiter">::</span><span>time</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>t</span><span class="delimiter">::</span><span>time</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≤ t"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>ie</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cps</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p s"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p i t - IC p i s ≤ (t - s)*(1+ρ)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>IClock</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p i t = PC p t + Adj p i"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cps</span><span> </span><span>IClock</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p i s = PC p s + Adj p i"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>ie</span><span> </span><span>rate_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"PC p t - PC p s ≤ (t - s)*(1+ρ)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rho_bound1_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>IC_rate2</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">"rho_bound2 (λ p t. IC p i t)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p</span><span class="delimiter">::</span><span>process</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span class="delimiter">::</span><span>time</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>t</span><span class="delimiter">::</span><span>time</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≤ t"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>ie</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cps</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p s"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(t - s)*(1 - ρ) ≤ IC p i t - IC p i s"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>IClock</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p i t = PC p t + Adj p i"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cps</span><span> </span><span>IClock</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p i s = PC p s + Adj p i"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp</span><span> </span><span>ie</span><span> </span><span>rate_2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(t - s)*(1-ρ) ≤ PC p t - PC p s"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rho_bound2_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Auxilary function ‹ICf›: we introduce this to avoid some
unification problem in some tactic of isabelle.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>ICf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat ⇒ (process ⇒ time ⇒ Clocktime)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ICf i = (λ p t. IC p i t)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>IC_bd</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≤ t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p i t - IC q j t¦ ≤ ¦IC p i s - IC q j s¦ + 2*ρ*(t - s)"</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?C</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"ICf i"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?D</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"ICf j"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?G</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?C p t - ?D q t¦ ≤ ¦?C p s - ?D q s¦ + 2*ρ*(t - s)"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>IC_rate1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rb1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound1 (ICf i) ∧ rho_bound1 (ICf j)"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ICf_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>IC_rate2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rb2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"rho_bound2 (ICf i) ∧ rho_bound2 (ICf j)"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ICf_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>rb1</span><span> </span><span>rb2</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>bounded_drift</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?G</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ICf_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>event_bound</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ (t::real)"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃ i. t &lt; max (te p i) (te q i)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (∃ i. t &lt; max (te p i) (te q i))"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ i. te p i ≤ t"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; max (te p i) (te q i))"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p i) (te q i) ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ max (te p i) (te q i)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ (i :: nat). correct p (te p i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>correct_closed</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p i)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ (i :: nat). real i * rmin ≤ te p i"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin ≤ te p i"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>synch0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real (0::nat) * rmin ≤ te p 0"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ind_hyp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin ≤ te p i"</span></span></span><span>
</span><span>        
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real (Suc i) * rmin ≤ te p (Suc i)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin + rmin = (real i + 1)*rmin"</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>distrib_right</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"real i + 1 = real (i+1)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin + rmin = real (i+1) * rmin"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p i)"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>cp1</span><span> </span><span>rts1d</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"rmin ≤ te p (i+1) - te p i"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>Eq4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i + rmin ≤ te p (i+1)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ind_hyp</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin + rmin ≤ te p i + rmin"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin + rmin ≤ te p (i+1)"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ (i::nat). real i * rmin ≤ t"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span class="delimiter">::</span><span>nat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin ≤ te p i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real i * rmin ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>constants_ax</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"0 &lt; rmin"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>reals_Archimedean3</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Archi</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"∃ (k::nat). t &lt; real k * rmin"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Archi</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span class="delimiter">::</span><span>nat</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>C</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; real k * rmin"</span></span></span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"real k * rmin ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>notC</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; real k * rmin)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>C</span><span> </span><span>notC</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Agreement property›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"γ1 x = π (2*ρ*β + 2*Λ) (2*Λ + x + 2*ρ*(rmax + β))"</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"γ2 x = x + 2*ρ*rmax"</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"γ3 x = α (2*Λ + x + 2*ρ*(rmax + β)) + Λ + 2*ρ*β"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>okmaxsync</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[nat, Clocktime] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"okmaxsync i x ⟷ (∀ p q. correct p (max (te p i) (te q i))
     ∧ correct q (max (te p i) (te q i)) ⟶ 
       ¦IC p i (max (te p i) (te q i)) - IC q i (max (te p i) (te q i))¦ ≤ x)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>
</span><span>  </span><span>okClocks</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"[process, process, nat] ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"okClocks p q i ⟷ (∀ t. 0 ≤ t ∧ t &lt; max (te p i) (te q i)
        ∧ correct p t ∧ correct q t 
     ⟶ ¦VC p t - VC q t¦ ≤ δ)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>okClocks_sym</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ok_pq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q i"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks q p i"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>t</span><span> </span><span class="delimiter">::</span><span> </span><span>time</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ t"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ie2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; max (te q i) (te p i)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te q i) (te p i) = max (te p i) (te q i)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>ok_pq</span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC q t - VC p t¦ ≤ δ"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_minus_commute</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ICp_Suc</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p (i+1) (te p (i+1)) = cfn p (θ p (i+1)) "</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>corr_p</span><span> </span><span>IClock</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Adj_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>IC_trans_inv</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ te p (i+1)"</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span class="string"><span class="delete"><span class="delete">"IC q (i+1) (te p (i+1)) =  
  cfn q (λ n. θ q (i+1) n + (PC q (te p (i+1)) - PC q (te q (i+1))))"</span></span></span><span>
</span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?T1 = ?T2"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?X</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"PC q (te p (i+1)) - PC q (te q (i+1))"</span></span></span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q</span><span> </span><span>ie1</span><span> </span><span>PC_monotone</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>posX</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ ?X"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>IClock</span><span> </span><span>corr_q</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?T1 = cfn q (θ q (i+1)) + ?X"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Adj_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>posX</span><span> </span><span>trans_inv</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>beta_rho</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ te p (i+1)"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦(PC l (te p (i+1)) - PC l (te q (i+1))) - (te p (i+1) - te q (i+1))¦ ≤ β*ρ"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?X</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"(PC l (te p (i+1)) - PC l (te q (i+1)))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?D</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) - te q (i+1)"</span></span></span><span> 
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>posD</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ ?D"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>PC_monotone</span><span> </span><span>corr_l</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>posX</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ ?X"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_l</span><span> </span><span>rate_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?X ≤ ?D * (1 + ρ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te q (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>blast</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_q</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_q_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q_tq</span><span> </span><span>corr_p</span><span> </span><span>rts2b</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?D¦ ≤ β"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>constants_ax</span><span> </span><span>posD</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>D_beta</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?D*ρ ≤ β*ρ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?D ≤ ?X"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>posX</span><span> </span><span>posD</span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>absEq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?X - ?D¦ = ?X - ?D"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bound2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?X - ?D ≤ ?D*ρ"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>mult.commute</span><span> </span><span>distrib_right</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>D_beta</span><span> </span><span>absEq</span><span> </span><span>bound2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>notA</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (?D ≤ ?X)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>absEq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?X - ?D¦ = ?D - ?X"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_l</span><span> </span><span>rate_2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bound3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?D*(1 - ρ) ≤ ?X"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?D - ?X ≤ ?D*ρ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>algebra_simps</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>absEq2</span><span> </span><span>D_beta</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹This lemma (and the next one pe-cond2) proves an assumption used 
in the precision enhancement.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pe_cond1</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ te p (i+1)"</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te p (i + 1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ q (i+1) l + (PC q (te p (i+1)) - PC q (te q (i+1))) - 
           θ p (i+1) l¦ ≤ 2* ρ * β + 2*Λ"</span></span></span><span>
</span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?M ≤ ?N"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Xl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"(PC l (te p (i+1)) - PC l (te q (i+1)))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Xq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"(PC q (te p (i+1)) - PC q (te q (i+1)))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?D</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) - te q (i+1)"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?T</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ p (i+1) l - θ q (i+1) l"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?RE1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ p (i+1) l - IC l i (te p (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?RE2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ q (i+1) l - IC l i (te q (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?ICT</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC l i (te p (i+1)) - IC l i (te q (i+1))"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?M = ¦(?Xq - ?D) - (?T - ?D)¦"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>Split</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?M ≤ ¦?Xq - ?D¦ + ¦?T - ?D¦"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_q</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_q_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>blast</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te q (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>corr_l</span><span> </span><span>ie</span><span> </span><span>beta_rho</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>XlD</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?Xl - ?D¦ ≤ β*ρ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>ie</span><span> </span><span>beta_rho</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>XqD</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?Xq - ?D¦ ≤ β*ρ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>TD</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?T - ?D¦ ≤ 2*Λ + β*ρ"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?T - ?D¦ = ¦(?T - ?ICT) + (?ICT - ?D)¦"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 = ?E2"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?E2 ≤ ¦?T - ?ICT¦ + ¦?ICT - ?D¦"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?T - ?ICT¦ ≤  ¦?RE1¦ + ¦?RE2¦"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>readerror</span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?RE1¦ ≤ Λ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>     
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_l_tq</span><span> </span><span>corr_q_tq</span><span> </span><span>this</span><span> </span><span>readerror</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?RE2¦ ≤ Λ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq3</span><span> </span><span>Eq4</span><span> </span><span>Eq5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?T - ?ICT¦ ≤ 2*Λ"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ICT - ?D = ?Xl - ?D"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>rte</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tpi</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te p i)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q_tq</span><span> </span><span>rte</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te q i ≤ te q (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_l_tq</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tqi</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te q i)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>IClock</span><span> </span><span>corr_l</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC l i (te p (i+1)) = PC l (te p (i+1)) + Adj l i"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>IClock</span><span> </span><span>corr_l_tq</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC l i (te q (i+1)) = PC l (te q (i+1)) + Adj l i"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F1</span><span> </span><span>F2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>XlD</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?ICT - ?D¦ ≤ β*ρ"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span>Eq6</span><span> </span><span>Eq8</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Split</span><span> </span><span>XqD</span><span> </span><span>TD</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?M ≤ 2* β * ρ + 2*Λ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"2 * ρ * β + 2*Λ = 2* β * ρ + 2*Λ"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>F1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>only</span><span class="delimiter">:</span><span> </span><span>F2</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pe_cond2</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te m i ≤ te l i"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_k</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct k (te k (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_l_tk</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te k (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_m_tk</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct m (te k (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ind_hyp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC l i (te l i) - IC m i (te l i)¦ ≤ δS"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ k (i+1) l - θ k (i+1) m¦ ≤ 2*Λ + δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?X</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ k (i+1) l - θ k (i+1) m"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?N</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"2*Λ + δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?D1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ k (i+1) l - IC l i (te k (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?D2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ k (i+1) m - IC m i (te k (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?ICS</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC l i (te k (i+1)) - IC m i (te k (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tlm</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?IC</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC l i ?tlm - IC m i ?tlm"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?X¦ = ¦(?D1 - ?D2) + ?ICS¦"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 = ?E2"</span></span></span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?E2 ≤ ¦?D1 - ?D2¦ + ¦?ICS¦"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_l_tk</span><span> </span><span>corr_k</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ie_lk</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i ≤ te k (i+1)"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_l_tk</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te l i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie_lk</span><span> </span><span>corr_l_tk</span><span> </span><span>corr_m_tk</span><span> </span><span>IC_bd</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?ICS¦ ≤ ¦?IC¦ + 2*ρ*(te k (i+1) - ?tlm)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>ind_hyp</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?ICS¦ ≤ δS + 2*ρ*(te k (i+1) - ?tlm)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_l</span><span> </span><span>corr_k</span><span> </span><span>beta_bound2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te k (i+1) - ?tlm ≤ rmax + β"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>constants_ax</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"2*ρ*(te k (i+1) - ?tlm) ≤ 2*ρ*(rmax + β)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>real_mult_le_cancel_iff2</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq4a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?ICS¦ ≤ δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_k</span><span> </span><span>corr_l_tk</span><span> </span><span>readerror</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?D1¦ ≤ Λ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_k</span><span> </span><span>corr_m_tk</span><span> </span><span>readerror</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?D2¦ ≤ Λ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?D1 - ?D2¦ ≤ ¦?D1¦ + ¦?D2¦"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq5</span><span> </span><span>Eq6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?D1 - ?D2¦ ≤ 2*Λ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span>Eq4a</span><span> </span><span>Eq7</span><span> </span><span>split</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>theta_bound</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_m</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct m (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IC_bound</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"¦IC l i (max (te l i) (te m i)) - IC m i (max (te l i) (te m i))¦
      ≤ δS"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ p (i+1) l - θ p (i+1) m¦
       ≤  2*Λ + δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tli_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i ≤ te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_m</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tmi_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te m i ≤ te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tml</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te l i) (te m i)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tli_le_tp</span><span> </span><span>tmi_le_tp</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tml_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tml ≤ te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tml_le_tp</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tml</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l ?tml"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tml_le_tp</span><span> </span><span>corr_m</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_m_tml</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct m ?tml"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Y</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"2*Λ + δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ p (i+1) l - θ p (i+1) m¦ ≤ ?Y"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te m i &lt; te l i"</span></span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>IC_bound</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC l i (te l i) - IC m i (te l i)¦ ≤ δS"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>A</span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> </span><span>corr_m</span><span> </span><span>pe_cond2</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (te m i &lt; te l i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i ≤ te m i"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>IC_bound</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC l i (te m i) - IC m i (te m i)¦ ≤ δS"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC m i (te m i) - IC l i (te m i)¦ ≤ δS"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_minus_commute</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq1</span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> </span><span>corr_m</span><span> </span><span>pe_cond2</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ p (i+1) m - θ p (i+1) l¦ ≤ ?Y"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_minus_commute</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>four_one_ind_half</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ rmin"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"μ ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ1 δS ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ind_hyp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync i δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ te p (i+1)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te p (i+1))"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p (i+1) (te p (i+1)) - IC q (i+1) (te p (i+1))¦ ≤ δS"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tpq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1)"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?f</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"λ n. θ q (i+1) n + (PC q (te p (i+1)) - PC q (te q (i+1)))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?g</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ p (i+1)"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie4</span><span> </span><span>corr_q</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_q_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq_IC_cfn</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p (i+1) ?tpq - IC q (i+1) ?tpq¦ = 
    ¦cfn q ?f - cfn p ?g¦"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>ICp_Suc</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p (i+1) ?tpq = cfn p ?g"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie4</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>IC_trans_inv</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC q (i+1) ?tpq = cfn q ?f"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?ppred</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"λ l. correct l (te p (i+1))"</span></span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?X</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"2*ρ*β + 2*Λ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ l. ?ppred l ⟶ ¦?f l - ?g l¦ ≤ ?X"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred l"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie4</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>this</span><span> </span><span>pe_cond1</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?f l - ?g l¦ ≤ (2*ρ*β + 2*Λ)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>cond1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okRead2 ?f ?g ?X ?ppred"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okRead2_def</span><span class="delimiter">)</span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Y</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"2*Λ + δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ l m. ?ppred l ∧ ?ppred m ⟶ ¦?f l - ?f m¦ ≤ ?Y"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span> </span><span>m</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred l"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_m</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred m"</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tli_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_m</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tmi_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te m i ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tlm</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te l i) (te m i)"</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tli_le_tp</span><span> </span><span>tmi_le_tp</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tlm_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tlm ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie4</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l (te q (i+1))"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie4</span><span> </span><span>corr_m</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_m_tq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct m (te q (i+1))"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tlm_le_tp</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tlm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l ?tlm"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tlm_le_tp</span><span> </span><span>corr_m</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_m_tlm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct m ?tlm"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ind_hyp</span><span> </span><span>corr_l_tlm</span><span> </span><span>corr_m_tlm</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>EqAbs1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC l i ?tlm - IC m i ?tlm¦ ≤ δS"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okmaxsync_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>EqAbs3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?f l - ?f m¦ = ¦θ q (i+1) l - θ q (i+1) m¦"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>EqAbs1</span><span> </span><span>corr_q_tq</span><span> </span><span>corr_l_tq</span><span> </span><span>corr_m_tq</span><span> </span><span>theta_bound</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ q (i+1) l - θ q (i+1) m¦ ≤ ?Y"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>EqAbs3</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?f l - ?f m¦ ≤ ?Y"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>cond2a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okRead1 ?f ?Y ?ppred"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okRead1_def</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ l m. ?ppred l ∧ ?ppred m ⟶ ¦?g l - ?g m¦ ≤ ?Y"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span> </span><span>m</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred l"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_m</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred m"</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tli_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>corr_m</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tmi_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te m i ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tlm</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te l i) (te m i)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tli_le_tp</span><span> </span><span>tmi_le_tp</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tlm_le_tp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tlm ≤ te p (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tlm_le_tp</span><span> </span><span>corr_l</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_l_tlm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l ?tlm"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tlm_le_tp</span><span> </span><span>corr_m</span><span> </span><span>correct_closed</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_m_tlm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct m ?tlm"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ind_hyp</span><span> </span><span>corr_l_tlm</span><span> </span><span>corr_m_tlm</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>EqAbs1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC l i ?tlm - IC m i ?tlm¦ ≤ δS"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okmaxsync_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>EqAbs1</span><span> </span><span>corr_p</span><span> </span><span>corr_l</span><span> </span><span>corr_m</span><span> </span><span>theta_bound</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?g l - ?g m¦ ≤ ?Y"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>cond2b</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okRead1 ?g ?Y ?ppred"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okRead1_def</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>correct_count</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"np - maxfaults ≤ count ?ppred np"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>cond1</span><span> </span><span>cond2a</span><span> </span><span>cond2b</span><span> </span><span>prec_enh</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦cfn q ?f - cfn p ?g¦ ≤ π ?X ?Y"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie3</span><span> </span><span>this</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦cfn q ?f - cfn p ?g¦ ≤ δS"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>γ1_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq_IC_cfn</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Theorem 4.1 in Shankar's paper.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>four_one</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ rmin"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"μ ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ1 δS ≤ δS"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync i δS"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync 0 δS"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p</span><span> </span><span>q</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (max (te p 0) (te q 0))"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (max (te p 0) (te q 0))"</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>synch0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p 0"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q</span><span> </span><span>synch0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cq0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q 0"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>synch0</span><span> </span><span>cp0</span><span> </span><span>cq0</span><span> </span><span>IClock</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>IC_eq_PC</span><span class="delimiter">:</span><span> 
</span><span>        </span><span class="string"><span class="delete"><span class="delete">"¦IC p 0 (max (te p 0) (te q 0)) - IC q 0 (max (te p 0) (te q 0))¦
         = ¦PC p 0 - PC q 0¦"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?T1 = ?T2"</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Adj_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie2</span><span> </span><span>init</span><span> </span><span>synch0</span><span> </span><span>cp0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>range1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ PC p 0 ∧ PC p 0 ≤ δS"</span></span></span><span>  
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie2</span><span> </span><span>init</span><span> </span><span>synch0</span><span> </span><span>cq0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>range2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ PC q 0 ∧ PC q 0 ≤ δS"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?T2 ≤ δS"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">"PC p 0 &lt; PC q 0"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span>range1</span><span> </span><span>range2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>notA</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (PC p 0 &lt; PC q 0)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>notA</span><span> </span><span>range1</span><span> </span><span>range2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>IC_eq_PC</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?T1 ≤ δS"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okmaxsync_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ind_hyp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync i δS"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync (Suc i) δS"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p</span><span> </span><span>q</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (max (te p (i + 1)) (te q (i + 1)))"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (max (te p (i + 1)) (te q (i + 1)))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tp</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i + 1)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i + 1)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tpq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max ?tp ?tq"</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p (i+1) ?tpq - IC q (i+1) ?tpq¦ ≤ δS"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 ≤ δS"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tq &lt; ?tp"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span>corr_p</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span>corr_q</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te p (i+1))"</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 = ¦IC p (i+1) (te p (i+1)) - IC q (i+1) (te p (i+1))¦"</span></span></span><span> 
</span><span>                  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 = ?E2"</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span>cp1</span><span> </span><span>cq1</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>ind_hyp</span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> 
</span><span>          </span><span>four_one_ind_half</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E2 ≤ δS"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>notA</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (?tq &lt; ?tp)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te q (i+1))"</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>notA</span><span> </span><span>corr_q</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q (i+1))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>notA</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 = ¦IC q (i+1) (te q (i+1)) - IC p (i+1) (te q (i+1))¦"</span></span></span><span> 
</span><span>                  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1  = ?E3"</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span> </span><span>abs_minus_commute</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>notA</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?tp ≤ ?tq"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>cp2</span><span> </span><span>cq2</span><span> </span><span>ind_hyp</span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> </span><span>four_one_ind_half</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E3 ≤ δS"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okmaxsync_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>VC_cfn</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te p (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) &lt; te p (i+2)"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"VC p (te p (i+1)) = cfn p (θ p (i+1))"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie</span><span> </span><span>corr_p</span><span> </span><span>VClock</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"VC p (te p (i+1)) = IC p (i+1) (te p (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>IClock</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p (i+1) (te p (i+1)) = PC p (te p (i+1)) + Adj p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"PC p (te p (i+1)) + Adj p (i+1) = cfn p (θ p (i+1))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Adj_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Lemma for the inductive case in Theorem 4.2›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>four_two_ind</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ rmin"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"μ ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ1 δS ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ2 δS ≤ δ"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ3 δS ≤ δ"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ te p (i+1)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ind_hyp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q i"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>t_bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>t_bound2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; max (te p (i+1)) (te q (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>t_bound3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p i) (te q i) ≤ t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>tpq_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p i) (te q i) &lt; max (te p (i+1)) (te q (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ δ"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; te q (i+1)"</span></span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tpq</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p i) (te q i)"</span></span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ t ∧ te q i ≤ t"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ te q i"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span>  </span><span>t_bound3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (te p i ≤ te q i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>t_bound3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tp_max</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p (i+1)) (te q (i+1)) = te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>t_bound2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; te p (i+1)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>VClock</span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span>corr_p</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"VC p t = IC p i t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>VClock</span><span> </span><span>Eq1</span><span> </span><span>A</span><span> </span><span>corr_q</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"VC q t = IC q i t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq3</span><span> </span><span>Eq4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ = ¦IC p i t - IC q i t¦"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound3</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>correct_closed</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_tpq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p ?tpq ∧ correct q ?tpq"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>blast</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound3</span><span> </span><span>IC_bd</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p i t - IC q i t¦  ≤ ¦IC p i ?tpq - IC q i ?tpq¦
    + 2*ρ*(t - ?tpq)"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 ≤ ?E2"</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>blast</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> </span><span>four_one</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync i δS"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_tpq</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p i ?tpq - IC q i ?tpq¦ ≤ δS"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okmaxsync_def</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq6</span><span> </span><span>this</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 ≤ δS + 2*ρ*(t - ?tpq)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p</span><span> </span><span>Eq2</span><span> </span><span>rts0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"t - te p i ≤ rmax"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"t - ?tpq ≤ rmax"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>constants_ax</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"2*ρ*(t - ?tpq) ≤ 2*ρ*rmax"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>real_mult_le_cancel_iff1</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"δS + 2*ρ*(t - ?tpq) ≤ δS + 2*ρ*rmax"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 ≤ δS + 2*ρ*rmax"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq5</span><span> </span><span>ie4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>γ2_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; te q (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span>  </span><span>B</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie6</span><span> </span><span>t_bound2</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tp_max</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p (i+1)) (te q (i+1)) = te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ max (te p i) (te q i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>t_bound3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tp_bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tp_max</span><span> </span><span>t_bound2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tp_bound2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; te p (i+1)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tq_bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; te q (i+2)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; te q (i+2))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>C</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+2) ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>C</span><span> </span><span>corr_q</span><span> </span><span>correct_closed</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_q_t2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q (i+2))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) + β ≤ t"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_q_t2</span><span> </span><span>rts1d</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"rmin ≤ te q (i+2) - te q (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>ie1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ te q (i+2) - te q (i+1)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) + β ≤ te q (i+2)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>C</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>rts2a</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) ≤ t"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; te p (i+1))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>tp_bound2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tq_bound1</span><span> </span><span>B</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tq_bound2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) &lt; te q (i+2)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>B</span><span> </span><span>tp_bound2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tq_bound3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) &lt; te p (i+1)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>B</span><span> </span><span>corr_p</span><span> </span><span>correct_closed</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_p_tq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p (te q (i+1))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>B</span><span> </span><span>correct_closed</span><span> </span><span>corr_q</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_q_tq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q (te q (i+1))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p_tq1</span><span> </span><span>corr_q_tq1</span><span> </span><span>beta_bound1</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tq_bound4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p i ≤ te q (i+1)"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tq_bound1</span><span> </span><span>VClock</span><span> </span><span>B</span><span> </span><span>corr_q</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"VC q t = IC q (i+1) t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>VClock</span><span> </span><span>tp_bound1</span><span> </span><span>tp_bound2</span><span> </span><span>corr_p</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"VC p t = IC p i t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>Eq1</span><span> </span><span>Eq2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ = ¦IC p i t - IC q (i+1) t¦"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>B</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>IC_bd</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC p i t - IC q (i+1) t¦ ≤ 
     ¦IC p i (te q (i+1)) - IC q (i+1) (te q (i+1))¦ + 2*ρ*(t - te q (i+1))"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq3</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>VC_split</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ 
    ¦IC p i (te q (i+1)) - IC q (i+1) (te q (i+1))¦ + 2*ρ*(t - te q (i+1))"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tq_bound2</span><span> </span><span>VClock</span><span> </span><span>corr_q_tq1</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"VC q (te q (i+1)) = IC q (i+1) (te q (i+1))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>tq_bound2</span><span> </span><span>VC_cfn</span><span> </span><span>corr_q_tq1</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC q (i+1) (te q (i+1)) = cfn q (θ q (i+1))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>IC_eq_cfn</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"IC p i (te q (i+1)) - IC q (i+1) (te q (i+1)) = 
    IC p i (te q (i+1)) - cfn q (θ q (i+1))"</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?E1 = ?E2"</span></span></span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?f</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ q (i+1)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?ppred</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"λ l. correct l (te q (i+1))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?X</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"2*Λ + δS + 2*ρ*(rmax + β)"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∀ l m. ?ppred l ∧ ?ppred m ⟶ ¦θ q (i+1) l - θ q (i+1) m¦ ≤ ?X"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span> </span><span class="delimiter">::</span><span> </span><span>process</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span> </span><span class="delimiter">::</span><span> </span><span>process</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred l"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_m</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?ppred m"</span></span></span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tlm</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te l i) (te m i)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tlm_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tlm ≤ te q (i+1)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_l</span><span> </span><span>corr_q_tq1</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te l i ≤ te q (i+1)"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_m</span><span> </span><span>corr_q_tq1</span><span> </span><span>beta_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te m i ≤ te q (i+1)"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>le_diff_eq</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>tlm_bound</span><span> </span><span>corr_l</span><span> </span><span>corr_m</span><span> </span><span>correct_closed</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>corr_tlm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct l ?tlm ∧ correct m ?tlm"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦IC l i ?tlm - IC m i ?tlm¦ ≤ δS"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> </span><span>four_one</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okmaxsync i δS"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_tlm</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okmaxsync_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_l</span><span> </span><span>corr_m</span><span> </span><span>corr_q_tq1</span><span> </span><span>theta_bound</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦θ q (i+1) l - θ q (i+1) m¦ ≤ ?X"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>readOK</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okRead1 (θ q (i+1)) ?X ?ppred"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okRead1_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?E3</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"cfn q (θ q (i+1)) - θ q (i+1) p"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?E4</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"θ q (i+1) p - IC p i (te q (i+1))"</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?E2¦ = ¦?E3 + ?E4¦"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>Eq8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?E2¦ ≤ ¦?E3¦ + ¦?E4¦"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_if</span><span class="delimiter">)</span><span>
</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>correct_count</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ppredOK</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"np - maxfaults ≤ count ?ppred np"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>readOK</span><span> </span><span>ppredOK</span><span> </span><span>corr_p_tq1</span><span> </span><span>corr_q_tq1</span><span> </span><span>acc_prsv</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?E3¦ ≤ α ?X"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?E2¦ ≤ α ?X + ¦?E4¦"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>corr_p_tq1</span><span> </span><span>corr_q_tq1</span><span> </span><span>readerror</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?E4¦ ≤ Λ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>Eq9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Eq10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"¦?E2¦ ≤ α ?X + Λ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>VC_split</span><span> </span><span>IC_eq_cfn</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>almost_right</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ 
     α ?X + Λ + 2*ρ*(t - te q (i+1))"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"t - te q (i+1) ≤ β"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t - te q (i+1) ≤ β)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) + β ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>rts2a</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) ≤ t"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; te p (i+1))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>tp_bound2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>constants_ax</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α ?X + Λ + 2*ρ*(t - te q (i+1)) 
        ≤ α ?X + Λ + 2*ρ*β"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>almost_right</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ α ?X + Λ + 2*ρ*β"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>ie5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>γ3_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹Theorem 4.2 in Shankar's paper.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>four_two</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ rmin"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"μ ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ1 δS ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ2 δS ≤ δ"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ3 δS ≤ δ"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q i"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q 0"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>t</span><span> </span><span class="delimiter">::</span><span> </span><span>time</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>t_bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ t"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>t_bound2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; max (te p 0) (te q 0)"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound2</span><span> </span><span>synch0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; 0"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>t_bound1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ δ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span class="delimiter">::</span><span>nat</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ind_hyp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q i"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q (Suc i)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>t</span><span> </span><span class="delimiter">::</span><span> </span><span>time</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>t_bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ t"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>t_bound2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; max (te p (i+1)) (te q (i+1))"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>corr_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct q t"</span></span></span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tpq1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p i) (te q i)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?tpq2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p (i+1)) (te q (i+1))"</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ δ"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>tpq_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tpq1 &lt; ?tpq2"</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; ?tpq1"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound1</span><span> </span><span>this</span><span>  </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>ind_hyp</span><span>
</span><span>          </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (t &lt; ?tpq1)"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>tpq_le_t</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?tpq1 ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>
</span><span>          </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te q (i+1) ≤ te p (i+1)"</span></span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span>tpq_le_t</span><span> </span><span>tpq_bound</span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> </span><span>ie4</span><span> </span><span>ie5</span><span> 
</span><span>              </span><span>ind_hyp</span><span> </span><span>t_bound1</span><span> </span><span>t_bound2</span><span> 
</span><span>              </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>tpq_bound</span><span> </span><span>four_two_ind</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (te q (i+1) ≤ te p (i+1))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>B</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"te p (i+1) ≤ te q (i+1)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ind_hyp</span><span> </span><span>okClocks_sym</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ind_hyp1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks q p i"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>maxsym1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p (i+1)) (te q (i+1)) = max (te q (i+1)) (te p (i+1))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>maxsym2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te p i) (te q i) = max (te q i) (te p i)"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>max_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>maxsym1</span><span> </span><span>t_bound2</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>t_bound21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; max (te q (i+1)) (te p (i+1))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>maxsym1</span><span> </span><span>maxsym2</span><span> </span><span>tpq_bound</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tpq_bound1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te q i) (te p i) &lt; max (te q (i+1)) (te p (i+1))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>maxsym2</span><span> </span><span>tpq_le_t</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tpq_le_t1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"max (te q i) (te p i) ≤ t"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>B</span><span> </span><span>tpq_le_t1</span><span> </span><span>tpq_bound1</span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> </span><span>ie4</span><span> </span><span>ie5</span><span> 
</span><span>              </span><span>ind_hyp1</span><span> </span><span>t_bound1</span><span> </span><span>t_bound21</span><span> 
</span><span>              </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>tpq_bound</span><span> </span><span>four_two_ind</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC q t - VC p t¦ ≤ δ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>abs_minus_commute</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¬ (?tpq1 &lt; ?tpq2)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?tpq2 ≤ ?tpq1"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound2</span><span> </span><span>this</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; ?tpq1"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound1</span><span> </span><span>this</span><span> </span><span>corr_p</span><span> </span><span>corr_q</span><span> </span><span>ind_hyp</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span class="keyword1"><span class="command">text</span></span><span class="cartouche"><span class="delete"><span class="delete">‹The main theorem: all correct clocks are synchronized within the
bound delta.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>agreement</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ie1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β ≤ rmin"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"μ ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ1 δS ≤ δS"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ2 δS ≤ δ"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"γ3 δS ≤ δ"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ie6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"0 ≤ t"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"correct p t ∧ correct q t"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"¦VC p t - VC q t¦ ≤ δ"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie6</span><span> </span><span>cpq</span><span> </span><span>event_bound</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃ i :: nat. t &lt; max (te p i) (te q i)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span>  </span><span class="delimiter">::</span><span> </span><span>nat</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>t_bound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"t &lt; max (te p i) (te q i)"</span></span></span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>t_bound</span><span> </span><span>ie1</span><span> </span><span>ie2</span><span> </span><span>ie3</span><span> </span><span>ie4</span><span> </span><span>ie5</span><span> </span><span>four_two</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"okClocks p q i"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ie6</span><span> </span><span>this</span><span> </span><span>t_bound</span><span> </span><span>cpq</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>okClocks_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div>