<div id="Recursive_Inseparability">
<div class="head">
<h1>Theory Recursive_Inseparability</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Recursive inseperability›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Recursive_Inseparability
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Recursion-Theory-I/RecEnSet.html">Recursion-Theory-I.RecEnSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two sets $A$ and $B$ are recursively inseparable if there is no computable set that
contains $A$ and is disjoint from $B$. In particular, a set is computable if the set and its
complement are recursively inseparable. The terminology was introduced by Smullyan~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> R58<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
The underlying idea can be traced back to Rosser, who essentially showed that provable and
disprovable sentences are \emph{arithmetically} inseparable in Peano Arithmetic~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> R36<span class="antiquote"><span class="antiquote">}</span></span></span></span>;
see also Kleene's symmetric version of Gödel's incompleteness theorem~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> K52<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Here we formalize recursive inseparability on top of the \texttt{Recursion-Theory-I} AFP
entry~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> RTI<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Our main result is a version of Rice' theorem that states that the index
sets of any two given recursively enumerable sets are recursively inseparable.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two sets $A$ and $B$ are recursively inseparable if there are no decidable sets $X$ such
that $A$ is a subset of $X$ and $X$ is disjoint from $B$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rec_inseparable</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rec_inseparable</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⊆</span> <span class="main">-</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="main">¬</span> computable <span class="bound">X</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparableI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">-</span> <span class="bound">X</span> <span class="main">⟹</span> computable <span class="bound">X</span> <span class="main">⟹</span> False<span class="main">)</span> <span class="main">⟹</span> rec_inseparable <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rec_inseparable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparableD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⟹</span> computable <span class="free">X</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rec_inseparable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Recursive inseperability is symmetric and enjoys a monotonicity property.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> rec_inseparable <span class="free">B</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rec_inseparable_def computable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A'</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">B'</span> <span class="main">⟹</span> rec_inseparable <span class="free">A'</span> <span class="free">B'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rec_inseparable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subset_trans<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Many-to-one reductions apply to recursive inseparability as well.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_many_reducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total_recursive <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"rec_inseparable <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rec_inseparable <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> rec_inseparableI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="main">-</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"computable <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"many_reducible_to <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> many_reducible_to_def many_reducible_to_via_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"computable <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> m_red_to_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> rec_inseparable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Recursive inseparability of $A$ and $B$ holds vacuously if $A$ and $B$ are not disjoint.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_collapse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> rec_inseparable <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rec_inseparable_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Recursive inseparability is intimately connected to non-computability.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_non_computable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> rec_inseparable <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">¬</span> computable <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rec_inseparable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> computable_rec_inseparable_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"computable <span class="free">A</span> <span class="main">⟷</span> <span class="main">¬</span> rec_inseparable <span class="free">A</span> <span class="main">(</span><span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> computable_def rec_inseparable_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rice's theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide a stronger version of Rice's theorem compared to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> RTI<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
Unfolding the definition of recursive inseparability, it states that there are no decidable
sets $X$ such that
\begin{itemize}
\item there is a r.e.\ set such that all its indices are elements of $X$; and
\item there is a r.e.\ set such that none of its indices are elements of $X$.
\end{itemize}
This is true even if $X$ is not an index set (i.e., if an index of a r.e.\ set is an element
of $X$, then $X$ contains all indices of that r.e.\ set), which is a requirement of Rice's
theorem in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> RTI<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c_pair_inj'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"c_pair <span class="free">x1</span> <span class="free">y1</span> <span class="main">=</span> c_pair <span class="free">x2</span> <span class="free">y2</span> <span class="main">⟷</span> <span class="free">x1</span> <span class="main">=</span> <span class="free">x2</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">=</span> <span class="free">y2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_fst_of_c_pair c_snd_of_c_pair<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rice_rec_inseparable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="main">{</span><span class="bound">k</span><span class="main">.</span> nat_to_ce_set <span class="bound">k</span> <span class="main">=</span> nat_to_ce_set <span class="free">n</span><span class="main">}</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> nat_to_ce_set <span class="bound">k</span> <span class="main">=</span> nat_to_ce_set <span class="free">m</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> rec_inseparableI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Rice_2<span class="antiquote"><span class="antiquote">}</span></span></span></span> is not applicable because X may not be an index set.›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> s_ce <span class="bound">q</span> <span class="bound">q</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">}</span> <span class="main">×</span> nat_to_ce_set <span class="free">m</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> s_ce <span class="bound">q</span> <span class="bound">q</span> <span class="main">∈</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">}</span> <span class="main">×</span> nat_to_ce_set <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">∈</span> ce_rels"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> ce_set_lm_5 comp2_1<span class="main">[</span><span class="operator">OF</span> s_ce_is_pr id1_1 id1_1<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> computable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ce_union<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ce_rel_to_set <span class="main"><span class="main"><span class="main">_</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ce_rel_to_set <span class="main"><span class="main"><span class="main">_</span></span></span>"</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> ce_rel_lm_32 ce_rel_lm_8<span class="main"><span class="main">]</span></span>
      ce_rel_lm_29 nat_to_ce_set_into_ce<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"nat_to_ce_set <span class="skolem">q</span> <span class="main">=</span> <span class="main">{</span>c_pair <span class="bound">q</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">q</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ce_rel_lm_8 ce_rel_to_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> nat_to_ce_set_srj<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eqset_imp_iff<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"c_pair <span class="skolem">q</span> <span class="main">_</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_ce_set <span class="main">(</span>s_ce <span class="skolem">q</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> s_ce <span class="skolem">q</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="keyword1">then</span> nat_to_ce_set <span class="free">m</span> <span class="keyword1">else</span> nat_to_ce_set <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_lm c_pair_inj' nat_to_ce_set_def fn_to_set_def pr_conv_1_to_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> subsetD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"s_ce <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">q</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Minsky">
<div class="head">
<h1>Theory Minsky</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Minsky machines›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Minsky
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Recursive_Inseparability.html">Recursive_Inseparability</a> <span class="quoted">"<a href="../Abstract-Rewriting/Abstract_Rewriting.html">Abstract-Rewriting.Abstract_Rewriting</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We formalize Minksy machines, and relate them to recursive functions. In our flavor of
Minsky machines, a machine has a set of registers and a set of labels, and a program is a set of
labeled operations. There are two operations, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Inc</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Dec</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; the former takes a
register and a label, and the latter takes a register and two labels. When an <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Inc</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
instruction is executed, the register is incremented and execution continues at the provided label.
The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Dec</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> instruction checks the register. If it is non-zero, the register and continues
execution at the first label. Otherwise, the register remains at zero and execution continues at
the second label.

We continue to show that Minksy machines can implement any primitive recursive function. Based on
that, we encode recursively enumerable sets as Minsky machines, and finally show that
\begin{enumerate}
\item The set of Minsky configurations such that from state $1$, state $0$ can be reached,
  is undecidable;
\item There is a deterministic Minsky machine $U$ such that the set of values $x$ such that
  $(2, \lambda n.\, \text{if $n = 0$ then $x$ else $0$})$ reach state $0$ is recursively
  inseparable from those that reach state $1$; and
\item As a corollary, the set of Minsky configurations that reach state $0$ but not state $1$ is
  recursively inseparable from the configurations that reach state $1$ but not state $0$.
\end{enumerate}›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Deterministic relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A relation $\to$ is \emph{deterministic} if $t \from s \to u'$ implies $t = u$.
This abstract rewriting notion is useful for talking about deterministic Minsky machines.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deterministic</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">¯</span> <span class="keyword1">O</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⊆</span> Id"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deterministicD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deterministic <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deterministic_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deterministic_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"deterministic <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deterministic_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deterministic_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"deterministic <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deterministic_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deterministic_imp_weak_diamond <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"deterministic <span class="free">R</span> <span class="main">⟹</span> <span class="keyword1">w◇</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> weak_diamond_def deterministic_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> deterministic_imp_CR <span class="main">=</span> deterministic_imp_weak_diamond<span class="main">[</span><span class="operator">THEN</span> weak_diamond_imp_CR<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> deterministic_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="free">S</span> <span class="main">∩</span> fst <span class="main">`</span> <span class="free">R</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> deterministic <span class="free">S</span> <span class="main">⟹</span> deterministic <span class="free">R</span> <span class="main">⟹</span> deterministic <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deterministic_def disjoint_iff_not_equal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deterministic_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span>fst <span class="main">`</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> deterministic <span class="free">R</span> <span class="main">⟹</span> deterministic <span class="main">(</span>map_prod <span class="free">f</span> <span class="free">g</span> <span class="main">`</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deterministic_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onD<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Minsky machine definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A Minsky operation either decrements a register (testing for zero, with two possible
successor states), or increments a register (with one successor state). A Minsky machine is a
set of pairs of states and operations.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> Op <span class="main">=</span> Dec <span class="main">(</span><span class="free"><span class="entity">op_var</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'v</span></span></span><span class="main">)</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span> <span class="main">|</span> Inc <span class="main">(</span>op_var<span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'v</span></span></span><span class="main">)</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> minsky <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> Op<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Semantics: A Minsky machine operates on pairs consisting of a state and an assignment of
the registers; in each step, either a register is incremented, or a register is decremented,
provided it is non-zero. We write $\alpha$ for assignments; $\alpha[v]$ for the value of the
register $v$ in $\alpha$ and $\alpha[v := n]$ for the update of $v$ to $n$. Thus, the semantics
is as follows:
\begin{enumerate}
\item if $(s, Inc\ v\ s') \in M$ then $(s, \alpha) \to (s', \alpha[v := \alpha[v] + 1]$);
\item if $(s, Dec\ v\ s_n\ s_z) \in M$ and $\alpha[v] &gt; 0$ then $(s, \alpha) \to (s_n, \alpha[v := \alpha[v] - 1]$); and
\item if $(s, Dec\ v\ s_n\ s_z) \in M$ and $\alpha[v] = 0$ then $(s, \alpha) \to (s_z, \alpha)$.
\end{enumerate}
A state is finite if there is no operation associated with it.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> minsky <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> nat<span class="main">)</span><span class="main">)</span> rel"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Inc <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">step</span> <span class="free">M</span>"</span></span>
<span class="main">|</span> decn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Dec <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">sn</span></span></span> <span class="free"><span class="bound"><span class="entity">sz</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">sn</span></span></span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">step</span> <span class="free">M</span>"</span></span>
<span class="main">|</span> decz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Dec <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">sn</span></span></span> <span class="free"><span class="bound"><span class="entity">sz</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">sz</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">step</span> <span class="free">M</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> <span class="free">M'</span> <span class="main">⟹</span> step <span class="free">M</span> <span class="main">⊆</span> step <span class="free">M'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> step.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> step.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> steps_mono <span class="main">=</span> rtrancl_mono<span class="main">[</span><span class="operator">OF</span> step_mono<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A Minsky machine has deterministic steps if its defining relation between states and
operations is deterministic.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deterministic_stepI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="main">(</span>step <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">s1</span> <span class="skolem">vs1</span> <span class="skolem">s2</span> <span class="skolem">vs2</span>
    <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">s1</span><span class="main">,</span> <span class="skolem">vs1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">vs2</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s1</span><span class="main">,</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">vs2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deterministicD<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> step.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> step.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deterministic_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A Minksy machine halts when it reaches a state with no associated operation.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> NF_stepI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">)</span> <span class="main">∈</span> NF <span class="main">(</span>step <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> no_step <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> step.cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Deterministic Minsky machines enjoy unique normal forms.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> deterministic_minsky_UN <span class="main">=</span>
  join_NF_imp_eq<span class="main">[</span><span class="operator">OF</span> CR_divergence_imp_join<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deterministic_imp_CR<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deterministic_stepI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> NF_stepI NF_stepI<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We will rename states and variables.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">map_minsky</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">map_minsky</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> map_prod <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map_Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_minsky_id<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_minsky id id <span class="free">M</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_minsky_def Op.map_id0 map_prod.id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_minsky_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_minsky <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>map_minsky <span class="free">f'</span> <span class="free">g'</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> map_minsky <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">g'</span><span class="main">)</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_minsky_def image_comp Op.map_comp map_prod.comp comp_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map_Op <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹When states and variables are renamed, computations carry over from the original machine,
provided that variables are renamed injectively.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span> <span class="main">∘</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> <span class="free">ws</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">vs'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="main">(</span>map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> step.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>inc <span class="skolem">v</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> inc<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ws'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">v</span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free">vs'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">vs'</span> <span class="bound">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">,</span> <span class="var">?ws'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="main">(</span>map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inc<span class="main">(</span>2<span class="main">)</span> step.inc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">vs'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> <span class="free">ws</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">vs'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?ws'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> injD image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>decn <span class="skolem">v</span> <span class="skolem">sz</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> decn<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ws'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">v</span> <span class="keyword1">then</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="free">vs'</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">,</span> <span class="var">?ws'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="main">(</span>map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> decn<span class="main">(</span>2-<span class="main">)</span> step.decn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">sz</span>"</span></span> <span class="quoted"><span class="quoted">"map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> <span class="free">ws</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">vs'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?ws'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> injD image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>decz <span class="skolem">v</span> <span class="skolem">sn</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> decz<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> step <span class="main">(</span>map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> decz<span class="main">(</span>2-<span class="main">)</span> step.decz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">sn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">vs'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> <span class="free">ws</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">vs'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> injD image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_steps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">∘</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">,</span> <span class="free">ws</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> <span class="free">vs'</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">ws</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="main">(</span>map_minsky <span class="free">f</span> <span class="free">g</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">vs</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">ws</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> <span class="free">vs'</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">ws</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> injD image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> range <span class="free">g</span> <span class="keyword1">then</span> snd <span class="skolem">y</span> <span class="main">(</span>inv <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">ws</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="free">g</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?ys'</span> <span class="main">∘</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> map_step<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> step<span class="main">(</span>1<span class="main">)</span>
    step<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ys'</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Concrete Minsky machines›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following definition expresses when a Minsky machine $M$ implements a specification $P$.
We adopt the convention that computations always start out in state $1$ and end in state $0$, which
must be a final state. The specification $P$ relates initial assignments to final assignments.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_minsky_wit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_minsky_wit</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> finite <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> deterministic <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mk_minsky</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_minsky</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">M</span><span class="main">.</span> mk_minsky_wit <span class="bound">M</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> mk_minsky_def <span class="main">=</span> mk_minsky_wit_def

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">⟹</span> mk_minsky <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_minsky_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky_wit <span class="free">M</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="free">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">vs</span> <span class="free">vs'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"deterministic <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_minsky_wit_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="free">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">vs</span> <span class="skolem">vs''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">,</span> <span class="free">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deterministic_minsky_UN<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vs''<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vs''<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Realizability of $n$-ary functions for $n = 1 \dots 3$. Here we use the convention that the
arguments are passed in registers $1 \dots 3$, and the result is stored in register $0$.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mk_minsky1</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_minsky1</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mk_minsky2</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_minsky2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mk_minsky3</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_minsky3</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Trivial building blocks›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can increment and decrement any register.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_inc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="bound">vs</span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> step.inc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deterministic_def mk_minsky_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> Inc <span class="free">v</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_dec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">v</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> Dec <span class="free">v</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mk_minsky_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?M</span></span></span></span></span><span class="main"><span class="main">]</span></span> allI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">vs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">vs</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.decz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">]</span> step.decn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="free">v</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential composition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma has two useful corollaries (which we prove simultaneously because they
share much of the proof structure): First, if $P$ and $Q$ are realizable, then so is $P \circ Q$.
Secondly, if we rename variables by an injective function $f$ in a Minksy machine, then the
variables outside the range of $f$ remain unchanged.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_seq_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span> <span class="bound">vs'</span> <span class="bound">vs''</span><span class="main">.</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">vs'</span> <span class="bound">vs''</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">vs</span> <span class="bound">vs''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs'</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> range <span class="free">g</span> <span class="main">⟶</span> <span class="bound">vs</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">vs'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">M</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_minsky_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">N</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">vs</span> <span class="bound">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="comment1">― ‹M: from 1 to 2›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fN</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">s</span>"</span></span>                                               <span class="comment1">― ‹N: from 2 to 0›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_minsky <span class="var">?fM</span> <span class="free">g</span> <span class="skolem">M</span> <span class="main">∪</span> map_minsky <span class="var">?fN</span> <span class="free">g</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mk_minsky_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?M</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1<span class="main">)</span> N<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> N<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> map_minsky_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deterministic_union deterministic_map<span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def rev_image_eqI Suc_double_not_eq_double <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> N<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_image_eqI map_minsky_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">vs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vsM</span></span> <span class="keyword2"><span class="keyword">where</span></span> M'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="skolem">vs</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">vsM</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">vsM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vsN</span></span> <span class="keyword2"><span class="keyword">where</span></span> N'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="skolem">vsM</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">vsN</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">vsM</span> <span class="skolem">vsN</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> subsetD<span class="main">[</span><span class="operator">OF</span> steps_mono<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">]</span>
      map_steps<span class="main">[</span><span class="operator">OF</span> _ _ M'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="var"><span class="quoted"><span class="var">?fM</span></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
      map_steps<span class="main">[</span><span class="operator">OF</span> _ _ N'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?fN</span></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> M'<span class="main">(</span>2<span class="main">)</span> N'<span class="main">(</span>2<span class="main">)</span> rtrancl_trans<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sequential composition.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_seq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">Q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span> <span class="bound">vs'</span> <span class="bound">vs''</span><span class="main">.</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">vs'</span> <span class="bound">vs''</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">vs</span> <span class="bound">vs''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mk_minsky_seq_map<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">id</span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_seq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">vs'</span> <span class="bound">vs''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can do nothing (besides transitioning from state 1 to state 0).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_nop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">=</span> <span class="bound">vs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_inc mk_minsky_dec<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Renaming variables.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs'</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> range <span class="free">f</span> <span class="main">⟶</span> <span class="bound">vs</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">vs'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mk_minsky_seq_map<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mk_minsky_nop assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounded loop›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following lemma, $P$ is the specification of a loop body, and $Q$ the specification
of the loop itself (a loop invariant). The loop variable is $v$. $Q$ can be realized provided that
\begin{enumerate}
\item $P$ can be realized;
\item $P$ ensures that the loop variable is not changed by the loop body; and
\item $Q$ follows by induction on the loop variable:
  \begin{enumerate}
  \item $\alpha\,Q\,\alpha$ holds when $\alpha[v] = 0$; and
  \item $\alpha[v := n]\,P\,\alpha'$ and $\alpha'\,Q\,\alpha''$ imply $\alpha\,Q\,alpha''$
    when $\alpha[v] = n+1$.
  \end{enumerate}
\end{enumerate}›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">P</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span> <span class="main">⟹</span> <span class="bound">vs'</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">vs</span> <span class="free">v</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="bound">vs</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">vs</span> <span class="bound">vs</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">vs</span> <span class="bound">vs'</span> <span class="bound">vs''</span><span class="main">.</span> <span class="bound">vs</span> <span class="free">v</span> <span class="main">=</span> Suc <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">vs'</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">vs'</span> <span class="bound">vs''</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">vs</span> <span class="bound">vs''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">M</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">vs</span> <span class="bound">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> Dec <span class="free">v</span> <span class="numeral">2</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> map_minsky Suc id <span class="skolem">M</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mk_minsky_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?M</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> map_minsky_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deterministic_union deterministic_map<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">vs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="free">v</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> step.decz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">0</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> M'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="skolem">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="skolem">vs</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">vs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs''</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="var">?M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">vs'</span> <span class="skolem">vs''</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs'</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> M'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> subsetD<span class="main">[</span><span class="operator">OF</span> steps_mono<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span><span class="main">]</span>
        r_into_rtrancl<span class="main">[</span><span class="operator">OF</span> decn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">0</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        map_steps<span class="main">[</span><span class="operator">OF</span> _ _ M'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">id</span> <span class="main">_</span> <span class="quoted">Suc</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> refl<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">folded</span> numeral_2_eq_2<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rtrancl_trans<span class="main">[</span><span class="operator">OF</span> rtrancl_trans<span class="main">,</span> <span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> D<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        D<span class="main">(</span>2<span class="main">)</span> Suc<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ M'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">vs''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Copying values›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We work up to copying values in several steps.
\begin{enumerate}
\item Clear a register. This is a loop that decrements the register until it reaches $0$.
\item Add a register to another one. This is a loop that decrements one register, and increments
  the other register, until the first register reaches 0.
\item Add a register to two others. This is the same, except that two registers are incremented.
\item Move a register: set a register to 0, then add another register to it.
\item Copy a register destructively: clear two registers, then add another register to them.
\end{enumerate}›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_loop<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> <span class="comment1">― ‹ while v[v]$--$: ›</span>
    mk_minsky_nop<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>                   <span class="comment1">― ‹   pass          ›</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_add1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">w</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">v</span> <span class="main">+</span> <span class="bound">vs</span> <span class="free">w</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_loop<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> <span class="comment1">― ‹ while v[v]$--$: ›</span>
    mk_minsky_inc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>                         <span class="comment1">― ‹   v[w]++        ›</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_add2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">u</span> <span class="main">+</span> <span class="bound">vs</span> <span class="free">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">w</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">u</span> <span class="main">+</span> <span class="bound">vs</span> <span class="free">w</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_loop<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="comment1">― ‹ while v[u]$--$: ›</span>
    mk_minsky_inc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>                                                  <span class="comment1">― ‹   v[v]++        ›</span>
    mk_minsky_inc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>                                          <span class="comment1">― ‹   v[w]++        ›</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_copy1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">w</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">v</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
    mk_minsky_zero<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>          <span class="comment1">― ‹ v[w] := 0                      ›</span>
    mk_minsky_add1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="comment1">― ‹ v[w] := v[w] + v[v], v[v] := 0 ›</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_copy2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">w</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">u</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">,</span></span> <span class="operator">OF</span>
    mk_minsky_zero<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>            <span class="comment1">― ‹ v[v] := 0                                           ›</span>
    mk_minsky_zero<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>            <span class="comment1">― ‹ v[w] := 0                                           ›</span>
    mk_minsky_add2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="comment1">― ‹ v[v] := v[v] + v[u], v[w] := v[w] + v[u], v[u] := 0 ›</span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_copy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="bound">vs</span> <span class="free">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">w</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
    mk_minsky_copy2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>      <span class="comment1">― ‹ v[v] := v[u], v[w] := v[u], v[u] := 0 ›</span>
    mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="comment1">― ‹ v[u] := v[w], v[w] := 0               ›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Primitive recursive functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Nondestructive apply: compute $f$ on arguments $\alpha[u]$, $\alpha[v]$, $\alpha[w]$,
storing the result in $\alpha[t]$ and preserving all other registers below $k$. This is easy
now that we can copy values.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_apply3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">.</span> <span class="bound">vs'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">vs</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">vs</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span>
    mk_minsky_copy<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> <span class="comment1">― ‹ v[1+k] := v[u] ›</span>
    mk_minsky_copy<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> <span class="comment1">― ‹ v[2+k] := v[v] ›</span>
    mk_minsky_copy<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> <span class="comment1">― ‹ v[3+k] := v[w] ›</span>
    mk_minsky_map<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="free"><span class="free"><span class="free">t</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 2<span class="main">)</span>
                                   <span class="comment1">― ‹ v[t] := f v[1+k] v[2+k] v[3+k] ›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Composition is just four non-destructive applies.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_comp3_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span>
    mk_minsky_apply3<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">4</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">7</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>        <span class="comment1">― ‹ v[4] := g v[1] v[2] v[3] ›</span>
    mk_minsky_apply3<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">5</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">7</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>        <span class="comment1">― ‹ v[5] := h v[1] v[2] v[3] ›</span>
    mk_minsky_apply3<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">6</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">7</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>        <span class="comment1">― ‹ v[6] := k v[1] v[2] v[3] ›</span>
    mk_minsky_apply3<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">7</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">4</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">5</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">6</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="comment1">― ‹ v[0] := f v[4] v[5] v[6] ›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Primitive recursion is a non-destructive apply followed by a loop with another
non-destructive apply. The key to the proof is the loop invariant, which we can specify
as part of composing the various <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mk_minsky_*›</span></span></span></span> lemmas.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_prim_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mk_minsky1 <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"mk_minsky3 <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_minsky2 <span class="main">(</span>PrimRecOp <span class="free">g</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main">,</span></span> <span class="operator">OF</span>
    mk_minsky_apply3<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">4</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>       <span class="comment1">― ‹ v[0] := g v[2]             ›</span>
    mk_minsky_zero<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>                              <span class="comment1">― ‹ v[3] := 0                  ›</span>
    mk_minsky_loop<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v <span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">OF</span> mk_minsky_seq'<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">OF</span> <span class="comment1">― ‹ while v[1]$--$:            ›</span>
      mk_minsky_apply3<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">4</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span>     <span class="comment1">― ‹   v[0] := h v[3] v[0] v[2] ›</span>
      mk_minsky_inc<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span>                            <span class="comment1">― ‹   v[3]++                   ›</span>
      <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="bound"><span class="bound"><span class="bound">vs'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> PrimRecOp <span class="free"><span class="free"><span class="free">g</span></span></span> <span class="free"><span class="free"><span class="free">h</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">⟶</span></span></span> <span class="bound"><span class="bound"><span class="bound">vs'</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> PrimRecOp <span class="free"><span class="free"><span class="free">g</span></span></span> <span class="free"><span class="free"><span class="free">h</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">vs</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span>
    <span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹With these building blocks we can easily show that all primitive recursive functions can
be realized by a Minsky machine.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_minsky_PrimRec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> PrimRec1 <span class="main">⟹</span> mk_minsky1 <span class="free">f</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> PrimRec2 <span class="main">⟹</span> mk_minsky2 <span class="free">g</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> PrimRec3 <span class="main">⟹</span> mk_minsky3 <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∈</span> PrimRec1 <span class="main">⟶</span> mk_minsky1 <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g</span> <span class="main">∈</span> PrimRec2 <span class="main">⟶</span> mk_minsky2 <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h</span> <span class="main">∈</span> PrimRec3 <span class="main">⟶</span> mk_minsky3 <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> PrimRec1_PrimRec2_PrimRec3.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> zero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_zero<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> mk_minsky_inc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> id1_1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> id2_1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> id2_2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> id3_1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> id3_2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> id3_3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mk_minsky_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_copy1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp1_1 <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp1_2 <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp1_3 <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp2_1 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp3_1 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp2_2 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp2_3 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp3_2 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>comp3_3 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_comp3_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prim_rec <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mk_minsky_prim_rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Recursively enumerable sets as Minsky machines›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following is the most complicated lemma of this theory: Given two r.e.\ sets $A$ and $B$
we want to construct a Minsky machine that reaches the final state $0$ for input $x$ if $x \in A$
and final state $1$ if $x \in B$, and never reaches either of these states if $x \notin A \cup B$.
(If $x \in A \cap B$, then either state $0$ or state $1$ may be reached.) We consider two
r.e.\ sets rather than one because we target recursive inseparability.

For the r.e.\ set $A$, there is a primitive recursive function $f$ such that
$x \in A \iff \exists y.\, f(x,y) = 0$. Similarly there is a primitive recursive function $g$ for
$B$ such that $x \in B \iff \exists y.\, f(x,y) = 0$. Our Minsky machine takes $x$ in register
$0$ and $y$ in register $1$ (initially $0$) and works as follows.
\begin{enumerate}
\item evaluate $f(x,y)$; if the result is $0$, transition to state $0$; otherwise,
\item evaluate $g(x,y)$; if the result is $0$, transition to state $1$; otherwise,
\item increment $y$ and start over.
\end{enumerate}›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ce_set_pair_by_minsky<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> ce_sets"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> ce_sets"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">M</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">⟹</span>
     <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> PrimRec2"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ce_sets_def fn_to_set_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> PrimRec2"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ce_sets_def fn_to_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_minsky_seq<span class="main">[</span><span class="operator">OF</span>
      mk_minsky_apply3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_PrimRec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> g<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> <span class="comment1">― ‹ v[2] := g v[0] v[1] ›</span>
      mk_minsky_nop<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                                           <span class="comment1">― ‹ pass                ›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">M</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span>
    <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_minsky_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mk_minsky <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_minsky_seq<span class="main">[</span><span class="operator">OF</span>
      mk_minsky_apply3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_minsky_PrimRec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> h<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> <span class="comment1">― ‹ v[2] := h v[0] v[1] ›</span>
      mk_minsky_inc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                                     <span class="comment1">― ‹ v[1] := v[1] + 1    ›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">N</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span>
    <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_minsky_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">3</span> <span class="keyword1">else</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">s</span>"</span></span> <span class="comment1">― ‹M: from state 4 to state 3›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">+</span> <span class="numeral">5</span>"</span></span>                  <span class="comment1">― ‹N: from state 7 to state 5›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> map_minsky <span class="var">?f</span> id <span class="skolem">M</span> <span class="main">∪</span> map_minsky <span class="var">?g</span> id <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> Dec <span class="numeral">2</span> <span class="numeral">7</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="numeral">5</span><span class="main">,</span> Dec <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> MX<span class="main">:</span> <span class="quoted"><span class="quoted">"map_minsky <span class="var">?f</span> id <span class="skolem">M</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> NX<span class="main">:</span> <span class="quoted"><span class="quoted">"map_minsky <span class="var">?g</span> id <span class="skolem">N</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> DX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">,</span> Dec <span class="numeral">2</span> <span class="numeral">7</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">5</span><span class="main">,</span> Dec <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> X1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1<span class="main">)</span> N<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def X_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> X2<span class="main">:</span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> N<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> deterministic_union<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_minsky_def rev_image_eqI inj_on_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> deterministic_map<span class="main">)</span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> X3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>3<span class="main">)</span> N<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> X_def map_minsky_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> X4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span>
    <span class="skolem">h</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span>
    <span class="skolem">g</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">vs</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">vs</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">vs</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> vs' <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> vs' <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subsetD<span class="main">[</span><span class="operator">OF</span> steps_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MX<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> map_steps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ vs'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted">id</span> <span class="quoted"><span class="skolem">vs</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> decz<span class="main">[</span><span class="operator">OF</span> DX<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">vs'</span></span><span class="main">]</span> vs' 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> Suc' <span class="main">=</span> Suc
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="skolem">vs'</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="var">?vs</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 decn<span class="main">[</span><span class="operator">OF</span> DX<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">vs'</span></span><span class="main">]</span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> vs'' <span class="keyword1"><span class="command">using</span></span> N<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?vs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> vs'' <span class="main">=</span> this
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="skolem">vs''</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 subsetD<span class="main">[</span><span class="operator">OF</span> steps_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NX<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> map_steps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ vs''<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted">id</span> <span class="var"><span class="quoted"><span class="var">?vs</span></span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs''</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 decz<span class="main">[</span><span class="operator">OF</span> DX<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">vs''</span></span><span class="main">]</span> vs''<span class="main">(</span>2-<span class="main">)</span> vs'<span class="main">(</span>2-<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="skolem">m</span> <span class="keyword1">else</span> <span class="skolem">vs''</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="var">?vs</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 decn<span class="main">[</span><span class="operator">OF</span> DX<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">vs''</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vs''<span class="main">(</span>2-<span class="main">)</span> vs'<span class="main">(</span>2-<span class="main">)</span> Suc Suc' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?vs</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">vs</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">1</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> base step<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">vs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> X4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">vs</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> vs' <span class="keyword1"><span class="command">using</span></span> X4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ex_disj_distrib <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>4<span class="main">)</span> step<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> trancl_into_rtrancl<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> rtrancl_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">ws'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">ws'</span> <span class="main">0</span><span class="main">)</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">ws'</span> <span class="main">0</span><span class="main">)</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">vs</span> <span class="skolem">ws'</span> <span class="skolem">ws</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ws'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtrancl_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> refl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl<span class="main">(</span>1<span class="main">)</span> NF_not_suc<span class="main">[</span><span class="operator">OF</span> refl<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> NF_stepI<span class="main">]</span> X3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">s</span> <span class="skolem">vs</span> <span class="skolem">s'</span> <span class="skolem">vs'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtranclE<span class="main"><span class="main">[</span></span><span class="operator">case_names</span> base' step'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> base'
      <span class="keyword1"><span class="command">note</span></span> *** <span class="main">=</span> deterministic_minsky_UN<span class="main">[</span><span class="operator">OF</span> X2 _ _ X3<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> X4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ws'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">vs''</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> ***<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="skolem">ws'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs''</span></span> <span class="quoted"><span class="skolem">ws</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> base' <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_rtrancl_into_rtrancl<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">vs''</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> ***<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="skolem">ws'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">ws</span></span> <span class="quoted"><span class="skolem">vs''</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> base' <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_rtrancl_into_rtrancl<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">vs''</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>2<span class="main">)</span> step<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs''</span></span><span class="main">,</span> <span class="operator">OF</span> step<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
          deterministicD<span class="main">[</span><span class="operator">OF</span> deterministic_stepI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X2<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> _ step<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> base' if_bool_eq_conj trancl_unfold_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step' <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> deterministicD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deterministic_stepI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> step<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> step<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">X</span></span></span></span><span class="main"><span class="main">]</span></span> X1 X2 X3<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">vs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">vs</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">vs</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> h<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For r.e.\ sets we obtain the following lemma as a special case (taking $B = \varnothing$,
and swapping states $1$ and $2$).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ce_set_by_minsky<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> ce_sets"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">M</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">vs</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> M <span class="keyword1"><span class="command">using</span></span> ce_set_pair_by_minsky<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ce_empty<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> M <span class="main">=</span> this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="bound">s</span>"</span></span> <span class="comment1">― ‹swap states 1 and 2›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∘</span> <span class="var">?f</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> map_minsky <span class="var">?f</span> id <span class="skolem">M</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> M_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> map_minsky <span class="var">?f</span> id <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> N_def map_minsky_comp <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="main">∘</span> <span class="var">?f</span> <span class="main">=</span> id›</span></span> map_minsky_id o_id <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">N</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">vs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> 4<span class="main">(</span>6<span class="main">)</span> M<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
      map_steps<span class="main">[</span><span class="operator">of</span> <span class="quoted">id</span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">0</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">M</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">x</span> <span class="skolem">vs</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 5<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> 5<span class="main">(</span>6<span class="main">)</span> map_steps<span class="main">[</span><span class="operator">of</span> <span class="quoted">id</span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">N</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def map_minsky_def inj_on_def rev_image_eqI deterministic_map <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Encoding of Minsky machines›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹So far, Minsky machines have been sets of pairs of states and operations. We now provide an
encoding of Minsky machines as natural numbers, so that we can talk about them as r.e.\ or
computable sets. First we encode operations.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">encode_Op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> Op <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">encode_Op</span> <span class="main">(</span>Dec <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">=</span> c_pair <span class="main">0</span> <span class="main">(</span>c_pair <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>c_pair <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">encode_Op</span> <span class="main">(</span>Inc <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> c_pair <span class="main">1</span> <span class="main">(</span>c_pair <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decode_Op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> Op"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decode_Op</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_fst <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span>
   <span class="keyword1">then</span> Dec <span class="main">(</span>c_fst <span class="main">(</span>c_snd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>c_fst <span class="main">(</span>c_snd <span class="main">(</span>c_snd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>c_snd <span class="main">(</span>c_snd <span class="main">(</span>c_snd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">else</span> Inc <span class="main">(</span>c_fst <span class="main">(</span>c_snd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>c_snd <span class="main">(</span>c_snd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> encode_Op_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"decode_Op <span class="main">(</span>encode_Op <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decode_Op_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Minsky machines are encoded via lists of pairs of states and operations.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">encode_minsky</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> Op<span class="main">)</span> list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">encode_minsky</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> list_to_nat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> c_pair <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>encode_Op <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decode_minsky</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> Op<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decode_minsky</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>c_fst <span class="bound">n</span><span class="main">,</span> decode_Op <span class="main">(</span>c_snd <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nat_to_list <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> encode_minsky_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"decode_minsky <span class="main">(</span>encode_minsky <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> encode_minsky_def decode_minsky_def comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Assignments are stored as lists (starting with register 0).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decode_regs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decode_regs</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">xs</span> <span class="main">=</span> nat_to_list <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="bound">xs</span> <span class="keyword1">then</span> nat_to_list <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The undecidability results talk about Minsky configurations (pairs of Minsky machines and
assignments). This means that we do not have to construct any recursive functions that modify
Minsky machines (for example in order to initialize variables), keeping the proofs simple.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decode_minsky_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky <span class="main">×</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decode_minsky_state</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span>set <span class="main">(</span>decode_minsky <span class="main">(</span>c_fst <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>decode_regs <span class="main">(</span>c_snd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Undecidablity results›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We conclude with some undecidability results. First we show that it is undecidable whether
a Minksy machine starting at state 1 terminates in state 0.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minsky_reaching_0</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minsky_reaching_0</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span> <span class="main">|</span><span class="bound">n</span> <span class="bound">M</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="bound">M</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span> <span class="main">=</span> decode_minsky_state <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="bound">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minsky_reaching_0_not_computable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> computable minsky_reaching_0"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> U <span class="keyword1"><span class="command">using</span></span> ce_set_by_minsky<span class="main">[</span><span class="operator">OF</span> univ_is_ce<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> U <span class="main">=</span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list<span class="main">[</span><span class="operator">OF</span> U<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> c_pair <span class="main">(</span>encode_minsky <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>c_cons <span class="bound">n</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> PrimRec1"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp2_1<span class="main">[</span><span class="operator">OF</span> c_pair_is_pr const_is_pr comp2_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c_cons_is_pr id1_1 const_is_pr<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">∈</span> minsky_reaching_0 <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> univ_ce"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> U<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">i</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minsky_reaching_0_def decode_minsky_state_def decode_regs_def c_cons_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"many_reducible_to univ_ce minsky_reaching_0"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> many_reducible_to_def many_reducible_to_via_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> pr_is_total_rec<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> many_reducible_lm_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The remaining results are resursive inseparability results. We start be showing that there
is a Minksy machine $U$ with final states $0$ and $1$ such that it is not possible to recursively
separate inputs reaching state $0$ from inputs reaching state $1$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_0not1_1not0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">0</span> <span class="main">∈</span> nat_to_ce_set <span class="bound">p</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">∉</span> nat_to_ce_set <span class="bound">p</span><span class="main">}</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">0</span> <span class="main">∉</span> nat_to_ce_set <span class="bound">p</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">∈</span> nat_to_ce_set <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_ce_set <span class="skolem">n</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_to_ce_set_srj<span class="main">[</span><span class="operator">OF</span> ce_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_ce_set <span class="skolem">m</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_to_ce_set_srj<span class="main">[</span><span class="operator">OF</span> ce_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rec_inseparable_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Rice_rec_inseparable<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n m<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ce_sets_containing_n_ce<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">∈</span> nat_to_ce_set <span class="bound">p</span><span class="main">}</span> <span class="main">∈</span> ce_sets"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ce_set_lm_5<span class="main">[</span><span class="operator">OF</span> univ_is_ce comp2_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c_pair_is_pr id1_1 const_is_pr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> univ_ce_lm_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_fixed_minsky_reaching_0_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="free">U</span>"</span></span>
    <span class="quoted"><span class="quoted">"rec_inseparable <span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">U</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>
      <span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="free">U</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> U <span class="keyword1"><span class="command">using</span></span> ce_set_pair_by_minsky<span class="main">[</span><span class="operator">OF</span> ce_sets_containing_n_ce ce_sets_containing_n_ce<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1-4<span class="main">)</span> this<span class="main">(</span>5-7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> <span class="bound"><span class="bound"><span class="bound">n</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 0 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">U</span></span><span class="main"><span class="main">]</span></span> rec_inseparable_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rec_inseparable_0not1_1not0<span class="main"><span class="main">]</span></span>
      pr_is_total_rec <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_image_eqI <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span> <span class="operator">meson</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Consequently, it is impossible to separate Minsky configurations with determistic machines
and final states $0$ and $1$ that reach state $0$ from those that reach state $1$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minsky_reaching_s</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minsky_reaching_s</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">m</span> <span class="main">|</span><span class="bound">M</span> <span class="bound">m</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="bound">M</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span> <span class="main">=</span> decode_minsky_state <span class="bound">m</span> <span class="main">∧</span>
    deterministic <span class="bound">M</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="bound">M</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="bound">M</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="bound">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_minsky_reaching_0_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="main">(</span>minsky_reaching_s <span class="main">0</span><span class="main">)</span> <span class="main">(</span>minsky_reaching_s <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> U <span class="keyword1"><span class="command">using</span></span> rec_inseparable_fixed_minsky_reaching_0_1 <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> U <span class="main">=</span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list<span class="main">[</span><span class="operator">OF</span> U<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> c_pair <span class="main">(</span>encode_minsky <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>c_cons <span class="bound">n</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> PrimRec1"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp2_1<span class="main">[</span><span class="operator">OF</span> c_pair_is_pr const_is_pr comp2_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c_cons_is_pr id1_1 const_is_pr<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> U<span class="main">(</span>1-4<span class="main">)</span> rec_inseparable_many_reducible<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">,</span> <span class="operator">OF</span> _ rec_inseparable_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> U<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pr_is_total_rec minsky_reaching_s_def decode_minsky_state_def rev_image_eqI
      decode_regs_def c_cons_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As a corollary, it is impossible to separate Minsky configurations that reach state 0 but not
state 1 from those that reach state 1 but not state 0.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minsky_reaching_s_not_t</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minsky_reaching_s_not_t</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">m</span> <span class="main">|</span><span class="bound">M</span> <span class="bound">m</span> <span class="bound">vs</span> <span class="bound">vs'</span><span class="main">.</span> <span class="main">(</span><span class="bound">M</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span> <span class="main">=</span> decode_minsky_state <span class="bound">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step <span class="bound">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="bound">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>step <span class="bound">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minsky_reaching_s_imp_minsky_reaching_s_not_t<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minsky_reaching_s <span class="free">s</span> <span class="main">⊆</span> minsky_reaching_s_not_t <span class="free">s</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="skolem">vs'</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>step <span class="skolem">M</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"deterministic <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> minsky"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">vs</span> <span class="skolem">vs'</span>
    <span class="keyword1"><span class="command">using</span></span> deterministic_minsky_UN<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ _ that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minsky_reaching_s_def minsky_reaching_s_not_t_def rev_image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rec_inseparable_minsky_reaching_0_not_1_1_not_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rec_inseparable <span class="main">(</span>minsky_reaching_s_not_t <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>minsky_reaching_s_not_t <span class="main">1</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rec_inseparable_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rec_inseparable_minsky_reaching_0_1<span class="main"><span class="main">]</span></span>
    minsky_reaching_s_imp_minsky_reaching_s_not_t<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>