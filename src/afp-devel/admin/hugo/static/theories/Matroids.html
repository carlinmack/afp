<div id="Indep_System">
<div class="head">
<h1>Theory Indep_System</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Indep_System.thy
  Author:   Jonas Keinholz

Independence systems
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Independence systems›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Indep_System
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_psubset_inc_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊂</span> <span class="bound">Y</span> <span class="main">⟹</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊂</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_bounded_set<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ub <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">A</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf<span class="main"><span class="main">,</span></span> <span class="operator">case_names</span> step<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An \emph{independence system} consists of a finite ground set together with an independence
  predicate over the sets of this ground set. At least one set of the carrier is independent and
  subsets of independent sets are also independent.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> indep_system <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">carrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">indep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> carrier_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indep_subset_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indep_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="free">indep</span> <span class="bound">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> indep_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="free">Y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> psubset_inc_induct <span class="main">[</span><span class="operator">case_names</span> carrier step<span class="main">]</span> <span class="main">=</span> finite_psubset_inc_induct<span class="main">[</span><span class="operator">OF</span> carrier_finite<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> indep_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> finite_subset<span class="main">[</span><span class="operator">OF</span> indep_subset_carrier carrier_finite<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The empty set is independent.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indep_ex indep_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sub-independence systems›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A subset of the ground set induces an independence system.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indep_in</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep_in</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="main">∧</span> <span class="free">indep</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_inI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_subI<span class="main">:</span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> indep_in <span class="free">ℰ'</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">ℰ'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indep_subset <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dep_in_subI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ'</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_subset_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_subI_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">ℰ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_in_subI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">ℰ</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_in_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_supI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">ℰ'</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_in_subI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ℰ' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_indep<span class="main">:</span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> indep_inD <span class="main">=</span> indep_in_subset_carrier indep_in_indep

<span class="keyword1"><span class="command">lemma</span></span> indep_system_subset <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indep_system <span class="free">ℰ</span> <span class="main">(</span>indep_in <span class="free">ℰ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indep_system_def indep_in_def
  <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> assms carrier_finite<span class="main">]</span> indep_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We will work a lot with different sub structures. Therefore, every definition `foo' will have
  a counterpart `foo\_in' which has the ground set as an additional parameter. Furthermore, every
  result about `foo' will have another result about `foo\_in'. With this, we usually don't have to
  work with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> interpretation<span class="antiquote"><span class="antiquote">}</span></span></span></span> in proofs.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.indep_in <span class="free">ℰ'</span> <span class="free">X</span> <span class="main">⟷</span> indep_in <span class="free">ℰ'</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ℰ.indep_in_def indep_in_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> indep_in_ex <span class="main">=</span> ℰ.indep_ex
<span class="keyword1"><span class="command">lemmas</span></span> indep_in_subset <span class="main">=</span> ℰ.indep_subset
<span class="keyword1"><span class="command">lemmas</span></span> indep_in_empty <span class="main">=</span> ℰ.indep_empty

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bases›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A \emph{basis} is a maximal independent set, i.\,e.\ an independent set which becomes dependent on
  inserting any element of the ground set.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">basis</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> <span class="free">indep</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basisI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_indep<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="free">X</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_max_indep<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> basisD <span class="main">=</span> basis_indep basis_max_indep
<span class="keyword1"><span class="command">lemmas</span></span> basis_subset_carrier <span class="main">=</span> indep_subset_carrier<span class="main">[</span><span class="operator">OF</span> basis_indep<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> indep_finite<span class="main">[</span><span class="operator">OF</span> basis_indep<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_not_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> basis <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">X</span><span class="main">.</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms basisI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_subset_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_indep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span> indep_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x basis_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms basisD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">basis_in</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">basis_in</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> indep_system.basis <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="main">(</span>indep_in <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_iff_basis_in<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="free">B</span> <span class="main">⟷</span> basis_in <span class="free">carrier</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B</span> <span class="main">⟷</span> basis_in <span class="free">carrier</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LTR
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ℰ.basisI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">carrier</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LTR basisD indep_subset_carrier indep_inI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LTR basisD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">carrier</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_inD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> RTL
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basisI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RTL ℰ.basis_indep indep_inD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">carrier</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RTL ℰ.basisD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_subset_carrier indep_inI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_inI_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"ℰ.basis <span class="free">X</span> <span class="main">⟹</span> basis_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_inD_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> ℰ.basis <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> not_basis_inD_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> basis_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">¬</span> ℰ.basis <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> basis_inI_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> basis_inI <span class="main">=</span> basis_inI_aux<span class="main">[</span><span class="operator">OF</span> ℰ.basisI<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_in_indep_in <span class="main">=</span> ℰ.basis_indep<span class="main">[</span><span class="operator">OF</span> basis_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_in_max_indep_in <span class="main">=</span> ℰ.basis_max_indep<span class="main">[</span><span class="operator">OF</span> basis_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_inD <span class="main">=</span> ℰ.basisD<span class="main">[</span><span class="operator">OF</span> basis_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_in_subset_carrier <span class="main">=</span> ℰ.basis_subset_carrier<span class="main">[</span><span class="operator">OF</span> basis_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_in_finite <span class="main">=</span> ℰ.basis_finite<span class="main">[</span><span class="operator">OF</span> basis_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> indep_in_not_basis_in <span class="main">=</span> ℰ.indep_not_basis<span class="main">[</span><span class="operator">OF</span> _ not_basis_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_in_subset_eq <span class="main">=</span> ℰ.basis_subset_eq<span class="main">[</span><span class="operator">OF</span> basis_inD_aux basis_inD_aux<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.basis_in <span class="free">ℰ'</span> <span class="free">B</span> <span class="main">⟷</span> basis_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LTR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basis_inI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * assms LTR ℰ.basis_in_subset_carrier ℰ.basis_in_indep_in indep_in_sub_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ'</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * assms LTR ℰ.basis_in_max_indep_in ℰ.basis_in_subset_carrier indep_in_sub_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> RTL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ℰ.basis_inI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ℰ.indep_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * assms RTL basis_in_subset_carrier basis_in_indep_in indep_in_sub_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ℰ.indep_in <span class="free">ℰ'</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * assms RTL basis_in_max_indep_in basis_in_subset_carrier indep_in_sub_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Circuits›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A \emph{circuit} is a minimal dependent set, i.\,e.\ a set which becomes independent on removing
  any element of the ground set.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circuit</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">circuit</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⊆</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">indep</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="free">indep</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuitI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> circuit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_subset_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit <span class="free">X</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circuit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> finite_subset<span class="main">[</span><span class="operator">OF</span> circuit_subset_carrier carrier_finite<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_dep<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit <span class="free">X</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circuit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_min_dep<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circuit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> circuitD <span class="main">=</span> circuit_subset_carrier circuit_dep circuit_min_dep

<span class="keyword1"><span class="command">lemma</span></span> circuit_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit <span class="free">X</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circuit_dep indep_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> dep_not_circuit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> circuit <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms circuitI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_subset_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_subset <span class="quoted"><span class="quoted">‹<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> circuit_min_dep<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹circuit <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms circuitD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circuit_in</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circuit_in</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> indep_system.circuit <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="main">(</span>indep_in <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_inI_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"ℰ.circuit <span class="free">X</span> <span class="main">⟹</span> circuit_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_inD_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> ℰ.circuit <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> not_circuit_inD_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> circuit_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">¬</span> ℰ.circuit <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circuit_inI_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> circuit_inI <span class="main">=</span> circuit_inI_aux<span class="main">[</span><span class="operator">OF</span> ℰ.circuitI<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> circuit_in_subset_carrier <span class="main">=</span> ℰ.circuit_subset_carrier<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_in_finite <span class="main">=</span> ℰ.circuit_finite<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_in_dep_in <span class="main">=</span> ℰ.circuit_dep<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_in_min_dep_in <span class="main">=</span> ℰ.circuit_min_dep<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_inD <span class="main">=</span> ℰ.circuitD<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_in_nonempty <span class="main">=</span> ℰ.circuit_nonempty<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> dep_in_not_circuit_in <span class="main">=</span> ℰ.dep_not_circuit<span class="main">[</span><span class="operator">OF</span> _ _ not_circuit_inD_aux<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> circuit_in_subset_eq <span class="main">=</span> ℰ.circuit_subset_eq<span class="main">[</span><span class="operator">OF</span> circuit_inD_aux circuit_inD_aux<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_in_subI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ'</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> circuit_inI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_in_subset_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ℰ'</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
      circuit_in_dep_in<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span>
      circuit_in_subset_carrier dep_in_subI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms circuit_in_min_dep_in indep_in_subI_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_in_supI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ'</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> circuit_inI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_in_dep_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ'</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep_in_subI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">ℰ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_in_min_dep_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="main">(</span><span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="free">ℰ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_in_subI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="free">ℰ'</span> <span class="main">=</span> <span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_in_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_in_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.circuit_in <span class="free">ℰ'</span> <span class="free">C</span> <span class="main">⟷</span> circuit_in <span class="free">ℰ'</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LTR
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> circuit_inI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms LTR ℰ.circuit_in_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ'</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms LTR ℰ.circuit_in_dep_in indep_in_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms LTR ℰ.circuit_in_min_dep_in indep_in_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> RTL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ℰ.circuit_inI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms * RTL circuit_in_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ℰ.indep_in <span class="free">ℰ'</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms * RTL circuit_in_dep_in indep_in_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ℰ.indep_in <span class="free">ℰ'</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms * RTL circuit_in_min_dep_in indep_in_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_imp_circuit_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">carrier</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> circuit_inI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_subset_carrier<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">carrier</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_dep<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> indep_in_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_min_dep<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">carrier</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_subset_carrier<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> indep_inI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation between independence and bases›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A set is independent iff it is a subset of a basis.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_imp_subset_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> basis <span class="bound">B</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubset_inc_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> carrier
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> indep_subset_carrier<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> basis <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.prems indep_not_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">X</span>"</span></span><span class="main">]</span> indep_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> subset_basis_imp_indep <span class="main">=</span> indep_subset<span class="main">[</span><span class="operator">OF</span> basis_indep<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_iff_subset_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> basis <span class="bound">B</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indep_imp_subset_basis subset_basis_imp_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> basis <span class="bound">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indep_imp_subset_basis<span class="main">[</span><span class="operator">OF</span> indep_empty<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_imp_subset_basis_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">using</span></span> ℰ.indep_imp_subset_basis<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> subset_basis_in_imp_indep_in <span class="main">=</span> indep_in_subset<span class="main">[</span><span class="operator">OF</span> * basis_in_indep_in<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_iff_subset_basis_in<span class="main">:</span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indep_in_imp_subset_basis_in subset_basis_in_imp_indep_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">using</span></span> ℰ.basis_ex <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_subI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">B'</span></span> <span class="main">⊆</span> <span class="free">ℰ</span> <span class="main">-</span> <span class="free">ℰ'</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="bound">B'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in indep_in_subI_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> B'<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="skolem">B'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indep_in_imp_subset_basis_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">ℰ</span> <span class="main">-</span> <span class="free">ℰ'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹basis_in <span class="free">ℰ</span> <span class="skolem">B'</span>›</span></span> basis_in_subset_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ℰ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> * assms indep_in_subset<span class="main">[</span><span class="operator">OF</span> _ basis_in_indep_in<span class="main">]</span> B' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms basis_in_subset_carrier <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms * <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>›</span></span> basis_in_max_indep_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">-</span> <span class="free">ℰ'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">B'</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">B'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">⊆</span> <span class="skolem">B'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">ℰ</span> <span class="main">-</span> <span class="free">ℰ'</span> <span class="main">∧</span> basis_in <span class="free">ℰ</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">B'</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹basis_in <span class="free">ℰ</span> <span class="skolem">B'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_supI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basis_inI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span> <span class="main">(</span><span class="free">B</span> <span class="main">∩</span> <span class="free">ℰ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> indep_in_subI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∩</span> <span class="free">ℰ'</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">ℰ'</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">¬</span> indep_in <span class="free">ℰ'</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms basis_in_subset_carrier basis_in_max_indep_in dep_in_subI<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="free">ℰ'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation between dependence and circuits›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A set is dependent iff it contains a circuit.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dep_imp_supset_circuit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> remove_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>remove <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> circuit <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> remove.prems dep_not_circuit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"circuit <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> remove.prems remove.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> remove.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> carrier_finite finite_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> supset_circuit_imp_dep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms indep_subset circuit_dep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dep_iff_supset_circuit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms dep_imp_supset_circuit supset_circuit_imp_dep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dep_in_imp_supset_circuit_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> circuit_in <span class="free">ℰ</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">using</span></span> ℰ.dep_imp_supset_circuit<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> supset_circuit_in_imp_dep_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">C</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.supset_circuit_imp_dep <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dep_in_iff_supset_circuit_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">C</span><span class="main">.</span> circuit_in <span class="free">ℰ</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms dep_in_imp_supset_circuit_in supset_circuit_in_imp_dep_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ranks›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lower_rank_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lower_rank_of</span> <span class="free"><span class="bound"><span class="entity">carrier'</span></span></span> <span class="main">≡</span> Min <span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free"><span class="bound"><span class="entity">carrier'</span></span></span> <span class="bound">B</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upper_rank_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">upper_rank_of</span> <span class="free"><span class="bound"><span class="entity">carrier'</span></span></span> <span class="main">≡</span> Max <span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free"><span class="bound"><span class="entity">carrier'</span></span></span> <span class="bound">B</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collect_basis_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Collect basis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Collect basis <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">carrier</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> carrier_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> collect_basis_in_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Collect <span class="main">(</span>basis_in <span class="free">ℰ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">using</span></span> ℰ.collect_basis_finite <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lower_rank_of_le<span class="main">:</span> <span class="quoted"><span class="quoted">"lower_rank_of <span class="free">ℰ</span> <span class="main">≤</span> card <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span><span class="main">}</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> card <span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> ℰ.carrier_finite basis_in_subset_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span> basis_in_ex<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> collect_basis_in_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lower_rank_of_def <span class="keyword1"><span class="command">using</span></span> basis_ex Min_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> upper_rank_of_le<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_rank_of <span class="free">ℰ</span> <span class="main">≤</span> card <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span><span class="main">}</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> card <span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> ℰ.carrier_finite basis_in_subset_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upper_rank_of_def <span class="keyword1"><span class="command">using</span></span> basis_in_ex<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> collect_basis_in_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ'</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ'<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ'</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">interpretation</span></span> ℰ'<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> indep_system <span class="quoted"><span class="free">ℰ'</span></span> <span class="quoted"><span class="quoted">"ℰ.indep_in <span class="free">ℰ'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lower_rank_of_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.lower_rank_of <span class="free">ℰ'</span> <span class="main">=</span> lower_rank_of <span class="free">ℰ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span><span class="main">.</span> ℰ'<span class="hidden">⇩</span><sub>1</sub>.basis <span class="bound">B</span> <span class="main">⟷</span> ℰ'<span class="hidden">⇩</span><sub>2</sub>.basis <span class="bound">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ** basis_in_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">ℰ'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def ℰ.basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lower_rank_of_def ℰ.lower_rank_of_def
    <span class="keyword1"><span class="command">using</span></span> basis_in_sub_cong<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> upper_rank_of_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.upper_rank_of <span class="free">ℰ'</span> <span class="main">=</span> upper_rank_of <span class="free">ℰ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span><span class="main">.</span> ℰ'<span class="hidden">⇩</span><sub>1</sub>.basis <span class="bound">B</span> <span class="main">⟷</span> ℰ'<span class="hidden">⇩</span><sub>2</sub>.basis <span class="bound">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ** basis_in_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">ℰ'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def ℰ.basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upper_rank_of_def ℰ.upper_rank_of_def
    <span class="keyword1"><span class="command">using</span></span> basis_in_sub_cong<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Matroid">
<div class="head">
<h1>Theory Matroid</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Matroid.thy
  Author:   Jonas Keinholz
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Matroids›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Matroid
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Indep_System.html">Indep_System</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_subset_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">B</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> card <span class="bound">B</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card.empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">B</span></span> <span class="main">⊆</span> <span class="skolem">A</span><span class="main">.</span> card <span class="bound">B</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc insert.hyps card_insert_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">locale</span></span> matroid <span class="main">=</span> indep_system <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> augment_aux<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="free">Y</span> <span class="main">⟹</span> card <span class="free">X</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="free">Y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="free">Y</span><span class="main">.</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> augment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="free">Y</span><span class="main">.</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X'</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms card_subset_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="free">Y</span><span class="main">)</span>"</span></span><span class="main">]</span> indep_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X'</span> <span class="main">-</span> <span class="free">Y</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms augment_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X'</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> indep_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X'</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> augment_psubset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊂</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="free">Y</span><span class="main">.</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms augment psubset_card_mono indep_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Minors›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A subset of the ground set induces a matroid.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matroid_subset <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matroid <span class="free">ℰ</span> <span class="main">(</span>indep_in <span class="free">ℰ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matroid_def matroid_axioms_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> indep_system augment<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> indep_system
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> indep_system_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>augment <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> augment_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> indep_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> augment_aux_indep_in <span class="main">=</span> ℰ.augment_aux
<span class="keyword1"><span class="command">lemmas</span></span> augment_indep_in <span class="main">=</span> ℰ.augment
<span class="keyword1"><span class="command">lemmas</span></span> augment_psubset_indep_in <span class="main">=</span> ℰ.augment_psubset

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bases›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> card <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> card <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> card <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;</span> card <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"basis <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"basis <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> card <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> augment basisD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹basis <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> basisD indep_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹basis <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> basisD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_indep_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"basis <span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">B'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_imp_subset_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_finite basis_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="skolem">B'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_augment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> basis <span class="main">(</span>insert <span class="bound">y</span> <span class="main">(</span><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> card <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms basis_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span> card_Diff1_less<span class="main">[</span><span class="operator">OF</span> basis_finite<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_indep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> indep_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms augment<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span> basis_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">y</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis <span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">indep</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basisI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> <span class="quoted">"insert"</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">&gt;</span> card <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert card.insert_remove<span class="main">[</span><span class="operator">OF</span> indep_finite<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub>'</span></span></span><span class="main">]</span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>card <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card.insert_remove<span class="main">[</span><span class="operator">OF</span> indep_finite<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">indep</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms basis_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> card.remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms basis_indep_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms insert y basis_finite indep_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> basis_in_card <span class="main">=</span> ℰ.basis_card<span class="main">[</span><span class="operator">OF</span> basis_inD_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span> basis_inD_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> basis_in_indep_in_card <span class="main">=</span> ℰ.basis_indep_card<span class="main">[</span><span class="operator">OF</span> _ basis_inD_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_augment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="main">(</span>insert <span class="bound">y</span> <span class="main">(</span><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.basis_augment <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Circuits›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_elim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">C<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> circuit <span class="bound">C<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?carrier</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> assms'<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">carrier</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">carrier</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms circuit_imp_circuit_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dep_iff_supset_circuit <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="var">?carrier</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> indep_inI<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?carrier</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="var">?carrier</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms' circuit_in_min_dep_in<span class="main">[</span><span class="operator">OF</span> * circuit_in_supI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="var">?carrier</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * assms indep_in_imp_subset_basis_in<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?carrier</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="var">?carrier</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * assms' circuit_in_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="var">?carrier</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B basis_in_subset_carrier<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> supset_circuit_in_imp_dep_in<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms B basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms B basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> indep_in_subset<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">B</span>"</span></span><span class="main">]</span> indep_in_indep
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms circuitD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms carrier_finite finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">≤</span> card <span class="main">(</span><span class="var">?carrier</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B basis_in_subset_carrier<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="var">?carrier</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> card_Diff_subset_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> card <span class="var">?carrier</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?carrier</span> <span class="main">=</span> card <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> card <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> card_Un_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">(</span>card <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> card_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> card <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> card_Diff_subset_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> card <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms circuit_nonempty <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∉</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?carrier</span>›</span></span> card_Diff_singleton <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">&lt;</span> card <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> basis_in_indep_in_card<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> B <span class="quoted"><span class="quoted">‹indep_in <span class="var">?carrier</span> <span class="var">?C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_dep_imp_supset_circuit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms circuitD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_dep_imp_ex1_supset_circuit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indep_subset_carrier dep_iff_supset_circuit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> ex unique<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circuit <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C'</span>
      <span class="keyword3"><span class="command">assume</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">≠</span> <span class="skolem">C</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="skolem">C'</span> <span class="main">∩</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C C' assms min_dep_imp_supset_circuit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span><span class="skolem">C'</span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> circuit_elim<span class="main">[</span><span class="operator">OF</span> C<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> C'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> supset_circuit_imp_dep<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C C' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms indep_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C'</span><span class="main">.</span> circuit <span class="bound">C'</span> <span class="main">∧</span> <span class="bound">C'</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">C'</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_ex1_supset_circuit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms min_dep_imp_ex1_supset_circuit basisD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fund_circuit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fund_circuit</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_iff_fund_circuit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"circuit <span class="free">C</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="bound">B</span> <span class="main">∧</span> basis <span class="bound">B</span> <span class="main">∧</span> <span class="free">C</span> <span class="main">=</span> fund_circuit <span class="bound">x</span> <span class="bound">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LTR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LTR <span class="keyword1"><span class="command">unfolding</span></span> circuit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_imp_subset_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LTR circuit_subset_carrier <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LTR B basis_subset_carrier supset_circuit_imp_dep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> B basis_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fund_circuit_def
    <span class="keyword1"><span class="command">using</span></span> LTR B theI_unique<span class="main">[</span><span class="operator">OF</span> basis_ex1_supset_circuit<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RTL <span class="skolem">x</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="skolem">x</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min_dep_imp_ex1_supset_circuit basisD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fund_circuit_def
    <span class="keyword1"><span class="command">using</span></span> theI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">C</span><span class="main">.</span> circuit <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="skolem">x</span> <span class="skolem">B</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fund_circuitI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fund_circuit <span class="free">x</span> <span class="free">B</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fund_circuit_def
  <span class="keyword1"><span class="command">using</span></span> assms theI_unique<span class="main">[</span><span class="operator">OF</span> basis_ex1_supset_circuit<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fund_circuit_in</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fund_circuit_in</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> matroid.fund_circuit <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="main">(</span>indep_in <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fund_circuit_inI_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"ℰ.fund_circuit <span class="free">x</span> <span class="free">B</span> <span class="main">=</span> fund_circuit_in <span class="free">ℰ</span> <span class="free">x</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fund_circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_in_elim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">C<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> circuit_in <span class="free">ℰ</span> <span class="bound">C<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.circuit_elim <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> min_dep_in_imp_supset_circuit_in <span class="main">=</span> ℰ.min_dep_imp_supset_circuit<span class="main">[</span><span class="operator">OF</span> _ circuit_inD_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> min_dep_in_imp_ex1_supset_circuit_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="free">ℰ</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">C</span><span class="main">.</span> circuit_in <span class="free">ℰ</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.min_dep_imp_ex1_supset_circuit <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_ex1_supset_circuit_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">C</span><span class="main">.</span> circuit_in <span class="free">ℰ</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.basis_ex1_supset_circuit <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fund_circuit_inI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fund_circuit_in <span class="free">ℰ</span> <span class="free">x</span> <span class="free">B</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.fund_circuitI
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def circuit_in_def fund_circuit_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fund_circuit_in_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ'</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ'</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.fund_circuit_in <span class="free">ℰ'</span> <span class="free">x</span> <span class="free">B</span> <span class="main">=</span> fund_circuit_in <span class="free">ℰ'</span> <span class="free">x</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ'</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms basis_in_ex1_supset_circuit_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ℰ'</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fund_circuit_in <span class="free">ℰ'</span> <span class="free">x</span> <span class="free">B</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms fund_circuit_inI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ℰ.fund_circuit_in <span class="free">ℰ'</span> <span class="free">x</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms C ℰ.fund_circuit_inI basis_in_sub_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ℰ</span></span><span class="main">]</span> circuit_in_sub_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ℰ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ranks›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rank_of</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rank_of</span> <span class="main">≡</span> lower_rank_of"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rank_of_def <span class="main">=</span> lower_rank_of_def
<span class="keyword1"><span class="command">lemmas</span></span> rank_of_sub_cong <span class="main">=</span> lower_rank_of_sub_cong
<span class="keyword1"><span class="command">lemmas</span></span> rank_of_le <span class="main">=</span> lower_rank_of_le

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lower_rank_of_eq_upper_rank_of<span class="main">:</span> <span class="quoted"><span class="quoted">"lower_rank_of <span class="free">ℰ</span> <span class="main">=</span> upper_rank_of <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_in_ex<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>card <span class="skolem">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> basis_in_card<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lower_rank_of_def upper_rank_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_eq_card_basis_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">ℰ</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>card <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> basis_in_card<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rank_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_indep_in_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> rank_of <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">B'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms indep_in_imp_subset_basis_in<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> card <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> basis_in_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">]</span> basis_in_card<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">B'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>card <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> basis_in <span class="free">ℰ</span> <span class="bound">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> collect_basis_in_finite<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rank_of_def <span class="keyword1"><span class="command">using</span></span> basis_in_ex<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">≤</span> rank_of <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="hidden">⇩</span><sub>X</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">X</span>  <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="hidden">⇩</span><sub>Y</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">Y</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">≤</span> card <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in_card<span class="main">[</span><span class="operator">OF</span> _ _ B<span class="hidden">⇩</span><sub>Y</sub><span class="main">]</span> basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> _ B<span class="hidden">⇩</span><sub>X</sub><span class="main">]</span> indep_in_subI_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms rank_of_eq_card_basis_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_insert_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">X</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B</span> <span class="main">∨</span> basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">x</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> B'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">∪</span> <span class="skolem">B'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms B basis_in_subI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="skolem">B'</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">x</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms B rank_of_eq_card_basis_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">x</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="free">x</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms rank_of_eq_card_basis_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms card.insert_remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> B basis_in_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms B basis_in_finite card_Diff1_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms B rank_of_eq_card_basis_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_Un_Int_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B_Int</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="skolem">B_Int</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="skolem">B_Int</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indep_in_subI_subset<span class="main">[</span><span class="operator">OF</span> _ basis_in_indep_in<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="skolem">B_Int</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B_Un</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="skolem">B_Un</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Int</span> <span class="main">⊆</span> <span class="skolem">B_Un</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indep_in_imp_subset_basis_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="skolem">B_Int</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc inf_left_commute inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms finite_subset<span class="main">[</span><span class="operator">OF</span> _ carrier_finite<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_Un_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">X</span> <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> _ B_Un<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> indep_in_subI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms rank_of_indep_in_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">Y</span> <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> _ B_Un<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> indep_in_subI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms rank_of_indep_in_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">Y</span> <span class="main">≥</span> card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">B_Un</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_subset_carrier<span class="main">[</span><span class="operator">OF</span> _ B_Un<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">B_Int</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">B_Int</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> _ B_Un<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> indep_in_subI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">B_Int</span></span><span class="main">]</span> B_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms carrier_finite finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_Int</span> <span class="main">⊆</span> <span class="skolem">B_Un</span> <span class="main">∩</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms B_Un B_Int basis_in_subset_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="skolem">B_Int</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_seteq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">Y</span> <span class="main">≥</span> card <span class="skolem">B_Un</span> <span class="main">+</span> card <span class="skolem">B_Int</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B_Un</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">OF</span> _ B_Un<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B_Int</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">OF</span> _ B_Int<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">Y</span> <span class="main">≥</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_of_Un_absorbI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⟹</span> rank_of <span class="main">(</span>insert <span class="bound">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Y</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span><span class="main">]</span> carrier_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">-</span> <span class="free">X</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct <span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="free">X</span> <span class="main">≤</span> rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="main">(</span><span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>  rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rank_of_Un_Int_le<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">y</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">-</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert insert<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">+</span> rank_of <span class="free">X</span> <span class="main">≥</span> rank_of <span class="free">X</span> <span class="main">+</span> rank_of <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert rank_of_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_iff_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span> <span class="main">⟷</span> rank_of <span class="free">X</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LTR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">X</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> indep_inI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">X</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> basis_inI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> RTL
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">X</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_in_ex<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RTL rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis_in_subset_carrier<span class="main">[</span><span class="operator">OF</span> assms B<span class="main">]</span> card_seteq<span class="main">[</span><span class="operator">OF</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms carrier_finite<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> assms B<span class="main">]</span> indep_in_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_iff_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">X</span> <span class="main">⟷</span> rank_of <span class="free">X</span> <span class="main">=</span> card <span class="free">X</span> <span class="main">∧</span> rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">carrier</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LTR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">=</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_iff_rank_of basis_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LTR rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> basis_iff_basis_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> RTL
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basisI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms RTL indep_iff_rank_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">-</span> <span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="free">carrier</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms x indep_inI rank_of_indep_in_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RTL <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> assms carrier_finite<span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_iff_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circuit <span class="free">X</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LTR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> indep_remove<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circuit_min_dep<span class="main">[</span><span class="operator">OF</span> LTR<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_iff_rank_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms rank_of_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">≠</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms LTR circuitD indep_iff_rank_of<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">≤</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * finite_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> carrier_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_remove <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms rank_of_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> RTL
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> indep_remove<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> circuitI<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dep indep_remove <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_Diff1_less<span class="main">[</span><span class="operator">OF</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms carrier_finite<span class="main"><span class="main">]</span></span> x<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_iff_rank_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> indep_iff_rank_of<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_iff_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟷</span> rank_of <span class="free">X</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.indep_iff_rank_of rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> * assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> basis_in_iff_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟷</span> rank_of <span class="free">X</span> <span class="main">=</span> card <span class="free">X</span> <span class="main">∧</span> rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ℰ.basis_iff_rank_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> basis_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> circuit_in_iff_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circuit_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟷</span> ℰ.circuit <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> circuit_in_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span>  <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> ℰ.rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ℰ.circuit_iff_rank_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span> <span class="main">⟷</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closure›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cl</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> rank_of <span class="main">(</span>insert <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> clI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">carrier</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> rank_of <span class="bound">Y</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">carrier</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> rank_of <span class="bound">Y</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">carrier</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> rank_of <span class="bound">Y</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">carrier</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> rank_of <span class="bound">Y</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="skolem">Y</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rank_of_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">≤</span> rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rank_of_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> cl_rank_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="free">X</span> <span class="main">⟹</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_subset_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> clD <span class="main">=</span> cl_rank_of cl_subset_carrier

<span class="keyword1"><span class="command">lemma</span></span> cl_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> insert_absorb<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> clI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">⊆</span> cl <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">X</span>›</span></span> cl_subset_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> X_insert<span class="main">:</span> matroid <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">X</span>›</span></span> cl_subset_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> Y_insert<span class="main">:</span> matroid <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> clI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms insert_absorb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="hidden">⇩</span><sub>X</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="free">X</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms basis_in_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">=</span> card <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">∧</span> rank_of <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">=</span> card <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">∧</span> rank_of <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms B<span class="hidden">⇩</span><sub>X</sub>
            basis_in_subset_carrier<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span><span class="main">]</span>
            basis_in_iff_rank_of<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cl_rank_of<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> cl <span class="free">X</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms basis_in_subset_carrier<span class="main">[</span><span class="operator">OF</span> _ B<span class="hidden">⇩</span><sub>X</sub><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> basis_in_iff_rank_of<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> _ B<span class="hidden">⇩</span><sub>X</sub><span class="main">]</span> indep_in_subI_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="hidden">⇩</span><sub>Y</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">⊆</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> indep_in_iff_subset_basis_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">Y</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">⊆</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">⊆</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span>
            B<span class="hidden">⇩</span><sub>Y</sub> basis_in_indep_in<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span><span class="main">]</span>
            indep_in_subset<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms B<span class="hidden">⇩</span><sub>X</sub>
            basis_in_subset_carrier<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span><span class="main">]</span>
            indep_in_supI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ℰ' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">X</span>›</span></span> B<span class="hidden">⇩</span><sub>X</sub> basis_in_subset_carrier<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> <span class="quoted"><span class="quoted">‹basis_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span>›</span></span>
            basis_in_max_indep_in<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> B<span class="hidden">⇩</span><sub>Y</sub> basis_in_subset_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span><span class="main">]</span>
        basis_in_supI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ℰ' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> <span class="quoted"><span class="quoted">‹basis_in <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">Y</span><span class="main">)</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>›</span></span> basis_in_subset_carrier
        <span class="keyword1"><span class="command">using</span></span> basis_in_iff_rank_of<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> <span class="quoted"><span class="quoted">‹basis_in <span class="free">Y</span> <span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span>›</span></span> basis_in_subset_carrier
        <span class="keyword1"><span class="command">using</span></span> basis_in_iff_rank_of<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">B<span class="hidden">⇩</span><sub>Y</sub></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_insert_absorb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> cl <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cl <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> elem<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elem <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rank_of_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">⊆</span> cl <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cl_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elem <span class="keyword1"><span class="command">using</span></span> cl_rank_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms cl_rank_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> clI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">⊆</span> cl <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier cl_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_cl_absorb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl <span class="main">(</span>cl <span class="free">X</span><span class="main">)</span> <span class="main">=</span> cl <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cl <span class="main">(</span>cl <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> elem<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elem <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> clI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">≥</span> rank_of <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> rank_of_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>cl <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> cl_subset_carrier cl_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
                rank_of_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="main">(</span>cl <span class="free">X</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span>cl <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elem cl_rank_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="main">(</span>cl <span class="free">X</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Diff_partition<span class="main">[</span><span class="operator">OF</span> cl_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>›</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rank_of_Un_absorbI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">-</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> cl <span class="free">X</span> <span class="main">-</span> <span class="free">X</span> <span class="main">-</span> <span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">⊆</span> cl <span class="main">(</span>cl <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cl_subset<span class="main">[</span><span class="operator">OF</span> cl_subset_carrier<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_augment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> clI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rank_of_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span>rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rank_of_insert_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>rank_of <span class="free">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rank_of_insert_le<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span> <span class="main">≠</span> rank_of <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="free">X</span> <span class="main">≤</span> rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms cl_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rank_of_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> clI_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> clI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> indep_inI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indep_in_iff_subset_basis_in<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> False<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B indep_in_subset<span class="main">[</span><span class="operator">OF</span> ** basis_in_indep_in<span class="main"><span class="main">[</span></span><span class="operator">OF</span> **<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms indep_in_indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_in <span class="free">X</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> basis_inI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> indep max_indep<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> indep
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indep_in_supI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">X</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B basis_in_subset_carrier<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_in_indep_in<span class="main">[</span><span class="operator">OF</span> ** B<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>max_indep <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> indep_in <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B basis_in_max_indep_in<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> indep_in_subI_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> B rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> rank_of_eq_card_basis_in<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> indep_in_carrier <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"indep_in <span class="free">carrier</span> <span class="main">=</span> <span class="free">indep</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indep_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indep_in_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cl <span class="main">(</span><span class="bound">X</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> I_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="free">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cl <span class="main">(</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl <span class="main">(</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> cl <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cl_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword2"><span class="keyword">and</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> cl <span class="main">(</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> clI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">I</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cl <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms False y <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl <span class="main">(</span>insert <span class="skolem">y</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cl_augment<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> assms False y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">y</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> matroid_I<span class="main">:</span> <span class="quoted"><span class="quoted">"matroid <span class="free">carrier</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> carrier_finite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> cl <span class="main">(</span><span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cl_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword2"><span class="keyword">and</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="free">I</span> <span class="bound">X</span> <span class="main">∧</span> <span class="free">I</span> <span class="bound">Y</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">&lt;</span> card <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">Y</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="main">¬</span><span class="free">I</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="free">I</span> <span class="bound">X</span> <span class="main">∧</span> <span class="free">I</span> <span class="bound">Y</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">&lt;</span> card <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">Y</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="main">¬</span><span class="free">I</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span> <span class="bound">Y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span><span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">}</span> <span class="main">⊆</span> Pow <span class="free">carrier</span> <span class="main">×</span> Pow <span class="free">carrier</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> carrier_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span><span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_in finite_imageI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> XY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">X</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> finite'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ carrier_finite<span class="main">]</span> XY <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> XY finite' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">-</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> y XY <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cl <span class="skolem">X</span> <span class="main">⊆</span> cl <span class="main">(</span>cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cl_mono cl_subset_carrier<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> XY <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cl_cl_absorb<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl <span class="skolem">X</span> <span class="main">⊆</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y I_def XY<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> cl <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> I_def
        <span class="keyword1"><span class="command">using</span></span> XY y clI' <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> y XY <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">X</span> <span class="main">⊆</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> cl <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> XY <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">-</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> t y clI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span>  <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XY<span class="main">(</span>1<span class="main">)</span> I_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> clI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> XY <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ carrier_finite<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">t</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">-</span> <span class="skolem">Y</span>›</span></span> y
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc card_gt_0_iff<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">X</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XY * <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">-</span> <span class="skolem">Y</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> insert <span class="skolem">t</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">using</span></span> finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_ge<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> insert <span class="skolem">t</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> insert <span class="skolem">t</span> <span class="main">(</span><span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> y <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">-</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> y <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">-</span> <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card.insert_remove<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> XY <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> XY <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cl_in</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cl_in</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> matroid.cl <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="main">(</span>indep_in <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_eq_cl_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">=</span> cl_in <span class="free">carrier</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> matroid_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cl <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> rank_of <span class="main">(</span>insert <span class="bound">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> ℰ.rank_of <span class="main">(</span>insert <span class="bound">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rank_of_sub_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">carrier</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cl_in <span class="free">carrier</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def ℰ.cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_inI_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> ℰ.cl <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_inD_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> ℰ.cl <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_inI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ℰ.clI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">ℰ</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> rank_of <span class="bound">Y</span> <span class="main">=</span> rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LTR <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">ℰ</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> ℰ.rank_of <span class="bound">Y</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ℰ.cl_altdef<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> Pow <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="skolem">Y</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RTL <span class="skolem">x</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">Y</span></span> <span class="main">∈</span> Pow <span class="free">ℰ</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> ℰ.rank_of <span class="bound">Y</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ℰ.cl_altdef<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_subset_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"cl_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ℰ.cl_subset_carrier <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_rank_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ℰ.cl_rank_of <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span>"</span></span><span class="main">]</span> cl_in_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> cl_inD <span class="main">=</span> cl_in_rank_of cl_in_subset_carrier

<span class="keyword1"><span class="command">lemma</span></span> cl_in_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ℰ.cl_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl_in <span class="free">ℰ</span> <span class="free">X</span> <span class="main">⊆</span> cl_in <span class="free">ℰ</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ℰ.cl_mono<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_insert_absorb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl_in <span class="free">ℰ</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.cl_insert_absorb <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_augment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ℰ.cl_augment <span class="keyword1"><span class="command">unfolding</span></span> cl_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> cl_inI_insert <span class="main">=</span> cl_inI_aux<span class="main">[</span><span class="operator">OF</span> ℰ.clI_insert<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_subI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cl_in <span class="free">ℰ'</span> <span class="free">X</span> <span class="main">⊆</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> elem<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elem <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms cl_inD<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ℰ'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cl_in <span class="free">ℰ</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cl_inI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ℰ<span class="main">:</span> matroid <span class="quoted"><span class="free">ℰ</span></span> <span class="quoted"><span class="quoted">"indep_in <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl_in_sub_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ'</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℰ.cl_in <span class="free">ℰ'</span> <span class="free">X</span> <span class="main">=</span> cl_in <span class="free">ℰ'</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> LTR RTL<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LTR <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> ℰ.rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
      ℰ.cl_in_rank_of<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      ℰ.cl_in_subset_carrier<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ℰ'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cl_inI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RTL <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>"</span></span> <span class="quoted"><span class="quoted">"rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms cl_inD<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℰ <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ℰ'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="free">X</span> <span class="main">=</span> rank_of <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℰ.rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> rank_of <span class="main">(</span>insert <span class="skolem">x</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rank_of_sub_cong<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="free">X</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ℰ.cl_inI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>