<div id="Matching">
<div class="head">
<h1>Theory Matching</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Matching
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> label <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_graph</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> finite <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> snd <span class="bound">e</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> fst <span class="bound">e</span> <span class="main">~=</span> snd <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">degree</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∨</span> snd <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">edge_as_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">edge_as_set</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">{</span>fst <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> label<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="bound">v</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weight</span><span class="main">::</span> <span class="quoted"><span class="quoted">"label set <span class="main">⇒</span> <span class="main">(</span>label <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">LV</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">OSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> label<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">OSC</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>fst <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> 
                     <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>fst <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>fst <span class="bound">e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">disjoint_edges</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">disjoint_edges</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">≠</span> fst <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">≠</span> snd <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">∧</span> 
                          snd <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">≠</span> fst <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">∧</span> snd <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">≠</span> snd <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matching</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">matching</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span> finite_graph <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">e1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound">e2</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> disjoint_edges <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matching_i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> label<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">matching_i</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>fst <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> 
  <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">&gt;</span><span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>fst <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">V_i</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> 
                  <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> label<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">V_i</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>edge_as_set <span class="main">`</span> matching_i <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">endpoint_inV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">endpoint_inV</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="keyword1">then</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">else</span> snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">relevant_endpoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> label<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span> set <span class="main">⇒</span> 
                                 <span class="main">(</span><span class="tfree">'v</span> <span class="main">*</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">relevant_endpoint</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">else</span> snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1" id="Matching-definition_of_range"><span class="command">lemma</span></span> definition_of_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"endpoint_inV <span class="free">V1</span> <span class="main">`</span> matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span> <span class="main">=</span> 
  <span class="main">{</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">e</span> <span class="main">∈</span> matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">.</span> endpoint_inV <span class="free">V1</span> <span class="bound">e</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matching-matching_i_edges_as_sets"><span class="command">lemma</span></span> matching_i_edges_as_sets<span class="main">:</span>
  <span class="quoted"><span class="quoted">"edge_as_set <span class="main">`</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span> <span class="main">=</span> 
  <span class="main">{</span> <span class="bound">e1</span><span class="main">.</span> <span class="main">∃</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">.</span> edge_as_set <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">e1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Matching-matching_disjointness"><span class="command">lemma</span></span> matching_disjointness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e2</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≠</span> <span class="free">e2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"edge_as_set <span class="free">e1</span> <span class="main">∩</span> edge_as_set <span class="free">e2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> edge_as_set_def disjoint_edges_def matching_def<span class="main">)</span>

<span class="keyword1" id="Matching-expand_set_containment"><span class="command">lemma</span></span> expand_set_containment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>matching_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> injectivity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_osc<span class="main">:</span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_m<span class="main">:</span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e1_in_M1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">∈</span> matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e2_in_M1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e2</span> <span class="main">∈</span> matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e1</span> <span class="main">≠</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"endpoint_inV <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="free">e1</span> <span class="main">≠</span> endpoint_inV <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="free">e2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> e1_in_M1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_i_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> e2_in_M1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e2</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_i_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> disjoint_edge_sets<span class="main">:</span> <span class="quoted"><span class="quoted">"edge_as_set <span class="free">e1</span> <span class="main">∩</span> edge_as_set <span class="free">e2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> diff is_m matching_disjointness <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> edge_as_set_def endpoint_inV_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>|M1| ≤ n1›</span></span></span></span>›</span></span>

<span class="keyword1" id="Matching-card_M1_le_NVL1"><span class="command">lemma</span></span> card_M1_le_NVL1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span> N <span class="free">V</span> <span class="free">L</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"endpoint_inV <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms injectivity
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"endpoint_inV <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="skolem">e</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> endpoint_inV_def matching_def
          matching_i_def OSC_def finite_graph_def definition_of_range<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms definition_of_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_inj_on_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matching-edge_as_set_inj_on_Mi"><span class="command">lemma</span></span> edge_as_set_inj_on_Mi<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on edge_as_set <span class="main">(</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def edge_as_set_def matching_def
    disjoint_edges_def matching_i_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Matching-card_Mi_eq_card_edge_as_set_Mi"><span class="command">lemma</span></span> card_Mi_eq_card_edge_as_set_Mi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>edge_as_set<span class="main">`</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?Mi</span> <span class="main">=</span> card <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="main">_</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="var">?Mi</span> <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="var">?Mi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def matching_i_edges_as_sets edge_as_set_inj_on_Mi<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matching-card_edge_as_set_Mi_twice_card_partitions"><span class="command">lemma</span></span> card_edge_as_set_Mi_twice_card_partitions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span> <span class="main">∧</span> matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> card <span class="main">(</span>edge_as_set<span class="main">`</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> 
  <span class="main">=</span> card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> card <span class="var">?C</span> <span class="main">=</span> card <span class="var">?Vi</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="var">?C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def 
      matching_i_def edge_as_set_def finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> V_i_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_partition<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UnionD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">c</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> imageE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> edge_as_set <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> matching_i_def matching_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">≠</span> snd <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 3 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> edge_as_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
    <span class="keyword3"><span class="command">assume</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e1</span> <span class="skolem">e2</span>
      <span class="keyword3"><span class="command">assume</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> edge_as_set <span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> edge_as_set <span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> 7 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_i_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 6 7 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∩</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 7 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matching_disjointness<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> 4 5 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∩</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matching-card_Mi_twice_card_Vi"><span class="command">lemma</span></span> card_Mi_twice_card_Vi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span> <span class="main">∧</span> matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> card <span class="main">(</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> edge_as_set_def finite_subset
      matching_def finite_graph_def V_i_def matching_i_def <span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Mi_eq_card_edge_as_set_Mi 
      card_edge_as_set_Mi_twice_card_partitions V_i_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Matching-card_Mi_le_floor_div_2_Vi"><span class="command">lemma</span></span> card_Mi_le_floor_div_2_Vi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span> <span class="main">∧</span> matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_Mi_twice_card_Vi<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="Matching-card_Vi_le_NVLi"><span class="command">lemma</span></span> card_Vi_le_NVLi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&gt;</span><span class="main">1</span> <span class="main">∧</span> matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">≤</span> N <span class="free">V</span> <span class="free">L</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> N_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"edge_as_set <span class="main">`</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">L</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">i</span><span class="main">}</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span> <span class="main">⊆</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> V_i_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Union_least<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">.</span> edge_as_set <span class="bound">x</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_i_edges_as_sets<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="var">?C</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> finite_graph_def matching_def
        matching_i_def edge_as_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>|Mi| ≤ ⌊ni/2⌋›</span></span></span></span>›</span></span>

<span class="keyword1" id="Matching-card_Mi_le_floor_div_2_NVLi"><span class="command">lemma</span></span> card_Mi_le_floor_div_2_NVLi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span> <span class="main">∧</span> matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>N <span class="free">V</span> <span class="free">L</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>N <span class="free">V</span> <span class="free">L</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Vi_le_NVLi<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span>N <span class="free">V</span> <span class="free">L</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>matching_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>V_i <span class="free">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_Mi_le_floor_div_2_Vi<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>|M| ≤ ∑|Mi|›</span></span></span></span>›</span></span>
<span class="keyword1" id="Matching-card_M_le_sum_card_Mi"><span class="command">lemma</span></span> card_M_le_sum_card_Mi<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">.</span> card <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="main">_</span> <span class="main">≤</span> <span class="var">?CardMi</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?UnMi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">.</span> matching_i <span class="bound">x</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?UnMi</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def 
      finite_graph_def matching_i_def finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> e_inM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"relevant_endpoint <span class="free">L</span> <span class="free">V</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> matching_i <span class="main">(</span><span class="free">L</span> <span class="var">?v</span><span class="main">)</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms e_inM
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">(</span>fst <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms e_inM 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relevant_endpoint_def matching_i_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">(</span>fst <span class="skolem">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">(</span>fst <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">L</span> <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> 
          <span class="main">∨</span>  <span class="main">(</span><span class="free">L</span> <span class="main">(</span>fst <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> <span class="free">L</span> <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span> <span class="main">∧</span> <span class="free">L</span> <span class="main">(</span>fst <span class="skolem">e</span><span class="main">)</span> <span class="main">&gt;</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms e_inM <span class="keyword1"><span class="command">unfolding</span></span> OSC_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> expand_set_containment<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms e_inM a 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relevant_endpoint_def matching_i_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms e_inM 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def 
          relevant_endpoint_def matching_i_def finite_graph_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="skolem">e</span> <span class="main">∈</span> matching_i <span class="main">(</span><span class="free">L</span> <span class="bound">v</span><span class="main">)</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 1 2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main">)</span> 
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> <span class="var">?UnMi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">≤</span> card <span class="var">?UnMi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?UnMi</span> <span class="main">=</span> <span class="var">?CardMi</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> card_UN_disjoint<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">.</span> finite <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">unfolding</span></span> matching_def finite_graph_def matching_i_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> 
        matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span> <span class="main">∩</span> matching_i <span class="bound">j</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_i_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> card_M_le_weight_NVLi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">≤</span> weight <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">L</span> <span class="main">`</span> <span class="free">V</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span>N <span class="free">V</span> <span class="free">L</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?W</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M01</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound"><span class="bound">i</span></span><span class="main">|</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mgr1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound"><span class="bound">i</span></span><span class="main">|</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">.</span> card <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span><span class="free">L</span><span class="main">`</span><span class="free">V</span><span class="main">.</span> card <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">≤</span> <span class="var">?Mi</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_M_le_sum_card_Mi<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi</span> <span class="main">≤</span> <span class="var">?W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">L</span> <span class="main">`</span> <span class="free">V</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">L</span> <span class="main">`</span> <span class="free">V</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> card <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?set01</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">L</span> <span class="main">`</span> <span class="free">V</span> <span class="main">&amp;</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">|</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="main">(</span><span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="var">?A</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.union_disjoint<span class="main">)</span>    
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Mi</span> <span class="main">=</span> <span class="var">?M01</span><span class="main">+</span> <span class="var">?Mgr1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms a b 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_def finite_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>matching_i <span class="main">0</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matching_i_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M01</span> <span class="main">≤</span> N <span class="free">V</span> <span class="free">L</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M01</span> <span class="main">=</span> card <span class="main">(</span>matching_i <span class="main">1</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> a assms <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?set01</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?set01</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms a 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> card_M1_le_NVL1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> a assms <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?set01</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">L</span><span class="main">`</span><span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?set01</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M01</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> card <span class="main">(</span>matching_i <span class="bound">i</span> <span class="free">V</span> <span class="free">E</span> <span class="free">M</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Mgr1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span><span class="main">|</span><span class="bound">i</span><span class="main">∈</span><span class="free">L</span><span class="main">`</span><span class="free">V</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">.</span> N <span class="free">V</span> <span class="free">L</span> <span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono card_Mi_le_floor_div_2_NVLi<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 3 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weight_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Final Theorem›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem is due to Edmond~\cite{Edmonds:matching}:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> maximum_cardinality_matching<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OSC <span class="free">L</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">=</span> weight <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">L</span> <span class="main">`</span> <span class="free">V</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span>N <span class="free">V</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"matching <span class="free">V</span> <span class="free">E</span> <span class="free">M'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M'</span> <span class="main">≤</span> card <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms card_M_le_weight_NVLi
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The widely used algorithmic library LEDA has a certifying algorithm for maximum cardinality matching.
This Isabelle proof is part of the work done to verify the checker of this certifying algorithm. For more information see \cite{VerificationofCertifyingComputations}.›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>