<div id="Catalan_Auxiliary_Integral">
<div class="head">
<h1>Theory Catalan_Auxiliary_Integral</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Catalan numbers›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Catalan_Auxiliary_Integral
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Equivalence_Lebesgue_Henstock_Integration.html">HOL-Analysis.Equivalence_Lebesgue_Henstock_Integration</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary integral›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First, we will prove the integral $$\int\limits_0^4 \sqrt{\frac{4-x}{x}}\,\textrm{d}x = 2\pi$$
  which occurs in the proof for the integral formula for the Catalan numbers.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First of all, we prove two limits that we will require.
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> limit1<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> at_bot <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lhopital_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="numeral">4</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="numeral">4</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> 
          <span class="main">-</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_bot <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filterlim_uminus_at_top <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIM_at_top_divide tendsto_const eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> * <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">1</span><span class="main">)</span> at_bot <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> limit2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="main">0</span><span class="main">.</span> sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_rightI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_mult<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we prove the integral by explicitly constructing the indefinite integral.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> catalan_aux_integral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> arctan <span class="main">(</span><span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="comment1">― ‹The nice part of the indefinite integral. The endpoints are removable singularities.›</span>
    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="numeral">4</span> <span class="keyword1">then</span> pi <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span>pi <span class="keyword1">else</span> <span class="skolem">F</span> <span class="bound">x</span>"</span></span>
    <span class="comment1">― ‹The actual indefinite integral including the endpoints.›</span>

  <span class="comment1">― ‹We now prove that the indefinite integral indeed tends to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"pi"</span><span class="antiquote">}</span></span> resp. <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">-</span>pi"</span><span class="antiquote">}</span></span> 
      at the edges of the integration interval.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">/</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_tendsto_pos_mult_at_top <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> filterlim_tendsto_add_at_top
          filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sqrt_at_top<span class="main"><span class="main">]</span></span> LIM_at_top_divide eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> at_top <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> limit2 filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_arctan_at_top<span class="main"><span class="main">]</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">⤏</span> <span class="main">-</span>pi<span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> G_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="main">⤏</span> <span class="main">-</span>pi<span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_bot <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_tendsto_pos_mult_at_bot <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> limit1 <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="numeral">4</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">:&gt;</span> at_bot"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> * ** filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_arctan_at_bot<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">⤏</span> pi<span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> G_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="main">⤏</span> pi<span class="main">)</span> <span class="main">(</span>at_left <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  
  <span class="comment1">― ‹The derivative of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">G</span></span><span class="antiquote">}</span></span> is indeed the integrand in the interior of 
      the integration interval.›</span>
  <span class="keyword1"><span class="command">have</span></span> deriv_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="keyword1">has_field_derivative</span> sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">4</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">4</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
    
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="skolem">T</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> arctan <span class="main">(</span><span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> 
             <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">T</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> * <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power2_eq_square mult_ac<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">T</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">…</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> arctan <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span>
                        <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="keyword1">has_field_derivative</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> * <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> DERIV_cong_ev<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl eq refl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="comment1">― ‹It is now obvious that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">G</span></span><span class="antiquote">}</span></span> is continuous over the entire integration interval.›</span>
  <span class="keyword1"><span class="command">have</span></span> cont_G<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> continuous_on
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">4</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="main">⤏</span> <span class="skolem">G</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="main">≤</span> at_right <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> at_within_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> G_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="main">⤏</span> <span class="main">-</span>pi<span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">=</span> <span class="skolem">G</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="main">(</span><span class="numeral">4</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="main">≤</span> at_left <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> at_within_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> G_4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="main">⤏</span> pi<span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pi <span class="main">=</span> <span class="skolem">G</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="numeral">4</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> deriv_G<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">G</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_isCont<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> isCont_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> at_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="comment1">― ‹Finally, we can apply the Fundamental Theorem of Calculus.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">G</span> <span class="numeral">4</span> <span class="main">-</span> <span class="skolem">G</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cont_G deriv_G
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus_interior<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="numeral">4</span> <span class="main">-</span> <span class="skolem">G</span> <span class="main">0</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Catalan_Numbers">
<div class="head">
<h1>Theory Catalan_Numbers</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Catalan_Numbers.thy
  Author:   Manuel Eberl (TUM)

  The recursive definition of Catalan numbers with a proof of several closed form
  expressions for them using generating functions. Also contains reasonably efficient
  code generation and a proof of their asymptotic growth.
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Catalan_Numbers
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Catalan_Auxiliary_Integral.html">Catalan_Auxiliary_Integral</a>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Formal_Power_Series.html">HOL-Computational_Algebra.Formal_Power_Series</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
  <a href="../Landau_Symbols/Landau_More.html">Landau_Symbols.Landau_More</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Other auxiliary lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_eq_imp_eq_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> semidom_divide<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">div</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Gamma_minus_one_half_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> sqrt pi"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rGamma_plus1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">::</span> real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rGamma_inverse_Gamma <span class="dynamic"><span class="dynamic">divide_simps</span></span> Gamma_one_half_real <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_asymptotic'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="main">ℕ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">z</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Gamma <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_eq_zero_iff uminus_in_nonpos_Ints_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> at_top at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_subseq strict_mono_add<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> asymp_equivI'_const<span class="main">[</span><span class="operator">OF</span> gbinomial_asymptotic<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">z</span> <span class="keyword1">gchoose</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>Gamma <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">(</span><span class="free">z</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_eq_zero_iff uminus_in_nonpos_Ints_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span><span class="main">(</span><span class="free">z</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">z</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Gamma <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_subseq strict_mono_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">+</span> real <span class="free">k</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> real"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_powr_real<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define Catalan numbers by their well-known recursive definition. We shall later derive
  a few more equivalent definitions from this one.
›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span> <span class="main">=</span> sum.cong
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">catalan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">catalan</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">catalan</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="free">catalan</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">catalan</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> catalan.simps<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> catalan_0 <span class="main">=</span> catalan.simps<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> catalan_Suc <span class="main">=</span> catalan.simps<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> catalan_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"catalan <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_Suc<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The easiest proof of the more profound properties of the Catalan numbers (such as their
  closed-form equation and their asymptotic growth) uses their ordinary generating function (OGF).
  This proof is almost mechanical in the sense that it does not require `guessing' the closed
  form; one can read it directly from the generating function.

  We therefore define the OGF of the Catalan numbers ($\sum_{n=0}^\infty C_n z^n$ in standard
  mathematical notation):
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fps_catalan</span> <span class="main">=</span> Abs_fps <span class="main">(</span>of_nat <span class="main">∘</span> catalan<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fps_catalan_nth <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_nth fps_catalan <span class="free">n</span> <span class="main">=</span> of_nat <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_catalan_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given their recursive definition, it is easy to see that the OGF of the Catalan numbers
  satisfies the following recursive equation:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> fps_catalan_recurrence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fps_catalan <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> fps_X <span class="main">*</span> fps_catalan<span class="main">^</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fps_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fps_nth fps_catalan <span class="skolem">n</span> <span class="main">=</span> fps_nth <span class="main">(</span><span class="main">1</span> <span class="main">+</span> fps_X <span class="main">*</span> fps_catalan<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_square_nth catalan_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now easily solve this equation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">fps_catalan</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: if we denote the unknown OGF as
  $F(z)$, we get $F(z) = \frac{1}{2}(1 - \sqrt{1 - 4z})$.

  Note that we do not actually use the square root as defined on real or complex numbers.
  Any $(1 + cz)^\alpha$ can be expressed using the formal power series whose coefficients are
  the generalised binomial coefficients, and thus we can do all of these transformations in a
  purely algebraic way: $\sqrt{1-4z} = (1+z)^{\frac{1}{2}} \circ (-4z)$ (where ${\circ}$ denotes
  composition of formal power series) and $(1+z)^\alpha$ has the well-known expansion
  $\sum_{n=0}^\infty {\alpha \choose n} z^n$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> fps_catalan_fps_binomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fps_catalan <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>fps_binomial <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">oo</span> <span class="main">(</span><span class="main">-</span><span class="numeral">4</span><span class="main">*</span>fps_X<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fps_X"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_eq_imp_eq_div<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fps_catalan <span class="main">::</span> <span class="tfree">'a</span> fps"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_X <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> fps_X <span class="main">*</span> <span class="var">?F</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> fps_X <span class="main">*</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fps_catalan_recurrence <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> fps_X <span class="main">*</span> <span class="var">?F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">-</span> fps_X <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square fps_numeral_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>fps_binomial <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">oo</span> <span class="main">(</span><span class="main">-</span><span class="numeral">4</span><span class="main">*</span>fps_X<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib div_power fps_binomial_1 fps_binomial_power
                  fps_compose_power fps_compose_add_distrib ring_distribs<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> fps_X <span class="main">*</span> <span class="var">?F</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>fps_binomial <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">oo</span> <span class="main">(</span><span class="main">-</span><span class="numeral">4</span><span class="main">*</span>fps_X<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fps_power_eqD<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fps_X<span class="main">*</span><span class="var">?F</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>fps_binomial <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">oo</span> <span class="main">(</span><span class="main">-</span><span class="numeral">4</span><span class="main">*</span>fps_X<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closed-form formulae and more recurrences›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now read a closed-form formula for the Catalan numbers directly from the generating
  function $\frac{1}{2z}(1 - (1+z)^{\frac{1}{2}} \circ (-4z))$.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> catalan_closed_form_gbinomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"real <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">gchoose</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>catalan <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> fps_nth fps_catalan <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">gchoose</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fps_catalan_fps_binomial<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_div_fps_X_nth numeral_fps_const fps_compose_linear<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This closed-form formula can easily be rewritten to the form $C_n = \frac{1}{n+1} {2n \choose n}$,
  which contains only `normal' binomial coefficients and not the generalised ones:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> catalan_closed_form_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"catalan <span class="free">n</span> <span class="main">*</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binomial_fact power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">n</span> <span class="main">*</span> fact <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fact_double power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">/</span> <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_closed_form_gbinomial gbinomial_pochhammer pochhammer_rec
          <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square power_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>catalan <span class="free">n</span> <span class="main">*</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> of_nat_catalan_closed_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>catalan <span class="free">n</span> <span class="main">*</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> catalan_closed_form_aux<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>catalan <span class="free">n</span> <span class="main">*</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> catalan_closed_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"catalan <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> catalan_closed_form_aux <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc_right<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is another nice closed-form formula for the Catalan numbers, which directly
  follows from the previous one:
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> catalan_closed_form'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"catalan <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> real <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>fact <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> fact <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> binomial_fact<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>fact <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power2_eq_square<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_catalan_closed_form<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> binomial_fact<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now easily show that the Catalan numbers also satisfy another, simpler recurrence,
  namely $C_{n+1} = \frac{2(2n+1)}{n+2} C_n$. We will later use this to prove code equations to
  compute the Catalan numbers more efficiently.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> catalan_Suc_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> catalan <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> of_nat_catalan_closed_form<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> binomial_fact<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> catalan <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_ac of_nat_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> of_nat_catalan_Suc'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span>of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span>
          of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> catalan <span class="free">n</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> mult_ac <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc mult_Suc_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> catalan_Suc_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="main">(</span>catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc mult_Suc_right mult_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> catalan_Suc'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>catalan <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> catalan_Suc_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"catalan <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> catalan <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc mult_Suc_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Integral formula›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The recursive formula we have just proven allows us to derive an integral formula for 
  the Catalan numbers. The proof was adapted from a textbook proof by Steven Roman.~\cite{catalan}
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> has_integral_I0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span><span class="main">-</span><span class="main">{}</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_half_sqrt real_sqrt_divide<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_spike<span class="main"><span class="main">[</span></span><span class="operator">OF</span> negligible_empty _ catalan_aux_integral<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> integrable_I<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> has_integral_I0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_integrable<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_continuous_real continuous_on_mult continuous_on_powr'<span class="main">)</span>
                  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> I_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> I <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">v'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u'</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> u'_def v_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u'</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> I <span class="free">n</span> <span class="main">-</span> I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integration_by_parts_interior<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bounded_bilinear_mult<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_powr' continuous_on_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_powr' continuous_on_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">u'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff_has_vector_derivative <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> u_def u'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_half_sqrt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">v'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff_has_vector_derivative <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> v_def v'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">v'</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">u</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">v</span> <span class="numeral">4</span> <span class="main">-</span> <span class="skolem">u</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">-</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> I <span class="free">n</span> <span class="main">-</span> I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_spike<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">v'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def v'_def c_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_add<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_half_sqrt<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> 
                     sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_add<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">v'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">i</span> <span class="free">n</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">i</span> <span class="free">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> I <span class="free">n</span> <span class="main">-</span> I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> i_def I_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_mult_right has_integral_diff integrable_integral integrable_I<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">i</span> <span class="free">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>  <span class="skolem">u</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">v</span> <span class="numeral">4</span> <span class="main">-</span> <span class="skolem">u</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">-</span> <span class="main">-</span>
               <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> I <span class="free">n</span> <span class="main">-</span> I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def v_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u'</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">v</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u'_def v_def i_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> I <span class="free">n</span> <span class="main">-</span> I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> I <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> I <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> c_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> catalan_eq_I<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span> <span class="main">=</span> I <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> has_integral_I0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def integral_unique<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_catalan_Suc' Suc.IH I_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> catalan_integral_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> 
       <span class="keyword1">has_integral</span> real <span class="main">(</span>catalan <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
           I <span class="free">n</span> <span class="main">*</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">4</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_mult_left integrable_integral integrable_I<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_eq_I <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Asymptotics›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using the closed form $C_n = 2 \cdot (-4)^n {\frac{1}{2} \choose n+1}$ and the fact that
  ${\alpha \choose n} \sim \frac{(-1)^n}{\Gamma(-\alpha) n^{\alpha + 1}}$ for any
  $\alpha \notin \mathbb{N}$, wwe can now easily analyse the asymptotic behaviour of the
  Catalan numbers:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> catalan_asymptotics<span class="main">:</span>
  <span class="quoted"><span class="quoted">"catalan <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">4</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>sqrt pi <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"catalan <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> catalan_closed_form_gbinomial<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Gamma <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fraction_not_in_nats<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> gbinomial_asymptotic'<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">…</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">4</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>sqrt pi <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_minus_one_half_real power_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation to binary trees›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is well-known that the Catalan number $C_n$ is the number of rooted binary trees with
  $n$ internal nodes (where internal nodes are those with two children and external nodes
  are those with no children).

  We will briefly show this here to show that the above asymptotic formula also describes the
  number of binary trees of a given size.
›</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">datatype</span></span> tree <span class="main">=</span> Leaf <span class="main">|</span> Node <span class="quoted">tree</span> <span class="quoted">tree</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">count_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tree <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">count_nodes</span> Leaf <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">count_nodes</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">count_nodes</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">+</span> <span class="free">count_nodes</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">trees_of_size</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> tree set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">trees_of_size</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> count_nodes <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_nodes_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"count_nodes <span class="free">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">t</span> <span class="main">=</span> Leaf"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> trees_of_size_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trees_of_size <span class="main">0</span> <span class="main">=</span> <span class="main">{</span>Leaf<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trees_of_size_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trees_of_size_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"trees_of_size <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> Node <span class="bound">l</span> <span class="bound">r</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> trees_of_size <span class="bound">k</span> <span class="main">×</span> trees_of_size <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?lhs</span> <span class="main">⟷</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trees_of_size_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_trees_of_size <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>trees_of_size <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> catalan.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trees_of_size_Suc <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_imageI finite_cartesian_product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trees_of_size_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"trees_of_size <span class="free">n</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> catalan.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trees_of_size_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trees_of_size_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"trees_of_size <span class="free">m</span> <span class="main">∩</span> trees_of_size <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trees_of_size_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> card_trees_of_size<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>trees_of_size <span class="free">n</span><span class="main">)</span> <span class="main">=</span> catalan <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> catalan.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_Suc trees_of_size_Suc card_image inj_on_def
        trees_of_size_disjoint Times_Int_Times catalan_Suc card_UN_disjoint<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Efficient computation›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We shall now prove code equations that allow more efficient computation of Catalan numbers.
  In order to do this, we define a tail-recursive function that uses the recurrence
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> catalan_Suc'<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">catalan_aux</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">catalan_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="keyword1">else</span> <span class="free">catalan_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">acc</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">-</span> <span class="bound">b</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">lemma</span></span> catalan_aux_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">⟹</span> catalan_aux <span class="free">n</span> <span class="free">k</span> <span class="free">acc</span> <span class="main">=</span> <span class="free">acc</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> catalan_aux <span class="free">n</span> <span class="free">k</span> <span class="free">acc</span> <span class="main">=</span> catalan_aux <span class="free">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">acc</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> catalan_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">lemma</span></span> catalan_aux_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"catalan_aux <span class="free">n</span> <span class="free">k</span> <span class="main">(</span>catalan <span class="free">k</span><span class="main">)</span> <span class="main">=</span> catalan <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="quoted">"catalan <span class="free">k</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> catalan_aux.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"catalan_aux <span class="skolem">n</span> <span class="skolem">k</span> <span class="main">(</span>catalan <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> catalan_aux <span class="skolem">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>catalan <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> catalan_Suc'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_aux_simps<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_Suc'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted">"1.prems"</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> catalan_aux_simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> catalan_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"catalan <span class="free">n</span> <span class="main">=</span> catalan_aux <span class="free">n</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> catalan_aux_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>