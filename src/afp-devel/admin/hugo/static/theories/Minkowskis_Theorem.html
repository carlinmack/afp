<div id="Minkowskis_Theorem">
<div class="head">
<h1>Theory Minkowskis_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Minkowskis_Theorem.thy
  Author:  Manuel Eberl &lt;eberlm@in.tum.de&gt;

  A proof of Blichfeldt's and Minkowski's theorem about the relation between
  subsets of the Euclidean space, the Lebesgue measure, and the integer lattice.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Minkowski's theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Minkowskis_Theorem
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Equivalence_Lebesgue_Henstock_Integration.html">HOL-Analysis.Equivalence_Lebesgue_Henstock_Integration</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Could be generalised to arbitrary euclidean spaces and full-dimensional lattices *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous material›</span></span>

<span class="keyword1" id="Minkowskis_Theorem-bij_betw_UN"><span class="command">lemma</span></span> bij_betw_UN<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">of_int_vec</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">of_int_vec</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> of_int <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Minkowskis_Theorem-of_int_vec_nth"><span class="command">lemma</span></span> of_int_vec_nth <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_int_vec <span class="free">v</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> of_int <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_vec_def<span class="main">)</span>

<span class="keyword1" id="Minkowskis_Theorem-of_int_vec_eq_iff"><span class="command">lemma</span></span> of_int_vec_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int_vec <span class="free">a</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ring_char_0<span class="main">)</span> <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> <span class="main">=</span> of_int_vec <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_vec_def vec_eq_iff<span class="main">)</span>

<span class="keyword1" id="Minkowskis_Theorem-inj_axis"><span class="command">lemma</span></span> inj_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> axis <span class="bound">k</span> <span class="free">c</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"axis <span class="skolem">x</span> <span class="free">c</span> <span class="main">=</span> axis <span class="skolem">y</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"axis <span class="skolem">x</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">=</span> axis <span class="skolem">x</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> axis_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowskis_Theorem-compactD"><span class="command">lemma</span></span> compactD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> metric_space set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="free">f</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span> <span class="bound">l</span><span class="main">.</span> strict_mono <span class="main">(</span><span class="bound">h</span><span class="main">::</span>nat<span class="main">⇒</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="bound">h</span><span class="main">)</span> <span class="main">⇢</span> <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> compact_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Minkowskis_Theorem-closed_lattice"><span class="command">lemma</span></span> closed_lattice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"closed <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> discrete_imp_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_less_one<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>abs <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> component_le_norm_cart<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> of_int <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">m</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_less_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary theorems about measure theory›</span></span>

<span class="keyword1" id="Minkowskis_Theorem-emeasure_lborel_cbox_eq'"><span class="command">lemma</span></span> emeasure_lborel_cbox_eq'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"emeasure lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">∏</span><span class="bound">e</span><span class="main">∈</span>Basis<span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ba</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">ba</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">ba</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"emeasure lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span>prod <span class="main">(</span><span class="main">(∙)</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> Basis<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> emeasure_lborel_cbox_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">(∙)</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> Basis <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">e</span><span class="main">∈</span>Basis<span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def inner_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"emeasure lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emeasure_lborel_cbox_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">e</span><span class="main">∈</span>Basis<span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def inner_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowskis_Theorem-emeasure_lborel_cbox_cart_eq"><span class="command">lemma</span></span> emeasure_lborel_cbox_cart_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="main">(</span><span class="tfree">'n</span> <span class="main">::</span> finite<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emeasure lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">∏</span><span class="bound">e</span><span class="main">∈</span>Basis<span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> emeasure_lborel_cbox_eq' <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Basis <span class="main">::</span> <span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span> <span class="main">=</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> axis <span class="bound">k</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Basis_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">e</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_axis <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> inner_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowskis_Theorem-sum_emeasure'"><span class="command">lemma</span></span> sum_emeasure'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span> <span class="main">∩</span> <span class="free">B</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">∩</span> <span class="free">B</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> null_sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> null_sets.finite_UN<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="skolem">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">…</span> <span class="main">=</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> emeasure_Un_null_set<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sets.Un sets.Diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_emeasure<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def C_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sets.Diff sets.finite_UN<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl emeasure_Diff_null_set<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowskis_Theorem-sums_emeasure'"><span class="command">lemma</span></span> sums_emeasure'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span> <span class="main">∩</span> <span class="free">B</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="main">-</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">∩</span> <span class="free">B</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> null_sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> null_sets_UN'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="skolem">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_sets_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">…</span> <span class="main">=</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> emeasure_Un_null_set<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sets.Un sets.Diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">…</span>  "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_emeasure<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def C_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sets.Diff sets.finite_UN<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext emeasure_Diff_null_set<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Blichfeldt's theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Blichfeldt's theorem states that, given a subset of $\mathbb{R}^n$ with $n &gt; 0$ and a
  volume of more than 1, there exist two different points in that set whose difference
  vector has integer components.

  This will be the key ingredient in proving Minkowski's theorem.

  Note that in the HOL Light version, it is additionally required -- both for
  Blichfeldt's theorem and for Minkowski's theorem -- that the set is bounded,
  which we do not need.
›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> blichfeldt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">S</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹We define for each lattice point in $\mathbb{Z}^n$ the corresponding cell in $\mathbb{R}^n$.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">^</span> <span class="tfree">'n</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> cbox <span class="main">(</span>of_int_vec <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>of_int_vec <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">― ‹For each lattice point, we can intersect the cell it defines with our set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span>
      to obtain a partitioning of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">^</span> <span class="tfree">'n</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">S</span> <span class="main">∩</span> <span class="skolem">R</span> <span class="bound">a</span><span class="main">)</span>"</span></span>

  <span class="comment1">― ‹We can then translate each such partition into the cell at the origin, i.\,e. the
      unit box <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">R</span> <span class="main">0</span>"</span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">^</span> <span class="tfree">'n</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> of_int_vec <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">T</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> T'_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> of_int_vec <span class="skolem">a</span><span class="main">)</span> <span class="main">-`</span> <span class="skolem">T</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">unfolding</span></span> T'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">― ‹We need to show measurability of all the defined sets.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">a</span> <span class="main">∈</span> sets lebesgue"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">a</span> <span class="main">∈</span> sets lebesgue"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> of_int_vec <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> lebesgue <span class="keyword1">→<span class="hidden">⇩</span><sub>M</sub></span> lebesgue"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">using</span></span> lebesgue_affine_measurable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"of_int_vec <span class="skolem">a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euclidean_representation add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> measurable_sets<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">a</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="skolem">a</span> <span class="main">∈</span> sets lebesgue"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">unfolding</span></span> T'_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">― ‹Obviously, the original set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> is the union of all the lattice
      point cell partitions.›</span>
  <span class="keyword1"><span class="command">have</span></span> S_decompose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⌊</span><span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> R_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cbox_interval less_eq_vec_def of_int_vec_def a_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">S</span> <span class="main">∩</span> <span class="skolem">R</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Translating the partitioned subsets does not change their volume.›</span>
  <span class="keyword1"><span class="command">have</span></span> emeasure_T'<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="main">(</span><span class="skolem">T'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> of_int_vec <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">T</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="main">…</span> <span class="main">=</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> emeasure_lebesgue_affine<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Each translated partition of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> is a subset of the unit cell at the origin.›</span>
  <span class="keyword1"><span class="command">have</span></span> T'_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="skolem">a</span> <span class="main">⊆</span> cbox <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">unfolding</span></span> T'_def T_def R_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> cbox_interval of_int_vec_def less_eq_vec_def<span class="main">)</span>

  <span class="comment1">― ‹It is clear that the intersection of two different lattice point cells is a null set.›</span>
  <span class="keyword1"><span class="command">have</span></span> R_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">R</span> <span class="skolem">b</span> <span class="main">∈</span> null_sets lebesgue"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">R</span> <span class="skolem">b</span> <span class="main">=</span> cbox <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> max <span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> min <span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Int_interval_cart R_def interval_cbox
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_vec_def max_def min_def if_distrib <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="main">(</span><span class="skolem">R</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">R</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> emeasure lborel <span class="main">…</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">χ</span> <span class="bound">x</span><span class="main">.</span> real_of_int <span class="main">(</span>min <span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">$</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                                  <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">x</span><span class="main">.</span> real_of_int <span class="main">(</span>max <span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">$</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> ennreal <span class="var">?P</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> emeasure_lborel_cbox_cart_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_sets_def R_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Therefore, the intersection of two lattice point cell partitionings of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> is
      also a null set.›</span>
  <span class="keyword1"><span class="command">have</span></span> T_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">T</span> <span class="skolem">b</span> <span class="main">∈</span> null_sets lebesgue"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">T</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">R</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> null_sets lebesgue"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> null_set_Int2<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> R_Int assms<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> emeasure_T_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="main">(</span><span class="skolem">T</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">T</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> T_Int<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> null_sets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹The set of lattice points $\mathbb{Z}^n$ is countably infinite, so there exists
      a bijection $f: \mathbb{N} \to \mathbb{Z}^n$. We need this for summing over all
      lattice points.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int <span class="main">^</span> <span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> from_nat_into UNIV"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span>int <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span>int <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_char_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> bij_betw_from_nat_into <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>

  <span class="comment1">― ‹Suppose all the translated cell partitions <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">T'</span></span><span class="antiquote">}</span></span> are disjoint.›</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="skolem">T'</span> <span class="bound">a</span> <span class="main">∩</span> <span class="skolem">T'</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="comment1">― ‹We know by assumption that the volume of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> is greater than 1.›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> emeasure lebesgue <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">S</span> <span class="main">=</span> emeasure lebesgue <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">T'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="comment1">― ‹The sum of the volumes of all the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">T'</span></span><span class="antiquote">}</span></span> is precisely the volume
          of their union, which is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">S</span>"</span><span class="antiquote">}</span></span>.›</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S_decompose<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_UN <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> emeasure lebesgue <span class="main">…</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_emeasure' emeasure_T_Int<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> f<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emeasure_T'<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> emeasure lebesgue <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> emeasure lebesgue <span class="main">(</span><span class="skolem">T'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> emeasure lebesgue <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">T'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> disjoint <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_emeasure<span class="main">)</span>
                          <span class="main">(</span><span class="operator">insert</span> f<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def bij_betw_def inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">― ‹On the other hand, all the translated partitions lie in the unit cell
        <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"cbox <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> <span class="main">1</span>"</span><span class="antiquote">}</span></span>, so their combined volume cannot be
        greater than 1.›</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">T'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> emeasure lebesgue <span class="main">(</span>cbox <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T'_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> emeasure_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emeasure_lborel_cbox_cart_eq<span class="main">)</span>
    <span class="comment1">― ‹This leads to a contradiction.›</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="comment1">― ‹Therefore, there exists a point that lies in two different translated partitions,
      which obviously corresponds two two points in the non-translated partitions
      whose difference is the difference between two lattice points and therefore
      has integer components.›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">T'</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">T'</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> of_int_vec <span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> of_int_vec <span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T'_def T_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Minkowski's theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Minkowski's theorem now states that, given a convex subset of $\mathbb{R}^n$ that is
  symmetric around the origin and has a volume greater than $2^n$, that set must contain
  a non-zero point with integer coordinates.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> minkowski<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> symmetric<span class="main">:</span> <span class="quoted"><span class="quoted">"uminus <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> meas_B <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> sets lebesgue"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> measure_B<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">B</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹We scale <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> with $\frac{1}{2}$.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">-`</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> meas_B' <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">using</span></span> measurable_sets<span class="main">[</span><span class="operator">OF</span> lebesgue_measurable_scaling<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span> meas_B<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B'_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">― ‹The volume of the scaled set is $2^n$ times smaller than the original set, and
      therefore still has a volume greater than 1.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> emeasure lebesgue <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">B</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> measure_B <span class="keyword2"><span class="keyword">and</span></span> real <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ennreal <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ennreal_less_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> real <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_1 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ennreal_mult' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
                       ennreal_less_iff <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ennreal_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_mult_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> emeasure lebesgue <span class="skolem">B'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B'_altdef <span class="keyword1"><span class="command">using</span></span> emeasure_lebesgue_affine<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="skolem">B'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="comment1">― ‹We apply Blichfeldt's theorem to get two points whose difference vector has
      integer coefficients. It only remains to show that that difference vector is
      itself a point in the original set.›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> blichfeldt <span class="main"><span class="main">[</span></span><span class="operator">OF</span> meas_B' *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B'_def<span class="main">)</span>
  <span class="comment1">― ‹Exploiting the symmetric of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span>, the reflection of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span>"</span><span class="antiquote">}</span></span> is
      also in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> symmetric <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹Since <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> is convex, the mid-point between <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>"</span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">-</span><span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span>"</span><span class="antiquote">}</span></span>
      is also in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span>, and that point is simply <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span>"</span><span class="antiquote">}</span></span> as desired.›</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹convex <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convexD<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xy
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If the set in question is compact, the restriction to the volume can be weakened
  to ``at least 1'' from ``greater than 1''.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> minkowski_compact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compact <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> symmetric<span class="main">:</span> <span class="quoted"><span class="quoted">"uminus <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> measure_B<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">B</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">B</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="comment1">― ‹If the volume is greater than 1, we can just apply the theorem from before.›</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> measure_B <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="free">B</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹compact <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> meas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sets_completionI_sets lborelD borel_closed compact_imp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> minkowski<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> symmetric meas less<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> that
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="comment1">― ‹If the volume is precisely one, we look at what happens when <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> is
      scaled with a factor of $1 + \varepsilon$.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ε</span><span class="main">.</span> <span class="keyword1">(*<span class="hidden">⇩</span><sub>R</sub>)</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">ε</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹compact <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> compact'<span class="main">:</span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="skolem">B'</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ε</span>
    <span class="keyword1"><span class="command">unfolding</span></span> B'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_scaling<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B'_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="skolem">ε</span> <span class="main">=</span> <span class="keyword1">(*<span class="hidden">⇩</span><sub>R</sub>)</span> <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">-`</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ε</span>
    <span class="keyword1"><span class="command">using</span></span> ε <span class="keyword1"><span class="command">unfolding</span></span> B'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">― ‹Since the scaled sets are convex, they are stable under scaling.›</span>
  <span class="keyword1"><span class="command">have</span></span> B_scale<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹convex <span class="free">B</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> symmetric <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convexD<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> scaleR_half_double<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> scaleR_half_double<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹This means that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B'</span></span><span class="antiquote">}</span></span> is monotonic.›</span>
  <span class="keyword1"><span class="command">have</span></span> B'_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="skolem">a</span> <span class="main">⊆</span> <span class="skolem">B'</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> B_scale<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹We obtain some upper bound on the norm of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹compact <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compact_imp_bounded<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹We can then bound the distance of any point in a scaled set to the original set.›</span>
  <span class="keyword1"><span class="command">have</span></span> setdist_le<span class="main">:</span> <span class="quoted"><span class="quoted">"setdist <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="free">B</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="skolem">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">ε</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"setdist <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="free">B</span> <span class="main">≤</span> dist <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> setdist_le_dist<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">ε</span> <span class="main">*</span> norm <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"setdist <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="free">B</span> <span class="main">≤</span> <span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹By applying the standard Minkowski theorem to the a scaled set, we can see that
      any scaled set contains a non-zero point with integer coordinates.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="skolem">ε</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ε</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹convex <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> convex'<span class="main">:</span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span><span class="skolem">B'</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> B'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convex_scaling<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹compact <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> meas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="skolem">ε</span> <span class="main">∈</span> sets lebesgue"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sets_completionI_sets lborelD borel_closed compact_imp_closed compact_scaling<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> symmetric <span class="keyword1"><span class="command">have</span></span> symmetric'<span class="main">:</span> <span class="quoted"><span class="quoted">"uminus <span class="main">`</span> <span class="skolem">B'</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="skolem">B'</span> <span class="skolem">ε</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B'_altdef<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ε<span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> emeasure lebesgue <span class="free">B</span> <span class="main">&lt;</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> emeasure lebesgue <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword2"><span class="keyword">and</span></span> ε <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ennreal_mult_strict_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> emeasure lebesgue <span class="main">(</span><span class="skolem">B'</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> emeasure_lebesgue_affine<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="skolem">ε</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> ε <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> measure_B'<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure lebesgue <span class="main">(</span><span class="skolem">B'</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="skolem">ε</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> minkowski<span class="main"><span class="main">[</span></span><span class="operator">OF</span> convex' symmetric' meas measure_B'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹In particular, this means we can choose some sequence tending to zero
      -- say $\frac{1}{n+1}$ -- and always find a lattice point in the scaled set.›</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">v</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">v</span> <span class="bound">n</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> choice_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">B'</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹By the Bolzano--Weierstra{\ss} theorem, there exists a convergent subsequence of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">v</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span> <span class="bound">l</span><span class="main">.</span> strict_mono <span class="main">(</span><span class="bound">h</span><span class="main">::</span>nat<span class="main">⇒</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∘</span> <span class="bound">h</span><span class="main">)</span> <span class="main">⇢</span> <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> compactD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="skolem">B'</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compact'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">v</span> <span class="main">⊆</span> <span class="skolem">B'</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B'_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span>Suc <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">n</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹Since the convergent subsequence tends to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l</span></span><span class="antiquote">}</span></span>, the distance of the
      sequence elements to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> tends to the distance of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l</span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span>.
      Furthermore, the distance of the sequence elements is bounded by $(1+\varepsilon)C$,
      which tends to 0, so the distance of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l</span></span><span class="antiquote">}</span></span> to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> must be 0.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"setdist <span class="main">{</span><span class="skolem">l</span><span class="main">}</span> <span class="free">B</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_le<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> setdist <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="free">B</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> setdist <span class="main">{</span><span class="skolem">l</span><span class="main">}</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_tendsto l continuous_at_setdist<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> inverse <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">h</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_left_zero filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_subseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
                LIMSEQ_inverse_real_of_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> setdist <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="free">B</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>
                                  <span class="main">≤</span> inverse <span class="main">(</span>real <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> setdist_le <span class="keyword2"><span class="keyword">and</span></span> v <span class="keyword1"><span class="command">unfolding</span></span> o_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually allI setdist_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"setdist <span class="main">{</span><span class="skolem">l</span><span class="main">}</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym setdist_pos_le<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹compact <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> setdist_eq_0_closed<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> compact_imp_closed<span class="main">)</span>

  <span class="comment1">― ‹It is also easy to see that, since the lattice is a closed set and all sequence
      elements lie on it, the limit <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l</span></span><span class="antiquote">}</span></span> also lies on it.›</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">l</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_sequentially<span class="main"><span class="main">[</span></span><span class="operator">OF</span> closed_lattice _ l<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>